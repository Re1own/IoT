!function(a){define(function(require,b,c){function d(){var b=this,c=[{id:"video_image",title:"med.PicAdjust",iconCls:"ui-video-icon-image",type:"Side",on:function(){j.o.imageOn()},off:function(){j.o.imageOff()}},{id:"video_original",title:"med.FullResShow",iconCls:"ui-video-icon-per",type:"Single",on:function(b){-1!==e.stream&&("Original Size"!==webApp.DisplayMode&&f.set("DHVideoWHModeOld",webApp.DisplayMode,{duration:30,path:"/"}),webApp.DisplayMode="Original Size",e.SetShowMode(0),f.set("DHVideoWHMode",webApp.DisplayMode,{duration:30,path:"/"}),j.hideItem("video_whRate"),k.find("#video_whRate").hasClass("current")&&(k.find("#video_whRate").removeClass("current"),k.find("#video_whRate").toggleClass("currentflag")),j.o.modeChange(),a(b.target).attr("title",tl("med.FullResHide")))},off:function(b){k.find("#video_whRate").hasClass("currentflag")&&(k.find("#video_whRate").toggleClass("current"),k.find("#video_whRate").removeClass("currentflag")),j.o.showWhRate&&j.hideItem("video_whRate",!1),j.toggleCurrent("video_whRate","Original Rate"===f.get("DHVideoWHModeOld")?0:1),a(b.target).attr("title",tl("med.FullResShow"))}},{id:"video_whRate",title:"com.WHRate",iconCls:"ui-video-icon-wh",type:"Sub",subElems:[{t:"med.OriginalRate",handle:function(){if(-1!==e.stream){if(webApp.DisplayMode="Original Rate",f.set("DHVideoWHMode",webApp.DisplayMode,{duration:30,path:"/"}),j.hasItem("video_triggerTrack"))if(j.o.showTrigger){var a=j.o.trackMode();e.SetShowMode(a?2:1)}else e.SetShowMode(1);e.SetShowMode(1),j.o.modeChange()}}},{t:"sys.AdaptedWindow",handle:function(){-1!==e.stream&&(webApp.DisplayMode="Adaptive Window",f.set("DHVideoWHMode",webApp.DisplayMode,{duration:30,path:"/"}),e.SetShowMode(0),j.o.modeChange(webApp.DisplayMode))}}]},{id:"video_fluency",title:"ivs.AdjustFluency",iconCls:"ui-video-icon-quality",type:"Sub",subElems:[{t:"med.RealTime",handle:function(){e.setDelayTime(0)}},{t:"com.Normal",handle:function(){e.setDelayTime(1)}},{t:"med.Fluency",handle:function(){e.setDelayTime(2)}}]}];l=a.when(e.CheckFuncSupport(2),ability.get("VideoAnalyse"),ability.get("VideoInputCapsEx"),ability.get("VideoInputCaps"),ability.get("WideViewControl"),ability.get("IVSCaps"),ability.is("DSPConflict"),ability.get("VideoInImageGird"),ability.get("RadioMetry"),ability.get("ObjectTrack"),ability.get("PanoramaDrag")).always(function(d,f,i,l,m,n,o,p,q,r,s){if(d&&c.splice(2,0,{id:"video_fullScreen",title:"med.FullscreenOpen",iconCls:"ui-video-icon-full",type:"Normal",click:function(){e.SetFullScreen()}}),f&&f.Support&&!o&&!isEnable("is_numberOK_Gate")&&c.push({id:"video_ivsRule",title:"ivs.IvsRule",iconCls:"ui-video-icon-ivs",type:"Sub",subElems:[{t:"com.StartUsing",handle:function(){e.SetIVSEnable(!0)}},{t:"com.Cdisable",handle:function(){j.hasItem("video_triggerTrack")?e.ShowRuleState(!1):e.SetIVSEnable(!1)}}]}),c.push({id:"video_ptz",title:"per.Ptz",iconCls:"ui-video-icon-ptz",type:"Side",on:function(){j.o.ptzOn()},off:function(){j.o.ptzOff()}}),(i&&i.ABFFunction.Support||l&&(l.ElectricFocus||l.SyncFocus))&&h.chkAuthority("VideoInputConfig")&&h.chkAuthority("Monitor_01")&&c.push({id:"video_zoomFocus",title:"itc.ZoomFocus",iconCls:"ui-video-icon-adjust",type:"Side",on:function(){j.o.zoomOn()},off:function(){j.o.zoomOff()}}),webCaps&&1===webCaps.is_show_AntiAlias&&c.push({id:"video_anti_aliasing",title:"com.AntiAliasing",iconCls:"ui-video-icon-antiAliasing",type:"Sub",subElems:[{t:"sys.OpenMenu",handle:function(){e.SetAntiAliasMode(1)}},{t:"com.Off",handle:function(){e.SetAntiAliasMode(0)}}]}),m&&m[0]&&m[0].Support&&h.chkAuthority("MPTZ")&&c.push({id:"video_wideview",title:"ivs.WideView",iconCls:"ui-video-icon-wideview",type:"Single",on:function(a){j.o.wideviewOn(a)},off:function(a){j.o.wideviewOff(a)}}),!webApp.IsSDIntel&&n){var t=n.SupportedScenes||[],u=!1;a.each(t,function(b,d){if(u)return!1;var e=d.SupportedRules||[];a.each(e,function(a,b){return b.TriggerTrack?(c.push({id:"video_triggerTrack",title:"ivs.TriggerTrack",iconCls:"ui-video-icon-triggerTrack",type:"Side",on:function(){j.o.trackOn()},off:function(){j.o.trackOff()}}),u=!0,!1):void 0})})}if(l&&l.FishEye&&h.chkAuthority("VideoInputConfig")&&c.push({id:"video_fisheye",title:"FishEye",iconCls:"ui-video-icon-fish",type:"Side",on:function(){j.o.fishEyeOn()},off:function(){j.o.fishEyeOff()}}),n){var v=-1!==a.inArray("FaceAnalysis",n.SupportedScene),w=-1!==a.inArray("FaceDetection",n.SupportedScene)&&n.SupportedScenes.FaceDetection.SupportedRules.FaceDetection.FeatureSupport;o||((v||w)&&c.push({id:"video_face",title:"ivs.Face",iconCls:"ui-video-icon-face",type:"Side",on:function(){j.o.faceOn()},off:function(){j.o.faceOff()}}),webApp.IsIPCIntel&&-1!==a.inArray("Gate",n.SupportedScene)&&c.push({id:"video_traffic",title:"TrafficJunction",iconCls:"ui-video-icon-divide",type:"Side",on:function(){j.o.trafficOn()},off:function(){j.o.trafficOff()}}),-1!==a.inArray("ObjectDetect",n.SupportedScene)&&c.push({id:"video_object",title:"ivs.VideoStructrue",iconCls:"ui-video-icon-object1",type:"Side",on:function(){j.o.objectOn()},off:function(){j.o.objectOff()}}))}r&&c.push({id:"video_triggerVRTrack",title:"ivs.TriggerTrack",iconCls:"ui-video-icon-triggerVRTrack",type:"Side",on:function(){j.o.VRtrackOn()},off:function(){j.o.VRtrackOff()}}),s&&(webApp.isSupportPanoramaDrag=s.Support),c.push({id:"video_svac",title:"med.SVAC",iconCls:"ui-video-icon-svc",type:"Sub",subElems:[{t:"ivs.BaseLevel",handle:function(){e.ChooseFrame(0)}},{t:"ivs.EnhancementLevel",handle:function(){e.ChooseFrame(1)}}]}),-1!==webApp.DeviceType.indexOf("TPC")&&(c.push({id:"video_rayright",title:"com.RayRight",iconCls:"ui-video-icon-ray",type:"Single",on:function(){e.ActiveCrossLocation(!0),j.o.crossLocationOn()},off:function(){e.ActiveCrossLocation(!1),j.o.crossLocationOff()}}),q&&q.Support&&c.push({id:"video_report",title:"com.TemperReport",iconCls:"ui-video-icon-report",type:"Single",on:function(){j.o.reportOn()},off:function(){j.o.reportOff()}}),webApp.isFixFocusDoubleThermal||c.push({id:"video_adjust",title:"itc.ZoomFocus",iconCls:"ui-video-icon-adjust",type:"Side",on:function(){j.o.adjustOn()},off:function(){j.o.adjustOff()}}),isEnable("is_show_vehicleDivide")&&c.push({id:"video_divide",title:"com.DivideEnable",iconCls:"ui-video-icon-divide",type:"Single",on:function(){j.o.divideOn()},off:function(){j.o.divideOff()}})),a.each(c,function(c,d){var e=a('<div class="ui-video-iconbar"></div>'),f=a('<a href="javascript:;" class="ui-video-icon" itemtype='+d.type+" id="+d.id+"><i></i></a>");d.title&&f.attr("t","title::"+d.title),d.iconCls&&f.children("i").addClass(d.iconCls),k.append(e.append(f));var g="_init"+d.type;a.isFunction(b[g])&&b[g](d,f)}),k.translation(),j.toggleCurrent("video_fluency",1),j.toggleCurrent("video_svac",0),webCaps&&1===webCaps.is_show_AntiAlias&&j.toggleCurrent("video_anti_aliasing",1),f&&f.Support&&j.toggleCurrent("video_ivsRule",0),l&&l.FishEye&&!h.chkAuthority("VideoInputConfig")&&g.ConfigManager.getConfig("FishEye").done(function(a){var b=a[0]||{};"Original"!=b.CalibrateMode&&k.find("#video_ivsRule").parent().remove()}),"h5"===webApp.playMode&&(k.find("#video_ivsRule").parent().remove(),k.find("#video_fisheye").parent().remove())})}var e=require("../plugin"),f=require("common/common").Cookie,g=require("../rpc"),h=require("../rpcLogin"),i={showWhRate:!0,showImage:!0,showPtz:!1,showRayRight:!1,showTemperReport:!1,showTrigger:!0,showVRTrigger:!0,showFishEye:!1,showAdjust:!1,imageOn:a.noop,imageOff:a.noop,ptzOn:a.noop,ptzOff:a.noop,modeChange:a.noop,zoomOn:a.noop,zoomOff:a.noop,wideviewOn:a.noop,wideviewOff:a.noop,trackOn:a.noop,trackOff:a.noop,VRtrackOn:a.noop,VRtrackOff:a.noop,crossLocationOn:a.noop,crossLocationOff:a.noop,fishEyeOn:a.noop,fishEyeOff:a.noop,reportOn:a.noop,reportOff:a.noop,adjustOn:a.noop,adjustOff:a.noop,girdOn:a.noop,girdOff:a.noop,divideOn:a.noop,divideOnOff:a.noop,trafficOn:a.noop,trafficOff:a.noop,objectOn:a.noop,objectOff:a.noop},j=null,k=a("<div></div>"),l=null;a.fn.videoBar=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){if(!("string"!==a.type(b)||j&&a.isFunction(j[b])))return!1;if("string"===a.type(b)){var f=j[b].apply(a(this),c);if(void 0!==f)return e=f,!1}else"string"===a.type(b)||j||(j=new d)}),e},d.prototype.render=function(b){j.o=a.extend({},i,b),this.append(k),j.hideItem("video_image",j.o.showImage===!1),j.hideItem("video_ptz",j.o.showPtz===!1),j.hideItem("video_rayright",j.o.showRayRight===!1),j.hideItem("video_report",j.o.showTemperReport===!1),j.hideItem("video_triggerTrack",j.o.showTrigger===!1),j.hideItem("video_triggerVRTrack",j.o.showVRTrigger===!1),j.hideItem("video_fisheye",j.o.showFishEye===!1),j.hideItem("video_whRate",j.o.showWhRate===!1),j.hideItem("video_zoomFocus",j.o.showZoomFocus===!1),j.hideItem("video_original",j.o.showOriginal===!1),j.hideItem("video_fluency",j.o.showFluency===!1),j.hideItem("video_fullScreen",j.o.showFullScreeny===!1),j.hideItem("video_adjust",j.o.showAdjust===!1),j.hideItem("video_gird",j.o.showImageGird===!1),j.hideItem("video_divide",j.o.showDivideEnable===!1),j.hideItem("video_face",j.o.showFace===!1),j.hideItem("video_traffic",j.o.showTraffic===!1),j.hideItem("video_object",j.o.showObject===!1)},d.prototype.destroy=function(){j=null,k.empty()},d.prototype.hideItem=function(a,b){l.always(function(){var c=k.find("#"+a);b===!1?c.show().hasClass("current")&&c.next(".ui-video-wrap").show():c.hide().hasClass("current")&&c.next(".ui-video-wrap").hide()})},d.prototype.toggleCurrent=function(a,b){l.always(function(){var c=k.find("#"+a);void 0===b?c.click():c.next(".ui-video-wrap").find(".ui-video-wrap-item:eq("+b+")").click()})},d.prototype.isCurrent=function(a,b){var c=k.find("#"+a);return void 0===b?c.hasClass("current"):c.next(".ui-video-wrap").find(".ui-video-wrap-item:eq("+b+")").hasClass("current")},d.prototype.hasItem=function(a){var b=k.find("#"+a);return b.length},d.prototype._initSide=function(b,c){c.on("click",function(d){return c.hasClass("current")?(c.removeClass("current"),a(b.target).hide(),b.off(d)):(k.find(".ui-video-icon.current[itemtype="+c.attr("itemtype")+"]").click(),c.addClass("current"),a(b.target).show(),b.on(d))})},d.prototype._initNormal=function(a,b){b.on("click",function(b){return a.click(b)})},d.prototype._initSingle=function(a,b){b.on("click",function(c){return b.hasClass("current")?(b.removeClass("current"),a.off(c)):(b.addClass("current"),a.on(c))})},d.prototype._initSub=function(b,c){var d=a('<div class="ui-video-wrap"></div>');a.each(b.subElems,function(b,e){var f=a('<a href="javascript:;" class="ui-video-wrap-item"><i class="ui-video-wrap-icon"></i><label t="'+e.t+'"></label></a>').on("click",function(b){d.find(".ui-video-wrap-item").removeClass("current"),k.find(b.currentTarget).addClass("current"),a.isFunction(e.handle)&&e.handle(),c.trigger("click",[b.isTrigger])});d.append(f)}),c.parent().append(d),c.on("click",function(a,b){return b?!1:(c.hasClass("current")||k.find(".ui-video-icon.current[itemtype="+c.attr("itemtype")+"]").click(),c.toggleClass("current"),void d.toggle())})},c.exports=d})}(jQuery);