!function(a){define(function(require,b,c){function d(b,c){var d=this;d.options=a.extend({},h,c),d.e=a(b).empty().append(g).translation(),d.init()}var e=require("../plugin"),f=require("../rpc"),g=require("./faceFeature.html");require("widget/js/dui.scroll");var h=null;a.fn.faceFeature=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("faceFeature");if(g||f.data("faceFeature",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(){var b=this;b.hasInfo=!1,b.curPicNum=0,b.$picList=b.$("#face_Feature"),e.addEvent("FDPictureUrl",function(a){b.hasInfo||(b.$("#face_Feature").show(),b.$(".face-none").hide(),b.hasInfo=!0),++b.curPicNum>1e3&&(b.$picList.find("li:last").remove(),b.curPicNum--),a=JSON.parse(a),b.addFeature(a)}),b.$(".face").scroll({scrollYEnable:!0,contentWrap:".face-pic",content:"#face_Feature",yBar:".face-scrollY",actionList:{y:".face-dragY"}}),b.$faceDialog=b.$("#faceFeature_dialog").dialog({close:function(){e.cover(b.options.video),webApp.hide_by_dialog=!1}}).detach().appendTo(document.body),ability.get("IVSCaps").done(function(c){var d="FaceDetection";-1!==a.inArray("FaceAnalysis",c.SupportedScene)&&(d="FaceAnalysis");var e=c.SupportedScenes[d].SupportedRules;b.featureList=e[d].FeatureList;var f="";a.each(b.featureList,function(a,b){f+='<li><span t="'+b+'+:"></span><span key='+b+"></span></li>"}),b.$faceDialog.find(".face_attr ul").empty().html(f).translation()}),b.$("#face_Feature").delegate("li","click",function(){webApp.hide_by_dialog=!0,e.hide();var c=a(this).data("info")||{};b.showInfo(c),b.$faceDialog.dialog("show"),a(".u-mask").on("mousedown.face",function(a){a.stopPropagation()})}),b.e.on("mousedown",function(a){a.stopPropagation()}),b.$faceDialog.on("mousedown",function(a){a.stopPropagation()}),b.featureEnable={}},d.prototype.render=function(){var b=this;f.ConfigManager.getConfig("VideoAnalyseRule").done(function(c){a.each(c[e.channel],function(c,d){if("FaceDetection"===d.Type||"FaceAnalysis"===d.Type){var e=d.Config.FeatureList||[];b.featureEnable={},a.each(b.featureList,function(a,c){-1===e.indexOf(c)&&(b.featureEnable[c]="Unknown")})}})})},d.prototype.showInfo=function(b){var c=this;c.$faceDialog.find("#attrImg").prop("src",b.url),c.$faceDialog.find("[key]").each(function(){var c=a(this).attr("key");"Nation"===c&&("com.Yes"===b[c]?b[c]="维族":"com.No"===b[c]?b[c]="其他":"com.Yes"!==b[c]&&"com.No"!==b[c]&&"维族"!==b[c]&&"其他"!==b[c]&&(b[c]="未知")),a(this).html(tl(b[c])||"--")})},d.prototype.resize=function(){var a=this;a.$(".face").scroll("resize")},d.prototype.addFeature=function(b){var c=this;a.extend(b,c.featureEnable);var d=a("<li></li>");d.data("info",b);var e="",f=b.Sex.replace("Unknown","Sex"),g=b.Emotion.replace("Unknown","Emotion"),h=b.Glasses.replace("Unknown","Glasses");e+='<img src="'+b.url+'"/><div class="face-detail"><span class="'+b.Sex+'" t="'+f+";title::"+f+'"></span>',e+="Unknown"===b.Age?'<span class="Unknown" t="Age">'+tl("Age")+"</span>":'<span class="Age"><b>'+b.Age+'</b><a href="javascript:; t="Age">'+tl("Age")+"</a></span>",e+='<span class="'+b.Emotion+'" t="'+g+";title::"+g+'"></span><span class="'+b.Glasses+'" t="'+h+";title::"+h+'"></span></div><div class="face-info"><span class="fn-right">'+b.Time+"</span></div>",d.html(e).translation(),c.$("#face_Feature").prepend(d),c.resize()},d.prototype.destroy=function(){var a=this;a.hasInfo=!1,a.curPicNum=0,a.$("#face_Feature").empty().hide(),a.$(".face-none").show(),e.StopRecvFacePic(),e.StopHttpServer()},d.prototype.$=function(a){return this.e.find(a)},c.exports=d})}(jQuery);