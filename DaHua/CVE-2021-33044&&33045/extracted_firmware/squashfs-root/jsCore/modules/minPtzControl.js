!function(a){define(function(require,b,c){function d(b){var c=this;c.e=a(b).empty().append(h).translation()}function e(){var b=0,c=!1,d=!1;return a.when(f.get("LensControl"),f.get("LensControlMix"),f.get("smallPtz"),f.get("ZoomThermal"),f.get("FocusThermal")).then(function(a,e,f,g,h){return a?b=1:f&&f.Support?b=3:e&&e.Support&&(b=2),g&&g.Support&&(c=!0),h&&h.Support&&(d=!0),[b,c,d]})}var f=require("../ability"),g=require("../rpc"),h=require("./minPtzControl.html");a.fn.minPtzControl=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("minPtzControl");if(g||f.data("minPtzControl",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(b){var c=this;c.options=a.extend({},b),c.zoomState=!1,e().done(function(a){c.type=a[0],c.zoomThermal=a[1],c.focusThermal=a[2]}),c.$("a[boatCmd]").mousedown(function(a){var b=c.$(a.target).addClass("mouse-down");return g.PTZ.start(b.attr("boatCmd"),c.$("#mptz_step").val()-0||5,0,0),!1}).mouseup(function(a){var b=c.$(a.target).removeClass("mouse-down");return g.PTZ.stop(b.attr("boatCmd"),c.$("#mptz_step").val()-0||5,0,0),!1}).mouseover(function(a){var b=c.$(a.target);return b.parent().addClass("ui-boat-current-"+b.attr("boatCmd").toLowerCase()),!1}).mouseout(function(a){var b=c.$(a.target),d=b.attr("boatCmd");return b.parent().removeClass("ui-boat-current-"+d.toLowerCase()),b.hasClass("mouse-down")?(b.removeClass("mouse-down"),g.PTZ.stop(d,c.$("#mptz_step").val()-0||5,0,0),!1):!1}),c.$("a[cmd]").on("mousedown",function(b){var d=c.$(b.currentTarget),e=c.$("#mptz_step").val()-0||5,f=0,h=d.attr("cmd"),i=!0,j=0,k=0,l=0,m=0,n=!1,o=!1,p={ZoomWide:[-1,-.5],ZoomTele:[-1,.5],FocusFar:[-.5,-1],FocusNear:[.5,-1]},q=null;if(-1!==webApp.DeviceType.indexOf("TPC")&&((2===c.type||3===c.type)&&plugin.windowId||1===c.type?o=!0:c.focusThermal&&-1!==webApp.DeviceType.indexOf("SD")&&plugin.windowId?o=!0:-1===webApp.DeviceType.indexOf("SD")&&(o=!0)),c.zoomState=!0,o)if(-1!==a.inArray(h,["ZoomWide","ZoomTele","FocusFar","FocusNear"]))i=!1,n=!1,k=p[h][0],j=p[h][1],l=-1===k?-1:0,m=-1===j?-1:0,-1===webApp.DeviceType.indexOf("SD")?g.DevVideoInput.adjustFocusContinuously(k,j,plugin.windowId):setTimeout(function(){i?(q=g.DevVideoInput.adjustFocus(k,j,plugin.windowId),q.done(function(){g.DevVideoInput.adjustFocus(l,m,plugin.windowId)}),n=!0):(q=g.DevVideoInput.adjustFocusContinuously(k,j,plugin.windowId),n=!0)},200);else if(-1!==a.inArray(h,["IrisSmall","IrisLarge"])){var r="IrisLarge"===h?1:-1;q=g.DevVideoInput.adjustIris(r,plugin.windowId)}else q=g.PTZ.start(h,e,f,0);else q=g.PTZ.start(h,e,f,0);d.on("mouseup mouseout",function(){i=!0,d.off("mouseup mouseout"),o?-1!==a.inArray(h,["ZoomWide","ZoomTele","FocusFar","FocusNear"])?-1===webApp.DeviceType.indexOf("SD")?g.DevVideoInput.adjustFocusContinuously(l,m,plugin.windowId):n&&g.DevVideoInput.adjustFocusContinuously(l,m,plugin.windowId):-1!==a.inArray(h,["IrisSmall","IrisLarge"])?g.DevVideoInput.adjustIris(0,plugin.windowId):q.done(function(){g.PTZ.stop(h,e,f,0)}):q.done(function(){g.PTZ.stop(h,e,f,0)})})}),f.get("PTZCaps").done(function(a){a&&((-1===webApp.DeviceType.indexOf("TPC")||1===webApp.CamType||webApp.isFixFocusDoubleThermal)&&(a.Zoom===!1&&c.$("#mptz_zoom_wrap").remove(),a.Focus===!1&&c.$("#mptz_focus_wrap").remove()),a.Iris===!1&&c.$("#mptz_iris_wrap").remove(),a.PTZCtrl&&a.PTZCtrl.PTStep===!1&&c.$("#miniPtzStep").remove())}),-1!==webApp.DeviceType.indexOf("SD")||-1!==webApp.DeviceType.indexOf("TPC")||webApp.HasPtz&&webApp.isSpecialPtz?-1!==webApp.DeviceType.indexOf("SD_CA_ICT")?c.$("#miniPtzBoat,#miniPtzStep").css("visibility","hidden"):-1!==webApp.DeviceType.indexOf("TPC")&&(1===webApp.CHANNEL_NUMBER&&-1===webApp.DeviceType.indexOf("SD")?c.$("#miniPtzBoat,#miniPtzStep,#miniPtzAdjust").css("visibility","hidden"):webApp.CHANNEL_NUMBER>1&&-1===webApp.DeviceType.indexOf("SD")&&c.$("#miniPtzBoat,#miniPtzStep").css("visibility","hidden")):c.$("#miniPtzBoat,#miniPtzStep,#miniPtzAdjust").css("visibility","hidden")},d.prototype.$=function(a){return this.e.find(a)},d.prototype.changeChannel=function(a){var b=this;webApp.CHANNEL_NUMBER>1?a?(b.$("#mptz_iris_wrap").hide(),b.$("#mptz_zoom_wrap").toggle(b.zoomThermal),b.$("#mptz_focus_wrap").toggle(b.focusThermal)):b.$("#mptz_zoom_wrap,#mptz_focus_wrap,#mptz_iris_wrap").show():(b.$("#mptz_zoom_wrap").toggle(b.zoomThermal),b.$("#mptz_focus_wrap").toggle(b.focusThermal))},d.prototype.togglePTZ=function(a){var b=this;b.$("#miniPtzBoat,#miniPtzStep,#miniPtzAdjust").toggle(!!a)},d.prototype.attrState=function(a){var b=this;return void 0===a?b.zoomState:void(b.zoomState=a)},c.exports=d})}(jQuery);