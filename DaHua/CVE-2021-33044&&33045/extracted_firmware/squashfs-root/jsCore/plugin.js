!function(a){define(function(require,b,c){function d(b){a.each(C,function(a,c){b!==c&&s.state(c)&&s.state(c,!1)})}function e(){return o.ConfigManager.getConfig("RTSP").done(function(a){var b="rtsp://"+s.ip+":"+a.Port+"/cam/realmonitor?channel="+(s.channel+1)+"&subtype="+(s.stream-1);t.html('<div style="position:absolute;left:0; top:0; bottom:32px; width:100%;">                                <div id="qt" style="position:absolute;left:0;top:0;width:100%;height:100%;">                                    <embed src="../js/sample.mov" qtsrc="'+b+'" width="100%" height="100%" SCALE="ToFit" autoplay="true" loop="false" controller="false" wmode="transparent" type="video/quicktime">                                    </embed>                                    <div id="overShadow" style="width:100%;height:100%;-moz-opacity:.01;opacity:.01;filter:alpha(opacity=1);position:absolute;z-index:1000;top:0;left:0;" oncontextmenu="return false">                                    </div>                                </div>                            </div>                            <div class="download-plugin" style="bottom:0;top:auto;height:32px;">                                <a href="'+A+'" target="_download">                                    <span class="download-plugin-icon"></span>                                    <span t="com.NoPluginTip"></span>                                </a>                            </div>').translation()})}function f(){return o.ConfigManager.getConfig("RTSP").done(function(a){var b=r.getLoginInfo(),c="rtsp://"+b.username+":"+b.password+"@"+s.ip+":"+a.Port+"/cam/realmonitor?channel="+(s.channel+1)+"&subtype="+(s.stream-1);t.html('<div style="position:absolute;left:0; top:0; bottom:32px; width:100%;">                                <object id="qt" classid="clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921" style="position:absolute;left:0;top:0;width:100%;height:100%;">                                    <embed src="'+c+'" width="100%" height="100%" type="application/x-vlc-plugin">                                    </embed>                                </object>                            </div>                            <div class="download-plugin" style="bottom:0;top:auto;height:32px;">                                <a href="'+A+'" target="_download">                                    <span class="download-plugin-icon"></span>                                    <span t="com.NoPluginTip"></span>                                </a>                            </div>').translation()})}function g(){var b=!1;if(a.browser.ie&&a.browser.version<11)try{new ActiveXObject("QuickTime.QuickTime"),b=!0}catch(c){}else{navigator.plugins.refresh(!1);for(var d=0;d<navigator.plugins.length;d++)navigator.plugins[d].name.indexOf("QuickTime")>=0&&(b=!0)}return b}function h(){var b=!1;if(a.browser.ie);else{navigator.plugins.refresh(!1);for(var c=0;c<navigator.plugins.length;c++)navigator.plugins[c].name.indexOf("VLC")>=0&&(b=!0)}return b}function i(b,c,d){var e=o.getSession(),f=null;return"SetModuleMode"===b&&(i("ShowToolbar",["visible"],[0===d[0]]),3===d[0]?i("SetWindowText",["winID","text"],[0,""]):i("SetWindowText",["winID","text"],[0,r.chkAuthority("Monitor_01")?"":tl("com.NoVideoAuthoityTip")])),c&&d&&c.length>=d.length&&(f={},a.each(d,function(a,b){f[c[a]]=b})),F[e]||(F={},E=1,F[e]={}),a.Deferred(function(a){var c=E++;F[e][c]=a,w.postMessage({method:b,params:f,id:c},"*")}).promise()}function j(a){var b=JSON.parse(a.data),c=b.id,d=b.event,e=o.getSession();return c||"close"!==d&&"reload"!==d?!c&&d?s.fireEvent(d,b.params):void(F[e]&&F[e][c]&&F[e][c].resolve(b.result)):(r.logout(),s.logout(),void window.removeEventListener("message",m,!1))}function k(){var a=location.hostname;return/:/.test(a)?/\[|\]/.test(a)?a:"["+a+"]":a}function l(){var b=location.port-0;if("http:"===location.protocol.toLowerCase())return b||80;var c=window.webCaps||{},d=c.HttpPort,e=c.HttpsPort,f=[];return c.eth0&&(f.push(c.eth0.IPAddress),f.push(p.v6ToCanonicalForm(c.eth0.IPv6Address))),c.eth2&&(f.push(c.eth2.IPAddress),f.push(p.v6ToCanonicalForm(c.eth2.IPv6Address))),b=b||443,!e&&d?b=d.InnerPort:d&&e.InnerPort&&(e.InnerPort!=e.OuterPort?b=b==e.InnerPort?d.InnerPort:d.OuterPort:s.ConvertDomainToIP(k()).done(function(c){c=c.replace(/\[|\]/g,""),p.Check.ipv6(c)&&(c=p.v6ToCanonicalForm(c)),b=-1!==a.inArray(c,f)?d.InnerPort:d.OuterPort})),b}function m(a){return"domready"==a.data?(w=a.source,a.source.postMessage("domready","*"),s.type="nacl",t.hide(),void x.resolve()):void j(a)}function n(){a.when(ability.get("IVSCaps"),ability.is("DSPConflict")).done(function(b,c){if(b&&!c){var d=-1!==a.inArray("FaceDetection",b.SupportedScene)&&b.SupportedScenes.FaceDetection.SupportedRules.FaceDetection.FeatureSupport;d=d||-1!==a.inArray("FaceAnalysis",b.SupportedScene)||-1!==a.inArray("Gate",b.SupportedScene)||-1!==a.inArray("ObjectDetect",b.SupportedScene),d&&(s.StartHttpServer(),s.StartRecvFacePic())}}),s.LoadFisheyeModule(),o.DevVideoEncode.getCaps().done(function(a){2===a.EncryptMask&&o.ConfigManager.getConfig("NetSerEncrypt").done(function(a){var b=a[s.channel][0],c=b.Address||b.BakAddress,d=(b.Port||b.BakPort)-0,e=b.NetID;s.SetDecodeKeyEx(0,c,d,e,"")})})}var o=require("jsCore/rpc"),p=require("common/common"),q=p.Cookie,r=require("jsCore/rpcLogin"),s=c.exports={ip:k(),port:l(),channel:0,stream:1,socket:0,type:"",window:1,windowId:0,containerId:null,shapeId:null},t=null,u=null,v=null,w=null,x=a.Deferred(),y={},z={LiveSnapshot:1,LiveRecord:2,PlaybackSnapshot:3,PlaybackRecord:4,VideoClips:5,HeatMap:6,AroudWifiSearch:7,PlaybackDownload:8},A=function(){return a.browser.chrome&&a.browser.version>41&&-1===webCaps.deviceType.indexOf("TPC")?"https://chrome.google.com/webstore/detail/nacl-web-plug-in/pbdcmagkbhnjpjlnpibbmggikpedpilc":a.browser.Platform.win?"/webplugin.exe":a.browser.Platform.mac?"/webplugin.pkg":"/webplugin.tar.bz2"}(),B={dualAudioEnable1:null,dualAudioEnable14:null,dualAudioEnable15:null,recordVideo:null,partialEnlarged:null,activeLocalFocus:null,activeZoneExpose:null,cutResolute:null,activePTZLocate:null,controlTalking:null,enableMousePtz:null,setAFEnable:null,activeManualLocate:null,recordAllVideo:null,activeMeasureDistance:null,messageMarkDuckClick:null,changeZoomEvidence:null,highSkyEyes:null},C=["partialEnlarged","activeLocalFocus","activeZoneExpose","cutResolute","activePTZLocate","activeManualLocate","cutResolute","activeMeasureDistance","messageMarkDuckClick","enableMousePtz","changeZoomEvidence","highSkyEyes"];!function(){function b(){var b=!1,d="",e="",f=null,g=!1;if(a.browser.Platform.win?d=webCaps.PluginVersion:a.browser.Platform.mac&&(d=webCaps.MacPluginVersion),a.browser.ie){try{f=new ActiveXObject(o);try{e=f.GetVersion(),g=c(e,d),g||(b=!0,f.DestoryATLThread(),f=null)}catch(h){}f=null}catch(h){return!1}return b?!1:!0}if(a.browser.chrome&&a.browser.version>41&&-1===webCaps.deviceType.indexOf("TPC"))return!1;navigator.plugins.refresh(!1),f=navigator.mimeTypes[k+n];try{if(e=f.enabledPlugin.description.split("-")[2],g=c(e,d),!g)return!1}catch(h){}return!(!f||!f.enabledPlugin)}function c(a,b){try{if(a=a.split("."),b=b.split("."),b[3]&&a[3]){var c=parseInt(b[2]-0,10).toString(2),d=parseInt(a[2]-0,10).toString(2),e=c.length,f=d.length,g=!1;if(f>=e)for(var h=d.substring(f-e,f),i=0;e>i;i++)c.charAt(i)>h.charAt(i)&&(g=!0);if(b[3]>a[3]||e>f||g)return!1}}catch(j){}return!0}function d(){function b(){try{v.AddEventListener("ThisIsForTestPluginInit",a.noop),a.each(f,function(b){s.AddEventListener(b,function(){-1!==a.inArray(b,j)&&window.isPSS||a.isFunction(y[b])&&y[b].apply(null,arguments)})}),s.RegisterTranslateFunc(tl),s.type="general",x.resolve()}catch(c){setTimeout(b,10)}}if(a.browser.ie){var c=l+n.replace(/\./g,"");-1!==webApp.DeviceType.indexOf("TPC")&&(c=l),webCaps.MimeType&&(c=webCaps.Classid),t.html('<object id="ocx" width="100%" height="100%" classid="CLSID:'+c+'">                                 <param name="lVideoWindNum" value="1">                                 <param name="VideoWindBarColor" value="414141">                                 <param name="VideoWindTextColor" value="9c9c9c">                               </object>'),v=-1!==webApp.DeviceType.indexOf("TPC")?t.find("#ocx")[0].CreatePlugin():t.find("#ocx")[0]}else t.html('<embed id="ocx" width="100%" height="100%" type='+(k+n)+'                                 VideoWindTextColor="9c9c9c"                                 VideoWindBarColor="414141">                               </embed>'),v=t.find("#ocx")[0];b()}var e={AddEventListener:null,LogoutDevice:null,LoginDevice:["ip","port","username","password"],GetConfigPath:["type"],SetConfigPath:["type","path"],GetDefaultConfigPath:["type"],ConnectRealVideo:["channel","streamType","socketType"],SetSocketType:["socketType"],SetStreamType:["streamType"],DisConnectRealVideo:["channel"],SetModuleMode:["nMode"],SetConfig:["name","value"],RegisterTranslateFunc:null,SetShowMode:["nMode"],SetDeviceMode:null,OpenAudioFile:["fileName"],SetFilename:null,ReadFile:["path"],WriteFile:["buffer","mode","path"],ShowFileBrowse:null,ShowSaveOrOpenDlg:["type","suggestedName","accepts"],ReadBase64Data:["path","nmaxlen"],WriteBase64Data:["path","data","mode"],MakeReport:null,SetIVSEnable:["enable"],ResumePlayBack:["playerId"],SlowPlayBack:["playerId"],FastPlayBack:["playerId"],PausePlayBack:["playerId"],StopDownload:["saveName"],DownloadByFile:["fileInfo","path","saveName"],DownloadByFileEx:["fileInfo","path","saveName"],DownloadByTime:["fileInfo","startTime","endTime","path","saveName"],StopPlayBack:["playerId"],PlaySetVolume:["playerId","volume"],ControlVideoStable:null,SetRegionNum:["regionNum"],SetSelRegionByIndex:["regNoID","left","top","right","bottom"],SetFullScreen:null,SetRegionAttributeByIndex:["regNoID","tip","mode","reserved1","reserved2","reserved3"],DelSelReg:["mode"],SetCurrentDrawId:["nID"],SetFuntionInfo:["strFunction","strInfo"],SetGridNum:["nRow","nCol"],AddShape:null,SetCurShape:null,SetCurPtzID:null,DeleteShape:null,SetObjectConfig:null,SetIVSConfig:null,SetCurModule:null,AddDetectionRegion:null,AddExcludeRegion:null,DelExcludeRegion:null,SetCurName:null,SelectRule:null,CreateHeatMap:["begintime","endtime"],CreateHeatMapEx:null,EnableHeatMap:["enable"],SubVideoWndCtrl:null,SetMaxPntNum:null,GetLength:null,SetCalibrateAndRules:null,PlaybackByFile:["fileInfo","playerId","channel","locateTime"],PlayBackByTime:["fileInfo","startTime","endTime","seektime"],PlayOpenSound:["playerId"],PlayStopSound:["playerId"],PlayPreFrame:["playerId"],SetColor:["regionNum","brightness","contrast","saturation","hue"],SetAFEnable:["enable"],SetDelayTime:["level"],SetDelayTimeEx:["delayTime","threadShold"],ControlTalking:["sampleRate","depth","encodeType","enable"],PartialEnlarged:["enable"],ActiveLocalFocus:["enable"],ActiveZoneExpose:["enable"],ActivePTZLocate:["enable"],ActiveManualLocate:["enable"],ConvertDomainToIP:["domainName"],DualAudioEnable:["channel","enable"],RecordVideo:["path","type","enable"],CatchPicture:["format","path"],CatchPictures:["format","path"],LoginWideView:null,ShowWideView:null,LogoutWideView:null,ShowToolbar:["visible"],RemoveMonDetectReg:null,RemoveAllMonDetectReg:null,SetTranslateString:["language"],SetMonitorEnable:["channel","enable"],OpenHelp:["src","state"],Reload:["href"],CheckFuncSupport:["funcType"],SetProductType:["szMode"],SetMouseDrawEnable:null,SetMouseDrawPen:null,SetVideoWndNum:["num"],EnableMousePtz:["enable"],ConnectAudioPath:null,EnableVideoAnalyseModule:["enable"],CreateMainVideoAnalyseShape:["containerID","winID","evnetName","mainShapeName","markedName","data","param"],GetVideoAnalyseShapeConfigData:["containerID","shapeID"],DeleteAllVideoAnalyseShape:["containerID"],DeleteAllContainers:null,ShowIVSTrack:null,ShowRuleState:null,SetShowMultiScreenMode:["mode"],SetTrackMode:["mode"],SetRuleTrackAlarm:null,SetTrackTimeout:null,SetDecodeKey:["key"],ChooseFrame:["frameID"],SetDecodeKeyEx:null,SetTalkFromDeviceEnable:["enable"],FaceShowMode:["enable"],SetVideoWndTip:["channel","tip"],SetVisibleVideoWnd:["windows","begin"],ConnectRealVideoEx:["curWindow","channel","streamType"],ConnectAllChannel:["channel","streamType"],SetIVSDrawingEnable:["enable"],ClearAllOpData:null,SetCalibrationRange:["CalibrationRange"],SetCalibrationEnable:["channel","enable"],SetCalibrationData:["CalibrationData"],CreateOneIntelShapeContainer:["ID",""],DeleteAllIntelShape:["id"],SelectOneIntelShape:["shapeId","enable"],DeleteOneIntelShape:["shapeId"],GetIntelShapeData:["shapeId"],CreateOneIntelShape:["id","ReSpot","VideoAnalyzeConfig","Spot","name","data",""],SetOneIntelShapeThickness:["shapeId","1/2"],SetOneIntelShapeDisplayColor:["shapeId","normal","R","G","B"],SetOneIntelShapeVisible:["shapeId","enable"],SnatchAtHeatmapData:null,SetCGISessionID:null,ActiveCrossLocation:["bool"],ResetOneIntelShapeData:["data"],DisConnectAllChannel:null,RecordAllVideo:["enable"],SetCalWndSize:null,SetFullScreenMode:["mode"],RegionClip:["Width","Height","Left","Top","Right","Bottom"],CutResolute:null,LoadFisheyeModule:null,ControlFe:["enable"],SetFeInstallMode:["mode"],SetFeShowMode:["mode"],SetFisheyeParamsEx:["index","nx","ny","hangle","vangle","mode"],ActiveMeasureDistance:["enable"],SetJoinVideoNum:["lensType","num"],CatchSingleJoinPic:["index"],StartMultiVideoJoin:null,GetLocalRecordFileList:null,StopAllPlayBack:null,SetIntelShapeDirection:null,RemoveOneIntelShapeContainer:null,AddOneSubIntelShape:["id","filterBoxID","RectangleShape","eventID","shapeID","","shapeData",""],ZoomActive:["id","enable"],SetBprManualConfig:["BadPoints"],SetOneBprManualEnable:["id","enable"],ClearAllBprManualData:null,ClearBprManualDataByID:["id"],BprManualZoomActive:["enable"],GetBackupGainMap:["channel"],SelectOneBprManual:["id"],RequestOneCGIInteraction:["url","filename","event"],PostOneHttpRequest:["url","filename","type","session","event"],CreateVideoAnalyseContainer:null,EnableVideoAnalyseContainer:["containerID","flag"],SetVideoAnalyseContainerTip:["containerID","winID","tip"],AddVideoAnalyseShape:["containerID","shapeID","shapeName","shapData","param"],DeleteVideoAnalyseShape:["containerID","shapeID"],ShowVideoAnalyseShape:["containerID","shapeID","flag"],SetVideoAnalyseShapeColor:["containerID","shapeID","red","green","blue","sel"],SetVideoAnalyseShapeShowName:["containerID","shapeID","showName"],SelectVideoAnalyseShape:["containerID","shapeID","flag"],ReleaseVideoAnalyseContainer:["containerID"],EnableVideoAnalyseShape:["containerID","shapeID","flag"],RedrawVideoAnalyseShape:["containerID","shapeID"],SetVideoAnalyseShapeDirection:["containerID","shapeID","direction"],NetShowMode:null,SetDivideEnble:null,SetNucRawDataParam:null,SnatchAtHeatmapDataEx:["channel","maxCount"],StopSnatchHeatmap:null,SetDelayTimeAndLevel:["delayTime","threadShold","level"],StartHttpServer:null,StopHttpServer:null,StartRecvFacePic:null,StopRecvFacePic:null,RegisterFaceInfo:["Config","Name","OperateType"],ClipFacePicture:["nWidth","nHeight","left","top","right","bottom"],SetFaceFilePath:["path"],SyncFaceRecognitionDB:null,StopSyncFaceRecognitionDB:null,StartBatchRegister:["group"],GetPicFileNum:["path"],StopBatchRegister:null,SaveFailRegisterFile:["filePath"],SetProductModel:null,SetLensInfo:["info"],SetResolution:["width","height"],SetAntiAliasMode:null,InternetDownloadFile:null,SetCustomerInfo:["info"],StopAllPictureDownloadRequests:null,GetGrayHistogramData:["channel"],SetVisibleView:["nodeIndex","viewIndex"],EnableIVSConfig:["enable"],ReasetShapeShow:null,DelDetectRegionShape:null,SetCurNameEx:null,SetLineProperty:null,AddSubVideoAnalyseShape:null,SelectCurVideoAnalyseShape:["shapeID","bFlag"],GetSelectedVideoAnalyseShapeID:null},f={FocusZoomStatus:["Focus","Zoom","Status"],RegionChanged:["RegionID","left","top","right","bottom"],OutPutModuleRect:null,OutPutStringInfo:["szFunctionName","szOutputInfo"],OutPutWifiInfo:["szFunctionName","szOutputInfo"],FileDialogInfo:null,LocalFocus:null,StateChanged:["channel","state","winID","streamtype"],KeepAliveFailed:null,DeviceReconnected:null,RButtonDown:["winID"],ResolutionChange:["width","height"],PlaybackRecordfileFailed:null,RecordDiskFull:null,ErrorCode:null,CurPlayTime:["CurrentPlayTime"],PlayBackOneFileEnd:["winID","CurrentPlayTime"],DownloadPos:["percent","current","total"],MousePtzEvent:["winID","event","x","y","delta","time","reserve"],VideoAnalyzeConfig:["EventName","EventParam"],CalibrationData:null,CalibrationRange:null,HeatmapData:null,WndSwitch:["windowId"],ZoomInStatus:["disable"],DownLoadError:null,PlayBackLocalFileFailed:null,BadPointsData:["id","BadPoints"],FeInstallMode:null,FisheyeParamsEx:["index","lx","ly","hangle","vangle","isStoped"],MultiVideoJoinInfo:["bResult","pano0","pano1","pano2","dist"],message:null,LocalFileList:null,ReturnWindInfo:null,HeatmapDataIndex:null,FDPictureUrl:["info"],PictureUrl:["url","type"],FRPictureUrl:["info"],FaceInfoRegister:["Tag","Status","FileName"],RegPicNum:["num"],configFileImport:["code"],configFileExport:["code"],TrafficJunction:["info"],NonMotorDetect:["info"],HumanTrait:["info"],GrayHistogramData:["info"],HeatmapDataStatus:["info"],DiskSpaceLow:["path"]},j=["KeepAliveFailed","DeviceReconnected","RButtonDown","ResolutionChange","PlaybackRecordfileFailed","RecordDiskFull","ErrorCode","CurPlayTime","PlayBackOneFileEnd","DownloadPos"],k="application/media-plugin-version-",l=-1!==webCaps.deviceType.indexOf("TPC")?"240999BE-CBAD-44F7-A19D-DA415C8A5B58":"ED1EDBF5-CCC7-4171-A559-6578BD6D",n=-1!==webCaps.deviceType.indexOf("TPC")?"3.1.0.0":a.browser.Platform.win?"3.0.0.3":"3.0.0.2",o="WebActiveX.Plugin."+n;if(webCaps.MimeType&&(n=-1!==webCaps.deviceType.indexOf("TPC")?"3.1.0.0":a.browser.Platform.win?webCaps.MimeType:"3.0.0.2",o=a.browser.Platform.win?webCaps.PluginName:"WebActiveX.Plugin."+n,l=webCaps.Classid),t=a('<div id="video" style="background:rgb(0,0,0);position:absolute;top:-10000px;width:1px;height:1px"></div>').html('<div class="download-plugin" style="margin-top: -16px">                          <a href="'+A+'" target="_download">                            <span class="download-plugin-icon"></span>                            <span t="com.NoPluginTip"></span></a>                        </div>').translation().appendTo(document.body),-1!==location.href.indexOf("fromWebChromeNACL"))window.addEventListener("message",m,!1);else{var p=0,q=function(){return clearTimeout(r),"h5"===webApp.playMode?!1:void(b()?d():(p=1e3,r=setTimeout(q,p)))},r=setTimeout(q,p);webCaps.is_show_QT_VidAnalyse_VidInAttr&&a.browser.Platform.mac&&(h()&&(s.type="vlc"),g()&&(s.type="qt"))}a.each(e,function(b,c){s[b]=function(){var d=arguments;return"nacl"===s.type?i(b,c,d):a.isFunction(D[b])?D[b].apply(null,d):a.Deferred(function(a){try{var c=null,e=d.length;0===e&&(c=v[b]()),1===e&&(c=v[b](d[0])),2===e&&(c=v[b](d[0],d[1])),3===e&&(c=v[b](d[0],d[1],d[2])),4===e&&(c=v[b](d[0],d[1],d[2],d[3])),5===e&&(c=v[b](d[0],d[1],d[2],d[3],d[4])),6===e&&(c=v[b](d[0],d[1],d[2],d[3],d[4],d[5])),7===e&&(c=v[b](d[0],d[1],d[2],d[3],d[4],d[5],d[6])),8===e&&(c=v[b](d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7])),a.resolve(c)}catch(f){}}).promise()}}),s.addEvent=function(a,b){y[a]=b},s.fireEvent=function(b,c){if(a.isFunction(y[b])){var d=f[b];if(!d||!c)return y[b].call(null);var e=[];a.each(c,function(a,b){var c=d.indexOf(a);-1!==c&&(e[c]=b)}),y[b].apply(null,e)}},s.addEvent("KeepAliveFailed",function(a,b){b&&s.open(a)}),s.addEvent("ResolutionChange",function(b,c){b>0&&c>0&&(webApp.resolution.x=b,webApp.resolution.y=c,webApp.resolution.rate=b/c,a.isFunction(y.ResolutionChangePlayBack)&&y.ResolutionChangePlayBack.apply(null),a.isFunction(y.ResolutionChangePTZ)&&y.ResolutionChangePTZ.apply(null),a.isFunction(y.ResolutionChangePreview)&&y.ResolutionChangePreview.apply(null),a.isFunction(y.ResolutionChangeOSD)&&y.ResolutionChangeOSD.apply(null),a.isFunction(y.ResolutionChangeEncode)&&y.ResolutionChangeEncode.apply(null),a.isFunction(y.ResolutionChangeIvs)&&y.ResolutionChangeIvs.apply(null))}),s.addEvent("ErrorCode",function(b,c){if(18==b&&0==c)return void a.alert(tl("com.ReSearchTip"));if(0==c){var d=t.css("top");t.css("top",-1e4),a.alert(tl("com.NoWriteRightTip"),function(){t.css("top",d)})}17==b&&1==c&&(s.hide(),t.hide(),t.html(""),a.alert(tl("com.ErrorAuthorizeReloginTip"),function(){s.Reload()}))}),function(){var b=!1;s.addEvent("DiskSpaceLow",function(c){if(b)return!1;b=!0,s.hide(),webApp.hide_by_dialog=!0;var d=tl("pfm.StorageLowSpace")+"</br>"+tl("com.Path")+":"+c;a.alert(d,function(){s.cover(),b=!1,webApp.hide_by_dialog=!1})})}(),s.addEvent("RecordDiskFull",function(){a.isFunction(y.RecordDiskFullPreview)&&y.RecordDiskFullPreview.apply(null),a.isFunction(y.RecordDiskFullPlayback)&&y.RecordDiskFullPlayback.apply(null)}),s.addEvent("DeviceReconnected",function(){a.isFunction(y.DeviceReconnectedPreview)&&y.DeviceReconnectedPreview.apply(null),a.isFunction(y.DeviceReconnectedPTZ)&&y.DeviceReconnectedPTZ.apply(null),s.state("partialEnlarged")&&s.PartialEnlarged(!0);var b=a("#video_fluency").parent()[0].lastChild.children;a.each(b,function(a,b){"ui-video-wrap-item current"===b.className&&s.setDelayTime(a)})}),s.addEvent("StateChanged",function(b,c){1===c&&s.state("recordVideo")&&s.state("recordVideo",!1),-1!==b&&1===c&&(a.isFunction(y.StateChangedPreview)&&y.StateChangedPreview.apply(null),a.isFunction(y.StateChangedHeatMap)&&y.StateChangedHeatMap.apply(null),a.isFunction(y.StateChangedCutZone)&&y.StateChangedCutZone.apply(null),a.isFunction(y.StateChangedPlayBack)&&y.StateChangedPlayBack.apply(null),a.isFunction(y.DeviceReconnectedPTZ)&&y.DeviceReconnectedPTZ.apply(null))}),s.addEvent("TrafficJunction",function(b){a.isFunction(y.TrafficJunctionGate)&&y.TrafficJunctionGate.call(null,b),a.isFunction(y.TrafficJunctionObject)&&y.TrafficJunctionObject.call(null,b)}),s.addEvent("message",function(a){var b=JSON.parse(a);b.event&&s.fireEvent(b.event,b.params)})}(),function(){var b=null;s.login=function(c,d,g){return a.Deferred(function(h){function i(){switch(webApp.CustomerInfo&&s.SetCustomerInfo(webApp.CustomerInfo),s.SetDeviceMode(0,1),webApp.DisplayMode){case"Adaptive Window":s.SetShowMode(0);break;default:s.SetShowMode(1)}a.each(z,function(a){s.GetConfigPath(a).done(function(b){s.SetConfigPath(a,b)})}),a.isFunction(b)&&b(!0),"resolved"!==h.state()&&h.resolve(),n(),a.publish("pluginLogin")}function j(b){var c={"-1":"ivs.DNSError",3:"com.LogInOvertimeTip",7:"com.SystemIsBusyingTip",8:"com.SubConnectFailTip",9:"com.MainConnectFail",10:"com.MaximumConnectTip"};a.alert(tl(c[b]||"com.LoginControlFailureTip"))}"pending"===x.state()&&h.resolve(),x.done(function(){var b=r.getAuthority(),e=-1!==webApp.DeviceType.indexOf("TPC")?"TPC":"IPC";s.SetConfig("AuthorityList",JSON.stringify(b)),s.SetTranslateString("nacl"===s.type?global.getLangJson():JSON.stringify(global.getLangJson())),s.SetMonitorEnable(s.channel,-1!==a.inArray("Monitor_01",b)),s.SetProductType(e),1===webApp.CamType&&s.SetProductModel("Lepton"),s.SetVideoWndNum(webApp.CHANNEL_NUMBER),s.socket=g,webCaps.is_show_Ushield?s.LoginDevice(s.ip,s.port,c,webApp.mTokenPsw).done(i).fail(j):s.LoginDevice(s.ip,s.port,c,d).done(i).fail(j)}),"qt"===s.type?e().done(i).fail(j):"vlc"===s.type&&f().done(i).fail(j)}).promise()},s.logout=function(){return s.clearState(),s.close(),s.LogoutDevice()},s.open=function(b,c,d){return s.stream=b||1,void 0!==c&&(s.channel=c),s.window=d||1,"nacl"===s.type?s.ConnectRealVideo(s.channel,s.stream,s.socket):"general"===s.type?-1!==webApp.DeviceType.indexOf("TPC")?s.window>1?s.ConnectAllChannel(s.window,s.stream):s.ConnectRealVideoEx(s.channel,s.channel,s.stream):s.ConnectRealVideo(s.channel,s.stream):"qt"===s.type&&b?e():"vlc"===s.type?f():a.Deferred()},s.setSocketType=function(a){return void 0!==a&&(s.socket=a),s.SetSocketType(a)},s.close=function(b){return-1!==webApp.DeviceType.indexOf("TPC")?!b&&s.state("recordVideo")?a.Deferred():s.DisConnectAllChannel().done(function(a){a&&b&&(s.stream=-1)}):!b&&s.state("recordVideo")?a.Deferred():s.DisConnectRealVideo(s.channel).done(function(a){a&&b&&(s.stream=-1)})},s.cover=function(c,d){if(c&&(u=a(c)),!u.is(":hidden")){a.isFunction(d)&&("resolved"===x.state()?d():b=d),a.browser.chrome&&(a(window).off(".plugin"),a(window).on("resize.plugin",function(){var a=t.css("top");t.css("top",-1e4),u.offset(),t.css("top",a)}));var e=u.offset(),f=u.width(),g=u.height();if(t.css({width:f,height:g,top:e.top,left:e.left,"z-index":10002}),"nacl"===s.type){var h=0;document.documentElement.clientWidth-1450>0&&(h=(document.documentElement.clientWidth-1450)/100),a(window).on("scroll.plugin",function(){"Original Size"===u.attr("DHVideoWHMode")&&"Original Size"===webApp.DisplayMode?i("changeOcxStyle",["top","left","width","height","originalWidth","originalHeight"],[e.top-document.body.scrollTop,e.left-document.body.scrollLeft,f,g,webApp.resolution.x,webApp.resolution.y]):i("changeOcxStyle",["top","left"],[e.top-document.body.scrollTop,e.left-document.body.scrollLeft+h])});var j=["width","height","top","left"],k=[f,g,e.top-document.body.scrollTop,e.left-document.body.scrollLeft+h];"Original Size"===u.attr("DHVideoWHMode")&&"Original Size"===webApp.DisplayMode&&(j.push("originalWidth"),j.push("originalHeight"),k.push(webApp.resolution.x),k.push(webApp.resolution.y)),i("changeOcxStyle",j,k)}}},s.hide=function(){a(window).off(".plugin"),b=null,t.css("top",-1e4),"nacl"===s.type&&i("changeOcxStyle",["top"],[-1e4])},s.state=function(b,c){return"boolean"===a.type(c)&&B[b]&&c!==B[b].hasClass("current")?void B[b].click():!(!B[b]||!B[b].hasClass("current"))},s.clearState=function(){a.each(B,function(a,b){b&&b.hasClass("current")&&b.click()}),B={}},s.subVideoWndCtrl=function(a,b){return s.SubVideoWndCtrl(a,b)},s.enableHeatMap=function(b){return a.Deferred(function(a){b&&s.DisConnectRealVideo(s.channel),s.EnableHeatMap(b),b?s.open():s.DisConnectRealVideo(s.channel),a.resolve()})},s.controlTalking=function(b){var c=!b.hasClass("current");return a.Deferred(function(a){if(c)o.ConfigManager.getConfig(["Encode","Web"]).done(function(d){var e;e=2===s.stream?d[0].params.table[0].ExtraFormat[0].Audio:3===s.stream?d[0].params.table[0].ExtraFormat[1].Audio:d[0].params.table[0].MainFormat[0].Audio,s.SetConfig("audio",JSON.stringify(e)),s.SetConfig("Web",JSON.stringify(d[1].params.table)),b.data("audio",{Frequency:e.Frequency,Depth:e.Depth,Compression:e.Compression}),s.ControlTalking(e.Frequency,e.Depth,e.Compression,c).done(function(b){a.resolve(b)})});else{var d=b.data("audio");d&&s.ControlTalking(d.Frequency,d.Depth,d.Compression,c).done(function(b){a.resolve(b)})}}).promise().done(function(a){a&&(B.controlTalking=b.toggleClass("current"))})},s.dualAudioEnable=function(a){var b=!a.hasClass("current"),c=a.data("mode"),d=null;if("nacl"===s.type){var e=1===c||14===c?0:1;d=s.DualAudioEnable(e,b)}else d=s.SubVideoWndCtrl(c,b?1:0);return d.done(function(d){b?d&&(B["dualAudioEnable"+c]=a.toggleClass("current")):B["dualAudioEnable"+c]=a.toggleClass("current")})};var c=null;s.setAFEnable=function(b){var d=!b.hasClass("current");return s.SetAFEnable(d).done(function(e){e&&(B.setAFEnable=d?b.addClass("current"):b.removeClass("current"),d?(c=setTimeout(function(){s.state("setAFEnable")&&B.setAFEnable.click(),-1!==webApp.DeviceType.indexOf("TPC")&&o.ConfigManager.getConfig("VideoInFocus").done(function(b){b[s.windowId]||(b[s.windowId]=a.extend(!0,[],b[0])),b[s.windowId][0].Mode=2,b[s.windowId][1].Mode=2,b[s.windowId][2].Mode=2,o.ConfigManager.setConfig("VideoInFocus",b)})},3e5),o.ConfigManager.getConfig("VideoInFocus").done(function(b){b[s.windowId]||(b[s.windowId]=a.extend(!0,[],b[0])),b[s.windowId][0].Mode=1,b[s.windowId][1].Mode=1,b[s.windowId][2].Mode=1,o.ConfigManager.setConfig("VideoInFocus",b)})):(o.ConfigManager.getConfig("VideoInFocus").done(function(b){b[s.windowId]||(b[s.windowId]=a.extend(!0,[],b[0]));var c=s.windowId,d=2;-1!==webApp.DeviceType.indexOf("TPC")&&(c=webApp.CHANNEL_NUMBER>1?1:0,d=3),b[c][0].Mode=d,b[c][1].Mode=d,b[c][2].Mode=d,o.ConfigManager.setConfig("VideoInFocus",b).done(function(){a(window).trigger("VideoInFocusChanged")})}),clearTimeout(c)))})},s.recordVideo=function(a){var b=!a.hasClass("current");return s.RecordVideo("LiveRecord",0,b).done(function(c){if(c&&(B.recordVideo=a.toggleClass("current"),b)){var d;1===s.stream?d="Main":2===s.stream?d="Extra1":3===s.stream&&(d="Extra2"),o.DevVideoEncode.setIFrame(d)}})},s.recordAllVideo=function(a){var b=!a.hasClass("current");return s.RecordAllVideo(b).done(function(b){b&&(B.recordAllVideo=a.toggleClass("current"))})},s.clearShape=function(a,b){return b&&s.DeleteOneIntelShape(b),a?s.DeleteAllIntelShape(a):!0},s.creatShape=function(a,b,c){return s.CreateOneIntelShapeContainer(s.windowId,"").done(function(d){s.containerId=d,s.CreateOneIntelShape(s.containerId,a,"VideoAnalyzeConfig",a,"","","").done(function(a){s.shapeId=a;var c=[];if(b){switch(b){case"red":c=[255,0,0];break;case"yellow":c=[255,255,0];break;case"blue":c=[0,0,255];break;case"green":c=[0,255,0];break;default:c=[0,255,0]}s.SetOneIntelShapeDisplayColor(s.shapeId,0,c[0],c[1],c[2])}}),s.SetOneIntelShapeThickness(s.shapeId,c)})},s.activeManualLocate=function(a){var b=!a.hasClass("current");return b&&d("activeManualLocate"),s.ActiveManualLocate(b).done(function(c){c&&(B.activeManualLocate=a.toggleClass("current"),b?-1!==!webApp.DeviceType.indexOf("TPC")&&s.addEvent("RegionChanged",function(a,b,c,d,e){o.DevIntelliTracker.trackObject({ObjectID:-1,BoundingBox:[b,c,d,e]})}):-1!==!webApp.DeviceType.indexOf("TPC")&&s.addEvent("RegionChanged",null))})},s.partialEnlarged=function(a){var b=!a.hasClass("current");return b&&d("partialEnlarged"),s.PartialEnlarged(b).done(function(c){c&&(B.partialEnlarged=a.toggleClass("current"),b?-1!==webApp.DeviceType.indexOf("TPC")?s.addEvent("ZoomInStatus",function(a){"disable"==a&&s.state("partialEnlarged",!1)}):s.addEvent("RButtonDown",function(a){0===a&&s.state("partialEnlarged",!1)}):-1!==webApp.DeviceType.indexOf("TPC")?s.addEvent("ZoomInStatus",null):s.addEvent("RButtonDown",null))})},s.changeZoomEvidence=function(b){var c={statusFlag:!1,init:function(){c.bind()},bind:function(){b.off("click").on("click",function(){a(this).hasClass("current")?(a(this).removeClass("current"),c.statusFlag=!1):(d("changeZoomEvidence"),B.changeZoomEvidence=b.toggleClass("current"),a(this).addClass("current"),c.statusFlag=!0,s.addEvent("OutPutStringInfo",function(a,b){"OutPutRuleRect"==a&&c.ocxBackStatusFlag(b)})),c.varSetStatusFlag(c.statusFlag)})},varSetStatusFlag:function(a){c.ocxStatusFlag(a)},ocxStatusFlag:function(a){if(a){s.SetCurPtzID(0);var b=0,c=0;s.SetIVSConfig("",0),s.AddShape(6,"","MannualEvidence",b,c)}else s.DeleteShape("MannualEvidence")},ocxBackStatusFlag:function(a){var b=JSON.decode(a),d=[b.OutPutRuleRect[0][0],b.OutPutRuleRect[0][1],b.OutPutRuleRect[1][0],b.OutPutRuleRect[1][1]];if(d[0]+d[1]>d[2]+d[3]){var e=[d[2],d[3],d[0],d[1]];d=e}c.applySend(d)},applySend:function(a){var b={channel:0,object:[]},c={objectID:-1,boundingBox:a};b.object.push(c),o.DevVideoAnalyse.setAnalyseObject(b).fail(function(){alert(tl("Operateingfailure"))})}};c.init()},s.activeLocalFocus=function(a,b){var c=!a.hasClass("current");return c&&d("activeLocalFocus"),s.ActiveLocalFocus(c).done(function(d){if(d){B.activeLocalFocus=a.toggleClass("current");var e="nacl"===s.type?"RegionChanged":"LocalFocus";-1!==!webApp.DeviceType.indexOf("TPC")?c&&s.addEvent(e,function(a,c,d,e,f){var g=global.getScreenOrder(c,d,e,f);void 0!=b&&b?b&&c==e&&d==f&&(g=[c,d,e,f]):s.state("activeLocalFocus",!1),-1!==webApp.DeviceType.indexOf("SD")?o.PTZ.focusRegion("InROIRegion",g,s.windowId):o.DevVideoInput.focusRegion("InROIRegion",global.getScreenOrder(c,d,e,f),s.windowId)}):s.addEvent(e,null)}})},s.highSkyEyes=function(a){var b=!a.hasClass("current");b&&d("highSkyEyes"),B.highSkyEyes=a.toggleClass("current"),b?(a.addClass("current"),s.SubVideoWndCtrl(30,1)):(a.removeClass("current"),s.SubVideoWndCtrl(30,0))},s.activeZoneExpose=function(a){var b,c=!a.hasClass("current"),e={},f={};return c&&d("activeZoneExpose"),o.ConfigManager.getConfig(["VideoInBacklight","VideoInMode"]).done(function(a){e=a[0].params.table,f=a[1].params.table,b=f[0].Config[0]
}),s.ActiveZoneExpose(c).done(function(d){if(d){B.activeZoneExpose=a.toggleClass("current");var f="nacl"===s.type?"RegionChanged":"LocalFocus";c?s.addEvent(f,function(a,c,d,f,g){e[0][b].Mode="Backlight",e[0][b].BacklightMode="Region",e[0][b].BacklightRegion=[c,d,f,g],o.ConfigManager.setConfig("VideoInBacklight",e).done(function(){})}):s.addEvent(f,null)}})},s.enableMousePtz=function(a){var b=!a.hasClass("current");return b&&d("enableMousePtz"),s.EnableMousePtz(b?1:0).done(function(c){if(c)if(B.enableMousePtz=a.toggleClass("current"),b){var d=[[0,0,0],[0,0,0],[0,0,0]],e=0;s.addEvent("MousePtzEvent",function(a,b,c,f,g,h){switch(b){case 3:var i=(-1*g/20).limit(-1,1);o.PTZ.continueMoveDirectly(e,0,!1,[0,0,i]);break;case 0:d.push([c,f,h])&&d.shift();var j=(c/8192).limit(-1,1),k=(f/8192).limit(-1,1);(e=1)&&o.PTZ.continueMoveDirectly(e,0,!1,[j,k,0]);break;case 1:Math.abs(h-d[2][2])>20&&d.push([c,f,h])&&d.shift();var j=(c/8192).limit(-1,1),k=(f/8192).limit(-1,1),l=d[2][2]-d[1][2];++e<256&&o.PTZ.continueMoveDirectly(e,l,!0,[j,k,0]);break;case 2:d.push([c,f,h])&&d.shift();var j=(c/8192).limit(-1,1),k=(f/8192).limit(-1,1),l=d[2][2]-d[1][2];++e<256&&o.PTZ.continueMoveDirectly(e,l,!1,[j,k,0])}})}else s.addEvent("MousePtzEvent",null)})},s.activePTZLocate=function(a){var b=!a.hasClass("current");return b&&d("activePTZLocate"),s.ActivePTZLocate(b).done(function(c){c?(B.activePTZLocate=a.toggleClass("current"),b?s.addEvent("RegionChanged",function(a,b,c,d,e){var f=((b+d)/16384).limit(-1,1),g=((c+e)/16384).limit(-1,1),h=Math.abs(e-c)>Math.abs(d-b)?e-c:d-b,i=(h/8192).limit(-1,1),j=d>b?i*i:-1*i*i;o.PTZ.moveDirectly([f,g,j],null,s.windowId)}):s.addEvent("RegionChanged",null)):-1!==webApp.DeviceType.indexOf("TPC")&&(B.activePTZLocate=a.toggleClass("current"))})},s.cutResolute=function(a){var b=!a.hasClass("current");return b&&d("cutResolute"),s.CutResolute(b).done(function(){B.cutResolute=a.toggleClass("current")})},s.activeMeasureDistance=function(a){var b=!a.hasClass("current");return b&&d("activeMeasureDistance"),s.ActiveMeasureDistance(b).done(function(c){c&&(B.activeMeasureDistance=a.toggleClass("current"),b?s.addEvent("MousePtzEvent",function(a,b,c,d){o.LaserDistMeasure.displayDistanceOnOSD(0,[c,d]).fail(function(a){if(a&&a.error&&a.error.code)switch(a.error.code){case 287440897:alert(tl("per.DevHeightInvalid"));break;case 287440898:alert(tl("per.DistMeasureNotEnable"));break;case 287440899:alert(tl("per.DistMeasureOSDNotEnable"))}})}):s.addEvent("MousePtzEvent",null))})},s.messageMarkColorClick=function(b){if(0!=s.stream)switch(a("#b_duckdrawn").toggleClass("main-top-duck-draw-current"),a("#duck_wrap").css(a("#b_duckdrawn").hasClass("main-top-duck-draw-current")?{display:""}:{display:"none"}),a("#b_duck").hasClass("duckbtn")||(a("#b_duck").hasClass("duckbtn")&&a("ocx")&&s.SetMouseDrawEnable(0)&&(a("#b_duck").removeClass("main-top-icon-icon-duck-red"),a("#b_duck").removeClass("main-top-icon-icon-duck-blue"),a("#b_duck").removeClass("main-top-icon-icon-duck-green"),a("#b_duck").removeClass("duckbtn")),a("#b_duck").addClass("duckbtn")),s.SetMouseDrawEnable(1),a("#duck_wrap a").removeClass("main-top-duckcheck"),a("#b_duck").removeClass("main-top-icon-icon-duck-red").removeClass("main-top-icon-icon-duck-blue").removeClass("main-top-icon-icon-duck-green"),b){case 1:a("#b_duck").addClass("main-top-icon-icon-duck-red"),a("#b_duck_red").addClass("main-top-duckcheck"),s.SetMouseDrawPen(233,16,42,.8,4).done();break;case 2:a("#b_duck").addClass("main-top-icon-icon-duck-blue"),a("#b_duck_blue").addClass("main-top-duckcheck"),s.SetMouseDrawPen(4,20,236,.8,4);break;case 3:a("#b_duck").addClass("main-top-icon-icon-duck-green"),a("#b_duck_green").addClass("main-top-duckcheck"),s.SetMouseDrawPen(6,245,45,.8,4)}},s.messageMarkDuckDrawnClick=function(){a("#b_duckdrawn").toggleClass("main-top-duck-draw-current"),a("#duck_wrap").css(a("#b_duckdrawn").hasClass("main-top-duck-draw-current")?{display:""}:{display:"none"})},s.messageMarkDuckClick=function(b,c){if(B.messageMarkDuckClick=a("#b_duck"),c===!0&&a("#b_duck").addClass("current"),0!=s.stream&&!a("#b_duck").hasClass("current")){var e=!b.hasClass("current");return e&&d("messageMarkDuckClick"),s.SetMouseDrawEnable(1),a("#b_duck").addClass("current"),void(a("#b_duck_red").hasClass("main-top-duckcheck")?(a("#b_duck").addClass("main-top-icon-icon-duck-red"),s.SetMouseDrawPen(233,16,42,.8,5)):a("#b_duck_blue").hasClass("main-top-duckcheck")?(a("#b_duck").addClass("main-top-icon-icon-duck-blue"),s.SetMouseDrawPen(4,20,236,.8,5)):(a("#b_duck").addClass("main-top-icon-icon-duck-green"),s.SetMouseDrawPen(6,245,45,.8,5)))}s.SetMouseDrawEnable(0),a("#b_duck").removeClass("main-top-icon-icon-duck-red"),a("#b_duck").removeClass("main-top-icon-icon-duck-blue"),a("#b_duck").removeClass("main-top-icon-icon-duck-green"),a("#b_duck").removeClass("current")};var g=[5,4,1];s.setDelayTime=function(b){ability.get("DecodeBuf").done(function(c){c?(a.merge(g,c),c=null,s.setDelayTime=function(a){var b=g[a+3];return s.SetDelayTimeAndLevel(b[0],b[1],g[a])}):s.setDelayTime=function(a){return s.SetDelayTime(g[a])},s.setDelayTime(b)})}}();var D={};!function(){function b(){var a=v.GetPlaybackMsg(0);s.fireEvent("DownloadPos",{percent:-1===a?100:(a/10).floor(),current:0,total:0}),-1===a&&(clearInterval(d),d=null)}var c=null,d=null;D.SetSocketType=function(a){var b=r.getLoginInfo();return D.LoginDevice(s.ip,s.port,b.username,b.password,a)},D.LoginDevice=function(b,c,d,e){return a.Deferred(function(a){var f=v&&v.LoginDeviceEx(b,c,d,e,s.socket);0===f?a.resolve():a.reject(f)}).promise()},D.SetFullScreen=function(){return a.Deferred(function(a){var b=v&&v.OnFullScreenClk();a.resolve(b)}).promise()},D.PartialEnlarged=function(b){return a.Deferred(function(a){if(-1!==webApp.DeviceType.indexOf("TPC")){var c=v&&v.ActiveLocalEnlarge(b);a.resolve(c)}else{var c=v&&v.SubVideoWndCtrl(5,b?1:0);a.resolve(c)}}).promise()},D.ActiveLocalFocus=function(b){return a.Deferred(function(a){var c=v&&v.SubVideoWndCtrl(16,b?1:0);a.resolve(c)}).promise()},D.ActiveZoneExpose=function(b){return a.Deferred(function(a){var c=v&&v.SubVideoWndCtrl(16,b?1:0);a.resolve(c)}).promise()},D.ActivePTZLocate=function(b){return a.Deferred(function(a){var c=v&&v.SubVideoWndCtrl(11,b?1:0);a.resolve(c)}).promise()},D.ActiveManualLocate=function(b){return a.Deferred(function(a){if(-1!==webApp.DeviceType.indexOf("TPC"))if(b)var c=s.clearShape(s.containerId,s.shapeId).done(function(){s.creatShape("RectangleShape","green",2)});else var c=s.clearShape(s.containerId,s.shapeId).done(function(){s.creatShape("ReSpot","green")});else var c=v&&v.SubVideoWndCtrl(10,b?1:0);a.resolve(c)}).promise()},D.ShowFileBrowse=function(){return a.Deferred(function(a){v&&v.ShowFileBrowse(),s.addEvent("FileDialogInfo",function(b,c){a.resolve(c)})}).promise()},D.SetConfigPath=function(b,c){var d=z[b],e="DhWebVideoPath"+d;return a.Deferred(function(a){q.set(e,c,{expires:30}),a.resolve(v&&v.SetConfigPath(d,c))}).promise()},D.GetConfigPath=function(b){var c=z[b],d="DhWebVideoPath"+c,e=q.get(d);return a.Deferred(function(a){var d=v&&v.GetConfigPath(c);d?a.resolve(d):e?a.resolve(e):D.GetDefaultConfigPath(b).done(function(b){a.resolve(b)})}).promise()},D.ActiveMeasureDistance=function(b){return a.Deferred(function(a){var c=v&&v.SubVideoWndCtrl(23,b?1:0);a.resolve(c)}).promise()},D.GetDefaultConfigPath=function(b){return a.Deferred(function(c){if(v){var d=v.GetUserDirectory()+(a.browser.Platform.win?"\\WebDownload\\":"/WebDownload/")+b;c.resolve(d)}}).promise()},D.CatchPicture=function(b){return a.Deferred(function(a){a.resolve(v&&v.SubVideoWndCtrl(2,b))}).promise()},D.CatchPictures=function(b){return a.Deferred(function(a){a.resolve(v&&v.SubVideoWndCtrl(9,b))}).promise()},D.RecordVideo=function(b,c,d){return a.Deferred(function(a){a.resolve(v&&v.SubVideoWndCtrl(3,d?1:0))}).promise()},D.RecordAllVideo=function(b){return a.Deferred(function(a){a.resolve(b?v&&v.StartAllLocalRecord(0):v&&v.StopAllLocalRecord())}).promise()},D.ControlTalking=function(b,c,d,e){return a.Deferred(function(a){a.resolve(v&&v.ControlTalking(e?1:0))}).promise()},D.ShowSaveOrOpenDlg=function(b,c,d){return a.Deferred(function(e){if(v){if(d&&d.length){var f=a.map(d,function(b){return b.description+"|"+a.map(b.extensions,function(a){return"*."+a}).join(";")}),g=f.join("|")+"||";v.SetFilter(g)}"saveFile"===b?(v.SetFilename(c),v.ShowSave()):"openFile"===b&&v.ShowOpen(),s.addEvent("FileDialogInfo",function(a,b,c){e.resolve([a,b,c])})}}).promise()},D.ReadFile=function(b){return a.Deferred(function(a){a.resolve(v.ReadFile(b))}).promise()},D.WriteFile=function(b,c,d){return a.Deferred(function(a){a.resolve(v.WriteFile(d,b,c))}).promise()},D.ReadBase64Data=function(b,c){return a.Deferred(function(a){a.resolve(v.ReadBase64Data(b,c))}).promise()},D.WriteBase64Data=function(b,c,d){return a.Deferred(function(a){a.resolve(v.WriteBase64Data(b,c,d))}).promise()},D.ResumePlayBack=function(){return a.Deferred(function(a){v&&a.resolve(v.ResumePlayBack())}).promise()},D.SlowPlayBack=function(){return a.Deferred(function(a){v&&a.resolve(v.SlowPlayBack())}).promise()},D.FastPlayBack=function(){return a.Deferred(function(a){v&&a.resolve(v.FastPlayBack())}).promise()},D.PausePlayBack=function(){return a.Deferred(function(a){v&&a.resolve(v.PausePlayBack())}).promise()},D.StopPlayBack=function(){return clearInterval(c),c=null,a.Deferred(function(a){v&&a.resolve(v.StopPlayBack())}).promise()},D.PlaySetVolume=function(b,c){return a.Deferred(function(a){v&&a.resolve(v.PlaySetVolume(c))}).promise()},D.PlayOpenSound=function(){return a.Deferred(function(a){v&&a.resolve(v.PlayOpenSound())}).promise()},D.PlayStopSound=function(){return a.Deferred(function(a){v&&a.resolve(v.PlayStopSound())}).promise()},D.PlayPreFrame=function(){return a.Deferred(function(a){v&&a.resolve(v.SingleFramePlayBack())}).promise()},D.PlaybackByFile=function(b,d,e,f,g){return a.Deferred(function(a){if(v){if("local"===g)var d=v.PlayBackByLocalFile(b);else if(-1!==webApp.DeviceType.indexOf("TPC"))var d=v.PlayBackByRecordFile(0,f,JSON.encode(b));else if(void 0!==b.startTime&&b.startTime==f)var d=v.PlayBackByTime(JSON.stringify(b),b.startTime,b.endTime,f);else var d=v.PlayBackByRecordFileEx(JSON.stringify(b),f);if(a.resolve(d),d){var h=/^0000-00-00/,i=/stop$/,j=function(){if(-1!==webApp.DeviceType.indexOf("TPC")){var a=v.GetPlayedTime(0);if(""===a)return void s.fireEvent("PlayBackOneFileEnd")}else var a=v.GetPlayTime();if(h.test(a)||i.test(a))i.test(a)&&s.fireEvent("PlayBackOneFileEnd",{winID:0,CurrentPlayTime:a.slice(0,19)});else{var b=a.split(" ")[1].split(":").join("");s.fireEvent("CurPlayTime",{CurrentPlayTime:"0"+e+b})}};c||(c=setInterval(j,1e3))}}}).promise()},D.StopAllPlayBack=function(){return clearInterval(c),c=null,a.Deferred(function(a){v&&a.resolve(v.StopAllPlayBack())}).promise()},D.SetVideoAnalyseContainerTip=function(b,c){return a.Deferred(function(a){v&&a.resolve(v.SetVideoAnalyseContainerTip(b,c))}).promise()},D.EnableVideoAnalyseModule=function(b){return a.Deferred(function(a){v&&a.resolve(v.EnableVideoAnalyseModule(b))}).promise()},D.SetVideoAnalyseShapeColor=function(b,c,d,e,f){return a.Deferred(function(a){v&&a.resolve(v.SetVideoAnalyseShapeColor(b,c,d,e,f))}).promise()},D.SelectCurVideoAnalyseShape=function(b,c){return a.Deferred(function(a){v&&a.resolve(v.SelectCurVideoAnalyseShape(b,c))}).promise()},D.GetSelectedVideoAnalyseShapeID=function(){return a.Deferred(function(a){v&&a.resolve(v.GetSelectedVideoAnalyseShapeID())}).promise()},D.DeleteVideoAnalyseShape=function(b){return a.Deferred(function(a){v&&a.resolve(v.DeleteVideoAnalyseShape(b))}).promise()},D.DeleteAllVideoAnalyseShape=function(){return a.Deferred(function(a){v&&a.resolve(v.DeleteAllVideoAnalyseShape())}).promise()},D.GetVideoAnalyseShapeConfigData=function(b){return a.Deferred(function(a){v&&a.resolve(v.GetVideoAnalyseShapeConfigData(b))}).promise()},D.SetVideoAnalyseShapeShowName=function(b,c){return a.Deferred(function(a){v&&a.resolve(v.SetVideoAnalyseShapeShowName(b,c))}).promise()},D.ShowVideoAnalyseShape=function(b,c){return a.Deferred(function(a){v&&a.resolve(v.ShowVideoAnalyseShape(b,c))}).promise()},D.DownloadByFile=function(c,e,f){return a.Deferred(function(g){v&&s.GetConfigPath(e).done(function(e){var h=f.lastIndexOf("."),i=f.slice(h+1),j=e+(a.browser.Platform.win?"\\":"/")+f.slice(0,h),k=null;void 0!==c.startTime?(j=e+(a.browser.Platform.win?"\\":"/")+c.startTime.replace(/\D/g,"")+"-"+c.endTime.replace(/\D/g,""),k=v.DownloadByTimeEx(0,c.startTime,c.endTime,j,i,JSON.stringify(c))):k=v.DownloadByRecordFile(JSON.stringify(c),j,i),g.resolve(k),k&&(d||(d=setInterval(b,500)))})}).promise()},D.DownloadByFileEx=function(c,e,f,g){return a.Deferred(function(e){if(v){var h=f.lastIndexOf("."),i=f.slice(h+1),j=g+(a.browser.Platform.win?"\\":"/")+f.slice(0,h),k=null;k=v.DownloadByRecordFileEx(JSON.stringify(c),j,i),e.resolve(k),k&&(d||(d=setInterval(b,500)))}}).promise()},D.StopDownload=function(){return a.Deferred(function(a){v&&(a.resolve(v.StopDownload(1)),clearInterval(d),d=null)}).promise()},D.DownloadByTime=function(c,e,f,g,h){return a.Deferred(function(i){v&&s.GetConfigPath(g).done(function(g){var j=h.lastIndexOf("."),k=h.slice(j+1),l=g+(a.browser.Platform.win?"\\":"/")+h.slice(0,j),m=v.DownloadByTimeEx(0,e,f,l,k,JSON.stringify(c));i.resolve(m),m&&(d||(d=setInterval(b,500)))})}).promise()},D.Reload=function(b){return a.Deferred(function(){b?location.href=location.protocol+"//"+b:location.reload(!0)}).promise()},D.CheckFuncSupport=function(b){return a.Deferred(function(a){0===b||1===b?a.resolve(!(global.isDDNS()||/:/.test(location.hostname))):2===b&&a.resolve(!0)}).promise()},D.SetCalWndSize=function(b,c){return a.Deferred(function(a){var d=v&&v.SetCalWndSize(b,c);a.resolve(d)}).promise()},D.CutResolute=function(b){return a.Deferred(function(a){var c=v&&v.SubVideoWndCtrl(24,b?1:0);a.resolve(c)}).promise()},D.PostOneHttpRequest=function(b,c,d,e,f){return a.Deferred(function(a){a.resolve(v.PostOneHttpRequest(b,c,d,e,f))}).promise()},D.RequestOneCGIInteraction=function(b,c,d){return a.Deferred(function(a){a.resolve(v.RequestOneCGIInteraction(b,c,d))}).promise()}}();var E=1,F={}})}(jQuery);