var objectMap={},VideoAnalyseRule={},ctx=document.getElementById("ivscanvas").getContext("2d"),canvas=document.getElementById("ivscanvas"),ivsDraw=function(a){console.log("type:"+a.type+"   jsondata:"+JSON.stringify(a.params));var b=a.params;if(ctx.clearRect(0,0,canvas.width,canvas.height),b.hasOwnProperty("VideoAnalyseRule")&&(VideoAnalyseRule=b.VideoAnalyseRule),drawRule(),5===a.type)for(var c=b.object,d=b.coordinate,e=0;e<c.length;e++)switch(c[e].operateType){case 1:objectMap[c[e].objectId]={},objectMap[c[e].objectId].show=!0,c[e].hasOwnProperty("track")&&(objectMap[c[e].objectId].pos=c[e].track[0]),objectMap[c[e].objectId].coordinate=d;break;case 2:objectMap.hasOwnProperty(c[e].objectId)||(objectMap[c[e].objectId]={},objectMap[c[e].objectId].coordinate=d),c[e].hasOwnProperty("track")&&(objectMap[c[e].objectId].pos=c[e].track[0],objectMap[c[e].objectId].show=!0);break;case 3:objectMap.hasOwnProperty(c[e].objectId)&&delete objectMap[c[e].objectId];break;case 4:objectMap.hasOwnProperty(c[e].objectId)&&(objectMap[c[e].objectId].show=!1)}drawTrack()},drawTrack=function(){ctx.save(),ctx.strokeStyle="#00FF00",ctx.lineWidth=2;for(var a in objectMap){var b=objectMap[a];if(b.show){var c=b.coordinate-1;ctx.strokeRect(b.pos[0]*canvas.width/c,b.pos[1]*canvas.height/c,(b.pos[2]-b.pos[0])*canvas.width/c,(b.pos[3]-b.pos[1])*canvas.height/c)}}ctx.restore()},drawRule=function(){if(VideoAnalyseRule){ctx.save(),ctx.strokeStyle="#0000FF",ctx.lineWidth=2,ctx.beginPath();for(var a=0;a<VideoAnalyseRule.length;a++)switch(VideoAnalyseRule[a].Type){case"CrossLineDetection":for(var b=VideoAnalyseRule[a].Config.DetectLine,c=0,d=b.length;d-1>c;c++)ctx.moveTo(b[c][0]*canvas.width/8191,b[c][1]*canvas.height/8191),ctx.lineTo(b[c+1][0]*canvas.width/8191,b[c+1][1]*canvas.height/8191);break;case"CrossRegionDetection":case"LeftDetection":case"MoveDetection":case"ParkingDetection":case"RioterDetection":case"TakenAwayDetection":case"WanderDetection":for(var e=VideoAnalyseRule[a].Config.DetectRegion,c=0;c<e.length;c++)0==c?ctx.moveTo(e[c][0]*canvas.width/8191,e[c][1]*canvas.height/8191):ctx.lineTo(e[c][0]*canvas.width/8191,e[c][1]*canvas.height/8191);ctx.lineTo(e[0][0]*canvas.width/8191,e[0][1]*canvas.height/8191)}ctx.stroke(),ctx.closePath(),ctx.restore()}};