!function(a){var b={};define(function(require,c,d){d.exports=require("jsCore/pageTab"),d.exports.prototype.enc_inter=a.when(rpc.DevVideoEncode.getCaps(),ability.is("ROIConflict")).then(function(a,c){return b=a,!(c||!isEnable("is_show_roi")||!a.MaxROICount)}),d.exports.prototype.enc_encrypt=rpc.DevVideoEncode.getCaps().then(function(a){return 2===a.EncryptMask}),d.exports.prototype.enc_nvrEncrypt=rpc.DevVideoEncode.getCaps().then(function(a){return 8===a.EncryptMask}),d.exports.prototype.enc_path="flash"!==webApp.playMode&&"h5"!==webApp.playMode?!0:!1}),define("enc_encode",function(require,c,d){function e(a){var b=[],c=[],d=O.Flip,e=O.Rotate90,f=O.Mirror;if(1===e?(b[0]=a[1],b[1]=8191-a[0],b[2]=a[3],b[3]=8191-a[2]):2===e?(b[0]=8191-a[1],b[1]=a[0],b[2]=8191-a[3],b[3]=a[2]):d?(b[0]=a[0],b[1]=8191-a[1],b[2]=a[2],b[3]=8191-a[3]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b[0]>b[2]){var g=b[0];b[0]=b[2],b[2]=g}if(b[1]>b[3]){var h=b[1];b[1]=b[3],b[3]=h}return f?(c[0]=8191-b[2],c[1]=b[1],c[2]=8191-b[0],c[3]=b[3],c):b}function f(a){var b=[],c=[],d=O.Flip,e=O.Rotate90,f=O.Mirror;if(1===e?(b[0]=8191-a[1],b[1]=a[0],b[2]=8191-a[3],b[3]=a[2]):2===e?(b[0]=a[1],b[1]=8191-a[0],b[2]=a[3],b[3]=8191-a[2]):d?(b[0]=a[0],b[1]=8191-a[1],b[2]=a[2],b[3]=8191-a[3]):(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]),b[0]>b[2]){var g=b[0];b[0]=b[2],b[2]=g}if(b[1]>b[3]){var h=b[1];b[1]=b[3],b[3]=h}return f?(0===e?(c[0]=8191-b[2],c[1]=b[1],c[2]=8191-b[0],c[3]=b[3]):(c[0]=b[0],c[1]=8191-b[3],c[2]=b[2],c[3]=8191-b[1]),c):b}{var g=require("jsCore/pageBase"),h=require("jsCore/rpc");require("jsCore/rpcLogin")}require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect"),require("widget/js/dui.slider");var i,j,k,l,m,n,o,p,q,r,s=require("common/common"),t=s.Check,u=null,v=null,w=null,x=0,y=0,z=0,A=null,B=null,C=[0,32,48,64,80,96,128,160,192,224,256,320,384,448,512,640,768,896,1024,1280,1536,1792,2048,4096,6144,8192,10240,12288,14336,16384,18432,20480,22528,24576,26624,28672,30720,32768],D={Main:"H.264",Baseline:"H.264B",High:"H.264H"},E=0,F=["H.264"],G=!0,H=[],I=null,J=null,K=["H.264"],L=!1,M=[],N=[],O={},P="Extra1",Q=null,R=null,S=null,T=require("jsCore/flashplayer"),U=require("jsCore/pluginCanvas"),V=require("jsCore/hlsplayer"),W=require("jsCore/h5player"),X=null,Y=null,Z=null,$=!1,_=!1,ab=!1,bb=global.getWidthH,cb=!1,db=!1,eb=!1,fb=!1,gb=null;d.exports=g.extend({init:function(){u=this,u.IsFirstEntry={main:!0},H.length=0;for(var c=0;c<=webApp.MaxExtraStream;c++)H.push({Compression:"H.264",Policy:0});webApp.GongAnDetect&&(K.push("H.265"),u.$("#video_smart264_enable").parent().parent().show());var d=u.$("#enc_encode_channel");if(webApp.CHANNEL_NUMBER>1?(d.parent().removeClass("fn-hide"),d.parent().next("div").removeClass("fn-hide"),d.iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){z=b.ch,u._putvalueWater(j,z),u._putJsonEncode(i)}}),d.iconSelect("index",z)):(d.parent().next("div").remove(),d.parent().remove()),u.bind(),E=b.MaxSVCTLevel||0,F=b.SvcEncodeTypes||["H.264"],G=isEnable("special_GOP_728WP"),ability.get("EncodePriority").done(function(a){if(a&&a.definition){var b=a.definition||[];b.length>0&&(u.$("#video_PriorityWrap0").removeClass("fn-hide"),u.$("#video_PriorityWrap1").removeClass("fn-hide"))}}),E>0){for(var e="",c=1;E>=c;c++)e+='<option value="'+c+'">'+c+(1==c?"(off)":"")+"</option>";u.$("#video_svc0").append(e),u.$("#video_svc1").append(e),u.$("#video_mainSvc").removeClass("fn-hide"),u.$("#video_extrSvc").removeClass("fn-hide")}if(isEnable("is_show_mainStreamType")){var f=u.$("#video_streamType0");f.parent().removeClass("fn-hide");var g='<option value="1" t="med.Motion"></option>';(webApp.ALARM_IN_NUMBER>0||webApp.IsLocalStore)&&(g+='<option value="2" t="per.Alarm"></option>'),f.append(g).translation()}var k=u.$("#video_extraAudioList");ability.is("ExtraConflict").done(function(a){if(webApp.MaxExtraStream<1)u.$("#video_subStream_con").addClass("fn-hide");else if(webApp.MaxExtraStream<2)k.addClass("fn-hide");else{for(var b="",c=a?1:webApp.MaxExtraStream,d=0;c>d;d++)u.IsFirstEntry["extra"+d]=!0,b+="<option value="+d+' t="med.AuxiliaryStream+'+(d+1)+'"></option>';k.append(b).translation(),webApp.GongAnDetect&&(u.IsFirstEntry.extra2=!0,u.IsFirstEntry.extra3=!0,k.append('<option value="2" t="med.AuxiliaryStream+3"></option>').translation(),k.append('<option value="3" t="med.AuxiliaryStream+4"></option>').translation())}u.render()}),ability.get("RotateResolutionLimit").done(function(a){a&&u.$("#video_resolution0").data("limitR",a)}),h.Encode.getNAACaps(z).done(function(b){X=b,X.MainAdapt&&1==X.MainAdapt[0]?u.$("#video_net_mainAdapt").removeClass("fn-hide"):u.$("#video_net_mainAdapt").addClass("fn-hide");var c=a("#video_extraAudioList").val()-0;if(X.ExtraAdapt&&1===X.ExtraAdapt[c]?u.$("#video_net_assiAdapt").removeClass("fn-hide"):u.$("#video_net_assiAdapt").addClass("fn-hide"),X&&X.MainIPSmooth&&X.ExtraIPSmooth){u.$("#video_code_mainSlider").slider({min:1,max:100,value:50,complete:function(a,b){Y&&(Y[z].MainFormat[0].IPSmooth=~~b.value)}}),X.MainIPSmooth&&1===X.MainIPSmooth[0]&&webCaps.SupportIpsmooth?u.$("#video_code_mainSmooth").removeClass("fn-hide"):u.$("#video_code_mainSmooth").addClass("fn-hide");var c=a("#video_extraAudioList").val()-0;u.$("#video_code_assiSlider").slider({min:1,max:100,value:50,complete:function(b,c){if(Y){var d=a("#video_extraAudioList").val()-0;Y[z].ExtraFormat[d].IPSmooth=~~c.value}}}),X.ExtraIPSmooth&&1===X.ExtraIPSmooth[c]&&webCaps.SupportIpsmooth?u.$("#video_code_assiSmooth").removeClass("fn-hide"):u.$("#video_code_assiSmooth").addClass("fn-hide")}}),ability.get("VideoInputCapsEx").done(function(b){b&&b.VideoInConflict&&b.VideoInConflict.IsConflict&&a.each(b.VideoInConflict.ConflictTable,function(b,c){-1!==a.inArray("Extra2",c)&&-1!==a.inArray("TVOut",c)&&($=!0),-1!==a.inArray("Extra2",c)&&-1!==a.inArray("Cover",c)&&(_=!0)})}),B=u.$("#video_waterString"),A=a.validator([{element:B,check:[t.require,t.require],errorMsg:["com.NotNoneTip","com.NotNoneTip"],events:["keyup","blur"]}],function(a){a.parent().translation()}),ability.get("SupportBitRateUnite").done(function(a){a&&(eb=!0,fb=!0)})},bind:function(){webApp.DeviceType.indexOf("SD")>-1&&fb&&u.$('[id^="video_custom"]').on("change",function(){eb=!1}),u.$("#video_custom0").numberfield({allowNegative:!1,allowDecimal:!1}),u.$("#video_custom1").numberfield({allowNegative:!1,allowDecimal:!1}).blur(function(){var b=a(this).numberfield("value");a(this).data("val"+y,b)}),u.$("#video_gop0").numberfield({max:150,allowNegative:!1,allowDecimal:!1}).blur(function(){u._refreshEncodeCap(0)}),u.$("#video_gop1").numberfield({max:150,allowNegative:!1,allowDecimal:!1}).blur(function(){u._refreshEncodeCap(1)}),u.$("#video_waterString").textfield({charset:"utf-8",length:127}),u.$("#svcPsd0").textfield({validReg:/^[\x00-\x7f]+$/,errorHandle:"prevent"}).keyup(function(a){""===u.$(a.target).val()&&u.tip("warning","com.NullPwdTip")}),u.$("[name=video_cut_enable]").click(function(a){var b=a.target;u.disabled(u.$("#video_resolution1"),"VideoCut"===b.value),u.disabled(u.$("#video_setAreaZone"),"Resolution"===b.value),p[z][P].Enable=u.$("#radio_vid").prop("checked"),u.$("#video_resolution1").val()!==S&&(u.$("#video_resolution1").val(S),u.$("#video_resolution1").trigger("change"))}),r=u.$("#v_c_dialog").dialog({confirm:function(b,c){M=N,S=r.find("#videoCut_resolution").val(),p[z][P].Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Resolution=S,p[z][P].Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Region=M,u.$("#video_resolution1").val(S).trigger("change"),L=!1,plugin.SetGridNum(0,0),plugin.RegionClip(0,0,0,0,0,0),plugin.close(),plugin.hide(),c.ui.close(),plugin.addEvent("StateChangedCutZone",null),plugin.addEvent("ResolutionChangeEncode",null),V&&V.hideAndStopLoad(),T&&T.hide(),W&&W.hide(),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(U.hide(),a.unsubscribe("RegionChanged",null))},close:function(){L=!1,plugin.SetGridNum(0,0),plugin.RegionClip(0,0,0,0,0,0),plugin.close(),plugin.hide(),plugin.addEvent("StateChangedCutZone",null),plugin.addEvent("ResolutionChangeEncode",null),V&&V.hideAndStopLoad(),T&&T.hide(),W&&W.hide(),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(U.hide(),a.unsubscribe("RegionChanged",null))},resize:function(){"flash"===webApp.playMode?(T.cover("#v_c_cutzone"),U.resize("#v_c_cutzone")):"h5"===webApp.playMode?(W.cover(a("#v_c_cutzone")),U.resize("#v_c_cutzone")):plugin.cover("#v_c_cutzone")}}),r.dialog("setPosition",[310,615]),r.find("#videoCut_resolution").on("change",function(a){u._initCutZone(a.target.value,!0)}),u.$("#video_subStream_enable").on("click",function(b){a(b.target).prop("checked")&&"1"===u.$("#video_extraAudioList").val()&&$&&Z[z].Enable&&u.tip("warning","com.IntellMutexTVOutTip")})},setAreaZone:function(){return u.$("#video_resolution0").val()!==R?(u.tip("warning","com.MainResolusionChangedTip"),!1):(plugin.addEvent("ResolutionChangeEncode",function(){u._initCutZone(r.find("#videoCut_resolution").val(),!1)}),plugin.addEvent("StateChangedCutZone",function(){plugin.SetModuleMode(1),u._initCutZone(r.find("#videoCut_resolution").val(),!1)}),r.dialog("show"),r.find("#videoCut_resolution").val(S),u.openVideo(),void(L=!0))},openVideo:function(){if("hls"===webApp.playMode)V.cover(u.$("#v_c_cutzone")),plugin.hide(),V.init("","",""),V.beginPlay();else if("flash"===webApp.playMode||"h5"===webApp.playMode){"flash"===webApp.playMode?(T.cover(u.$("#v_c_cutzone")),T.playPreview(1,0)):"h5"===webApp.playMode&&(gb=new a.Deferred,W.playPreview(1,0,a("#v_c_cutzone"),null,gb));var b=u.$("#videoCut_resolution").val(),c=bb(b).split("*")[0]-0,d=bb(b).split("*")[1]-0,g=function(){N=M,N=f(N),U.cover("#v_c_cutzone",webApp.resolution.x+"*"+webApp.resolution.y),U.SetRegionNum(1),U.RegionClip(c,d,N[0],N[1],N[2],N[3]),a.subscribe("RegionChanged",function(a,b){b.length>1&&(N=e([b[0],b[1],b[2],b[3]]))})};"flash"===webApp.playMode?h.ConfigManager.getConfig(["Encode","VideoImageControl"]).done(function(a){if(webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[1].params.table[0].Rotate90||2==a[1].params.table[0].Rotate90){var b;b=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=b}g()}):"h5"===webApp.playMode&&gb&&gb.done(function(a){webApp.resolution.x=a.width,webApp.resolution.y=a.height,g()})}else plugin.cover("#v_c_cutzone",function(){plugin.open()})},leave:function(){u.$("#video_videoCutWrap").addClass("fn-hide"),u.$("#radio_res").addClass("fn-hide"),plugin.hide(),plugin.addEvent("RegionChanged",null),a(window).off("resize.encode")},destroy:function(){plugin.hide(),plugin.addEvent("RegionChanged",null),a(window).off("resize.encode")},_initCutZone:function(a,b){var c=0,d=0,e=[];N=M,c=bb(a).split("*")[0]-0,d=bb(a).split("*")[1]-0,N=f(N),e=b?[0,0,0,0]:N,O.Rotate90?plugin.RegionClip(d,c,e[0],e[1],e[2],e[3]):plugin.RegionClip(c,d,e[0],e[1],e[2],e[3]),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(O.Rotate90?U.RegionClip(d,c,0,0,0,0):U.RegionClip(c,d,0,0,0,0))},onSelectMode:function(b){var c=a(b.target),d=c.attr("id").slice(-1),e="#video_bitctrl"+d;"on"===c.val()?(u.$(e).val("VBR").change(),u.$("#video_showGop0").addClass("fn-hide")):(u.$(e).val("CBR").change(),u.$("#video_showGop0").removeClass("fn-hide")),v[0].Enable="on"===c.val()?!0:!1,E&&u.renderSvc(i[z].MainFormat[x].Video.Compression,0)},_freshNetAdaptEncode:function(){if(Y){a("#video_net_mainAdapt_sel").val(Y[z].MainFormat[0].AdaptEnable);var b=a("#video_extraAudioList").val()-0;Y[z].ExtraFormat[b]&&a("#video_net_assiAdapt_sel").val(Y[z].ExtraFormat[b].AdaptEnable),X&&X.MainIPSmooth&&X.ExtraIPSmooth&&webCaps.SupportIpsmooth&&(u.$("#video_code_mainSlider").slider("value",Y[z].MainFormat[0].IPSmooth),Y[z].ExtraFormat[b]&&u.$("#video_code_assiSlider").slider("value",Y[z].ExtraFormat[b].IPSmooth))}},render:function(){x=0,y=0,isEnable("is_show_mainStreamType")&&u.$("#video_streamType0").val(x),plugin.addEvent("RegionChanged",function(a,b,c,d,f){N=e([b,c,d,f])}),u.$("#video_extraAudioList").val(y),a.browser.ie11&&u.$("[sel-for=onRefreshEncodeCap]").prop("disabled",!0),h.ConfigManager.getConfig(["Encode","VideoWaterMark","MediaGlobal","EncodeEncrypt","EncodeAuth","VideoImageControl","EncodeCrop","NetAutoAdaptEncode","VideoOut"]).done(function(b){if(i=b[0].params.table,l=a.extend(!0,{},i),j=b[1].params.table,k=b[2].params.table,n=b[3].result&&b[3].params.table,o=b[4].result&&b[4].params.table,R=global.getFrame(i[z].MainFormat[0].Video.Width,i[z].MainFormat[0].Video.Height),Q=R,Y=b[7].result&&b[7].params.table,Z=b[8].result&&b[8].params.table,u._freshNetAdaptEncode(),b[5].result){var c=b[5].params.table[z].Rotate90;O=b[5].params.table[z],u.$("#video_resolution0").data("rotate",c)}b[6].result&&(p=b[6].params.table),u._getCapsConfig(),h.Encode.getConfigCaps(0,i).done(function(a){m=a,h.Encode.getCropCaps(z).done(function(a){J=a}),h.Encode.getSmartCaps(H,z).done(function(a){I=a,h.ConfigManager.getConfig("SmartEncode").done(function(a){v=a,w=v,u._initPage(),u._putvalue()}).fail(function(){I=null,u._initPage(),u._putvalue()})}).fail(function(){u._initPage(),u._putvalue()})})}),webApp.GongAnDetect&&h.ConfigManager.getConfig("smartH164Config").done(function(b){b&&b.result&&a("video_smart264_enable").prop("checked",b.Enable)}),_&&h.ConfigManager.getConfig("VideoWidget").done(function(a){if(a){var b=a[z]&&a[z].Covers||[];ab=b[0]&&b[0].EncodeBlend||b[1]&&b[1].EncodeBlend||b[2]&&b[2].EncodeBlend||b[3]&&b[3].EncodeBlend?!0:!1}}),a(window).on("resize.encode",function(){plugin.cover("#v_c_cutzone")})},_getCapsConfig:function(){for(var b=[i[z].MainFormat[0].Video],c=0;c<webApp.MaxExtraStream;c++)b.push(i[z].ExtraFormat[c].Video);b.length=webApp.MaxExtraStream+1,a.each(b,function(a,b){H[a].Compression=b.Compression})},_initPage:function(a){var b=m[z].MainFormat[x];if(I&&1===I[0]&&!a&&(q=v[0].Enable?"on":"off"),u._putEncodeCap(b,0,y),webApp.MaxExtraStream>0){var c=m[z].ExtraFormat[y];u._putEncodeCap(c,1,y)}},_putvalue:function(b,c,d){u._putvalueMain(i,z,x,b,c),u._putvalueExtr(i,z,y,b,c),u._putvalueWater(j,z),a.browser.ie11&&u.$("[sel-for=onRefreshEncodeCap]:not(.disabled)").prop("disabled",!1),0===b&&c&&d&&J&&J.Extra2.Support&&(S=p[z].Extra2.Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Resolution,u.$("#video_videoCutWrap").is(":visible")&&u.$("#radio_vid").prop("checked")&&(u.$("#video_resolution1").val(S),u.$("#video_resolution1").trigger("change"))),A.validate()},_putEncodeCap:function(b,c){var d=i[z].MainFormat[x].Video.Compression;I&&1===I[0]?"MJPG"===d?(u.$("#video_sencode0").parent().hide(),v[0].Enable=!1,u.$("#video_sencode0").val("off")):u.$("#video_sencode0").parent().show():u.$("#video_sencode0").parent().hide();var e=u.$("#video_compression"+c);e.empty();var f="";a.each(b.Video.CompressionTypes,function(c,d){isEnable("is_k6_DeviceType")&&"MJPG"==d||("H.264"==d?b.Video.H264Profile?a.each(b.Video.H264Profile,function(a,b){f+="<option value="+D[b]+" t=w_"+b+"></option>"}):(f+='<option value="H.264" t="H.264"></option>',f+='<option value="H.264B" t="H.264B"></option>',f+='<option value="H.264H" t="H.264H"></option>'):"H.265"==d?(f+='<option value="H.265" t="H.265"></option>',webApp.GongAnDetect&&(f+='<option value="H.265B" t="H.265B"></option>',f+='<option value="H.265H" t="H.265H"></option>')):f+="<option value="+d+" t="+d+"></option>")}),e.append(f).translation(),u._insertResolution(b.Video.ResolutionTypes,u.$("#video_resolution"+c)),1!==c||L||u._insertResolution(b.Video.ResolutionTypes,r.find("#videoCut_resolution"));var g=u.$("#video_fps"+c);g.empty(),0===b.Video.FPSMax&&g.append('<option value="0">0</option>');for(var h=0;h<b.Video.FPSMax;h++)g.append("<option value="+(h+1)+">"+(h+1)+"</option>");var j=b.Video.BitRateOptions;u.renderBitRate(u.$("#video_bitrate"+c),u.getBitRateList(j)),a("#video_bitrefer"+c).text(j[0]+"-"+j[1]+"Kb/S"),m[z].BitRateRange&&isEnable("is_show_CusBitRateRange")?(a("#video_custom"+c).numberfield("min",m[z].BitRateRange[0]),a("#video_custom"+c).numberfield("max",m[z].BitRateRange[1]),a("#video_custom_range"+c).text("("+m[z].BitRateRange[0]+"~"+m[z].BitRateRange[1]+")")):(a("#video_custom"+c).numberfield("min",j[0]),a("#video_custom"+c).numberfield("max",j[1]),a("#video_custom_range"+c).remove())},_insertResolution:function(b,c){c.empty(),a.each(b,function(a,b){var d=b;"720"==b&&(d="720P"),"1080"==b&&(d="1080P"),"1_3M"==b&&(d="1.3M"),"2_5M"==b&&(d="2.5M"),c.append("5_1M"==d?"<option value="+d+" realvalue="+b+">"+bb(d)+"(5M)</option>":"<option value="+d+" realvalue="+b+">"+bb(d)+"("+d+") </option>")})},_putvalueMain:function(b,c,d,e,f){var g=b[c].MainFormat[d],i=g.Video,j=global.getFrame(i.Width,i.Height);u.$("#video_resolution0").val(j),u.disabled(u.$("#video_resolution0"),!!d),u.disabled(u.$("#video_compression0"),!!d),u.$("#video_quality0").val(i.Quality),u.$("#video_gop0").val(i.GOP),E>0&&u.$("#video_svc0").val(i.SVCTLayer);var k=u.$("#video_compression0");a.inArray(i.Compression,K)>-1?("Baseline"==i.Profile&&k.val(i.Compression+"B"),"High"==i.Profile&&k.val(i.Compression+"H"),"Main"==i.Profile&&k.val(i.Compression)):k.val(i.Compression),E&&u.renderSvc(i.Compression,0),n&&o&&u.renderSVAC(i.Compression,0,i.SVCTLayer),k[0].selectedIndex<=0&&(k[0].selectedIndex=0),u.$("#video_resolution0")[0].selectedIndex<=0&&(u.$("#video_resolution0")[0].selectedIndex=0);var l=u.$("#video_bitctrl0");if("MJPG"==k.val()||"MPEG4"==k.val())l.val("CBR").change(),u.disabled(l,!0),u.$("#video_showQuality0").addClass("fn-hide"),"MJPG"==k.val()&&u.$("#video_showGop0").addClass("fn-hide"),"MPEG4"==k.val()&&u.$("#video_showGop0").removeClass("fn-hide");else if(u.disabled(l,!1),l.val(i.BitRateControl).change(),u.$("#video_showQuality0").toggleClass("fn-hide","CBR"==i.BitRateControl),I&&1===I[0]){var r="";if(r=v[0].Enable?"on":"off",u.$("#video_sencode0").val(r),k.children().is('option[value="MJPG"]')){var s=k.find('option[value="MJPG"]');"on"===q&&s.remove()}u.$("#video_showGop0").toggleClass("fn-hide","on"===r)}else u.$("#video_showGop0").removeClass("fn-hide");cb=l.val(),h.ConfigManager.getConfig("DynamicBitrate").done(function(a){db=a[0][0].DynamicFPSLevel}),u.$("#video_fps0").val(i.FPS);var t=u.$("#video_fps0 option").length;if(i.FPS>t&&(u.$("#video_fps0 option:last").prop("selected",!0),u.$("#video_gop0").val(G?2*t:12)),G){var w=u.$("#video_fps0").val()-0;u.$("#video_gop0_range").text("("+w+"~150)"),u.$("#video_gop0").numberfield("min",w)}else u.$("#video_gop0_range").text("(12~150)"),u.$("#video_gop0").numberfield("min",12);u.$("#video_gop0").attr("maxVal",150);var x=0===e,y=i.BitRate,z=m[c].MainFormat[d].Video.BitRateSuggested;f&&0===e&&z&&0!==z&&(y=z);var A;A=m[c].BitRateRange&&isEnable("is_show_CusBitRateRange")?u.getSuggestBitRate(m[c].BitRateRange,y,x):u.getSuggestBitRate(m[c].MainFormat[d].Video.BitRateOptions,y,x),eb&&!u.IsFirstEntry.main&&(A=m[c].MainFormat[d].Video.BitRateSuggested),u.putBitRateValue(0,A),u.$("#video_Priority0").val(b[c].MainFormat[d].Video.Priority||0),J&&J.Extra2.Support&&(M=p[c].Extra2.Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Region,S=p[c].Extra2.Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Resolution)},_putvalueExtr:function(b,c,d,e,f){if(!(webApp.MaxExtraStream<1)){var g=b[c].ExtraFormat[d],h=g.Video;u.$("#video_subStream_enable").prop("checked",g.VideoEnable);var i=global.getFrame(h.Width,h.Height);u.$("#video_resolution1").val(i),p&&p[c]&&p[c].Extra2&&(u.$("#radio_vid").prop("checked",p[c].Extra2.Enable),u.$("#radio_res").prop("checked",!p[c].Extra2.Enable),u.disabled(u.$("#video_resolution1"),d&&p[c].Extra2.Enable),u.disabled(u.$("#video_setAreaZone"),d&&!p[c].Extra2.Enable)),u.$("#video_quality1").val(h.Quality),u.$("#video_gop1").val(h.GOP),E>0&&u.$("#video_svc1").val(h.SVCTLayer);var j=u.$("#video_compression1");a.inArray(h.Compression,K)>-1?("Baseline"==h.Profile&&j.val(h.Compression+"B"),"High"==h.Profile&&j.val(h.Compression+"H"),"Main"==h.Profile&&j.val(h.Compression)):j.val(h.Compression),u.$("#video_fps1").val(h.FPS);var k=u.$("#video_fps1 option:first").val(),l=u.$("#video_fps1 option:last").val();E&&u.renderSvc(h.Compression,1),j[0].selectedIndex<0&&(j[0].selectedIndex=0),u.$("#video_resolution1")[0].selectedIndex<0&&(u.$("#video_resolution1")[0].selectedIndex=0,u.$("#video_resolution1").trigger("change"));var n=u.$("#video_bitctrl1");"MJPG"==j.val()||"MPEG4"==j.val()?(n.val("CBR").change(),u.disabled(n,!0),u.$("#video_showQuality1").addClass("fn-hide"),"MJPG"==j.val()&&u.$("#video_showGop1").css("display","none"),"MPEG4"==j.val()&&u.$("#video_showGop1").css("display","block")):(u.$("#video_showGop1").css("display","block"),u.disabled(n,!1),n.val(h.BitRateControl).change(),u.$("#video_showQuality1").toggleClass("fn-hide","CBR"==h.BitRateControl));var o=null;if(h.FPS<k?(u.$("#video_fps1").val(k),o=G?2*(k-0):12,u.$("#video_gop1").val(o)):h.FPS>l&&(u.$("#video_fps1").val(l),o=G?2*(l-0):12,u.$("#video_gop1").val(o)),G){var q=u.$("#video_fps1").val()-0;u.$("#video_gop1_range").text("("+q+"~150)"),u.$("#video_gop1").numberfield("min",q)}else u.$("#video_gop1_range").text("(12~150)"),u.$("#video_gop1").numberfield("min",12);u.$("#video_fps1").attr("maxVal",150);var r=1===e,s=h.BitRate,t=m[c].ExtraFormat[d].Video.BitRateSuggested;f&&t&&0!==t&&1===e&&(s=t);var v=null;v=m[c].BitRateRange&&isEnable("is_show_CusBitRateRange")?u.getSuggestBitRate(m[c].BitRateRange,s,r):u.getSuggestBitRate(m[c].ExtraFormat[d].Video.BitRateOptions,s,r);var w=u.$("#video_extraAudioList").val();eb&&!u.IsFirstEntry["extra"+w]&&(v=m[c].ExtraFormat[d].Video.BitRateSuggested),u.putBitRateValue(1,v),u.$("#video_Priority1").val(b[c].ExtraFormat[d].Video.Priority||0)}},_putvalueWater:function(a,b){var c=a[b],d=u.$("#video_water_enable");d.prop("checked",c.Enable),u.$("#video_water_show").toggleClass("fn-hide",!c.Enable),u.$("#video_waterString").val(c.String)},renderSvc:function(b,c){0===c?v&&v[0].Enable?u.$("#video_mainSvc").addClass("fn-hide"):a.inArray(b,F)<0?u.$("#video_mainSvc").addClass("fn-hide"):u.$("#video_mainSvc").removeClass("fn-hide"):u.$("#video_extrSvc").toggleClass("fn-hide",a.inArray(b,F)<0);var d=["H.264"];switch(c){case 0:webApp.GongAnDetect&&a.inArray(b,d)>-1?u.$("#video_PriorityWrap0").show():u.$("#video_PriorityWrap0").hide();break;case 1:webApp.GongAnDetect&&a.inArray(b,d)>-1?u.$("#video_PriorityWrap1").show():u.$("#video_PriorityWrap1").hide()}},renderSVAC:function(a,b,c){if("SVAC"===a){u.$("#video_mainSvac"+b).show();var d=n[z][b],e=o[z];u.$("#video_svac_svc"+b).val(2===c?c:1),u.$("#video_svcPwd_enable"+b).prop("checked",d.EncryptEnable),u.$("#svcPsd"+b).val(d.Key),u.$("#video_encodeAuth_enable"+b).prop("checked",e.Enable),u.disabled(u.$("#svcPsd"+b),!d.EncryptEnable)}else u.$("#video_mainSvac"+b).hide()},renderBitRate:function(b,c){var d="";a.each(c,function(a,b){d+='<option value="'+b+'">'+b+"</option>"}),d+='<option value="customize" t="sys.Customed">Customized</option>',b="element"==a.type(b)?b:a(b),b.html(d).translation(),b.data("BitRateList",c.join(","))},getSuggestBitRate:function(a,b,c){var d=u.getBitRateList(a),e=((a[0]+a[1])/2).toInt();if(b>=a[0]&&b<=a[1])return b;for(var f=0;f<d.length;f++)if(d[f]>=e)return d[f];return c?e:d[f-1]},putBitRateValue:function(b,c){var d=u.$("#video_bitrate"+b),e=u.$("#video_customwrap"+b),f=u.$("#video_custom"+b);d.val(c);var g=d.data("BitRateList").split(",");a.inArray(c.toString(),g)>-1?(d.next("span").show(),e.addClass("fn-hide")):(d.val("customize"),d.next("span").hide(),e.removeClass("fn-hide"),f.val(c).blur())},getBitRateList:function(b){var c=a.grep(C,function(a){return a>=b[0]&&a<=b[1]});return c.sort(function(a,b){return a-b})},_saveEncode:function(b){var c=i[b].MainFormat[x];c.Video.Priority=u.$("#video_Priority0").val()-0,u._saveEncodeByType(c,0);var d=null;if(webApp.MaxExtraStream>0){d=i[b].ExtraFormat;var e=d[y];e.Video.Priority=u.$("#video_Priority1").val()-0,u._saveEncodeByType(e,1),u.$("#video_subStream_enable").prop("checked")?e.VideoEnable=!0:(e.VideoEnable=!1,e.AudioEnable=!1)}var f=c.Video.Width,g=c.Video.Height;"ExtraFormat"==k.SnapFormatAs?(f=d[0].Video.Width,g=d[0].Video.Height):"Extra2Format"==k.SnapFormatAs?(f=d[1].Video.Width,g=d[1].Video.Height):"Extra3Format"==k.SnapFormatAs&&(f=d[2].Video.Width,g=d[2].Video.Height);var h=i[b].SnapFormat;a.each(h,function(a,b){b.Video.Width=f,b.Video.Height=g})},_saveEncodeByType:function(a,b){var c=u.$("#video_compression"+b).val(),d=null;"H.264"==c?d="Main":"H.264B"==c?(d="Baseline",c="H.264"):"H.264H"==c&&(d="High",c="H.264"),"H.265"==c?d="Main":"H.265B"==c?(d="Baseline",c="H.265"):"H.265H"==c&&(d="High",c="H.265"),a.Video.Compression=c,null!==d&&(a.Video.Profile=d);var e=bb(u.$("#video_resolution"+b).val()).split("*");a.Video.Width=e[0]-0,a.Video.Height=e[1]-0,E>0&&(a.Video.SVCTLayer=u.$("#video_svc"+b).val()-0),a.Video.FPS=u.$("#video_fps"+b).val()-0,a.Video.BitRateControl=u.$("#video_bitctrl"+b).val(),a.Video.Quality=u.$("#video_quality"+b).val()-0,a.Video.BitRate="customize"==u.$("#video_bitrate"+b).val()?u.$("#video_custom"+b).val()-0:u.$("#video_bitrate"+b).val()-0,a.Video.GOP=u.$("#video_gop"+b).val()-0},saveSVAC:function(){n[z][0].EncryptEnable=u.$("#video_svcPwd_enable0").prop("checked"),n[z][0].Key=u.$("#svcPsd0").val(),o[z].Enable=u.$("#video_encodeAuth_enable0").prop("checked"),i[z].MainFormat[0].Video.SVCTLayer=u.$("#video_svac_svc0").val()-0},onSave:function(){var b=function(b){var c=u.$("#video_resolution0").data("rotate");if(c){var d=u.$("#video_resolution0 option:selected").attr("realvalue");if(a.inArray(d,u.$("#video_resolution0").data("limitR"))<0){var e="";return"SimpChinese"!=global.currentLanguage&&(e=1==c?"med.Clockwise90Ex":"med.Clockwise90Ex2"),u.tip("error",tl("com.NoResolutionTip")+tl(e)),!1}}var f=u.$("#video_water_enable").prop("checked");j[z].Enable=f,f&&(j[z].String=u.$("#video_waterString").val()),u._saveEncode(z),u._checkBitRate();var g=["Encode","VideoWaterMark"],k=[i,j];if(I&&1===I[0]&&(g.push("SmartEncode"),k.push(v)),null!==X&&Y){Y[z].MainFormat[0].AdaptEnable=a("#video_net_mainAdapt_sel").val()-0;var m=a("#video_extraAudioList").val()-0;Y[z].ExtraFormat[m]&&(Y[z].ExtraFormat[m].AdaptEnable=a("#video_net_assiAdapt_sel").val()-0),g.push("NetAutoAdaptEncode"),k.push(Y)}if("SVAC"===u.$("#video_compression0").val()&&(u.saveSVAC(),g.push("EncodeEncrypt","EncodeAuth"),k.push(n,o),""===u.$("#svcPsd0").val()))return void u.tip("warning","com.NullPwdTip");if(0!==x||isEnable("is_show_mainStreamType")||(i[z].MainFormat[1].Video=i[z].MainFormat[2].Video=i[z].MainFormat[0].Video),J&&J.Extra2.Support&&p[z].Extra2.Enable&&(k[0][z].ExtraFormat[1].Video.Width=bb(S).split("*")[0]-0,k[0][z].ExtraFormat[1].Video.Height=bb(S).split("*")[1]-0),ab&&_){var q=k[0][z].ExtraFormat[1].VideoEnable;if(q)return void u.tip("warning",tl("med.CoverExtra2Conflict"))}a.browser.ie11&&u.$("[sel-for=onRefreshEncodeCap]").prop("disabled",!0),h.ConfigManager.setConfig(g,k).done(function(c){var d=0;if(a.each(c,function(b,c){c&&!c.result&&(d=2,a.each(c.params.options,function(a,b){return"CapsNotSupport"==b?(d=1,!1):void 0}))}),d)1===d?u.tip("error","com.RorateresolutiongSavingFailureTip"):2===d&&u.tip("error","com.SaveConfigFailTip");else if(J&&J.Extra2.Support)R=Q,p[z].Extra2.Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Region=M,p[z].Extra2.Config[u.$("#video_resolution0 option:selected").attr("realvalue")].Resolution=S,h.ConfigManager.setConfig("EncodeCrop",p).done(function(){var d=i[z].MainFormat[0].Video;"SVAC"==d.Compression&&(n.EncryptEnable&&plugin.SetDecodeKey(n.Key),d.SVCTLayer-1||plugin.ChooseFrame(0)),webApp.isNeedReboot(c)&&webApp.reboot("com.RebootingTip"),h.ConfigManager.getConfig("Encode").done(function(c){i=c,l=a.extend(!0,{},i),u._putJsonEncode(i),b&&h.MagicBox.reboot()}),R=u.$("#video_resolution0").val(),Q=R,u.tip("success","com.SaveSuccessTip")}).fail(function(){u.tip("error","com.SaveConfigFailTip")});else{var e=i[z].MainFormat[0].Video;"SVAC"==e.Compression&&(n.EncryptEnable&&plugin.SetDecodeKey(n.Key),e.SVCTLayer-1||plugin.ChooseFrame(0)),webApp.isNeedReboot(c)&&webApp.reboot("com.RebootingTip"),h.ConfigManager.getConfig("Encode").done(function(c){i=c,l=a.extend(!0,{},i),u._putJsonEncode(i),b&&h.MagicBox.reboot()}),R=u.$("#video_resolution0").val(),Q=R,u.tip("success","com.SaveSuccessTip")}}).fail(function(){u.tip("error","com.SaveConfigFailTip")})};if(I&&1===I[0]&&void 0!==q&&u.$("#video_sencode0").val()!==q?a.confirm(tl("ivs.Scode"),tl("com.SureToRebootTip"),function(){b(!0)}):b(!1),webApp.GongAnDetect){var c=u.$("#video_smart264_enable").prop("checked"),d={Enable:c};h.ConfigManager.setConfig("smartH164Config",d).done(function(){})}},onRefresh:function(){for(var a in u.IsFirstEntry)u.IsFirstEntry[a]=!0;h.ConfigManager.getConfig(["Encode","VideoWaterMark","EncodeEncrypt","EncodeAuth","EncodeCrop","NetAutoAdaptEncode"]).done(function(a){i=a[0].params.table,j=a[1].params.table,n=a[2].result&&a[2].params.table,o=a[3].result&&a[3].params.table,p=a[4].result&&a[4].params.table,Y=a[5].result&&a[5].params.table,u._freshNetAdaptEncode(),u._putvalueWater(j,z),u._putJsonEncode(i),R=global.getFrame(i[z].MainFormat[0].Video.Width,i[z].MainFormat[0].Video.Height),Q=R,p&&("1.3M"===Q?(M=p[z][P].Config["1_3M"].Region,S=p[z][P].Config["1_3M"].Resolution):(M=p[z].Extra2.Config[Q].Region,S=p[z].Extra2.Config[Q].Resolution)),u.tip("success","com.OperateSuccessTip")}).fail(function(){u.tip("error","com.OperateFailTip")}),webApp.GongAnDetect&&h.ConfigManager.getConfig("smartH164Config").done(function(a){u.$("#video_smart264_enable").prop("checked",a.Enable)})},onDefault:function(){h.ConfigManager.getDefault(["Encode","VideoWaterMark","EncodeEncrypt","EncodeAuth","EncodeCrop","NetAutoAdaptEncode"]).done(function(b){var c=b[0].params.table;j=b[1].params.table,n=b[2].result&&b[2].params.table,o=b[3].result&&b[3].params.table,p=b[4].result&&b[4].params.table,Y=b[5].result&&b[5].params.table,u._freshNetAdaptEncode();var d=i[z].MainFormat,e=i[z].ExtraFormat;a.each(c[z].MainFormat,function(b,c){d[b]&&(d[b].Video=a.extend(!0,{},c.Video))}),a.each(c[z].ExtraFormat,function(b,c){e[b]&&(e[b].Video=a.extend(!0,{},c.Video),e[b].VideoEnable=c.VideoEnable)}),u._putvalueWater(j,z),u._getCapsConfig(),h.Encode.getConfigCaps(0,i).done(function(a){m=a,h.Encode.getSmartCaps(H,z).done(function(a){I=a,h.ConfigManager.getDefault("SmartEncode").done(function(a){v=a,u._initPage(!0),u._putvalue()}).fail(function(){I=null,u._initPage(),u._putvalue()})}).fail(function(){u._initPage(),u._putvalue()})}),R=global.getFrame(i[z].MainFormat[0].Video.Width,i[z].MainFormat[0].Video.Height),Q=R,p&&(S=p[z][P].Config[Q].Resolution,M=p[z][P].Config[Q].Region),u.tip("success","com.DefaultSuccessTip")}).fail(function(){u.tip("error","com.DefaultfailureTip")}),webApp.GongAnDetect&&h.ConfigManager.getDefault("smartH164Config").done(function(a){u.$("#video_smart264_enable").prop("checked",a.Enable)})},_checkBitRate:function(){var b=i[z].ExtraFormat;a.each(m[z].ExtraFormat,function(a,c){b[a].Video.BitRate=m[z].BitRateRange&&isEnable("is_show_CusBitRateRange")?u.getSuggestBitRate(m[z].BitRateRange,b[a].Video.BitRate):u.getSuggestBitRate(c.Video.BitRateOptions,b[a].Video.BitRate)})},_putJsonEncode:function(a){u._getCapsConfig(),h.Encode.getConfigCaps(0,a).done(function(a){m=a,h.Encode.getSmartCaps(H,z).done(function(a){I=a,h.ConfigManager.getConfig("SmartEncode").done(function(a){v=a,u._initPage(),u._putvalue()}).fail(function(){I=null,u._initPage(),u._putvalue()})}).fail(function(){u._initPage(),u._putvalue()})})},onRefreshEncodeCap:function(b){function c(){if(0==f)u.IsFirstEntry.main=!1;else if(1==f){var a=u.$("#video_extraAudioList").val();u.IsFirstEntry["extra"+a]=!1}}webApp.DeviceType.indexOf("SD")>-1&&fb&&(eb=!0);var d=b.target.id,e=d.substr(0,d.length-1),f=d.substr(d.length-1,1)-0;switch(Q=u.$("#video_resolution0").val(),c(),e){case"video_compression":u._refreshEncodeCap(f,!0);break;case"video_resolution":u._refreshEncodeCap(f,!0,!0);
break;case"video_fps":var g=G?2*(a("#"+d).val()-0):12;a("#video_gop"+f).val(g),ability.get("SuggestEncode").done(function(a){a?u._refreshEncodeCap(f,!0):u._refreshEncodeCap(f)})}},onSelectBitRate:function(b){webApp.DeviceType.indexOf("SD")>-1&&fb&&(eb=!1);var c=b.target.id,d=c.substr(c.length-1,1)-0,e=u.$("#video_customwrap"+d),f=u.$("#video_custom"+d);if("customize"==u.$("#"+c).val()){e.removeClass("fn-hide"),u.$("#"+c).next("span").hide();var g=a("#video_bitrefer"+d).text().split("-"),h=f.val()-0;1===d&&(h=f.data("val"+y)||h),(isNaN(h)||h<g[0]||h>g[1])&&(h=(parseInt(g[0])+parseInt(g[1]))/2),f.val(h).blur()}else u.$("#"+c).next("span").show(),e.addClass("fn-hide")},onSelectBitctrl:function(a){var b=a.target.id,c=b.substr(b.length-1,1)-0,d=a.target.value,e="VBR"===d?"med.StreamUpperLimit":"med.StreamKbs";return"video_bitctrl0"===b&&0!==db&&"CBR"===d&&db!==!1?(u.$("#video_bitctrl0").val("VBR"),void u.tip("error","sto.ModifyConfigS")):(cb=d,u.$("#video_showQuality"+c).toggleClass("fn-hide","CBR"==d),0===c&&u.$("#video_bitrate0").parent().prev("label").attr("t",e).parent().translation(),void(1===c&&u.$("#video_bitrate1").parent().prev("label").attr("t",e).parent().translation()))},_refreshEncodeCap:function(b,c,d){a.browser.ie11&&u.$("[sel-for=onRefreshEncodeCap]").prop("disabled",!0),u._saveEncode(z,!0);var e=a.map(i,function(b){return a.extend(!0,{},b)});isEnable("is_show_mainStreamType")||(e[z].MainFormat[1].Video=e[z].MainFormat[2].Video=e[z].MainFormat[0].Video);var f=u.$("#video_compression"+b).val(),g=0;"H.264"===f.slice(0,5)?f="H.264":"H.265"===f.slice(0,5)&&(f="H.265"),0===b?g=0:0!==b&&"0"===u.$("#video_extraAudioList").val()||0!==b?g=1:0!==b&&"1"===u.$("#video_extraAudioList").val()&&(g=2),webApp.GongAnDetect&&("2"===u.$("#video_extraAudioList").val()&&(g=1),"3"===u.$("#video_extraAudioList").val()&&(g=2)),H[g].Compression=f,h.Encode.getConfigCaps(0,e).done(function(e){null!==a("ENCODECFG")&&(m=e,h.Encode.getSmartCaps(H,z).done(function(a){I=a}).always(function(){u._initPage(!0),u._putvalue(b,c,d)}))})},onSelectExtr:function(b){"0"===b.target.value?P="Extra1":"1"===b.target.value&&(P="Extra2"),u._saveEncode(z),y=b.target.value-0,2===y&&webApp.GongAnDetect&&(y=0),3===y&&webApp.GongAnDetect&&(y=1);var c=m[z].ExtraFormat[y];1===y&&J&&J.Extra2&&J.Extra2.Support?("1.3M"===Q?(M=p[z].Extra2.Config["1_3M"].Region,S=p[z].Extra2.Config["1_3M"].Resolution):(M=p[z].Extra2.Config[Q].Region,S=p[z].Extra2.Config[Q].Resolution),u.$("#video_videoCutWrap").removeClass("fn-hide"),u.$("#radio_res").removeClass("fn-hide")):(u.$("#video_videoCutWrap").addClass("fn-hide"),u.$("#radio_res").addClass("fn-hide"),u.disabled(u.$("#video_resolution1"),!1)),u._putEncodeCap(c,1,y),u._putvalueExtr(i,z,y),null!==X&&(1===X.ExtraAdapt[y]?(u.$("#video_net_assiAdapt").removeClass("fn-hide"),Y&&a("#video_net_assiAdapt_sel").val(Y[z].ExtraFormat[y].AdaptEnable)):u.$("#video_net_assiAdapt").addClass("fn-hide")),X&&X.MainIPSmooth&&X.ExtraIPSmooth&&webApp.DeviceType.indexOf("SD")>-1&&(1===X.ExtraIPSmooth[y]?(u.$("#video_code_assiSmooth").removeClass("fn-hide"),Y&&a("#video_code_assiSlider").slider("value",Y[z].ExtraFormat[y].IPSmooth)):u.$("#video_code_assiSmooth").addClass("fn-hide"))},onClickWater:function(b){var c=a(b.target).prop("checked");u.$("#video_water_show").toggleClass("fn-hide",!c)},onSelectMain:function(a){u._saveEncode(z),x=a.target.value-0;var b=m[z].MainFormat[x];u._putEncodeCap(b,0,y),u._putvalueMain(i,z,x)},onClickPassword:function(a){var b=u.$(a.target).prop("checked");u.disabled(u.$("#svcPsd0"),!b)}})}),define("enc_snap",function(require,b,c){var d,e,f=require("jsCore/pageBase"),g=require("jsCore/rpc"),h=require("jsCore/ability"),i=(require("jsCore/rpcLogin"),require("common/common")),j=null,k=0,l=!1,m=null,n=0,o=global.getWidthH,p=!1;c.exports=f.extend({init:function(){j=this,j.$("#snapSpeed_customized").numberfield({max:5e4,min:1,allowNegative:!1,allowDecimal:!1}),h.get("RadioMetry").done(function(a){p=a&&a.Support?!0:!1});var a=j.$("#enc_snap_channel");webApp.CHANNEL_NUMBER>1?(a.parent().removeClass("fn-hide"),a.parent().next("div").removeClass("fn-hide"),a.iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){n=b.ch,"thermal"===webApp.CHANNEL_TYPE[n]?p&&j.$("#snap_heatBox").removeClass("fn-hide"):j.$("#snap_heatBox").addClass("fn-hide"),j._putvalueSnap(d,n,k)}}),a.iconSelect("index",n)):(a.parent().next("div").remove(),a.parent().remove(),p&&j.$("#snap_heatBox").removeClass("fn-hide")),h.get("SnapshotInterval").done(function(a){a&&(j.$("#snapSpeed_customized").numberfield("max",a),j.$("#snapinterval").text("(1-"+a+")"))}),j.$('input[name= "snap_selSnapFormatsAs"]').click(j._selSnapFormatsAs),j.render()},render:function(){var a=["Encode","MediaGlobal"];k=0,p&&a.push("RadioDataInJpeg"),g.ConfigManager.getConfig(a).done(function(a){d=a[0].params.table,e=a[1].params.table,e.SnapFormatAs&&isEnable("is_has_SnapFormatAs")?(l=!0,j.$("#snap_showSnapFormatAs").removeClass("fn-hide")):j.$("#snap_showSnapFormatAs").addClass("fn-hide"),p&&(m=a[2].params.table),j._putvalueSnap(d,n,k)})},_putvalueSnap:function(a,b,c,d){j.$("#snap_snaptype").val(c);var f=j.$("#snap_resolution"),g=a[b].SnapFormat[c];if(!d){var h=global.getFrame(g.Video.Width,g.Video.Height),i=h;"5_1M"===h&&(i="5M"),f.val(i+" ("+o(h)+")")}j.disabled(f),l&&j.$("input[value="+e.SnapFormatAs+"]").prop("checked",!0);var k=a[0].ExtraFormat[0].VideoEnable;j.disabled(j.$("#snapSub_enable"),!k),j.$("#snap_imgQuality").val(g.Video.Quality);var n=Math.round(1/g.Video.FPS);n>7?(j.$("#snap_snapSpeed").val("Customized"),j.$("#snapSpeed_customized_wrap").removeClass("fn-hide")):(j.$("#snap_snapSpeed").val("-"+n),j.$("#snapSpeed_customized_wrap").addClass("fn-hide")),j.$("#snapSpeed_customized").val(n),j.$("#snap_heatBox").hasClass("fn-hide")||j.$("#snap_heatMap").prop("checked",m[b].Enable)},_saveSnap:function(){var b=d[n],c=b.MainFormat[0].Video,f=b.SnapFormat;l&&(j.$("#snapSub_enable").prop("checked")?(c=b.ExtraFormat[0].Video,e.SnapFormatAs="ExtraFormat"):j.$("#snapMain_enable").prop("checked")&&(e.SnapFormatAs="MainFormat"));var g=c.Width,h=c.Height;a.each(f,function(a,b){b.Video.Width=g,b.Video.Height=h}),f[k].Video.Quality=j.$("#snap_imgQuality").val()-0,f[k].Video.FPS=j._getSnapSpeed()},_getSnapSpeed:function(){var a=j.$("#snap_snapSpeed"),b=1;if("Customized"==a.val()){var c=j.$("#snapSpeed_customized");b=1/(c.val()-0)}else{var d=a.val()-0;b=0>d?-1/d:d}return b},onDefault:function(){var b=["Encode","MediaGlobal"];p&&b.push("RadioDataInJpeg"),g.ConfigManager.getDefault(b).done(function(b){var c=b[0].params.table,f=b[1].params.table;d[n].SnapFormat=a.map(c[n].SnapFormat,function(b){return a.extend(!0,{},b)}),e.SnapFormatAs=f.SnapFormatAs,p&&(m[n]=b[2].params.table[n]),j._putvalueSnap(d,n,k,!0),j.tip("success","com.DefaultSuccessTip")}).fail(function(){j.tip("error","com.DefaultfailureTip")})},onRefresh:function(){var a=["Encode","MediaGlobal"];p&&a.push("RadioDataInJpeg"),g.ConfigManager.getConfig(a).done(function(a){d=a[0].params.table,e=a[1].params.table,p&&(m=a[2].params.table),j._putvalueSnap(d,n,k),j.tip("success","com.OperateSuccessTip")}).fail(function(){j.tip("error","com.OperateFailTip")})},onSave:function(){var a=["Encode","MediaGlobal"],b=[d,e];p&&(m[n].Enable=j.$("#snap_heatMap").prop("checked"),a.push("RadioDataInJpeg"),b.push(m)),j._saveSnap(),g.ConfigManager.setConfig(a,b).done(function(a){i.chkMutilCallRet(a)?j.tip("success","com.SaveSuccessTip"):j.tip("error","com.SaveConfigFailTip")})},onChangeSnap:function(a){j._saveSnap(),k=a.target.value-0,j._putvalueSnap(d,n,k)},onChangeSpeed:function(a){var b=a.target.value;"Customized"==b?j.$("#snapSpeed_customized_wrap").removeClass("fn-hide"):j.$("#snapSpeed_customized_wrap").addClass("fn-hide")},_selSnapFormatsAs:function(b){var c=a(b.target).val(),e=d[n].MainFormat[0].Video;"ExtraFormat"==c&&(e=d[n].ExtraFormat[0].Video);var f=global.getFrame(e.Width,e.Height),g=f;"5_1M"===f&&(g="5M"),j.$("#snap_resolution").val(g+" ("+o(f)+")")}})}),define("enc_osd",function(require,c,d){function e(a){for(var b="",c=0;3>c;c++)b+=parseInt(a[c])>9?parseInt(a[c]).toString(16):"0"+parseInt(a[c]).toString(16);return b}function f(a,b){!function c(a){for(var d in a)if(a.hasOwnProperty(d)){if("FrontColor"==d)return a[d][0]=b[0]-0,a[d][1]=b[1]-0,void(a[d][2]=b[2]-0);if(a[d]instanceof Array)for(var e=0;e<a[d].length;e++)c(a[d][e]);else a[d]instanceof Object&&c(a[d])}}(a)}function g(a,b,c,d,e,f,g){a=a||[0,0,0,0],c=(J*c).toInt(),d=(K*d).toInt();var h=a[0]+c>8191?8191-c:a[0],i=a[1]+d>8191?8191-d:a[1];plugin.SetRegionNum(0),plugin.SetRegionNum(1),plugin.SetRegionAttributeByIndex(0,b,1,0,0,0),setTimeout(function(){plugin.SetSelRegionByIndex(0,h,i,h+c,i+d)},0),e&&(R.SetRegionNum(1),R.SetSelRegionByIndex(0,h,i,h+c,i+d,f,g))}function h(a,b,c,d){var e=function(){R.cover("#video_OSD_node",webApp.resolution.x+"*"+webApp.resolution.y),g(a,b,c,d,!0,!1,!0)};"flash"===webApp.playMode?l.ConfigManager.getConfig(["Encode","VideoImageControl"]).done(function(a){if(webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[1].params.table[0].Rotate90||2==a[1].params.table[0].Rotate90){var b;b=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=b}e()}):"h5"===webApp.playMode&&kb&&kb.done(function(a){webApp.resolution.x=a.width,webApp.resolution.y=a.height,e()})}function i(b){p[N].CustomTitle[1].FrontColor=b,p[N].TimeTitle.FrontColor=b,p[N].ChannelTitle.FrontColor=b,p[N].PTZPreset&&(p[N].PTZPreset.FrontColor=b),p[N].Temperature&&(p[N].Temperature.FrontColor=b),p[N].PTZCoordinates&&(p[N].PTZCoordinates.FrontColor=b),p[N].PTZZoom&&(p[N].PTZZoom.FrontColor=b),p[N].PTZOSDMenu&&(p[N].PTZOSDMenu.FrontColor=b),p[N].PTZOSDMenuViaApp&&(p[N].PTZOSDMenuViaApp.FrontColor=b),p[N].PTZDirection&&(p[N].PTZDirection.FrontColor=b),p[N].GPSTitle&&(p[N].GPSTitle.FrontColor=b),p[N].VoltageStatus&&(p[N].VoltageStatus.FrontColor=b),p[N].PtzPattern&&(p[N].PtzPattern.FrontColor=b),p[N].PtzRS485Detect&&(p[N].PtzRS485Detect.FrontColor=b),G&&(t.FrontColor=b),X&&(p[N].OSDMobileState.FrontColor=b),W&&(V[N].FrontColor=b),-1!==webApp.DeviceType.indexOf("TPC")&&p[N].PictureTitle&&(p[N].PictureTitle.FrontColor=b),H&&(webApp.IsSDIntel&&!webApp.NoIntelliPreset?a.each(s[N],function(a,c){c.FrontColor=b}):s[N].FrontColor=b),p[N].TrafficFlowTitle&&(p[N].TrafficFlowTitle.FrontColor=b),$&&(Z[N].FrontColor=b),fb&&(eb[N].FrontColor=b),ib&&(jb[N].FrontColor=b)}require("jsCore/modules/minPtzControl"),require("widget/js/dui.colorpicker");var j,k=require("jsCore/pageBase"),l=require("jsCore/rpc"),m=require("jsCore/ability"),n=require("common/common"),o=require("jsCore/rpcLogin"),p={},q={},r={},s={},t={},u={},v=!1,w={},x={},y=!1,z={},A=!1,B=!1,C=!1,D={},E=!1,F=[],G=!1,H=!1,I={},J=16.382,K=8191/374,L="/current_config/",M=null,N=0,O=!0,P=require("jsCore/hlsplayer"),Q=require("jsCore/flashplayer"),R=require("jsCore/pluginCanvas"),S=require("jsCore/h5player"),T=!1,U=!1,V={},W=!1,X=!1,Y=!1,Z={},$=!1,_=!1,ab=global.getDefaultRect,bb=!1,cb=!1,db=!1,eb=null,fb=0,gb=null,hb=!1,ib=!1,jb=null,kb=null;d.exports=k.extend({init:function(){M=this,-1===webApp.DeviceType.indexOf("IPC")&&a.when(m.get("PTZCaps",!0),m.get("PtzFunctionMenu")).then(function(a,b){b&&b.Support&&a&&a.Preset!==!1&&(A=!0,M.$("#osd_preset").removeClass("fn-hide"))}),l.FaceBoard.getCaps().done(function(b){if(b){var c=b.Temperatures||[],d=b.OSDTemperatureUnit||[];if(B=c.length?!0:!1,C=d.length?!0:!1,B&&(M.$("#osd_temperature").removeClass("fn-hide"),3===c.length&&(E=!0,F=b.Temperatures,M.$("#osd_temperature_cavity").removeClass("fn-hide"),l.ConfigManager.getConfig("MultiTemperatureOSD").done(function(a){D=a}))),C){M.$("#osd_TempUnit_wrap").removeClass("fn-hide");var e={Centigrade:"ºC",Fahrenheit:"ºF",Kelvin:"K"},f="";a.each(d,function(a,b){f+='<option value= "'+b+'">'+e[b]+"</option>"}),M.$("#osd_TempUnit").html(f)}b.HasAtmosphere&&($=b.HasAtmosphere,M.$('[data-for="osd_weather"]').removeClass("fn-hide"))}}),isEnable("is_show_image")&&M.$('[data-for="osd_image"]').removeClass("fn-hide"),isEnable("is_show_fontSize")&&(M.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),M.$("#osd_fontsGrade").removeClass("fn-hide"),I.grade=!0),m.get("FontColour").done(function(a){(a&&a.Support||"thermal"===webApp.CHANNEL_TYPE[N])&&(I.color=!0,M.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),M.$("#osd_fontColor").removeClass("fn-hide"),M.$('[data-for = "osd_fontSetting"] span').attr("t","com.Font;title::com.Font").parent().translation())}),m.get("FontBorder").done(function(a){a&&a.Support&&(I.border=!0,M.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),M.$("#osd_fontBorder_wrap").removeClass("fn-hide"),M.$('[data-for = "osd_fontSetting"] span').attr("t","com.Font;title::com.Font").parent().translation())}),m.get("FontSize").done(function(b){b&&b.Support&&(M.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),a.inArray("Grade",b.Type)>-1&&(I.grade=!0,M.$("#osd_fontsGrade").removeClass("fn-hide")),a.inArray("Pixel",b.Type)>-1&&(I.pixel=!0,M.$("#osd_fontsPixel").removeClass("fn-hide"),I.grade=!1,M.$("#osd_fontsGrade").addClass("fn-hide"),M.$('[data-for = "osd_fontSetting"] span').attr("t","com.Font;title::com.Font").parent().translation()))}),l.OSDManager.getCaps().done(function(a){G=a.OSDSysAbnormal&&a.OSDSysAbnormal.Support,I.rowHeight=a.OSDLineSpacing&&a.OSDLineSpacing.Support,G&&M.$('[data-for="osd_abnormal"]').removeClass("fn-hide"),I.rowHeight&&(M.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),M.$("#osd_fontsHeight").removeClass("fn-hide")),ib=a&&a.SolarCell&&a.SolarCell.Support,ib&&M.$("#osd_SolarCell").removeClass("fn-hide")}),m.get("OSDMobileState").done(function(a){a&&a.Support&&(X=a.Support,M.$('[data-for="osd_4g"]').removeClass("fn-hide"))}),webApp.DeviceType.indexOf("SD")>-1?(M.$('[data-for="osd_covers"]').remove(),M.$('[data-page="osd_covers"]').remove(),M.$("#osd_ipc_left_con").addClass("fn-hide"),isEnable("is_show_LocationInfo")||M.$("#osd_location").addClass("fn-hide")):(M.$('[data-for = "osd_osdcombination"] span').attr("t","com.Location;title::com.Location"),M.$('[data-for = "osd_osdcombination"]').attr("isLocaltion","true").translation(),(!isEnable("is_show_location")||isEnable("is_8M_Flash"))&&M.$('[data-for = "osd_osdcombination"]').addClass("fn-hide"),0===b.MaxCoverCount&&(M.$('[data-for="osd_covers"]').remove(),M.$('[data-page="osd_covers"]').remove())),isEnable("is_8M_Flash")&&(M.$('[data-for = "osd_fontSetting"]').addClass("fn-hide"),M.$('[data-for = "osd_image"]').addClass("fn-hide")),m.get("IsGpsInfoOsd").done(function(a){a&&(M.$('[data-for = "osd_GPS"]').removeClass("fn-hide"),webApp.GongAnDetect&&M.$("#osd_GPS_mode_wrap").removeClass("fn-hide"))}),m.get("GPS").done(function(a){y=a&&a.ManualInput}),l.LaserDistMeasure.getCaps().done(function(a){a&&a.Support&&1===isEnable("is_show_MeasureDistance")&&(M.$('[data-for = "osd_SDMeasureDistance"]').removeClass("fn-hide"),z=a)}),m.is("DSPConflict").done(function(b){b||(l.trafficFlowStat.getCaps().done(function(a){a&&2===a.Support&&M.$('[data-for = "osd_trafic"]').removeClass("fn-hide")}),l.FaceFlowStat.getCaps().done(function(a){a&&a.Support&&(M.$('[data-for = "osd_face"]').removeClass("fn-hide"),fb=a.Support)}),m.get("IVSCaps").done(function(b){return b?(hb=-1!==a.inArray("StereoNumber",b.SupportedScene),H=(webApp.IsIPCIntel||webApp.IsSDIntel)&&(-1!==a.inArray("NumberStat",b.SupportedScene)||-1!==a.inArray("NumberStatPlan",b.SupportedScene)||hb),H&&M.$('[data-for="osd_flowrate"]').removeClass("fn-hide"),void(-1!==a.inArray("ObjectDetect",b.SupportedScene)&&(M.$('[data-for = "osd_trafic"] span').attr("t","ivs.ObjectFlowStat"),M.$('[data-for = "osd_trafic"]').translation()))):!1}))}),a.when(m.get("PTZCaps",!0),m.get("PrivacyMasking")).then(function(b,c){if(b){if(u.PrivacyMasking=b.PrivacyMasking&&b.PrivacyMasking.Support,u.PtzPatternOSD=!!b.SupportPtzPatternOSD,u.PtzRS485DetectOSD=!!b.SupportPtzRS485DetectOSD,u.Zoom=b.Zoom,u.Focus=b.Focus,u.Iris=b.Iris,M.$("#osd_PTZPattern").toggleClass("fn-hide",!u.PtzPatternOSD),M.$("#osd_PTZRS485").toggleClass("fn-hide",!u.PtzRS485DetectOSD),M.$('[data-for = "osd_privateMask"]').toggleClass("fn-hide",!u.PrivacyMasking||!o.chkAuthority("MPTZ")),webApp.DeviceType.indexOf("SD")>-1){var d=b.VoltageStatus;d&&d.Support&&(v=!0,a('li[data-for="osd_voltage"]').css("display","block"))}b.PtzExtendPeripheralCheck&&b.PtzExtendPeripheralCheck.Peripherals&&-1!==a.inArray("MagSensor",b.PtzExtendPeripheralCheck.Peripherals)&&(Y=!0)}c&&c.Support&&(M.$('[data-for = "osd_privateMask"]').removeClass("fn-hide"),M.$('[data-for="osd_covers"]').remove(),M.$('[data-page="osd_covers"]').remove(),M.$("#video_OSD_delete").hide(),M.$("#video_privmask_goto").hide(),bb=!0)}).always(function(){M.$('[data-for = "osd_privateMask"]').hasClass("fn-hide")&&(M.$('[data-for = "osd_privateMask"]').remove(),M.$('[data-page="osd_privateMask"]').remove()),require.async("jsCore/pageTab",function(a){M.$("#osd_content").data("osdTab",new a({element:M.$("#osd_content")})),M.$("#osd_content .u-tab").tab("disableNextAll")}),-1!==webApp.DeviceType.indexOf("TPC")&&M.$('[data-for = "osd_fontSetting"] span').attr("t","com.Font;title::com.Font").parent().translation();var a=M.$("#enc_osd_channel");webApp.CHANNEL_NUMBER>1?(a.parent().removeClass("fn-hide"),a.parent().next("div").removeClass("fn-hide"),a.iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){N=b.ch,M.render()}}),a.iconSelect("index",N)):(a.parent().next("div").remove(),a.parent().remove()),M.render()}),M._initPtz(),webApp.GongAnDetect&&a("#font_size_largest").show(),m.get("MagSensor").done(function(a){a&&(T=a.Support)}),m.get("LensZoomThermal").done(function(a){a&&a.Support&&(U=!0)}),webCaps.Customize&&webCaps.Customize.OSD1&&M.$("#li_newtext1").removeClass("fn-hide"),webCaps.Customize&&webCaps.Customize.OSD2&&M.$("#li_newtext2").removeClass("fn-hide"),m.get("PtzRoadInfo").done(function(b){if(b&&b.Support){W=b.Support;for(var c=0;4>c;c++)a('<input type="text" class="ui-input fn-marb1" id="osd_road_info_'+c+'"/>').textfield({length:21,asciiByte:2,notAsciiByte:3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}).appendTo(M.$("#osd_road_info"));M.$("#osd_RoadUnit").removeClass("fn-hide"),M.$('[t="com.Location;title::com.Location"]').addClass("fn-hide"),M.$('[t="med.OsdRoadOrLocaInfo;title::med.OsdRoadOrLocaInfo"]').removeClass("fn-hide")}}),m.get("MeasureDistance").done(function(a){_=a&&a.Support&&"Laser"===a.Type&&2===isEnable("is_show_MeasureDistance"),_&&(_=a,M.$('[data-for="osd_laserDistMeasure"]').removeClass("fn-hide"))}),m.get("VideoInputCapsEx").done(function(b){b&&b.VideoInConflict&&b.VideoInConflict.IsConflict&&a.each(b.VideoInConflict.ConflictTable,function(b,c){-1!==a.inArray("Extra2",c)&&-1!==a.inArray("Cover",c)&&(cb=!0)})}),m.get("SupportOsdRestructure").done(function(a){1==a&&(M.$("[data-for=osd_customOsd]").removeClass("fn-hide"),M.$("[data-for=osd_fontAttr]").removeClass("fn-hide"),M.$("#osd_channel_textalign").parent().removeClass("fn-hide"),M.$("[data-for=osd_fontSetting]").addClass("fn-hide"))})},render:function(){O=!0,"hls"==webApp.playMode?(P.cover(a("#video_OSD_node")),plugin.hide(),P&&(P.init("","",""),P.beginPlay())):"flash"===webApp.playMode?(M.$("#video_OSD_delete_tip").hide(),Q.cover(a("#video_OSD_node")),Q.playPreview(1,0)):"h5"===webApp.playMode?(kb=new a.Deferred,M.$("#video_OSD_delete_tip").hide(),S.playPreview(1,0,a("#video_OSD_node"),null,kb)):plugin.cover("#video_OSD_node",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(1),-1!==webApp.DeviceType.indexOf("TPC")||webApp.CHANNEL_NUMBER>1?(plugin.SetVisibleVideoWnd(1,N),o.chkAuthority("Monitor_0"+(N+1))&&plugin.ConnectRealVideoEx(N,N,0),o.chkAuthority("Monitor_0"+(N+1))||plugin.SetVideoWndTip(N,tl("noVideoAuthoity"))):plugin.open(),-1!==webApp.DeviceType.indexOf("TPC")&&("thermal"===webApp.CHANNEL_TYPE[N]?M.$("#osd_fontColor").removeClass("fn-hide"):M.$("#osd_fontColor").addClass("fn-hide"),I.color="thermal"===webApp.CHANNEL_TYPE[N]),a&&M.onRefresh(!1)});var b,c=m.get("PTZCaps",!0).done(function(a){a&&(u.PrivacyMasking=a.PrivacyMasking&&a.PrivacyMasking.Support,u.PTZZoom=!!a.SupportPTZZoom,u.Coordinates=!!a.SupportPTZCoordinates,u.DirectionDisplay=!!a.DirectionDisplay,u.PtzPatternOSD=!!a.SupportPtzPatternOSD,u.PtzRS485DetectOSD=!!a.SupportPtzRS485DetectOSD,u.Zoom=a.Zoom,u.Focus=a.Focus,u.Iris=a.Iris)});b=webApp.IsSDIntel&&!webApp.NoIntelliPreset?"VideoWidgetNumberPlan":"VideoWidgetNumberStat";var d=l.ConfigManager.getConfig(["VideoWidget","ChannelTitle",b,"OSDSysAbnormal","VideoWidget2","GPS","VideoWidgetRoadInfo","AtmosphereOSD","LaserDistMeasure","FaceFlowStat","DevLocation","VideoWidgetSolarCellStat"]).done(function(a){p=a[0].params.table,r=a[1].params.table,gb=a,a[2].result&&(s=a[2].params.table),a[3].result&&(t=a[3].params.table),a[4].result&&(q=a[4].params.table),a[5].result&&(w=a[5].params.table),a[6].result&&(V=a[6].params.table),a[7].result&&(Z=a[7].params.table),a[8].result&&(j=a[8].params.table),a[9].result&&(eb=a[9].params.table),a[10].result&&(x=a[10].params.table),a[11].result&&(jb=a[11].params.table)}).always(function(){M.$("#osd_content .u-tab").tab("enableNextAll")});a.when(c,d,m.get("OSDCustom")).done(function(){O&&(M._displayByPTZCaps(),M.$("#osd_content").data("osdTab").render())}),cb&&l.ConfigManager.getConfig("Encode").done(function(a){a&&a[N]&&a[N].ExtraFormat&&(db=a[N].ExtraFormat[1].VideoEnable)})},leave:function(){O=!1,plugin.SetRegionNum(0),plugin.hide(),plugin.close(),P&&P.hideAndStopLoad(),Q&&Q.hide(),S&&S.hide(),M.$("#osd_content").data("osdTab").leave()},_initPtz:function(){M.$("#osd_PTZ").minPtzControl("init"),M.$("#osd_PTZ").minPtzControl("togglePTZ",!1)},_displayByPTZCaps:function(){M.$("#osd_coordinates").toggleClass("fn-hide",!u.Coordinates),M.$("#osd_PTZZoom").toggleClass("fn-hide",!(u.PTZZoom&&(-1===webApp.DeviceType.indexOf("TPC")||0===N||1===N&&U))),M.$("#osd_direction").toggleClass("fn-hide",!u.DirectionDisplay)},onSave:function(){M.$("#osd_content").data("osdTab").current.save();var b=["ChannelTitle","VideoWidget"],c=[r,p];if(H){var d;d=webApp.IsSDIntel&&!webApp.NoIntelliPreset?"VideoWidgetNumberPlan":"VideoWidgetNumberStat",b.push(d),c.push(s)}if(I.rowHeight&&(b.push("VideoWidget2"),c.push(q)),$&&(b.push("AtmosphereOSD"),c.push(Z)),webApp.GongAnDetect&&(b.push("GPS"),c.push(w)),E&&(b.push("MultiTemperatureOSD"),c.push(D)),W&&(b.push("VideoWidgetRoadInfo"),c.push(V)),G&&(b.push("OSDSysAbnormal"),c.push(t)),(_||z&&z.Support)&&(b.push("LaserDistMeasure"),c.push(j)),y&&(b.push("DevLocation"),c.push(x)),db&&cb){var e=M.$("#osd_covers_enable_on").prop("checked")?!0:!1;if(e)return void M.$(".u-tip:first").tip("warning",tl("med.CoverExtra2Conflict"))}fb&&(b.push("FaceFlowStat"),c.push(eb)),ib&&(b.push("VideoWidgetSolarCellStat"),c.push(jb)),l.ConfigManager.setConfig(b,c).done(function(c){n.chkMutilCallRet(c)?M.$(".u-tip:first").tip("success",tl("com.SaveSuccessTip")):M.$(".u-tip:first").tip("error",tl("com.SaveConfigFailTip")),!n.chkMutilCallRet(c)&&c[a.inArray("VideoWidget",b)].error&&285475073===c[a.inArray("VideoWidget",b)].error.code&&(plugin.hide(),a.alert(tl("per.PtzStartingTip"),function(){"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node")}))})},onRefresh:function(a){M._getConfig(a)},_getConfig:function(a){var b;b=webApp.IsSDIntel&&!webApp.NoIntelliPreset?"VideoWidgetNumberPlan":"VideoWidgetNumberStat",l.ConfigManager.getConfig(["VideoWidget","ChannelTitle",b,"OSDSysAbnormal","VideoWidget2","GPS","MultiTemperatureOSD","VideoWidgetRoadInfo","AtmosphereOSD","LaserDistMeasure","FaceFlowStat","DevLocation","VideoWidgetSolarCellStat"]).done(function(b){p=b[0].params.table,r=b[1].params.table,gb=b,b[2].result&&(s=b[2].params.table),b[3].result&&(t=b[3].params.table),b[4].result&&(q=b[4].params.table),b[5].result&&(w=b[5].params.table),b[6].result&&(D=b[6].params.table),b[7].result&&(V=b[7].params.table),b[8].result&&(Z=b[8].params.table),b[9].result&&(j=b[9].params.table),b[10].result&&(eb=b[10].params.table),b[11].result&&(x=b[11].params.table),b[12].result&&(jb=b[12].params.table),M.$("#osd_content").data("osdTab").render(),a&&M.$(".u-tip:first").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){M.$(".u-tip:first").tip("error",tl("com.OperateFailTip"))})},onDefault:function(){var b;b=webApp.IsSDIntel&&!webApp.NoIntelliPreset?"VideoWidgetNumberPlan":"VideoWidgetNumberStat",l.ConfigManager.getDefault(["VideoWidget","ChannelTitle",b,"OSDSysAbnormal","VideoWidget2","GPS","MultiTemperatureOSD","VideoWidgetRoadInfo","AtmosphereOSD","LaserDistMeasure","FaceFlowStat","DevLocation","VideoWidgetSolarCellStat"]).done(function(b){if(p=b[0].params.table,r=b[1].params.table,gb=b,b[2].result){var c=b[2].params.table;hb&&a.each(c,function(a,b){b.ShowEnterNum=s[a].ShowEnterNum,b.ShowExitNum=s[a].ShowExitNum,b.ShowInsideNum=s[a].ShowInsideNum}),s=c}b[3].result&&(t=b[3].params.table),b[4].result&&(q=b[4].params.table),b[5].result&&(w=b[5].params.table),b[6].result&&(D=b[6].params.table),b[7].result&&(V=b[7].params.table),b[8].result&&(Z=b[8].params.table),b[9].result&&(j=b[9].params.table),b[10].result&&(eb=b[10].params.table),b[11].result&&(x=b[11].params.table),b[12].result&&(jb=b[12].params.table),M.$("#osd_content").data("osdTab").render(),M.$(".u-tip:first").tip("success",tl("com.DefaultSuccessTip"))}).fail(function(){M.$(".u-tip:first").tip("error",tl("com.DefaultfailureTip"))})}}),define("osd_covers",function(require,c,d){var e=null,f=0,g=0;d.exports=k.extend({init:function(){e=this,f=b.MaxCoverCount,a("#page_encodeConfig #OSD_delete_all_covers").click(function(){e._clearCover()}),a("#page_encodeConfig #OSD_delete_selected_cover").click(function(){e._delCover()}),e.render()},render:function(){var b=p[N]&&p[N].Covers||[];if(a("#page_encodeConfig #osd_ipc_left_con").removeClass("fn-hide"),plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);g[0]==g[2]||g[1]==g[3]?b[a].Rect=[0,0,0,0]:(b[a]||(b[a]={BackColor:[0,0,0,128],EncodeBlend:!1,FrontColor:[255,255,255,0],PreviewBlend:!1,Rect:[0,0,0,0]}),b[a].Rect=g)}),b[0]&&b[0].EncodeBlend||b[1]&&b[1].EncodeBlend||b[2]&&b[2].EncodeBlend||b[3]&&b[3].EncodeBlend?e.$("#osd_covers_enable_on").prop("checked",!0):e.$("#osd_covers_enable_off").prop("checked",!0),plugin.SetRegionNum(0),plugin.SetRegionNum(-f),a.each(b,function(a,b){var c=b.Rect[0],d=b.Rect[1],e=b.Rect[2],f=b.Rect[3];c!=e&&d!=f&&plugin.SetSelRegionByIndex(a,c,d,e,f)}),"flash"==webApp.playMode||"h5"===webApp.playMode){var c=function(){R.cover("#video_OSD_node",webApp.resolution.x+"*"+webApp.resolution.y),R.SetRegionNum(b.length),a.each(b,function(a,b){var c=b.Rect[0],d=b.Rect[1],e=b.Rect[2],f=b.Rect[3];g=a,R.SetSelRegionByIndex(a,c,d,e,f,!0)})};"flash"==webApp.playMode?l.ConfigManager.getConfig(["Encode","VideoImageControl"]).done(function(a){if(webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[1].params.table[0].Rotate90||2==a[1].params.table[0].Rotate90){var b;b=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=b}c()}):"h5"===webApp.playMode&&kb&&kb.done(function(a){webApp.resolution.x=a.width,webApp.resolution.y=a.height,c()}),a.subscribe("RegionChanged",function(a,b){g=b[b.length-1],b.length>1&&(p[N].Covers[g].Rect=b.splice(0,b.length-1))})}},leave:function(){a("#page_encodeConfig #osd_ipc_left_con").addClass("fn-hide"),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),e.save()},save:function(){var b=e.$("#osd_covers_enable_on").prop("checked");a.each(p[N].Covers,function(a,c){c.EncodeBlend=0===c.Rect[0]&&0===c.Rect[1]&&0===c.Rect[2]&&0===c.Rect[3]?!1:b})},_clearCover:function(){plugin.DelSelReg(-2),("flash"===webApp.playMode||"h5"===webApp.playMode)&&R.DelSelReg(-2),a.each(p[N].Covers,function(a,b){b.Rect=[0,0,0,0]})},_delCover:function(){plugin.DelSelReg(-1),("flash"===webApp.playMode||"h5"===webApp.playMode)&&R.DelSelReg(-1)}})}),define("osd_privateMask",function(require,b,c){var d=null,e=null,f=0,g=null,h="V1",i={},j=!1;c.exports=k.extend({init:function(){d=this,d.onDrawing=!1,d.$("#osd_pr_color span").on("click",function(){d.$(".border-white").removeClass("border-white"),a(this).addClass("border-white")}),m.get("PTZCaps").done(function(a){var b=a&&a.PrivacyMasking;b&&(b.SetColorSupport&&d.initColor(b.SetColorSupport,b.SetColorIndependent),b.SetMosaicSupport&&b.SupportType?(j=!0,j&&(d._renderMosaicReslution(b.SupportMosaicType),d.$("#osd_pr_drawtype_wrap").removeClass("fn-hide"),d.$("#osd_pr_shapeWrap").remove()),d.initShape(b.SupportType)):b.SupportType&&(j=!0,d.onlySupportPolygon=!0,d.initShape(b.SupportType)),b.Version&&("V1"===b.Version?h="V1":"V2"===b.Version&&(h="V2"))),d._bindSpeedMark(),d.render()}).fail(function(){d._bindSpeedMark(),d.render()})},render:function(){if(d.isFirstChangeMosaic=!0,plugin.SetRegionNum(0),"New"==d.ocxEntry?plugin.addEvent("VideoAnalyzeConfig",function(a){config=JSON.parse(a);var b=config.EventParam.ShapeState;b&&3==b&&d._ocxEventDone(config.EventParam.ShapeID)}):plugin.addEvent("RegionChanged",function(a,b,c,e,f){d.onOcxDrawRegion(b,c,e,f)}),"flash"==webApp.playMode||"h5"===webApp.playMode){var b=function(){R.cover("#video_OSD_node",webApp.resolution.x+"*"+webApp.resolution.y),a.subscribe("IVSRuleConfig",function(a,b){d._getTuOcxData(b)})};"flash"===webApp.playMode?l.ConfigManager.getConfig(["Encode","VideoImageControl"]).done(function(a){if(webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[1].params.table[0].Rotate90||2==a[1].params.table[0].Rotate90){var c;c=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=c}b()}):"h5"===webApp.playMode&&kb&&kb.done(function(a){webApp.resolution.x=a.width,webApp.resolution.y=a.height,b()})}a("#osd_sd_save_el").addClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",!0),"thermal"===webApp.CHANNEL_TYPE[1]&&a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId),j&&jQuery("#Polygon_small_action_icon").removeClass("fn-hide"),d.getPrivacyMaskingList(),d.switchOcxPrivacyMasking(!1)},_renderMosaicReslution:function(a){for(var b=d.$('[sel-for="onMskChange"]').empty(),c="",e=0,f=a.length;f>e;e++)c+='<option value="'+a[e]+'">'+a[e]+"*"+a[e]+"</option>";b.append(c),b.val(64)},leave:function(){d._ocxEnale(!1),plugin.addEvent("VideoAnalyzeConfig",null),plugin.addEvent("RegionChanged",null),a("#osd_sd_save_el").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",!1),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),jQuery("#Polygon_small_action_icon").addClass("fn-hide")},renderMaskList:function(){var b=a("#video_privmask_number"),c="";"V1"===h?a.each(e[N],function(a,b){bb&&a>3||(c+="<option value="+a+' class="'+(b.Enable?"":"fn-gray")+'">'+(a+1)+"</option>")}):"V2"===h&&a.each(i[N],function(a,b){bb&&a>3||(c+="<option value="+a+' class="'+(b.Enable?"":"fn-gray")+'">'+(a+1)+"</option>")}),b.html(c),b.val(f),j&&d.onRelationChannel(!0)},onChangeMask:function(){return j?void d.onTuChangeMask():(d.switchOcxPrivacyMasking(!1),a("#video_privmask_draw").removeClass("ui-button-special-hover"),f=a("#video_privmask_number").val(),void(d.MosaicSupport&&(a("#osd_pr_Mosaic").val(e[N][f].Mosaic||0),d.onMosaicChange())))},onShapeChange:function(){d._ocxClear()},_getOcxData:function(a){if(j)return void d._getTuOcxData(a);if("V1"===h){if(a.Polygon)e[N][f].ShapType="Polygon",e[N][f].Polygon=a.Polygon;else{e[N][f].ShapType="Rect";var b=a.Rect;e[N][f].Rect=[b[0][0],b[0][1],b[1][0],b[1][1]]}d._saveData()}else if("V2"===h){if(a.Polygon)i[N][f].ShapeType="Polygon",i[N][f].Polygon=a.Polygon;else{i[N][f].ShapeType="Rect";var b=a.Rect;i[N][f].Rect=[b[0][0],b[0][1],b[1][0],b[1][1]]}d._saveData()}},_saveData:function(){bb||"V1"===h&&g.done(function(a){e[N][f].Postion=a.Postion
}),d.setMaskColor(),d.MosaicSupport&&("V1"===h?e[N][f].Mosaic=a("#osd_pr_Mosaic").val()-0:"V2"===h&&(i[N][f].Mosaic=a("#osd_pr_Mosaic").val()-0)),d.savePrivMaskConfig(!0),d.renderMaskList()},initColor:function(b,c){b===!0&&(d.colorSupport=!0,a("#osd_pr_colorWrap").removeClass("fn-hide"),c===!0?d.colorIndependent=!0:a("#osd_pr_colorWrap").insertBefore("#osd_pr_number_wrap"))},setMaskColor:function(){if(d.colorSupport===!0){var b=d.$(".border-white").attr("data-color"),c=d.getColorRGB(b);d.colorIndependent?e[N][f].Color=c:a.each(e[N],function(a,b){b.Enable&&(b.Color=c)})}},getColorRGB:function(a){var b={red:[255,0,0,255],orange:[255,150,0,255],yellow:[255,255,0,255],green:[93,214,33,255],blueGreen:[25,233,233,255],blue:[0,60,255,255],purple:[200,0,255,255],black:[0,0,0,255]};return b[a]},initShape:function(b){if(-1!==a.inArray("Polygon",b)){d.ocxEntry="New";for(var c="",e=0;e<b.length;e++)switch(b[e]){case"Rect":c+='<option t="med.Rectangle" value="Rect">'+tl("med.Rectangle")+"</option>";break;case"Polygon":c+='<option t="med.Polygon" value="Polygon">'+tl("med.ColorLunp")+"</option>";break;default:c+='<option t="com.Unknow" value="'+b[e]+'">'+tl("com.Unknow")+"</option>"}a("#osd_pr_ShapType").html(c),a("#osd_pr_ShapType").val("Polygon").prop("disabled",!0)}},initMosaic:function(b,c){if(b===!0){d.MosaicSupport=!0,d.MosaicSupportType=c||[24];for(var e='<option value="0" t="med.ColorLunp">'+tl("med.ColorLunp")+"</option>",f=0;f<d.MosaicSupportType.length;f++){var g=d.MosaicSupportType[f],h="mosaic+("+g+"x"+g+")";e+='<option value="'+g+'" t="'+h+'"></option>'}a("#osd_pr_Mosaic").html(e).translation(),a("#osd_pr_mosWrap").removeClass("fn-hide")}},onMosaicChange:function(){a("#osd_pr_Mosaic").val()-0!==0?a("#osd_pr_colorWrap").addClass("fn-hide"):d.colorSupport&&a("#osd_pr_colorWrap").removeClass("fn-hide")},onDrawClick:function(){return j?void d.onTuDrawClick():void(a("#video_privmask_draw").hasClass("ui-button-special-hover")?(a.unsubscribe("RegionChanged",null),d.switchOcxPrivacyMasking(!1)):(a.subscribe("RegionChanged",function(a,b){b.length>1&&d.onOcxDrawRegion(b[0],b[1],b[2],b[3])}),"V1"===h?e[N][f].Enable=!0:"V2"===h&&(i[N][f].Enable=1),d.switchOcxPrivacyMasking(!0),bb||(g=l.PTZ.getStatus().fail(function(){d.tip("error","com.OperateFailTip")}))))},onDelClick:function(){function b(){d.switchOcxPrivacyMasking(!1),e[N][f].Enable=!1,e[N][f].Polygon=[],e[N][f].Rect=[0,0,0,0],"flash"==webApp.playMode||"h5"===webApp.playMode?R.clearCanvas():d._ocxClear(),d.renderMaskList(),a("#video_privmask_draw").removeClass("ui-button-special-hover"),d.$("[sel-for=onShowRectOrMosaic]").prop("disabled",!1)}"V1"===h?(b(),d._ocxClear(),d.savePrivMaskConfig(!0)):"V2"===h&&(d.switchOcxPrivacyMasking(!1),l.PrivacyMasking.deletePrivacyMasking(N,f-0).done(function(){d.tip("success","com.OperateSuccessTip"),b()}).fail(function(){d.tip("error","com.OperateFailTip")}))},onCleanClick:function(){function b(){d.switchOcxPrivacyMasking(!1);for(var b=0;b<e[N].length;b++)e[N][b].Enable=!1,e[N][b].Rect=[0,0,0,0],e[N][b].Polygon=[];"flash"==webApp.playMode||"h5"===webApp.playMode?d.overDraw():d._ocxClear(),d.renderMaskList(),a("#video_privmask_draw").removeClass("ui-button-special-hover"),d.$("[sel-for=onShowRectOrMosaic]").prop("disabled",!1)}"V1"===h?(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.ClearPrivacyMaskConfirmTip"),function(){b(),d.savePrivMaskConfig(!0),"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node")},function(){"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node")},!0)):"V2"===h&&(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.ClearPrivacyMaskConfirmTip"),function(){d.switchOcxPrivacyMasking(!1),l.PrivacyMasking.clearPrivacyMasking(N).done(function(){d.tip("success","com.OperateSuccessTip"),b(),"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&plugin.cover("#video_OSD_node")}).fail(function(){d.tip("error","com.OperateFailTip")})},function(){"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&plugin.cover("#video_OSD_node")},!0))},onGotoClick:function(){if("V1"===h){if(e[N][f].Enable&&"0,0,0,0"!==e[N][f].Rect.toString()){var a=e[N][f].Postion;l.PTZ.moveAbsolutely(a,null,N)}}else"V2"===h&&(!i[N][f].Enable||"0,0,0,0"===i[N][f].Rect.toString()&&0==i[N][f].Polygon.length||l.PrivacyMasking.gotoPrivacyMasking(N,f-0))},onSaveClick:function(){d._saveData(),d.$("#video_privmask_draw").removeClass("fn-hide"),d.$("#video_privmask_save").addClass("fn-hide"),d.$("#video_privmask_draw").removeClass("ui-button-special-hover")},onOcxDrawRegion:function(a,b,c,g){(0!==a||0!==b||0!==g||0!==c)&&("V1"===h?e[N][f].Rect=[a,b,c,g]:"V2"===h&&(i[N][f].Rect=[a,b,c,g]),e[N][f].ShapeType="Rect",d._saveData())},savePrivMaskConfig:function(a,b){"V1"===h?l.ConfigManager.setConfig("PrivacyMasking",e).done(function(){a&&d.tip("success","com.OperateSuccessTip"),(webApp.DeviceType.indexOf("SD")>-1||bb)&&d.switchOcxPrivacyMasking(!1),"flash"==webApp.playMode||"h5"===webApp.playMode}).fail(function(){d.tip("error","com.OperateFailTip"),("flash"==webApp.playMode||"h5"===webApp.playMode)&&d.$("#video_privmask_draw").removeClass("ui-button-special-hover")}):"V2"===h&&l.PrivacyMasking.setPrivacyMasking(N,i[N][f]).done(function(){a&&d.tip("success","com.OperateSuccessTip"),(webApp.DeviceType.indexOf("SD")>-1||bb)&&(j?"flash"==webApp.playMode||"h5"===webApp.playMode?d.mosaicChangeWithRect?(d.mosaicChangeWithRect=!1,jQuery("body").off("click.canvas")):jQuery("body").off("click.canvas").on("click.canvas",function(a){"canvas"!=a.target.id&&(d.overDraw(),jQuery("body").off("click.canvas"))}):d.mosaicChangeWithRect?(d.mosaicChangeWithRect=!1,jQuery("body").off("click.ocx")):jQuery("body").off("click.ocx").on("click.ocx",function(a){"ocx"!=a.target.id&&(d.overDraw(),jQuery("body").off("click.ocx"))}):d.switchOcxPrivacyMasking(!1))}).fail(function(){b&&b>4?(d.tip("warning",tl("com.CurrentDevOnlySupport4Polygon")),d.$('[sel-for="onShowRectOrMosaic"]').prop("disabled",!1)):d.tip("error","com.OperateFailTip"),"flash"==webApp.playMode||"h5"==webApp.playMode?(d.overDraw(),d.$("#video_privmask_draw").removeClass("ui-button-special-hover")):d._ocxClear(),d.isNewDraw&&(i[N][f]={})})},getPrivacyMaskingList:function(){"V1"===h?l.ConfigManager.getConfig("PrivacyMasking").done(function(a){e=a,d.renderMaskList()}).fail(function(){d.tip("error","com.OperateFailTip")}):"V2"===h&&l.PrivacyMasking.getPrivacyMasking(N,0,24).done(function(a){i[N]=a.params.PrivacyMasking,e=i,d.renderMaskList()}).fail(function(){d.tip("error","com.OperateFailTip")})},_ocxEnale:function(a){"New"==d.ocxEntry?plugin.EnableVideoAnalyseModule(a):(plugin.SetRegionNum(a===!1?0:1),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(R.SetRegionNum(a===!1?0:1),R.SetSelRegionByIndex(0,0,0,0,0)))},_ocxCreateMainVideoAnalyseShape:function(b){if("New"==d.ocxEntry){var c=a("#osd_pr_ShapType").val(),e="";if(j&&b){var g=d.$('[sel-for="onShowRectOrMosaic"]').val();"mosaic"==g?c="Rect":"polygon"==g&&(c="Polygon"),d.onlySupportPolygon&&(c="Polygon");var h=i[N][f];if(h.Enable&&0==h.Mosaic){if("Rect"==h.ShapeType){var k=h.Rect[0],l=h.Rect[1],m=h.Rect[2],n=h.Rect[3],o={};o[c]=[[k,l],[m,l],[m,n],[k,n]],e=JSON.stringify(o)}else if("Polygon"==h.ShapeType){var o={};4==h.Polygon.length&&JSON.stringify(h.Polygon[3])==JSON.stringify(h.Polygon[2])&&h.Polygon.pop(),o[c]=h.Polygon,e=JSON.stringify(o)}d.isNewDraw=!1}else e="",d.isNewDraw=!0}d.shapeID=plugin.CreateMainVideoAnalyseShape(0,"PrivacyMask",c,c,e,"Convex")}else plugin.SetRegionNum(b===!0?1:0)},_ocxCreateMainVideoAnalyseShapeNoMosaic:function(){var b=a("#osd_pr_ShapType").val(),c="";d.shapeID=plugin.CreateMainVideoAnalyseShape(0,"PrivacyMask",b,b,c,"Convex")},_ocxClear:function(){"New"==d.ocxEntry?(plugin.DeleteAllVideoAnalyseShape(),a("#video_privmask_draw").removeClass("ui-button-special-hover")):plugin.SetRegionNum(0),a.unsubscribe("RegionChanged",null)},_ocxGetDate:function(a){return plugin.GetVideoAnalyseShapeConfigData(a)},_ocxEventDone:function(a){d.shapeID=a,d._ocxGetDate(a).done(function(a){var b=JSON.parse(a);d._getOcxData(b)})},switchOcxPrivacyMasking:function(b){d._ocxEnale(b),d._ocxCreateMainVideoAnalyseShape(b),b?a("#video_privmask_draw").addClass("ui-button-special-hover"):d.onDrawing||a("#video_privmask_draw").removeClass("ui-button-special-hover")},overDraw:function(){d.onDrawing=!1,"flash"==webApp.playMode||"h5"===webApp.playMode?R.clearCanvas():d._ocxClear(),a("#video_privmask_draw").removeClass("ui-button-special-hover")},onTuChangeMask:function(){d.onDrawing=!1,d.switchOcxPrivacyMasking(!1),a("#video_privmask_draw").removeClass("ui-button-special-hover"),f=a("#video_privmask_number").val(),d.onRelationChannel()},onRelationChannel:function(){i[N][f].Mosaic>0&&i[N][f].Enable?(d.$('[sel-for="onShowRectOrMosaic"]').val("mosaic"),a('[sel-for="onMskChange"]').val(e[N][f].Mosaic)):i[N][f].Enable&&"Polygon"==i[N][f].ShapeType?d.$('[sel-for="onShowRectOrMosaic"]').val("polygon").prop("disabled",!0):d.$('[sel-for="onShowRectOrMosaic"]').val("polygon").prop("disabled",!1),d.onShowRectOrMosaic(!0)},_getTuOcxData:function(b){var c=d.$('[sel-for="onShowRectOrMosaic"]').val();d.onlySupportPolygon&&(c=d.$("#osd_pr_ShapType").val().toLowerCase());var e=b.Rect,g=b.Polygon,h="flash"==webApp.playMode||"h5"==webApp.playMode;if(h&&(e=b.data,g=b.data),i[N][f].Enable=1,i[N][f].Index=f-0,"mosaic"==c||"rect"==c)i[N][f].ShapeType="Rect",i[N][f].Rect=[e[0][0],e[0][1],e[1][0],e[1][1]],"mosaic"==c&&(i[N][f].Mosaic=a("[sel-for=onMskChange]").val()-0);else{if(i[N][f].Mosaic=0,i[N][f].ShapeType="Polygon",i[N][f].Polygon=g,i[N][f].Rect=[0,0,0,0],g.length>4)return d.switchOcxPrivacyMasking(!1),i[N][f].ShapeType="Rect",i[N][f].Polygon=[],i[N][f].Enable=!1,i[N][f].Rect=[0,0,0,0],void d.savePrivMaskConfig(!1,g.length);3==g.length&&(g[3]=g[2])}d.$('[sel-for="onShowRectOrMosaic"]').prop("disabled",!1),d.setMaskColor(),d.savePrivMaskConfig(!0),d.renderMaskList()},onTuDrawClick:function(){a("#video_privmask_draw").hasClass("ui-button-special-hover")?(d.onDrawing=!1,"flash"==webApp.playMode||"h5"===webApp.playMode?d.overDraw():d._ocxClear(),d.$("[sel-for=onShowRectOrMosaic]").prop("disabled",!1),d.renderMaskList()):(d.onGotoClick(),"flash"==webApp.playMode||"h5"===webApp.playMode?(d.onDrawing=!0,setTimeout(function(){d.switchCanvasPrivacyMasking()},0)):(d._ocxClear(),setTimeout(function(){d.switchOcxPrivacyMasking(!0)},0)),d.$("[sel-for=onShowRectOrMosaic]").prop("disabled",!0))},switchCanvasPrivacyMasking:function(){var b=d.$("[sel-for=onShowRectOrMosaic]").val();d.containerId=R.CreateVideoAnalyseContainer(),"mosaic"==b?b="MinGatherRegion":"polygon"==b&&(b="Polygon"),d.onlySupportPolygon&&(b="Polygon"),a("#video_privmask_draw").addClass("ui-button-special-hover");var c=i[N][f];if(c.Enable&&0==c.Mosaic){if("Rect"==c.ShapeType){var e=c.Rect[0],g=c.Rect[1],h=c.Rect[2],j=c.Rect[3];d.shapeId=R.CreateMainVideoAnalyseShape(d.containerId,b,[[e,g],[h,g],[h,j],[e,j]],{})}else if("Polygon"==c.ShapeType){var k=i[N][f].Polygon,l=k.length;4==l&&JSON.stringify(k[3])==JSON.stringify(k[2])&&k.pop(),d.shapeId=R.CreateMainVideoAnalyseShape(d.containerId,b,i[N][f].Polygon,{})}R.ShowVideoAnalyseShape(d.containerId,d.shapeId),d.isNewDraw=!1}else d.shapeId=R.CreateMainVideoAnalyseShape(d.containerId,b,null,{}),d.isNewDraw=!0;d.getPtzTurnStatus(function(){R.SelectVideoAnalyseShape(d.containerId,d.shapeId)})},onShowRectOrMosaic:function(a){function b(a){function b(){"mosaic"==a?"Rect"==i[N][f].ShapeType&&(i[N][f].Mosaic=c-0):"polygon"==a&&(i[N][f].Mosaic=0),d.mosaicChangeWithRect=!0,d.setMaskColor(),d.savePrivMaskConfig(!0),d.renderMaskList()}var c=d.$("[sel-for=onMskChange]").val();i[N][f].Enable&&(d.onGotoClick(),d.getPtzTurnStatus(b))}function c(a){"mosaic"==a?(d.$("#osd_pr_colorWrap").addClass("fn-hide"),d.$("#osd_pr_mos_resolution").removeClass("fn-hide"),d.isFirstChangeMosaic&&(d.tip("warning",tl("com.MosaicChangeTip")),d.isFirstChangeMosaic=!1)):"polygon"==a&&(d.$("#osd_pr_colorWrap").removeClass("fn-hide"),d.$("#osd_pr_mos_resolution").addClass("fn-hide"))}var e=d.$('[sel-for="onShowRectOrMosaic"]').val();c(e),!(1==a)&&b(e)},getPtzTurnStatus:function(a){var b=setInterval(function(){l.PTZ.isMoving().done(function(c){c.moving||(clearInterval(b),a())})},1e3)},_bindSpeedMark:function(){var b=jQuery("#ptz_speed_mark");b.on("click",function(c){function e(a){g(),plugin.ActivePTZLocate(!a).done(function(b){b&&(a?plugin.addEvent("RegionChanged",null):plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=((b+d)/16384).limit(-1,1),g=((c+e)/16384).limit(-1,1),h=Math.abs(e-c)>Math.abs(d-b)?e-c:d-b,i=(h/8192).limit(-1,1),j=d>b?i*i:-1*i*i;l.PTZ.moveDirectly([f,g,j],null,plugin.windowId)}))})}function f(b){webApp.RegionFocusLocate=!1,webApp.TrackObjectLocate=!1,g(),R.ActivePTZLocate(!b),b?a.unsubscribe("RegionChanged",null):a.subscribe("RegionChanged",function(a,b){var c=((b[0]+b[2])/16384).limit(-1,1),d=((b[1]+b[3])/16384).limit(-1,1),e=Math.abs(b[3]-b[1])>Math.abs(b[2]-b[0])?b[3]-b[1]:b[2]-b[0],f=(e/8192).limit(-1,1),g=b[2]>b[0]?f*f:-1*f*f;webApp.RegionFocusLocate||webApp.TrackObjectLocate||l.PTZ.moveDirectly([c,d,g],null,plugin.windowId)})}function g(){h(),setTimeout(function(){jQuery("body").off("click.speedMark").on("click.speedMark",function(c){var d=b.hasClass("current");a.unsubscribe("RegionChanged",null),jQuery("body").off("click.speedMark"),b.removeClass("current"),"flash"==webApp.playMode?"canvas"!=c.target.id&&d&&R.ActivePTZLocate(!1):"video_OSD_node"!=c.target.id&&d&&plugin.ActivePTZLocate(!1)})},100)}function h(){var a=d.$("#video_privmask_draw");a.removeClass("ui-button-special-hover"),"flash"==webApp.playMode||"h5"===webApp.playMode?R.clearCanvas():d._ocxClear()}c.stopPropagation();var i=b.hasClass("current");i?b.removeClass("current"):b.addClass("current"),"flash"==webApp.playMode||"h5"==webApp.playMode?f(i):e(i)})}})}),define("osd_channel",function(require,b,c){function d(a){return['<li class="fn-clear">','<input type="text" ','class="ui-input fn-left" ','oncontextmenu = "return false" ',"value = "+(a?a:""),">",'<span class="ui-set-icon-add"></span>',"</li>"].join("")}var e=null,f=2;c.exports=k.extend({init:function(){e=this,e.render(),e.bind()},render:function(){if(p[N]){var b=p[N].ChannelTitle||{};plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?e.$("#osd_channel_enable_on").prop("checked",!0):e.$("#osd_channel_enable_off").prop("checked",!0),e.renderTitle(),g(b.Rect,tl("com.ChannelTitle"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("com.ChannelTitle"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))}},leave:function(){plugin.addEvent("RegionChanged",null),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),e.save()},save:function(){p[N].ChannelTitle.EncodeBlend=e.$("#osd_channel_enable_on").prop("checked"),p[N].ChannelTitle.TextAlign=e.$("#osd_channel_textalign").val()-0,r[N].Name=e.getTitle()},_initInput:function(a,b,c,d){a.textfield({length:b||63,asciiByte:c||2,notAsciiByte:d||3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"})},renderTitle:function(){function b(b){h.empty();for(var i=0;g>i;i++){var j=a(d());j.appendTo(h)}for(var i=0;g>i;i++)b?e._initInput(e.$("#osd_channel_title ul li").eq(i).find("input"),255,1,2):e._initInput(e.$("#osd_channel_title ul li").eq(i).find("input")),e.$("#osd_channel_title ul li").eq(i).find("input").textfield("value",c[i]||"");e.$("#osd_channel_title ul li span").hide(),b&&f>g&&h.find("li").last().find("span").show()}e.$("#osd_channel_textalign").val(0==p[N].ChannelTitle.TextAlign||p[N].ChannelTitle.TextAlign?p[N].ChannelTitle.TextAlign:2);var c=r[N].Name.split("|"),g=c.length,h=e.$("#osd_channel_title ul");1>=g&&(g=1),b(),m.get("SupportOsdRestructure").done(function(a){1==a&&b(!0)})},getTitle:function(){for(var a=e.$("#osd_channel_title ul li"),b=[],c=0,d=a.length;d>c;c++){var f=a.eq(c).find("input").val();b.push(f)}var g=b.join("|").replace(/(\|+)$/,"");return g},bind:function(){var b=e.$("#osd_channel_title ul");b.on("click","li span",function(){var c=e.$("#osd_channel_title ul li").length;if(!(c>=f)){var g=a(d());e._initInput(g.find("input"),255,1,2),g.appendTo(b),b.find("li span").hide(),c!==f-1&&b.find("li span").last().show()}})}})}),define("osd_time",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,d.render()},render:function(){var b=p[N].TimeTitle||{};plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?d.$("#osd_time_enable_on").prop("checked",!0):d.$("#osd_time_enable_off").prop("checked",!0),d.$("#osd_time_show_week").prop("checked",b.ShowWeek),g(b.Rect,tl("com.TimeTitle"),160,20),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("com.TimeTitle"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))},leave:function(){plugin.addEvent("RegionChanged",null),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),d.save()},save:function(){p[N].TimeTitle.EncodeBlend=d.$("#osd_time_enable_on").prop("checked"),p[N].TimeTitle.ShowWeek=d.$("#osd_time_show_week").prop("checked")}})}),define("osd_osdcombination",function(require,b,c){function d(a){return['<li class="fn-clear">','<input type="text" ','class="ui-input fn-left" ','oncontextmenu = "return false" ',"value = "+(a?a:""),">",'<span class="ui-set-icon-add"></span>',"</li>"].join("")}var e=this,f=!1,i=!1,j=14,n=5;c.exports=k.extend({init:function(){f=!!a('[data-for = "osd_osdcombination"]').attr("isLocaltion"),e=this,e.bind(),m.get("OSDCustom").done(function(a){a&&a.Geography&&a.Geography.Support&&(n=a.Geography.TitleLine),e.render()}),f&&e.$('[t="com.Location;title::com.Location"]').addClass("fn-hide"),m.get("SupportPresetOsdTime").then(function(a){a?(e.$("#osd_preset > div:first-child").addClass("fn-hide"),i=!0,e.$("#osd_sd_input").numberfield({max:3600,min:1,value:1,allowDecimal:!1})):e.$("#osd_preset > div:last-child").addClass("fn-hide"),e.render()})},bind:function(){e.$('[type ="radio"]').click(function(){if("on"==a(this).val()&&p[N].PictureTitle.EncodeBlend){var b=a(this).attr("id"),c=b.replace("_on","_off");plugin.hide();var d=tl("com.OsdPictureOverlayDisabledTip");f&&(d=tl("com.PictureOverlayDisabledTip")),a.confirm(tl("com.Ok"),d,function(){a("#page_encodeConfig #osd_image_enable_off").prop("checked",!0),p[N].PictureTitle.EncodeBlend=!1,e.$("#"+b).prop("checked",!0),"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node")},function(){e.$("#"+c).prop("checked",!0),"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node")},!0)}}),e.$('[name="osd_temperature_enable"]').click(function(){"on"==a(this).val()?(e.$("#osd_TempUnit_wrap").removeClass("fn-hide"),E&&e.$("#osd_temperature_cavity").removeClass("fn-hide")):(e.$("#osd_TempUnit_wrap").addClass("fn-hide"),e.$("#osd_temperature_cavity").addClass("fn-hide"))}),e.$('[name = "osd_direction_enable"]').unbind().click(function(){"on"==a(this).val()?p[N].PictureTitle.EncodeBlend?(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.OsdPictureOverlayDisabledTip"),function(){e._NorthTip(),a("#page_encodeConfig #osd_image_enable_off").prop("checked",!0),p[N].PictureTitle.EncodeBlend=!1,e.$("#osd_direction_enable_on").prop("checked",!0),"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node")},function(){"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&plugin.cover("#video_OSD_node"),e.$("#osd_direction_enable_off").prop("checked",!0)},!0)):e._NorthTip():(T||e.$("#dirSetting").addClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",0))}),e.$("#osd_dirSetting_btn").click(e._setNorth),e.$("#osd_RoadUnit").on("change",function(){var a=p[N].CustomTitle[1]||{};"location"===e.$("#osd_RoadUnit").val()?(e.$("#osd_location_Wrap").removeClass("fn-hide"),e.$("#osd_road_info").addClass("fn-hide")):(e.$("#osd_location_Wrap").addClass("fn-hide"),e.$("#osd_road_info").removeClass("fn-hide"),a=V[N]||{}),e._setLocationInfo(a.Text||""),a.EncodeBlend?e.$("#osd_location_enable_on").prop("checked",!0):e.$("#osd_location_enable_off").prop("checked",!0)}),e.$("#osd_sd_sel").click(function(){"custom"===this.value?e.$("#osd_sd_input").parent().removeClass("fn-hide"):e.$("#osd_sd_input").parent().addClass("fn-hide")}),e.$("#osd_location_info").on("click","li span",function(){var b=e.$("#osd_location_info li").length;if(!(b>=j)){var c=a(d());e._initInput(c.find("input"),255,1,2),e.$("#osd_location_info").append(c),e.$("#osd_location_info li span").hide(),b!==j-1&&e.$("#osd_location_info li span").last().show()}}),e.$("#osd_location_info").on("click focus","li input",function(){var a=e.$(this);a.on("input propertychange",function(){for(var a=e.$(this).val(),b=e.$("#osd_location_info li"),c=b.length,d="",f=0;c>f;f++)d+=b.eq(f).find("input").val();var g=e._getStrLength(d),h=e._getStrLength(a),i=1024-(g-h);return g>1024?(e.$(this).val(a.substr(0,i)),!1):void 0})})},_getStrLength:function(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c)<127?1:2;return b},render:function(){plugin.addEvent("RegionChanged",function(b,c,d,e,g){var h=ab(c,d,e,g);if(f)p[N].CustomTitle[1].Rect=h;else{var i=a.extend([],h),j=a.extend([],h),k=a.extend([],h);A&&(p[N].PTZPreset.Rect=i),B&&(p[N].Temperature.Rect=j),u.Coordinates&&(p[N].PTZCoordinates.Rect=j),u.PTZZoom&&(p[N].PTZZoom.Rect=j),u.DirectionDisplay&&(p[N].PTZDirection.Rect=j),ib&&(jb[N].Rect=j),p[N].CustomTitle[1].Rect=k}});var b=p[N].CustomTitle[1]||{};W&&V[N].EncodeBlend?(b=V[N]||{},e.$("#osd_RoadUnit").val("road"),e.$("#osd_location_Wrap").addClass("fn-hide"),e.$("#osd_road_info").removeClass("fn-hide")):(e.$("#osd_RoadUnit").val("location"),e.$("#osd_location_Wrap").removeClass("fn-hide"),e.$("#osd_road_info").addClass("fn-hide")),b.EncodeBlend?e.$("#osd_location_enable_on").prop("checked",!0):e.$("#osd_location_enable_off").prop("checked",!0),e._setLocationInfo(b.Text||""),e.$("#osd_location_textalign").val("TextAlign"in p[N].CustomTitle[1]?p[N].CustomTitle[1].TextAlign:2);var c=p[N].PTZPreset||{};c.EncodeBlend?e.$("#osd_preset_enable_on").prop("checked",!0):e.$("#osd_preset_enable_off").prop("checked",!0),A&&i&&c&&void 0!==c.DisplayTime&&(c.EncodeBlend?5===c.DisplayTime||15===c.DisplayTime||0===c.DisplayTime?(e.$("#osd_sd_sel").val(c.DisplayTime),e.$("#osd_sd_input").parent().addClass("fn-hide")):(e.$("#osd_sd_sel").val("custom"),e.$("#osd_sd_input").val(c.DisplayTime),e.$("#osd_sd_input").parent().removeClass("fn-hide")):(e.$("#osd_sd_sel").val("close"),e.$("#osd_sd_input").parent().addClass("fn-hide")));var d=p[N].Temperature||{};d.EncodeBlend?(e.$("#osd_temperature_enable_on").prop("checked",!0),e.$("#osd_TempUnit_wrap").removeClass("fn-hide"),E&&e.$("#osd_temperature_cavity").removeClass("fn-hide")):(e.$("#osd_temperature_enable_off").prop("checked",!0),e.$("#osd_TempUnit_wrap").addClass("fn-hide"),E&&e.$("#osd_temperature_cavity").addClass("fn-hide")),C&&e.$("#osd_TempUnit").val(d.TemperatureUnit),E&&(e.$("#osd_temperature_up").prop("checked",D[0].Content[F[0].Name].Enable),e.$("#osd_temperature_middle").prop("checked",D[0].Content[F[1].Name].Enable),e.$("#osd_temperature_down").prop("checked",D[0].Content[F[2].Name].Enable));var k=p[N].PTZCoordinates||{};k.EncodeBlend?e.$("#osd_coordinates_enable_on").prop("checked",!0):e.$("#osd_coordinates_enable_off").prop("checked",!0);var l=p[N].PTZZoom||{};l.EncodeBlend?e.$("#osd_PTZZoom_enable_on").prop("checked",!0):e.$("#osd_PTZZoom_enable_off").prop("checked",!0);var n=p[N].PTZDirection||{};n.EncodeBlend?(e.$("#osd_direction_enable_on").prop("checked",!0),T||e.$("#dirSetting").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",1),"thermal"===webApp.CHANNEL_TYPE[1]&&a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId)):(e.$("#osd_direction_enable_off").prop("checked",!0),T||e.$("#dirSetting").addClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",0));var o=p[N].PtzPattern||{};o.EncodeBlend?e.$("#osd_PTZPattern_enable_on").prop("checked",!0):e.$("#osd_PTZPattern_enable_off").prop("checked",!0);var q=p[N].PtzRS485Detect||{};q.EncodeBlend?e.$("#osd_PTZRS485_enable_on").prop("checked",!0):e.$("#osd_PTZRS485_enable_off").prop("checked",!0);var r=jb&&jb[N]||{};r.EncodeBlend?e.$("#osd_SolarCell_enable_on").prop("checked",!0):e.$("#osd_SolarCell_enable_off").prop("checked",!0);var s,t=20,v="ivs.osdcombination";s=(p[N].CustomTitle[1]||{}).Rect,f&&(v="com.Location"),g(s,tl(v),160,t),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(h(s,tl(v),160,t),a.subscribe("RegionChanged",function(b,c){var d=ab(c[0],c[1],c[2],c[3]);if(f)p[N].CustomTitle[1].Rect=d;else{var e=a.extend([],d),g=a.extend([],d),h=a.extend([],d);A&&(p[N].PTZPreset.Rect=e),B&&(p[N].Temperature.Rect=g),u.Coordinates&&(p[N].PTZCoordinates.Rect=g),u.PTZZoom&&(p[N].PTZZoom.Rect=g),u.DirectionDisplay&&(p[N].PTZDirection.Rect=g),p[N].CustomTitle[1].Rect=h}})),e.$("#osd_location_info li span").hide(),m.get("SupportOsdRestructure").done(function(a){if(1==a){var b=e.$("#osd_location_info li").length;j>b&&e.$("#osd_location_info li span").last().show()}})},leave:function(){e.save(),a("#osd_PTZ").minPtzControl("togglePTZ",0),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){if(W&&"road"===e.$("#osd_RoadUnit").val()?(V[N].Text=e._getLocationInfo(),V[N].EncodeBlend=e.$("#osd_location_enable_on").prop("checked"),V[N].PreviewBlend=e.$("#osd_location_enable_on").prop("checked"),V[N].BackColor=[0,0,0,128]):(p[N].CustomTitle[1].Text=e._getLocationInfo(),p[N].CustomTitle[1].EncodeBlend=e.$("#osd_location_enable_on").prop("checked"),p[N].CustomTitle[1].PreviewBlend=e.$("#osd_location_enable_on").prop("checked"),p[N].CustomTitle[1].BackColor=[0,0,0,128],p[N].CustomTitle[1].TextAlign=e.$("#osd_location_textalign").val()-0),A&&(p[N].PTZPreset.EncodeBlend=e.$("#osd_preset_enable_on").prop("checked")),A&&i&&!e.$("#osd_preset > div:last-child").hasClass("fn-hide")){var a=e.$("#osd_sd_sel").val();p[N].PTZPreset.EncodeBlend=!0,"custom"===a?p[N].PTZPreset.DisplayTime=~~e.$("#osd_sd_input").val():"close"===a?p[N].PTZPreset.EncodeBlend=!1:p[N].PTZPreset.DisplayTime=~~e.$("#osd_sd_sel").val()}B&&(p[N].Temperature.EncodeBlend=e.$("#osd_temperature_enable_on").prop("checked"),C&&(p[N].Temperature.TemperatureUnit=e.$("#osd_TempUnit").val())),E&&(D[0].Content[F[0].Name].Enable=e.$("#osd_temperature_up").prop("checked"),D[0].Content[F[1].Name].Enable=e.$("#osd_temperature_middle").prop("checked"),D[0].Content[F[2].Name].Enable=e.$("#osd_temperature_down").prop("checked")),u.Coordinates&&(p[N].PTZCoordinates.EncodeBlend=e.$("#osd_coordinates_enable_on").prop("checked")),u.PTZZoom&&(p[N].PTZZoom.EncodeBlend=e.$("#osd_PTZZoom_enable_on").prop("checked")),u.DirectionDisplay&&(p[N].PTZDirection.EncodeBlend=e.$("#osd_direction_enable_on").prop("checked")),u.PtzPatternOSD&&(p[N].PtzPattern.EncodeBlend=e.$("#osd_PTZPattern_enable_on").prop("checked")),u.PtzRS485DetectOSD&&(p[N].PtzRS485Detect.EncodeBlend=e.$("#osd_PTZRS485_enable_on").prop("checked")),ib&&(jb[N].EncodeBlend=e.$("#osd_SolarCell_enable_on").prop("checked"),jb[N].PreviewBlend=e.$("#osd_SolarCell_enable_on").prop("checked"))},_getLocationInfo:function(){if(W&&"road"===e.$("#osd_RoadUnit").val()){var b="road",c=[],d=null;return e.$('[id ^="osd_'+b+'_info_"]').each(function(b,d){c.push(a(d).val())}),d=c.join("|"),"||||"===d?"":d}for(var f=[],g=e.$("#osd_location_info li"),h=0,i=g.length;i>h;h++){var j=g.eq(h).find("input").val();f.push(j)}return f.join("|").replace(/(\|+)$/,"")},_setLocationInfo:function(b){function c(b){k.empty(),n>=i&&(i=n);for(var c=0;i>c;c++){var f=a(d());f.appendTo(k)}for(var c=0;i>c;c++)b?e._initInput(e.$("#osd_location_info li").eq(c).find("input"),255,1,2):e._initInput(e.$("#osd_location_info li").eq(c).find("input")),e.$("#osd_location_info li").eq(c).find("input").textfield("value",h[c]||"")}if(W&&"road"===e.$("#osd_RoadUnit").val()){var f="road";if(""===b)e.$("[id ^= osd_"+f+"_info]").each(function(b,c){a(c).val("")});else{var g=b.split("|");a.each(g,function(a,b){e.$("#osd_"+f+"_info_"+a).val(b)})}}else{var h=b.split("|"),i=h.length,k=e.$("#osd_location_info");c(),m.get("SupportOsdRestructure").done(function(a){c(a)}),i>=j&&e.$("#osd_location_info li span").hide()}},_initInput:function(a,b,c,d){a.textfield({length:b||45,asciiByte:c||2,notAsciiByte:d||3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"})},_setNorth:function(){l.PTZ.setDirection("North").done(function(){a('#page_encodeConfig [data-page="enc_osd"]').children(".u-tip").tip("success","com.SaveSuccessTip")})},_NorthTip:function(){l.ConfigManager.getConfig("VideoWidget").done(function(b){var c=b[N].PTZDirection&&b[N].PTZDirection.EncodeBlend;Y&&!c?(plugin.hide(),a.confirm(tl("com.Ok"),tl("per.PtzRestartTip"),function(){a("#osd_PTZ").minPtzControl("togglePTZ",1),"thermal"===webApp.CHANNEL_TYPE[1]&&a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId),e.$("#osd_direction_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node")},function(){plugin.cover("#video_OSD_node"),e.$("#osd_direction_enable_off").prop("checked",!0)},!0)):(T||e.$("#dirSetting").removeClass("fn-hide"),a("#osd_PTZ").minPtzControl("togglePTZ",1),"thermal"===webApp.CHANNEL_TYPE[1]&&a("#osd_PTZ").minPtzControl("changeChannel",plugin.windowId))})}})}),define("osd_fontSetting",function(require,b,c){require("widget/js/dui.slider");var d=null,e=null,f="ffffff",g=null;c.exports=k.extend({init:function(){g=this,webApp.GongAnDetect?(g.$("#osd_fontBackground").slider({min:0,max:128,complete:function(a,b){p[N].CustomTitle[1].BackColor=[0,0,0,b.value],p[N].ChannelTitle.BackColor=[0,0,0,b.value],p[N].TimeTitle.BackColor=[0,0,0,b.value]}}),g.$("#font_size_largest").show(),g.$("#osd_fontBackground").parent().show()):(g.$("#font_size_largest").remove(),g.$("#osd_fontBackground").parent().remove()),require.async("jsCore/modules/jscolor",function(){jscolor.init(),d=g.$('[data-pick="jsColor"]')[0],g.bind(),e=new jscolor.color(d,{positionID:"fontAll",positionNew:{left:"0px",top:"42px"},pickerFaceColor:"#C0C0C0",pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight"}),g.render()})},bind:function(){g.$("#fontAll").delegate("[data-show]","click",function(){var b=a(this).attr("data-show"),c=g.$("[data-name ="+b+"]");if(!c.hasClass("fn-hide"))return g._changeArrow("up"),void c.addClass("fn-hide");switch(g._changeArrow("down"),c.removeClass("fn-hide"),b){case"pick1":g._hidePick2();break;case"pick2":g._hidePick1(!1),g._setPickColorStr(f),d.value=f,d.focus()}}),g.$("#fontAll").delegate("[data-hide]","click",function(){g._hidePick1();var b=a(this).attr("data-value");g._renderDom(b)}),g.$("#fontAll").delegate("[data-btn]","click",function(){var b=a(this).attr("data-btn");if("ok"==b){var c=d.value;g._renderDom(c)}g._hidePick2(),g._hidePick1()}),a("#page_encodeConfig").click(function(b){var c=a('div[data-name="pick1"]').hasClass("fn-hide");c||b.target.hasClass("showPick1")||g._hidePick1()})},render:function(){if(plugin.SetRegionNum(0),void 0!==p[N].FontSizeScale)switch(p[N].FontSizeScale){case.7:g.$("#fontSizeSmall").prop("checked",!0);break;case 1.1:case 1.2:g.$("#fontSizeLarge").prop("checked",!0);break;case 1.3:g.$("#fontSizeLargest").prop("checked",!0);break;default:g.$("#fontSizeMiddle").prop("checked",!0)}g.$("#osd_fontSize").val(p[N].FontSize),g.$("#osd_FontBorder").prop("checked",p[N].FontBorder),I.rowHeight&&g.$("#osd_fontHeight").val(q[N].OSDLineSpacing);var a=p[N].ChannelTitle.FrontColor,b=g._getColorStr(a);g._renderDom(b),g._hidePick1(),g._hidePick2(),webApp.GongAnDetect&&g.$("#osd_fontBackground").slider("value",p[N].CustomTitle[1].BackColor[3])},leave:function(){g.save()},save:function(){if(I.color){var b=g._getColor();i(b)}I.grade&&m.get("FontSize").done(function(b){var c=[.7,1,1.1,1.3],d=g.$('[name="font-size"]:checked').val()-0;
b&&b.GradeRange?a.each(c,function(a){c[a]===d&&(p[N].FontSizeScale=b.GradeRange[a])}):p[N].FontSizeScale=d}),I.pixel&&(p[N].FontSize=g.$("#osd_fontSize").val()-0),I.border&&(p[N].FontBorder=g.$("#osd_FontBorder").prop("checked")),I.rowHeight&&(q[N].OSDLineSpacing=g.$("#osd_fontHeight").val()-0)},_getColorStr:function(a){var b="",c=parseInt(a[0]).toString(16).toUpperCase(),d=parseInt(a[1]).toString(16).toUpperCase(),e=parseInt(a[2]).toString(16).toUpperCase();return 1==c.length&&(c="0"+c),1==d.length&&(d="0"+d),1==e.length&&(e="0"+e),b=c+d+e},_changeArrow:function(a){var b=g.$('span[data-arrow="fontColor"]');switch(a){case"up":b.removeClass("triangleUp"),b.addClass("triangleDown");break;case"down":b.removeClass("triangleDown"),b.addClass("triangleUp")}},_hidePick1:function(b){a('div[data-name="pick1"]').addClass("fn-hide"),b!==!1&&g._changeArrow("up")},_hidePick2:function(){e.hidePicker(),a('div[data-name="pick2"]').addClass("fn-hide")},_setPickColorStr:function(a){e.fromString(a,!0)},_renderDom:function(b){f=b,a('span[data-name="text"]').css({"border-bottom":"2px solid #"+b,color:"#"+b}),fontColor=g._getColor()},_getColor:function(){return g._getColorRGB(f)},_getColorRGB:function(a){var b=[],c="0x"+a;return b[0]=c>>16&255,b[1]=c>>8&255,b[2]=255&c,b[3]=-1!==webApp.DeviceType.indexOf("TPC")?255:0,b}})}),define("osd_image",function(require,b,c){var d=null,e=null,f={"File Transmit Error":"com.FileTransmitErrorTip","File too large":"com.PicFileTooLargeTip","File length error":"com.FileLengthErrorTip","File write error":"com.FileWriteErrorTip",PicTypeNotSupport:"com.PicTypeNotSupportTip",BPPTypeNotSupport:"com.BPPTypeNotSupportTip",ResolutionNotSupport:"com.ResolutionNotSupportTip",PicNotExist:"com.PicNotExistTip",FileOperateError:"com.FileOperateErrorTip",PicFileTooLarge:"com.PicFileTooLargeTip"};c.exports=k.extend({init:function(){d=this,e=a("#enc_osd_tip"),d.render(),d.$('[name = "osd_image_enable"]').click(function(){if("on"==a(this).val())if(webApp.DeviceType.indexOf("SD")>-1){var b=d._getOSDInfo();b&&(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.OsdLocationFunctionDisabledTip"),function(){a('#osd_osdcombination [type="radio"][value="on"]').prop("checked",!1),d.$("#osd_image_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),p[N].CustomTitle[1].EncodeBlend=!1,p[N].CustomTitle[1].PreviewBlend=!1,W&&V&&(V[N].EncodeBlend=!1,V[N].PreviewBlend=!1),A&&(p[N].PTZPreset.EncodeBlend=!1),B&&(p[N].Temperature.EncodeBlend=!1),u.Coordinates&&(p[N].PTZCoordinates.EncodeBlend=!1),u.PTZZoom&&(p[N].PTZZoom.EncodeBlend=!1),u.DirectionDisplay&&(p[N].PTZDirection.EncodeBlend=!1),u.PtzPatternOSD&&(p[N].PtzPattern.EncodeBlend=!1),u.PtzRS485DetectOSD&&(p[N].PtzRS485Detect.EncodeBlend=!1),ib&&(jb[N].EncodeBlend=!1)},function(){plugin.cover("#video_OSD_node"),d.$("#osd_image_enable_off").prop("checked",!0)},!0))}else p[N].CustomTitle[1].EncodeBlend&&(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.LocationFunctionDisabledTip"),function(){a("#osd_location_enable_off").prop("checked",!0),d.$("#osd_image_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),p[N].CustomTitle[1].EncodeBlend=!1,p[N].CustomTitle[1].PreviewBlend=!1},function(){plugin.cover("#video_OSD_node"),d.$("#osd_image_enable_off").prop("checked",!0)},!0))})},render:function(){d.openVideo(),plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=ab(b,c,d,e);p[N].PictureTitle.Rect=f}),d._renderElement(),plugin.addEvent("ResolutionChangeOSD",function(){d._getImgRect()}),("flash"===webApp.playMode||"h5"===webApp.playMode)&&a.subscribe("RegionChanged",function(a,b){var c=ab(b[0],b[1],b[2],b[3]);p[N].PictureTitle.Rect=c})},openVideo:function(){"hls"===webApp.playMode?(P.cover(a("#video_OSD_node")),plugin.hide(),P.init("","",""),P.beginPlay()):"flash"===webApp.playMode?(Q.cover(a("#video_OSD_node")),Q.playPreview(1,0)):"h5"===webApp.playMode||plugin.cover("#video_OSD_node",function(){plugin.SetRegionNum(0),plugin.SetModuleMode(1),-1!==webApp.DeviceType.indexOf("TPC")||webApp.CHANNEL_NUMBER>1?plugin.SetVisibleVideoWnd(1,N):plugin.open()})},_renderElement:function(){var b=p[N].PictureTitle||{};if(b.EncodeBlend?d.$("#osd_image_enable_on").prop("checked",!0):d.$("#osd_image_enable_off").prop("checked",!0),b.Name){var c="url("+L+b.Name+"?"+Date.now()+")";a(".osd-image-preview").css("background-image",c)}d._getImgRect()},_getImgRect:function(){var a=p[N].PictureTitle,b=a.Width||80,c=a.Height||80,d={x:-1!==webApp.DeviceType.indexOf("TPC")?1280:webApp.resolution.x,y:-1!==webApp.DeviceType.indexOf("TPC")?960:webApp.resolution.y};b=Math.ceil(d.x/1920*b),c=Math.ceil(d.y/1080*c),b=(8*b+7)/8,b=b%32?32-b%32+b:b,c=c%4?4-c%4+c:c,b=Math.ceil(500/d.x*b)+2,c=Math.ceil(374/d.y*c)+2,b=Math.max(b,16),c=Math.max(c,16),g(a.Rect||[0,0,0,0],"",b,c),("flash"===webApp.playMode||"h5"===webApp.playMode)&&h(a.Rect||[0,0,0,0],"",b,c)},leave:function(){d.save(),plugin.addEvent("RegionChanged",null),plugin.addEvent("ResolutionChangeOSD",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){p[N].PictureTitle.EncodeBlend=d.$("#osd_image_enable_on").prop("checked")},imageFileUploadFinish:function(a){a.result?d.updateOverlayPicture():e.tip("warning",tl(f[a.errorCode]))},updateOverlayPicture:function(){l.Encode.updateOverlayPicture([{Name:"osd.bmp"}]).done(function(a){var b=a[0];if(""===b.Error){var c=b.Path.lastIndexOf("/"),g=b.Path.substring(c+1);p[N].PictureTitle.Name=g,p[N].PictureTitle.Width=b.Width,p[N].PictureTitle.Height=b.Height,l.ConfigManager.setConfig("VideoWidget",p).done(function(){var a=p[N].PictureTitle||{};if(a.Name){var b="url("+L+a.Name+"?"+Date.now()+")";d.$(".osd-image-preview").css("background-image",b)}d._getImgRect()}).fail(function(){e.tip("error","com.SaveConfigFailTip")})}else e.tip("warning",tl(f[b.Error]))})},onFileChange:function(a){var b=0;if(a.value.test(/.bmp$/i)){try{b=a.files[0].size}catch(c){}b>16384?e.tip("warning",tl("com.PicFileTooLargeTip")):d.$("#osd_image_submit").trigger("click")}else e.tip("warning",tl("com.PicTypeNotSupportTip"));a.outerHTML=a.outerHTML},_getOSDInfo:function(){var a={PTZPreset:A,Temperature:B,PTZCoordinates:u.Coordinates,PTZZoom:u.PTZZoom,PTZDirection:u.DirectionDisplay,PtzPattern:u.PtzPatternOSD,PtzRS485Detect:u.PtzRS485DetectOSD};if(p[N].CustomTitle[1].EncodeBlend)return!0;if(W&&V[N].EncodeBlend)return!0;for(var b in a)if(a[b]&&p[N][b].EncodeBlend)return!0;return!1}}),window.OSDImageUploadFinish=function(a){d.imageFileUploadFinish(a)},window.onOSDFileChange=function(a){d.onFileChange(a)}}),define("osd_flowrate",function(require,b,c){var d,e=null,f=!1;c.exports=k.extend({init:function(){e=this,d=e.$('select[sel-for="onChangePID"]'),m.get("IVSCaps").done(function(b){b&&b.SupportedScenes&&b.SupportedScenes.NumberStatPlan&&e.initRules(b.SupportedScenes.NumberStatPlan.MaxRules),b&&b.SupportedScene&&a.inArray("StereoNumber",b.SupportedScene)>-1&&(f=!0,e.$("#osd_flowrate_type").hide(),e.$("#osd_show_enter, #osd_show_exit").parent().parent().hide()),e.render()}),e.bind()},render:function(){var b,c=d.val()-0;webApp.IsSDIntel&&!webApp.NoIntelliPreset?a.each(s[N],function(a,d){d.PlanID===c&&(b=d)}):b=s[N]||{},plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?e.$("#osd_flowrate_enable_on").prop("checked",!0):e.$("#osd_flowrate_enable_off").prop("checked",!0),e.$("#osd_show_enter").prop("checked",b.ShowEnterNum),e.$("#osd_show_exit").prop("checked",b.ShowExitNum),e.$("#osd_flowrate_textalign").val("TextAlign"in b?b.TextAlign:2),g(b.Rect,tl("ivs.PtzNumberStat"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("ivs.PtzNumberStat"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))},initRules:function(a){if(d=e.$('select[sel-for="onChangePID"]'),a){var b,c="";for(b=1;a+1>b;b++)c+="<option value="+b+">"+b+"</option>";d.html(c).parent().removeClass("fn-hide")}},onChangePID:function(){e.render()},leave:function(){e.save(),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){var b,c=d.val()-0;webApp.IsSDIntel&&!webApp.NoIntelliPreset?a.each(s[N],function(a,d){d.PlanID===c&&(b=d)}):b=s[N],b.EncodeBlend=e.$("#osd_flowrate_enable_on").prop("checked"),b.ShowEnterNum=e.$("#osd_show_enter").prop("checked"),b.ShowExitNum=e.$("#osd_show_exit").prop("checked"),b.TextAlign=e.$("#osd_flowrate_textalign").val()-0},bind:function(){var b=0;e.$("#osd_flowrate_enable_on").on("click",function(){p&&p[N]&&p[N].UserDefinedTitle&&p[N].UserDefinedTitle[b]&&p[N].UserDefinedTitle[b].EncodeBlend&&(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.FlowrateDisableCustomosdTip"),function(){if(e.$("#osd_flowrate_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),p[N].UserDefinedTitle[b].EncodeBlend=!1,webApp.IsSDIntel&&!webApp.NoIntelliPreset){var a=d.val()-0;s[N][a-1].EncodeBlend=!0}else s[N].EncodeBlend=!0},function(){plugin.cover("#video_OSD_node"),e.$("#osd_flowrate_enable_off").prop("checked",!0)},!0))})}})}),define("osd_abnormal",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,d.render()},render:function(){plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=ab(b,c,d,e);t.Rect=f}),t.EncodeBlend?d.$("#osd_abnormal_enable_on").prop("checked",!0):d.$("#osd_abnormal_enable_off").prop("checked",!0),g(t.Rect,tl("ivs.OSDSysAbnormal"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(t.Rect,tl("ivs.OSDSysAbnormal"),160,20),a.subscribe("RegionChanged",function(a,b){var c=ab(b[0],b[1],b[2],b[3]);t.Rect=c}))},leave:function(){d.save(),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){t.EncodeBlend=d.$("#osd_abnormal_enable_on").prop("checked")}})}),define("osd_GPS",function(require,b,c){var d,e=null,f=[[-1,-1],[-1,-1],[-1,-1]],g=0,h=0,i=59,j=59;c.exports=k.extend({init:function(){e=this,d=e.$("#video_GPSmode"),e.$('[data-gps="osd_west_east_manual"]:eq(0)').numberfield({min:0,max:180,allowDecimal:!1,allowNegative:!1}),e.$('[data-gps="osd_north_south_manual"]:eq(0)').numberfield({min:0,max:90,allowDecimal:!1,allowNegative:!1}),e.$('[data-gps="osd_west_east_manual"]:gt(0), [data-gps=osd_north_south_manual]:gt(0)').numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),y?($GPSmode=e.$('[sel-for="_onSelectGPSMode"]').empty(),$GPSmode.append('<option t="com.Auto" value="auto"></option><option t="med.Manual" value="manual"></option>').translation(),e.$("#osd_GPS_enable_on").click(function(){e.$("#osd_GPS_enable_on_page").removeClass("fn-hide"),x.Enable?e.$('[sel-for="_onSelectGPSMode"]').val("manual").change():e.$('[sel-for="_onSelectGPSMode"]').val("auto").change()}),e.$("#osd_GPS_enable_off").click(function(){e.$("#osd_GPS_enable_on_page").addClass("fn-hide")})):e.$("#osd_GPS_enable_on_page").remove(),e.$('[data-gps="osd_west_east_manual"]:eq(0)').on("blur",function(){return 180==Number(a(this).val())&&0==e.$("[name=osd_west_east]:checked").val()?(a(this).val(0),void(e.$("#osd_east")[0].checked=!0)):void(180==Number(a(this).val())?(e.$('[data-gps="osd_west_east_manual"]:gt(0)').numberfield({min:0,max:0,allowDecimal:!1,allowNegative:!1}),i=0):0==i&&Number(a(this).val())<180&&(e.$('[data-gps="osd_west_east_manual"]:gt(0)').numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),i=59))}),e.$('[data-gps="osd_north_south_manual"]:eq(0)').on("blur",function(){return 90==Number(a(this).val())&&0==e.$("[name=osd_north_south]:checked").val()?(a(this).val(0),void(e.$("#osd_north")[0].checked=!0)):void(90==Number(a(this).val())?(e.$('[data-gps="osd_north_south_manual"]:gt(0)').numberfield({min:0,max:0,allowDecimal:!1,allowNegative:!1}),j=0):0==j&&Number(a(this).val())<90&&(e.$('[data-gps="osd_north_south_manual"]:gt(0)').numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),j=59))}),e.$("#osd_west").click(function(){180==e.$('[data-GPS="osd_west_east_manual"]:eq(0)').val()&&(e.$('[data-GPS="osd_west_east_manual"]:eq(0)').val(0),e.$("#osd_east")[0].checked=!0)}),e.$("#osd_south").click(function(){90==e.$('[data-GPS="osd_north_south_manual"]:eq(0)').val()&&(e.$('[data-GPS="osd_north_south_manual"]:eq(0)').val(0),e.$("#osd_north")[0].checked=!0)}),e.render()},render:function(){plugin.SetRegionNum(0);var a=p[N].GPSTitle||{};if(a.EncodeBlend?e.$("#osd_GPS_enable_on").click():e.$("#osd_GPS_enable_off").click(),webApp.GongAnDetect){var b=w[0].CurMode||"GPS";d.val(b)}},_onSelectGPSMode:function(b){var c=e.$(b.target),d=c.val(),g=[x.Longitude,x.Latitude];e.getDegree(g),"auto"===d?(x.Enable=!1,e.$("#osd_GPS_enable_on_manual").addClass("fn-hide")):(e.$("#osd_GPS_enable_on_manual").removeClass("fn-hide"),x.Enable=!0,e.$("[data-GPS=osd_west_east_"+d+"]").each(function(b,c){"SPAN"===c.tagName||a(c).val(f[b][0])}),e.$("[data-GPS=osd_north_south_"+d+"]").each(function(b,c){"SPAN"===c.tagName||a(c).val(f[b][1])}))},getDegree:function(a){var b=Math.abs(a[0])/1e6,c=Math.abs(a[1])/1e6;return 0>b||0>c?void(f=[[0,0],[0,0],[0,0]]):(f[0][0]=Math.floor(b),f[1][0]=Math.floor(60*(b-f[0][0])),f[2][0]=Math.round(3600*(b-f[0][0])%60),f[0][1]=Math.floor(c),f[1][1]=Math.floor(60*(c-f[0][1])),f[2][1]=Math.round(3600*(c-f[0][1])%60),f[0][0]<180?(g=0,e.$("#osd_west")[0].checked=!0):(g=180,f[0][0]-=g,e.$("#osd_east")[0].checked=!0),void(f[0][1]<90?(h=0,e.$("#osd_south")[0].checked=!0):(h=90,f[0][1]-=h,e.$("#osd_north")[0].checked=!0)))},setDegree:function(){x.Enable&&(e.$("[data-GPS=osd_west_east_manual]").each(function(b,c){f[b][0]=a(c).val()-0}),e.$("[data-GPS=osd_north_south_manual]").each(function(b,c){f[b][1]=a(c).val()-0}),g=e.$('input[name="osd_west_east"]:checked').val()-0,h=e.$('input[name="osd_north_south"]:checked').val()-0,x.Longitude=Math.floor(1e6*(f[0][0]+g+f[1][0]/60+f[2][0]/3600)),x.Latitude=Math.floor(1e6*(f[0][1]+h+f[1][1]/60+f[2][1]/3600)))},onSelectGPSMode:function(b){w[0].CurMode=a(b.target).val()},leave:function(){e.save()},save:function(){p[N].GPSTitle.EncodeBlend=e.$("#osd_GPS_enable_on").prop("checked"),webApp.GongAnDetect&&(w[0].CurMode=e.$("#video_GPSmode").val()),y&&e.setDegree()}})}),define("osd_voltage",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,d.render()},render:function(){plugin.SetRegionNum(0);var b=p[N].VoltageStatus||{};b.EncodeBlend?a("#osd_voltage_enable_on").prop("checked",!0):a("#osd_voltage_enable_off").prop("checked",!0),a("#osd_voltage_continue").val(b.DisplayTime),b.DisplayTime?(a("#osd_voltage_select").val("Manual"),a("#osd_voltage_continue").css("display","block")):(a("#osd_voltage_select").val("Auto"),a("#osd_voltage_continue").css("display","none"))},leave:function(){d.save()},save:function(){p[N].VoltageStatus.EncodeBlend=d.$("#osd_voltage_enable_on").prop("checked"),v&&(p[N].VoltageStatus.EncodeBlend=a("#osd_voltage_enable_on").prop("checked"),p[N].VoltageStatus.PreviewBlend=a("#osd_voltage_enable_on").prop("checked"),"Auto"==a("#osd_voltage_select").val()?(p[N].VoltageStatus.DisplayTime=0,a("#osd_voltage_continue").val(0)):p[N].VoltageStatus.DisplayTime=a("#osd_voltage_continue").val()-0)}})}),define("osd_4g",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,d.render()},render:function(){var b=p[N].OSDMobileState||{};plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?d.$("#osd_4g_enable_on").prop("checked",!0):d.$("#osd_4g_enable_off").prop("checked",!0),g(b.Rect,tl("net.ApnInfo"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("net.ApnInfo"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))},leave:function(){d.save(),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){p[N].OSDMobileState.EncodeBlend=d.$("#osd_4g_enable_on").prop("checked")}})}),define("osd_SDMeasureDistance",function(require,a,b){var c,d,e=null;b.exports=k.extend({init:function(){e=this,"Laser"!==z.Type?c=e.$("#osd_sd_height").numberfield({min:0,max:4294967296,allowNegative:!1,allowDecimal:!0,decimalPrecision:1}):(e.$("#osd_sd_height").parent().addClass("fn-hide"),e.$("#osd_sd_height").parent().prev().addClass("fn-hide")),d=e.$("#osd_sd_displayDuration").numberfield(),z&&z.OSDDisplay&&(d=e.$("#osd_sd_displayDuration").numberfield({min:z.OSDDisplay.DisplayDurationRange[0],max:z.OSDDisplay.DisplayDurationRange[1],allowNegative:!1,allowDecimal:!1}),e.$("#osd_sd_displayDuration_minTip").text(z.OSDDisplay.DisplayDurationRange[0]),e.$("#osd_sd_displayDuration_maxTip").text(z.OSDDisplay.DisplayDurationRange[1])),e.render()},render:function(){var a=0,b=j[N].DisplayDuration||2;j[N].EncodeBlend?e.$("#osd_SDMeasureDistance_enable_on").prop("checked",!0):e.$("#osd_SDMeasureDistance_enable_off").prop("checked",!0),"Laser"!==z.Type&&(a=(j[N].DeviceHeight/100).toFixed(1)-0||0,c.numberfield("value",a)),d.numberfield("value",b)},leave:function(){e.save()},save:function(){j[N].EncodeBlend=e.$("#osd_SDMeasureDistance_enable_on").prop("checked"),"Laser"!==z.Type&&(j[N].DeviceHeight=parseInt(100*c.numberfield("value"))),j[N].DisplayDuration=d.numberfield("value")}})}),define("osd_newtext1",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,d.$("#osd_newtext1_title").textfield({length:63,asciiByte:2,notAsciiByte:3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}),d.render()},render:function(){if(p[N]){var b=p[N].CustomTitle[0]||{};plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?d.$("#osd_newtext1_enable_on").prop("checked",!0):d.$("#osd_newtext1_enable_off").prop("checked",!0),d.$("#osd_newtext1_title").textfield("value",b.Text||""),g(b.Rect,tl("med.osd1"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("med.osd1"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))}},leave:function(){plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),d.save()},save:function(){p[N].CustomTitle[0].EncodeBlend=d.$("#osd_newtext1_enable_on").prop("checked"),p[N].CustomTitle[0].Text=d.$("#osd_newtext1_title").textfield("value")}})}),define("osd_newtext2",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,d.$("#osd_newtext2_title").textfield({length:63,asciiByte:2,notAsciiByte:3,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}),d.render()},render:function(){if(p[N]){var b=p[N].CustomTitle[2]||{};plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?d.$("#osd_newtext2_enable_on").prop("checked",!0):d.$("#osd_newtext2_enable_off").prop("checked",!0),d.$("#osd_newtext2_title").textfield("value",b.Text||""),g(b.Rect,tl("med.osd2"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("med.osd2"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))}},leave:function(){plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),d.save()},save:function(){p[N].CustomTitle[2].EncodeBlend=d.$("#osd_newtext2_enable_on").prop("checked"),p[N].CustomTitle[2].Text=d.$("#osd_newtext2_title").textfield("value")}})}),define("osd_trafic",function(require,b,c){var d=null,e={Vehicle:!0,NonMotor:!0,Human:!1};c.exports=k.extend({init:function(){d=this,m.get("IVSCaps").done(function(b){if(b.SupportedScenes.Gate){var c=b.SupportedScenes.Gate.SupportedRules.TrafficTollGate;if(c.FeatureLists){var f={};a.each(c.FeatureLists,function(a,b){f[b.ObjectType]=b.FeatureList}),f.NonMotor||(e.NonMotor=!1)}}else b.SupportedScenes.ObjectDetect&&m.get("FlowStat").done(function(b){b&&b[0]&&(e={},a.each(b[0],function(a,b){e[a]=b.Support}))});d.$("[data-flow]").each(function(){var b=a(this).attr("data-flow");e[b]&&a(this).show()})}),d.render()},render:function(){var b=p[N].TrafficFlowTitle||(p[N].TrafficFlowTitle={});plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?d.$("#osd_trafic_enable_on").prop("checked",!0):d.$("#osd_trafic_enable_off").prop("checked",!0),d.$("#osd_trafic_ShowMotorFlowStat").prop("checked",b.MotorOrNon.ShowMotorFlowStat),d.$("#osd_trafic_ShowNonMotorFlowStat").prop("checked",b.MotorOrNon.ShowNonMotorFlowStat),e.Human&&d.$("#osd_trafic_ShowHumanFlowStat").prop("checked",b.Human.ShowHumanFlowStat),d.$("#osd_trafic_textalign").val("TextAlign"in b?b.TextAlign:2),g(b.Rect,tl("TrafficFlowStat"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("TrafficFlowStat"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))},leave:function(){d.save(),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){var a=p[N].TrafficFlowTitle;a.EncodeBlend=d.$("#osd_trafic_enable_on").prop("checked"),a.MotorOrNon.ShowMotorFlowStat=d.$("#osd_trafic_ShowMotorFlowStat").prop("checked"),a.MotorOrNon.ShowNonMotorFlowStat=d.$("#osd_trafic_ShowNonMotorFlowStat").prop("checked"),e.Human&&(a.Human.ShowHumanFlowStat=d.$("#osd_trafic_ShowHumanFlowStat").prop("checked")),a.TextAlign=d.$("#osd_trafic_textalign").val()-0}})}),define("osd_weather",function(require,b,c){var d=null,e=null;c.exports=k.extend({init:function(){d=this,m.get("FaceBoardCaps").done(function(b){b&&b.Atmosphere&&b.Atmosphere.OSDAbility&&(e=b.Atmosphere.OSDAbility,a.each(e,function(a,b){b&&d.$("#osd_w_"+a).removeClass("fn-hide")}),d.bind(),d.render())})},bind:function(){d.$("#osd_weather_enable_on").click(function(){d.$('[value="on"]').each(function(a,b){var c=d.$(b);c.prop("checked",!0)}),d.$('[value="off"]').each(function(a,b){var c=d.$(b);c.prop("checked",!1)}),d.$('[value="on"][index]').each(function(a,b){var c=d.$(b);c.disabled(!1)})}),d.$("#osd_weather_enable_off").click(function(){d.$('[value="on"]').each(function(a,b){var c=d.$(b);c.prop("checked",!1)}),d.$('[value="off"]').each(function(a,b){var c=d.$(b);c.prop("checked",!0)}),d.$('[value="on"][index]').each(function(a,b){var c=d.$(b);c.disabled(!0)})})},render:function(){plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=ab(b,c,d,e);Z[N].Rect=f}),Z[N].EncodeBlend?(d.$("#osd_weather_enable_on").prop("checked",!0),d.$('[value="on"][index]').each(function(a,b){var c=d.$(b);c.disabled(!1)})):(d.$("#osd_weather_enable_off").prop("checked",!0),d.$('[value="on"][index]').each(function(a,b){var c=d.$(b);c.disabled(!0)}));for(var b=0;7>b;b++)if(5!==b){var c=Boolean(Z[N].Mask>>b&1);d.$('[value="on"][index='+b+"]").prop("checked",c),d.$('[value="off"][index='+b+"]").prop("checked",!c)}g(Z[N].Rect,tl("med.WeatherInfo"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(Z[N].Rect,tl("med.WeatherInfo"),160,20),a.subscribe("RegionChanged",function(a,b){var c=ab(b[0],b[1],b[2],b[3]);Z[N].Rect=c}))},save:function(){Z[N].EncodeBlend=d.$("#osd_weather_enable_on").prop("checked");for(var a=0,b=0;7>b;b++)if(5!==b){var c=d.$('[value="on"][index='+b+"]").prop("checked");a+=Number(c)<<b}Z[N].Mask=a},leave:function(){d.save(),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))}})}),define("osd_laserDistMeasure",function(require,a,b){var c=null;b.exports=k.extend({init:function(){c=this,c.render()},render:function(){if(c.$("#osd_laser_enable_on,#osd_laser_enable_off").prop("disabled",N),!N){var a=j[0]||{};a.EncodeBlend?c.$("#osd_laser_enable_on").prop("checked",!0):c.$("#osd_laser_enable_off").prop("checked",!0)}},save:function(){j[0].EncodeBlend=c.$("#osd_laser_enable_on").prop("checked")},leave:function(){c.save()}})}),define("osd_face",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this,fb>1&&d.$("#osd_face_Analysis_wrap").removeClass("fn-hide"),d.render()},render:function(){var b=eb[N];plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=ab(c,d,e,f);b.Rect=g}),b.EncodeBlend?d.$("#osd_face_enable_on").prop("checked",!0):d.$("#osd_face_enable_off").prop("checked",!0),d.$("#osd_face_Detection").prop("checked",b.ShowFaceDetection),d.$("#osd_face_Analysis").prop("checked",b.ShowFaceRecognition),d.$("#osd_face_textalign").val("TextAlign"in b?b.TextAlign:2),g(b.Rect,tl("ivs.FaceFlowStat"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b.Rect,tl("ivs.FaceFlowStat"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b.Rect=d}))},leave:function(){d.save(),plugin.addEvent("RegionChanged",null),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null))},save:function(){var a=eb[N];a.EncodeBlend=d.$("#osd_face_enable_on").prop("checked"),a.ShowFaceDetection=d.$("#osd_face_Detection").prop("checked"),a.ShowFaceRecognition=d.$("#osd_face_Analysis").prop("checked"),a.TextAlign=d.$("#osd_face_textalign").val()-0}})}),define("osd_fontAttr",function(require,b,c){var d=null;c.exports=k.extend({init:function(){d=this;var a=d.$("#color_picker").colorpicker({submitText:tl("com.Ok"),onChange:function(a,b){d._renderDom(b)},onShow:function(){var b=d.getColor(d.$("span[data-name=text]").css("color"));a.colorpickerSetColor(b),jQuery(".colpick_full").css(document.body.offsetWidth<1300?{left:d.$("#color_picker").offset().left-280}:{left:d.$("#color_picker").offset().left-160})},onHide:function(){d._changeArrow("up")},onSubmit:function(a,b){d._renderDom(b),d.$("#color_picker").colorpickerHide()}});jQuery(".colpick.colpick_full").find(".colpick_submit").hide(),d._bindColor(),d.render()},getColor:function(b){var c=b,d=[],e="";if(a.browser.ie&&c.length<8)e=c.replace("#","");else{d=c.match(/\d+/g);for(var f=0;3>f;f++){var g=Number(d[f]).toString(16);e+=(""+g).length<2?"0"+g:g}}return e},render:function(){plugin.SetRegionNum(0);var a=p[N].ChannelTitle.FrontColor,b=e(a);d._renderDom(b);var c=0;p[N].FontSize&&p[N].FontSize>=16&&(c=p[N].FontSize),d.$("#osd_font_size").val(c)},leave:function(){plugin.addEvent("RegionChanged",null),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),d.save()},save:function(){var b=d.$("#osd_font_size").val()-0||0;p[N].FontSize=b,p[N].FontSizeExtra1=b,p[N].FontSizeExtra2=b,p[N].FontSizeExtra3=b,p[N].FontSizeSnapshot=b,p[N].FontSizeScale=1;var c=d.$("span[data-name=text]").css("color"),e=[];if(a.browser.ie&&c.length<8){e=c.match(/[a-zA-z|\d]{2}/g);for(var g=0;3>g;g++)e[g]=parseInt(e[g],16)}else e=c.match(/\d+/g);for(var g=0,h=gb.length;h>g;g++){var i=gb[g].params.table;i&&i[N]&&f(i[N],e)}},_bindColor:function(){d.$("#fontAttr_fontAll").delegate("[data-show]","click",function(){var b=a(this).attr("data-show"),c=d.$("[data-name ="+b+"]");"pick1"==b?c.hasClass("fn-hide")?(d._changeArrow("down"),c.removeClass("fn-hide")):(d._changeArrow("up"),c.addClass("fn-hide")):"pick2"==b&&(d._hidePick1(!1),d.$("#color_picker").click())}),d.$("#fontAttr_fontAll").delegate("[data-hide]","click",function(){d._hidePick1();var b=a(this).attr("data-value");d._renderDom(b)})},_changeArrow:function(a){var b=d.$('span[data-arrow="fontColor"]');switch(a){case"up":b.removeClass("triangleUp"),b.addClass("triangleDown");break;case"down":b.removeClass("triangleDown"),b.addClass("triangleUp")}},_hidePick1:function(b){a('div[data-name="pick1"]').addClass("fn-hide"),b!==!1&&d._changeArrow("up")},_hidePick2:function(){d.$("#color_picker").colorpickerHide()},_renderDom:function(b){a('span[data-name="text"]').css({"border-bottom":"2px solid #"+b,color:"#"+b})}})}),define("osd_customOsd",function(require,b,c){function d(a){return['<li class="fn-clear">','<input type="text" ','class="ui-input fn-left" ','oncontextmenu = "return false" ',"value = "+(a?a:""),">",'<span class="ui-set-icon-add"></span>',"</li>"].join("")}var e=null,f=0,i=2;c.exports=k.extend({init:function(){e=this,e.render(),e.bind()},render:function(){var b=p[N].UserDefinedTitle;plugin.addEvent("RegionChanged",function(a,c,d,e,g){var h=ab(c,d,e,g);b[f].Rect=h}),b[f].EncodeBlend?e.$("#osd_custom_enable_on").prop("checked",!0):e.$("#osd_custom_enable_off").prop("checked",!0),e.$("#osd_title_textalign").val(0==b[f].TextAlign||b[f].TextAlign?b[f].TextAlign:2),g(b[f].Rect,tl("com.CustomOsd"),160,20),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(h(b[f].Rect,tl("com.CustomOsd"),160,20),a.subscribe("RegionChanged",function(a,c){var d=ab(c[0],c[1],c[2],c[3]);b[f].Rect=d})),e.renderTitle()},save:function(){for(var a=[],b=e.$("#osd_title ul li").length,c=0;b>c;c++){var d=e.$("#osd_title ul li").eq(c).find("input").val();d&&a.push(d)}p[N].UserDefinedTitle[f].Text=a.join("|"),p[N].UserDefinedTitle[f].TextAlign=e.$("#osd_title_textalign").val()-0,p[N].UserDefinedTitle[f].EncodeBlend=e.$("#osd_custom_enable_on").prop("checked")},bind:function(){function b(){function a(){for(var a=0,b=c.length;b>a;a++)if(c[a].EncodeBlend)return!0;return!1}function b(){for(var a=0,b=c.length;b>a;a++)c[a].EncodeBlend=!1}var c=[];return s&&s[N]&&(c=s[N]),{getEncodeBlend:a,setEncodeBlend:b}}e.$("#osd_title ul").on("click","li span",function(){var b=e.$("#osd_title ul li").length;if(!(b>=i)){var c=a(d());e._initInput(c.find("input"),255,1,2),e.$("#osd_title ul").append(c),e.$("#osd_title ul li span").hide(),b!==i-1&&e.$("#osd_title ul li span").last().show()}}),e.$("#osd_custom_enable_on").on("click",function(){webApp.IsSDIntel&&!webApp.NoIntelliPreset?b().getEncodeBlend()&&(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.CustomosdDisableFlowrateTip"),function(){e.$("#osd_custom_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),b().setEncodeBlend(),p[N].UserDefinedTitle[f].EncodeBlend=!0},function(){plugin.cover("#video_OSD_node"),e.$("#osd_custom_enable_off").prop("checked",!0)},!0)):s&&s[N]&&s[N].EncodeBlend&&(plugin.hide(),a.confirm(tl("com.Ok"),tl("com.CustomosdDisableFlowrateTip"),function(){e.$("#osd_custom_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),s[N].EncodeBlend=!1,p[N].UserDefinedTitle[f].EncodeBlend=!0},function(){plugin.cover("#video_OSD_node"),e.$("#osd_custom_enable_off").prop("checked",!0)},!0))})},renderTitle:function(){var b=p[N].UserDefinedTitle[0],c=b.Text?b.Text.split("|"):[""],f=e.$("#osd_title ul");f.empty();for(var g=0,h=c.length;h>g;g++){var j=a(d());e._initInput(j.find("input")),j.find("input").textfield("value",c[g]||""),f.append(j)}e.$("#osd_title ul li span").hide(),c.length<i&&e.$("#osd_title ul li span").last().show()},leave:function(){plugin.addEvent("RegionChanged",null),("flash"==webApp.playMode||"h5"===webApp.playMode)&&(R.hide(),a.unsubscribe("RegionChanged",null)),e.save()},_initInput:function(a){a.textfield({length:255,asciiByte:1,notAsciiByte:2,validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"})}})})}),define("enc_inter",function(require,c,d){var e=require("jsCore/pageBase"),f=require("jsCore/rpc"),g=require("jsCore/rpcLogin"),h=null,i=null,j=0,k=0,l=require("jsCore/hlsplayer"),m=require("jsCore/flashplayer"),n=require("jsCore/h5player"),o=require("jsCore/pluginCanvas"),p=0,q=global.getDefaultRect,r=null;d.exports=e.extend({init:function(){h=this;var a=h.$("#enc_inter_channel");webApp.CHANNEL_NUMBER>1?(a.parent().removeClass("fn-hide"),a.parent().next("div").removeClass("fn-hide"),a.iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){k=b.ch,h.openVideo(),h._renderElement()}}),a.iconSelect("index",k)):(a.parent().next("div").remove(),a.parent().remove()),j=b.MaxROICount,h.$("#inter_clear").on("click",function(){plugin.DelSelReg(-2),("flash"===webApp.playMode||"h5"===webApp.playMode)&&o.DelSelReg(-2),i[k].Regions=[]}),h.$("#inter_del").on("click",function(){plugin.DelSelReg(-1),("flash"===webApp.playMode||"h5"===webApp.playMode)&&o.DelSelReg(-1)}),h.render()},render:function(){h.openVideo(),plugin.addEvent("RegionChanged",function(a,b,c,d,e){h._postInterWindow(a,b,c,d,e)
}),f.ConfigManager.getConfig("VideoEncodeROI").done(function(a){i=a,h._renderElement()})},leave:function(){plugin.addEvent("RegionChanged",null),plugin.SetRegionNum(0),plugin.hide(),plugin.close(),"hls"===webApp.playMode?l.hideAndStopLoad():"flash"===webApp.playMode?(m.hide(),a.unsubscribe("RegionChanged",null),o.hide()):"h5"===webApp.playMode&&(n.hide(),a.unsubscribe("RegionChanged",null),o.hide())},openVideo:function(){"hls"===webApp.playMode?(l.cover(h.$("#inter_node")),plugin.hide(),l.init("","",""),l.beginPlay()):"flash"===webApp.playMode?(m.cover(h.$("#inter_node")),m.playPreview(1,0),h.$("#inter_del_tip").hide()):"h5"===webApp.playMode?(r=new a.Deferred,n.playPreview(1,0,h.$("#inter_node"),null,r),h.$("#inter_del_tip").hide()):plugin.cover("#inter_node",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(1),-1!==webApp.DeviceType.indexOf("TPC")||webApp.CHANNEL_NUMBER>1?(plugin.SetVisibleVideoWnd(1,k),g.chkAuthority("Monitor_0"+(k+1))&&plugin.open(1,k,1),g.chkAuthority("Monitor_0"+(k+1))||plugin.SetVideoWndTip(k,tl("noVideoAuthoity"))):plugin.open(),a&&h._renderElement()})},_renderElement:function(){var a=i[k];a.Main?h.$("#inter_enable_on").prop("checked",!0):h.$("#inter_enable_off").prop("checked",!0),h.$("#inter_ImgQuality").val(a.Quality),h._areaCoverInter()},_areaCoverInter:function(){plugin.SetRegionNum(0);var b=[];plugin.SetRegionNum(j),i[k].Regions?b=i[k].Regions:i[k].Regions=[];for(var c=b.length,d=0;c>d;d++){var e=b[d][0],g=b[d][1],l=b[d][2],m=b[d][3];e!=l&&g!=m&&plugin.SetSelRegionByIndex(d,e,g,l,m)}if("flash"===webApp.playMode||"h5"===webApp.playMode){var n=function(){o.cover("#inter_node",webApp.resolution.x+"*"+webApp.resolution.y),o.SetRegionNum(j);for(var a=0;j>a;a++)b[a]||(b[a]=[0,0,0,0]);for(a=0;j>a;a++){var c=b[a][0],d=b[a][1],e=b[a][2],f=b[a][3];o.SetSelRegionByIndex(a,c,d,e,f)}};"flash"===webApp.playMode?f.ConfigManager.getConfig(["Encode","VideoImageControl"]).done(function(a){if(webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[1].params.table[0].Rotate90||2==a[1].params.table[0].Rotate90){var b;b=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=b}n()}):"h5"===webApp.playMode&&r&&r.done(function(a){webApp.resolution.x=a.width,webApp.resolution.y=a.height,n()}),a.subscribe("RegionChanged",function(a,b){p=b[b.length-1],b.length>1&&h._postInterWindow(p,b[0],b[1],b[2],b[3])})}},_postInterWindow:function(a,b,c,d,e){var f=q(b,c,d,e);b=f[0],c=f[1],d=f[2],e=f[3];var g=i[k].Regions;g[a]=[b,c,d,e],(d==b||c==e)&&(g[a]=[0,0,0,0])},onDefault:function(){f.ConfigManager.getDefault("VideoEncodeROI").done(function(a){var b=i[k].DynamicTrack;i=a,i[k].DynamicTrack=b,h._renderElement(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.DefaultfailureTip")})},onRefresh:function(){f.ConfigManager.getConfig("VideoEncodeROI").done(function(a){i=a,h._renderElement(),h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},onSave:function(){var a=i[k];a.Main=h.$("#inter_enable_on").prop("checked"),a.Quality=h.$("#inter_ImgQuality").val()-0;for(var b=a.Regions.length;b--;)"0,0,0,0"==a.Regions[b]&&a.Regions.splice(b,1);f.ConfigManager.setConfig("VideoEncodeROI",i).done(function(){h._areaCoverInter(),h.tip("success","com.SaveSuccessTip")}).fail(function(){h.tip("error","com.SaveConfigFailTip")})}})}),define("enc_path",function(require,b,c){function d(){for(var a=f.$(".video-path-input"),b=null,c=0,d=a.length;d>c;c++){if(b=a[c],"nacl"===plugin.type&&""===b.value)return!0;if(""===b.value)return f.tip("error","com.PathErrorsTip"),!1;if(b.value=b.value.replace(/\s+[\\\\]/g,"\\").replace(/[\\\\]\s+/g,"\\"),b.value.lengthB()>200)return void f.tip("error","com.PathLongTip")}return!0}var e=require("jsCore/pageBase"),f=(require("jsCore/rpc"),require("jsCore/rpcLogin"),null),g=["LiveSnapshot","LiveRecord","PlaybackSnapshot","PlaybackRecord","VideoClips"];c.exports=e.extend({init:function(){f=this,webApp.IsLocalStore||f.$(".need-sd-card").addClass("fn-hide"),ability.get("RadioMetry").done(function(a){a&&a.Support?(f.$("#path_needTpc").removeClass("fn-hide"),g.push("HeatMap")):f.$("#path_needTpc").remove()}),f.render()},render:function(){a.each(g,function(a,b){plugin.GetConfigPath(b).done(function(a){f.$("#path_"+b).val(a)})})},onChoosePath:function(b){("flash"===webApp.playMode||"h5"===webApp.playMode)&&f.tip("error","com.NoSupport");var c=a(b.target).attr("data-target");plugin.ShowFileBrowse().done(function(a){c&&f.$("#path_"+c).val(a)})},onDefault:function(){a.each(g,function(a,b){plugin.GetDefaultConfigPath(b).done(function(a){f.$("#path_"+b).val(a)})}),f.tip("success","com.DefaultSuccessTip")},onSave:function(){d()&&(a.each(g,function(a,b){plugin.SetConfigPath(b,f.$("#path_"+b).val())}),f.tip("success","com.SaveSuccessTip"))}})}),define("enc_encrypt",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("common/common"),g=(require("jsCore/rpcLogin"),f.Check),h=null,i=null,j=0,k=null;c.exports=d.extend({init:function(){h=this,$port1=h.$("#encrypt_port").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),$port2=h.$("#encrypt_port2").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),k=a.validator([{element:"#encrypt_deviceid",check:[g.alphaNumLineDot,g.alphaNumLineDot],errorMsg:["com.WrongServerNameTip","com.WrongServerNameTip"],events:["keyup","blur"]}],function(a){a.parent().translation()}),h.$("#encrypt_serverip").ipfield({type:""}),h.$("#encrypt_serverip2").ipfield({type:""}),h.render()},render:function(a){e.ConfigManager.getConfig("NetSerEncrypt").done(function(b){i=b,h._renderElement(),a&&h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},_renderElement:function(){var a=i[j][0];h.$("#encrypt_deviceid").val(a.NetID),h.$("#encrypt_serverip").ipfield("value",a.Address),h.$("#encrypt_port").val(a.Port),h.$("#encrypt_serverip2").ipfield("value",a.BakAddress),h.$("#encrypt_port2").val(a.BakPort),k.validate()},onDefault:function(){e.ConfigManager.getDefault("NetSerEncrypt").done(function(a){i=a,h._renderElement(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.DefaultfailureTip")})},onRefresh:function(){h.render(!0)},onSave:function(){var a=i[j][0];return a.NetID=h.$("#encrypt_deviceid").val(),a.Address=h.$("#encrypt_serverip").ipfield("value"),a.Port=$port1.numberfield("value"),a.BakAddress=h.$("#encrypt_serverip2").ipfield("value"),a.BakPort=$port2.numberfield("value"),k.isInvalid()?h.tip("warning",k.errors()[0].errorMsg):void e.ConfigManager.setConfig("NetSerEncrypt",i).done(function(){var b=a.Address||a.BakAddress,c=(a.Port||a.BakPort)-0;plugin.SetDecodeKeyEx(0,b,c,a.NetID,""),h.tip("success","com.SaveSuccessTip")}).fail(function(){h.tip("error","com.SaveConfigFailTip")})}})}),define("enc_nvrEncrypt",function(require,b,c){function d(a){return a.length<=32}var e=require("jsCore/pageBase"),f=require("jsCore/rpc"),g=require("common/common"),h=g.Check,i=null,j=null,k=0,l=null;c.exports=e.extend({init:function(){i=this,$port1=i.$("#nvrencrypt_port0").numberfield({min:0,max:65535,allowDecimal:!1,allowNegative:!1}),$port2=i.$("#nvrencrypt_port1").numberfield({min:0,max:65535,allowDecimal:!1,allowNegative:!1}),$port3=i.$("#nvrencrypt_port2").numberfield({min:0,max:65535,allowDecimal:!1,allowNegative:!1}),l=a.validator([{element:"#nvrencrypt_deviceid",check:[h.alphaNumLineDot,d],errorMsg:["com.WrongServerNameTip","w_Stringlong32"],events:["keyup","keyup"]}],function(a){a.parent().translation()}),a("#nvrencrypt_deviceid").textfield({length:32}),i.$("#nvrencrypt_serverip0").ipfield({type:"ip",error:function(a,b){"firstIPError"==b.type?i.tip("warning","com.Ipv4Range"):"lastIPError"==b.type&&i.tip("warning","com.Ipv4RangeLast")}}),i.$("#nvrencrypt_serverip1").ipfield({type:"ip",error:function(a,b){"firstIPError"==b.type?i.tip("warning","com.Ipv4Range"):"lastIPError"==b.type&&i.tip("warning","com.Ipv4RangeLast")}}),i.render()},render:function(a){f.ConfigManager.getConfig("NvrEncrypt").done(function(b){j=b,i._renderElement(),a&&i.tip("success","com.OperateSuccessTip")}).fail(function(){i.tip("error","com.OperateFailTip")})},_renderElement:function(){var a=j[k][0];i.$("#nvrencrypt_deviceid").val(a.DevSeriId),i.$("#nvrencrypt_port0").val(a.ConsultPort),i.$("#nvrencrypt_port1").val(a.MatchPort),i.$("#nvrencrypt_port2").val(a.BakMatchPort),i.$("#nvrencrypt_serverip1").ipfield("value",a.BakServerIp),i.$("#nvrencrypt_serverip0").ipfield("value",a.ServerIp),l.validate()},onDefault:function(){f.ConfigManager.getDefault("NvrEncrypt").done(function(a){j=a,i._renderElement(),i.tip("success","com.DefaultSuccessTip")}).fail(function(){i.tip("error","com.DefaultfailureTip")})},onRefresh:function(){i.render(!0)},onSave:function(){var a=j[k][0];return a.DevSeriId=i.$("#nvrencrypt_deviceid").val(),a.BakServerIp=i.$("#nvrencrypt_serverip1").ipfield("value"),a.ServerIp=i.$("#nvrencrypt_serverip0").ipfield("value"),a.ConsultPort=$port1.numberfield("value"),a.MatchPort=$port2.numberfield("value"),a.BakMatchPort=$port3.numberfield("value"),l.isInvalid()?i.tip("warning",l.errors()[0].errorMsg):void f.ConfigManager.setConfig("NvrEncrypt",j).done(function(){i.tip("success","com.SaveSuccessTip")}).fail(function(){i.tip("error","com.SaveConfigFailTip")})}})})}(jQuery);