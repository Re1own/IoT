!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("ddns",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("common/common"),g=f.Check,h=null,i=0,j={},k={},l="",m="",n=60,o=null,p=null,q=null,r=null,s=null,t=null;c.exports=e.extend({init:function(){h=this,o=h.$("[sel-for=onProSel]"),$ddns_hostname=h.$("[cfg=HostName]"),r=h.$("[btn-for=onTest]"),s=h.$("[chk-for=onEnable]").on("change",function(){a(this).prop("checked")?h.$("#ddns_enable_tip").show():h.$("#ddns_enable_tip").hide()}),$dialogData=h.$("#ddns_connectDDNS").dialog({}).detach().appendTo(document.body),t=h.$("#ddns_test_tip"),validator=a.validator([{element:h.$("[cfg=Password]"),check:[g.noQuotation,g.noQuotation],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip"],events:["keyup","blur"]},{element:h.$("[cfg=UserName]"),check:[g.noQuotation,g.noQuotation],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip"],events:["keyup","blur"]},{element:h.$("[cfg=Address]"),check:[g.alphaNumLineDot,g.alphaNumLineDot,g.require],errorMsg:["com.WrongServerNameTip","com.WrongServerNameTip","com.WrongServerNameTip"],events:["keyup","blur","blur"]}],function(a){a.parent().translation()}),p=h.$("[cfg=Port]").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),q=h.$("[cfg=KeepAlive]").numberfield({min:1,max:500,allowDecimal:!1,allowNegative:!1}),h.$("input[id^=ddns_mode_]").click(h.onRadio),h.render()},destory:function(){$dialogData.remove()},render:function(){d.ConfigManager.getConfig("DDNS").done(function(b){j=b,k=a.extend(!0,{},b),h._setProtocolOptions(),h._renderElements()})},_setProtocolOptions:function(){o.empty();var b=!1;a.each(j,function(a,c){if(c.Enable&&!b&&(b=!0,i=a),("Private DDNS"!=c.Name||webCaps.vendor==Base64.decode("RGFodWE=")&&"SimpChinese"==global.currentLanguage&&"LC"===webCaps.vendor)&&(c.Name!=Base64.decode("RGFodWEgREROUw==")||!webCaps.hideDDNS)){if("Quick DDNS"==c.Name||"QUICK DDNS"==c.Name){if(webCaps.hideDDNS)return;o.append('<option value="'+c.Protocol+'" t="Quick DDNS"></option>')}else{if("CN99 DDNS"==c.Name&&webCaps.hide_CN99_DDNS&&"English"==global.currentLanguage)return;o.append('<option value="'+c.Protocol+'" t="'+(c.Name||c.Protocol)+'"></option>')}("CP Plus DDNS"==c.Protocol||"Private DDNS"==c.Protocol||"QUICK DDNS"==c.Protocol)&&((c.Enable||!b)&&(b=c.Enable,i=a),"CP Plus DDNS"!=c.Protocol&&(webCaps.vendor==Base64.decode("RGFodWE=")||"LC"===webCaps.vendor)&&o.find("option[value='"+c.Protocol+"']").attr("t",Base64.decode("RGFodWE=")+" DDNS"))}}),webCaps.hideDDNS&&-1!==["QUICK DDNS","Quick DDNS",Base64.decode("RGFodWEgREROUw==")].indexOf(j[i].Name)&&(i=0),o.get(0).selectedIndex=i,o.translation()},_renderElements:function(){var b=j[i];$ddns_hostname.unbind("keyup").keyup("CP Plus DDNS"===o.val()?h._showPostBtn:h._onHostnameKeyup),h.$("#ddns_hostname_postfix, #ddns_test_tip, #ddns_test_tipred").text(""),h.$('#ddns_macAddress_wrap, #ddns_internetStatus_wrap, #ddns_password_wrap, #ddns_keepalive_wrap, #ddns_cpPlusNotes_wrap, [t="com.UsernameTip"], [btn-for=onTest], #ddns_test_image, #ddns_port_wrap, #ddns_mode_wrap').hide(),h.$("#ddns_serviceIp_wrap, #ddns_username_wrap").show(),h.Available(!0);var c=!1;$ddns_hostname.prop("maxLength","Private DDNS"===b.Protocol||"QUICK DDNS"===b.Protocol?60:64),"Private DDNS"!=b.Protocol&&"QUICK DDNS"!=b.Protocol&&"CP Plus DDNS"!=b.Protocol&&"NO-IP DDNS"!=b.Protocol?(h.$("#ddns_password_wrap, #ddns_keepalive_wrap").show(),h.disabled("[cfg=HostName]",!1)):"CP Plus DDNS"===b.Protocol?(h.$("#ddns_macAddress_wrap, #ddns_internetStatus_wrap, #ddns_cpPlusNotes_wrap").show(),h.$("#ddns_serviceIp_wrap, #ddns_username_wrap").hide(),h.disabled("[cfg=HostName]",s.is(":checked")),$ddns_hostname.val(b.HostName.replace(/(.cpplusddns.com)+/,"")),c=!0,h.$("#ddns_hostname_postfix").text(".cpplusddns.com"),h.$("#ddns_title9").text("http://"+$ddns_hostname.val()+".cpplusddns.com"),""===m?d.ConfigManager.getConfig("Network").done(function(a){m=a[a.DefaultInterface].PhysicalAddress,h.$("#ddns_macAddressSpan").text(m)}):h.$("#ddns_macAddressSpan").text(m),n=60,h._getConnectState("one")):"Private DDNS"===b.Protocol||"QUICK DDNS"===b.Protocol?(l=b.Address.indexOf(".")>-1?b.Address.replace("www",""):"",h.$("#ddns_hostname_postfix").text(l),h.$('[t="com.UsernameTip"], #ddns_mode_wrap').show(),b.DefaultHostName&&b.DefaultHostName.Enable?(h.$("#ddns_mode_auto").prop("checked",!0),$ddns_hostname.val(b.DefaultHostName.HostName.replace(l,"")),h.disabled("[cfg=HostName]")):(h.$("#ddns_mode_manual").prop("checked",!0),r.show(),h.disabled("[cfg=HostName]",!1),$ddns_hostname.val(b.HostName.replace(l,""))),c=!0):"NO-IP DDNS"===b.Protocol&&(webCaps.NoIPDDNSTest?(h.$("#ddns_password_wrap, #ddns_keepalive_wrap").show(),h.$("[cfg=KeepAlive]").numberfield({min:1440,max:2880,allowDecimal:!1,allowNegative:!1}),h.$("#ddns_keepalive_range").text(tl("com.Minute")+"(1440~2880)"),h.disabled("[cfg=HostName]",!1),r.show()):(h.$("[cfg=KeepAlive]").numberfield({min:1,max:500,allowDecimal:!1,allowNegative:!1}),h.$("#ddns_password_wrap, #ddns_keepalive_wrap").show(),h.$("#ddns_keepalive_range").text(tl("com.Minute")+"(1~500)"),h.disabled("[cfg=HostName]",!1))),"NO-IP DDNS"!==b.Protocol&&(h.$("[cfg=KeepAlive]").numberfield({min:1,max:500,allowDecimal:!1,allowNegative:!1}),h.$("#ddns_keepalive_range").text(tl("com.Minute")+"(1~500)")),s.prop("checked",b.Enable||!1).change(),o.eq(i).attr("selected",!0),a.each(h.$("[cfg]"),function(a,d){var e=h.$(d).attr("cfg");"HostName"===e&&c||h.$(d).val(b[e])}),h.disabled("[cfg=Address]","Private DDNS"!=b.Name),"Private DDNS"===b.Name?h.$("#ddns_port_wrap").show():h.$("#ddns_port_wrap").hide(),validator.validate(),h.$("#ddns_test_tipred").text(g.alphaNumLineDot($ddns_hostname.val())?"":tl("com.WrongDomainName")),h.$("[chk-for=onEnable]").prop("checked")?h.$("#ddns_enable_tip").show():h.$("#ddns_enable_tip").hide()},onProSel:function(){return"CP Plus DDNS"==j[i].Protocol&&$ddns_hostname.val().length<3?(h.tip("warning","The hostname of CP Plus DDNS cannot be less than three alphas"),void o.eq(i).attr("selected",!0)):(h._saveData(),i=o.get(0).selectedIndex,void h._renderElements())},onRadio:function(){var a=h.$("#ddns_mode_auto").is(":checked");h.disabled($ddns_hostname,a),h.$("#ddns_test_image").hide(),a?(r.hide(),t.text(""),h.disabled("[btn-for=onConfirm]",!1),$ddns_hostname.val(j[i].DefaultHostName?j[i].DefaultHostName.HostName.replace(l,""):j[i].HostName.replace(l,""))):r.show()},onTest:function(){var b=j[i].Protocol,c=h.$("[cfg=Address]").val(),e=p.numberfield("value"),f=h.$("[cfg=UserName]").val(),g=h.$("[cfg=Password]").val(),k=["good","nochg",801,908,909,910,702],m="NO-IP DDNS"===b?$ddns_hostname.val():$ddns_hostname.val()+l;h.$("#ddns_test_tipred").text(""),t.text(tl("com.TestingTip")).prop("className","ui-tip-red"),h.$("#ddns_test_image").show(),h.Available(!1,!0),d.DdnsClient.testHostName(b,c,e,m,f,g).done(function(b){var c="com.FailTip";if(b&&a.inArray(b,k)>-1)t.text(tl("com.SucceedTip")).prop("className","ui-tip-green");else{switch(b){case"nohost\r\n":c="com.DomainExistTip";break;case"!yours\r\n":c="com.DomainUsedTip";break;case"!active\r\n":case"abuse\r\n":case"dnserr\r\n":case"911\r\n":c="com.ServerFailTip";break;default:c="com.FailTip"}t.prop("className","ui-tip-red"),$ddns_hostname.val(j[i].HostName.replace(l,"")),t.text(tl(c))}j[i].HostName=$ddns_hostname.val()+l,h.Available(!0,!0)}).fail(function(){h.Available(!0,!0),t.prop("className","ui-tip-red"),$ddns_hostname.val(j[i].HostName.replace(l,"")),t.text(tl("com.FailTip"))}).always(function(){h.$("#ddns_test_image").hide(),setTimeout(function(){t.text("")},3e3)})},onDefault:function(){d.ConfigManager.getDefault("DDNS").done(function(a){j=a,i=0,h._setProtocolOptions(),h._renderElements(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.DefaultfailureTip")})},onRefresh:function(){d.ConfigManager.getConfig("DDNS").done(function(a){j=a,i=0,h._setProtocolOptions(),h._renderElements(),h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},onConfirm:function(){var b=!0;return validator.isInvalid()?h.tip("warning",validator.errors()[0].errorMsg):g.alphaNumLineDot($ddns_hostname.val())?(h._saveData(),"CP Plus DDNS"!=o.val()||/^[a-zA-Z0-9-_.]+$/.test(j[i].HostName.replace(".cpplusddns.com",""))?(a.each(j,function(a,c){return"Private DDNS"!==c.Protocol&&"QUICK DDNS"!==c.Protocol||!c.UserName||f.Check.email(c.UserName)||""===c.UserName?("Private val"!=c.Name||f.Check.alphaNumLineDot(c.Address))&&g.alphaNumLineDot(c.Address)?g.alphaNumLineDot(c.HostName)?g.noQuotation(c.UserName)&&g.noQuotation(c.Password)?void 0:(h.tip("warning","com.NoInputMarksTip"),b=!1,!1):(h.tip("warning","com.WrongDomainName"),b=!1,!1):(h.tip("warning","com.WrongServerNameTip"),b=!1,!1):(h.tip("warning","Private DDNS"===c.Protocol?"com.EmailLimiteTip":"com.QuickemailLimiteTip"),b=!1,!1)}),void(b&&d.ConfigManager.setConfig("DDNS",j).done(function(){h.disabled("[sel-for=onProSel], #ddns_mode_auto, #ddns_mode_manual, #ddns_confirm",!1),h.tip("success","com.SaveSuccessTip"),"CP Plus DDNS"==o.val()&&($dialogData.dialog("show"),$dialogData.find("#ddns_connectDDNSTitle").text(tl("com.DDNSconnecttingTip")),n=60,setTimeout(h._getConnectState,6e3))}).fail(function(){"CP Plus DDNS"==o.val()&&h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1),h.tip("error","com.SaveConfigFailTip")}))):h.tip("error",tl("com.WrongDomainNameTip"))):h.tip("warning","com.WrongDomainName")},Available:function(a,b){h.disabled("[sel-for=onProSel], #ddns_mode_auto, #ddns_mode_manual, #ddns_confirm",!a),b&&(h.disabled("[cfg=HostName], [cfg=UserName], [chk-for=onEnable], [btn-for=onDefault], [btn-for=onRefresh], [btn-for=onConfirm], [btn-for=onTest]",!a),a?h.$("[btn-for=onDefault], [btn-for=onRefresh], [btn-for=onConfirm], [btn-for=onTest]").removeClass("ui-button-disabled"):h.$("[btn-for=onDefault], [btn-for=onRefresh], [btn-for=onConfirm], [btn-for=onTest]").addClass("ui-button-disabled"))},_saveData:function(){var a=j[i];a.Enable=s.is(":checked"),"Private DDNS"===a.Protocol||"QUICK DDNS"===a.Protocol?(h.$("#ddns_mode_manual").is(":checked")&&(a.HostName=$ddns_hostname.val()+l),null!=a.DefaultHostName&&(a.DefaultHostName.Enable=!h.$("#ddns_mode_manual").is(":checked"))):a.HostName=$ddns_hostname.val()||"",a.Address=h.$("[cfg=Address]").val(),a.Port=p.numberfield("value"),a.UserName=h.$("[cfg=UserName]").val(),a.Password=h.$("[cfg=Password]").val(),a.KeepAlive=q.numberfield("value")},_getConnectState:function(a){n--;var b="",c="",e="";d.DdnsClient.getStatus().done(function(d){var f=d[i].Value;switch(d[i].Status){case 0:b="Disconnected",n>0&&void 0===a&&setTimeout(h._getConnectState,1e3);break;case 1:switch(b="m_connected",f){case 908:c="com.CpDDNS908Tip";break;case 909:c="com.CpDDNS909Tip";break;case 910:c="com.CpDDNS910Tip";break;case 801:c="com.CpDDNS801Tip";break;case 702:c="com.CpDDNS702Tip"}$dialogData.find("#ddns_connectDDNSTitle").text(tl("net.Connected")+": "+tl(c)),setTimeout(function(){$dialogData.dialog("close")},5e3),h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1),e=d[i].ConIp;break;case 2:601==f?(c="com.CpDDNS601Tip",$dialogData.find("#ddns_connectDDNSTitle").text(tl("Disconnected")+": "+tl(c)),setTimeout(function(){$dialogData.dialog("close")},5e3)):$dialogData&&$dialogData.dialog("close"),b="Disconnected",h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1)}switch(f){case 0:c="com.CpDDNS0Tip";break;case 901:c="com.CpDDNS901Tip";break;case 902:c="com.CpDDNS902Tip";break;case 903:c="com.CpDDNS903Tip";break;case 904:c="com.CpDDNS904Tip";break;case 905:c="com.CpDDNS905Tip";break;case 906:c="com.CpDDNS906Tip";break;case 907:c="com.CpDDNS907Tip";break;case 911:c="com.CpDDNS911Tip";break;case 912:c="com.CpDDNS912Tip"}s.is(":checked")||(c="The CP PLUS DDNS function has not been enabled");var g=h.$("#ddns_noteStatus");return g.text("").prop("className","ui-text"),0===n?(h.$("#ddns_internetStatus").text(tl("Disconnected")),g.text(tl("com.CpDDNS0Tip")).prop("className","ui-tip-red"),h.disabled("#ddns_confirm, #ddns_refresh, #ddns_default",!1),void($dialogData&&$dialogData.dialog("close"))):(f=d[i].Status,1===f?g.text(e):2===f?g.text(tl(c)).prop("className","ui-tip-red"):0===f&&void 0!==a&&g.text(tl(c)).prop("className","ui-tip-red"),void h.$("#ddns_internetStatus").text(tl(b)))})},onEnable:function(){"CP Plus DDNS"==o.val()&&h.disabled("[cfg=HostName]",!s.is(":checked"))},_showPostBtn:function(){h.$("#ddns_title9").text("http://"+$ddns_hostname.val()+".cpplusddns.com"),""===$ddns_hostname.val()||0===$ddns_hostname.val().length?(t.text(tl("com.WrongHostNameTip")),h.disabled("#ddns_confirm")):(t.text(""),h.disabled("#ddns_confirm",!1))},_onHostnameKeyup:function(){h.$("#ddns_test_tipred").text(g.alphaNumLineDot($ddns_hostname.val())?"":tl("com.WrongDomainName")),("Private DDNS"===o.val()||"QUICK DDNS"===o.val())&&h.$("#ddns_mode_manual").is(":checked")&&h.Available($ddns_hostname.val()===k[i].HostName.replace(l,""))}})})}(jQuery);