!function(a){var b="EventType",c={A:"#D51111",F:"#00FFF7",M:"#DAE613",R:"#42D017"},d=[];define(function(require,e,f){function g(a,b,c){var d=a.match(/(\/[^\/]*)/g).pop().slice(1),e=b?b:ab.$("#pla_format input:checked").val();if("jpg"===e&&void 0!==c){var f=c.replace(/\s/g,"_").replace(/\-/g,"").split(":");f.length=f.length-1,d=f.toString().replace(/\,/g,"")+d}var g=d.substring(0,d.lastIndexOf(".")+1)+e;return g}function h(b){var c,d=ab.$("#pla_play_tip"),e=ab.$("[btn-for=onPlay]");switch(!0){case 16===b:c="8X";break;case 8===b:c="6X";break;case b>1:c=b+"X";break;case b>0&&1>b:c="1/"+1/b+"X";break;case 1===b:c="Play";break;case-1===b:c="Pause";break;case 0===b||-2===b:c="Stop",R.timeslider("value",a.pad(fb,2)+"000000")}tb=b,d.text(tl(c)),e.toggleClass("pause",1===b).attr("title",tl(1===b?"Pause":"com.Play")),ab.disabled("[btn-for=onEnlarge]",0===b||-2===b),ab.disabled("[btn-for=onCutRegion]",0===b||-2===b),ab.disabled("[btn-for=onSlow],[btn-for=onFast]",-1===b||0===b||-2==b),ab.disabled("[btn-for=onNextFrame]",0===b||-2===b)}function i(a){H.DownloadByFile(a,"PlaybackRecord",g(a.FilePath)).done(function(b){b&&(i.flag=a,tb=-2,kb=!0,ab.$("#ply_eventtype_select").addClass("ui-button-disabled"),ab.disabled('[btn-for="onSearch"],#pla_all,#pla_typechks :checkbox,#pla_format :radio',!0),a.Process=0,Q.table("refresh"),H.addEvent("DownloadPos",function(b){a.Process!==b&&(a.Process=b,Q.table("refresh")),100===b&&setTimeout(j,1e3)}),H.addEvent("DownLoadError",function(){j(),x(tl("com.NoSupportMp4Tip"))}))})}function j(){i.flag&&(H.StopDownload(g(i.flag.FilePath)),kb=!1,ab.$("#ply_eventtype_select").removeClass("ui-button-disabled"),tb=0,ab.disabled('[btn-for="onSearch"],#pla_all,#pla_typechks :checkbox,#pla_format :radio',!1),delete i.flag.Process,Q.table("refresh"),H.addEvent("DownloadPos",null),H.addEvent("DownLoadError",null),i.flag=null)}function k(a){var b=lb.find("#batch_media_type").val(),c=lb.find("#batch_down_path").val();H.DownloadByFileEx(a,"PlaybackRecord",g(a.FilePath,b,a.StartTime),c).done(function(b){b&&(i.flag=a,tb=-2,kb=!0,H.addEvent("DownloadPos",function(b){a.Process!==b&&(a.Process=b,$bd_file_table.table("refresh")),100===b&&(mb=nb.shift(),mb?k(mb):setTimeout(l,1e3))}),H.addEvent("DownLoadError",function(b,c){return-1==b?(a.Process="00",mb=nb.shift(),void(mb?k(mb):setTimeout(l,1e3))):0===b&&0===c?(a.Process="-1",mb=nb.shift(),void(mb?k(mb):setTimeout(l,1e3))):void 0}))})}function l(){i.flag&&(H.StopDownload(g(i.flag.FilePath)),kb=!1,tb=0,$bd_file_table.table("refresh"),H.addEvent("DownloadPos",null),H.addEvent("DownLoadError",null),i.flag=null),nb=[],mb=null,lb.find("[btn-for=onBatchDownload]").text(tl("com.StartDownload"))}function m(b,c){if(!c&&b.startTime&&(c=b.startTime.split(" ")[1]),-2===tb)return Q.table("selectRow",-1),x(tl("com.DownloadNotVedioTip"));var d=b.StartTime;c&&(d=b.StartTime.split(" ")[0]+" "+c),H.state("partialEnlarged")&&H.state("partialEnlarged",!1),H.PlaybackByFile(b,eb,fb,d).done(function(c){c?(ab.$('[btn-for="onSwitchSound"]').hasClass("play-bottom-iconbg-disabled")||H.PlayOpenSound(eb),R.timeslider("value",a.pad(fb,2)+d.split(" ")[1].split(":").join("")),h(1),Q.find("tbody tr[data-index="+b._index+"]").removeClass("error")):(Q.find("tbody tr[data-index="+b._index+"]").addClass("error"),setTimeout(function(){Q.table("selectRow",(Q.table("getSelectedRow")+1)%ib.length)},1e3))})}function n(){-2!==tb&&0!==tb&&(-1!==webApp.DeviceType.indexOf("TPC")?H.StopAllPlayBack().done(function(a){a&&(H.SetVisibleVideoWnd(1,0),W.table("selectRow",-1))}):(H.StopPlayBack(eb),Q.table("selectRow",-1).mouseleave(),H.state("partialEnlarged")&&H.state("partialEnlarged",!1)),h(0))}function o(){ub=setInterval(function(){Q.table("selectRow",(Q.table("getSelectedRow")+1)%ib.length)},3e3),ab.$("[btn-for=onPlay]").addClass("pause").attr("title",tl("com.Pause"))}function p(){ub&&(clearInterval(ub),ab.$("[btn-for=onPlay]").removeClass("pause").attr("title",tl("com.Play")))}function q(a){function b(a,b){e===vb&&(Math.abs(a-webApp.resolution.rate)>=1e-4&&(webApp.resolution.rate=a,w()),P.attr("src",b))}var c=global.isDDNS()?"http://"+location.hostname+":"+global.getDDNSMessage().devwebport:"",d=c+"/RPC_Loadfile"+a.FilePath,e=++vb;if(void 0===a.ImageRate){var f=new Image;f.onload=function(){a.ImageRate=f.width/f.height,b(a.ImageRate,d)},f.src=d}else b(a.ImageRate,d)}function r(b){var c=++wb,d=a.extend(!0,{Channel:fb,Types:[T.val()],Events:"*"},b);F.WorkDirectory.getBitmapEx(U.val(),d).done(function(a){if(c===wb)for(var b=a.toString(2),e=b.length;--e;)"1"===b.charAt(b.length-e-1)&&S.calendar("mark",new Date(d.Year,d.Month-1,e))})}function s(b){var c=[],d=[],e=ab.$("#pla_recordtype .ui-custom-select-content").empty();if(ab.$("#pla_recordtype .ui-custom-select-inputbox").text(""),ab.$("#pla_typechks :checkbox:checked:visible").each(function(f,g){var h=ab.$(g).prop("id"),i=null;switch(h){case"pla_normal":a('<li class="ui-custom-select-item" t="com.Normal"></li>').data("Flags",["Timing"]).data("TrueType",["All"]).appendTo(e),c.push("Timing"),d.push(tl("com.Normal"));break;case"pla_motion":a('<li class="ui-custom-select-item" t="com.Event"></li>').data("Flags",["Event"]).data("TrueType",["Event"]).appendTo(e),c.push("Event"),d.push(tl("com.Event")),(ob&&b&&a.isArray(b)||b&&b.EventTypes&&a.isArray(b.EventTypes.M))&&(i=ob?b:b.EventTypes.M,a.each(i,function(b,c){isEnable("is_numberOK_Gate")&&"TrafficJunction"===c?a('<li class="ui-custom-select-item" t="ANPR"></li>').data("Flags",["Event"]).data("Events",[c]).data("TrueType",["Event"]).appendTo(e):"LabelInfoAlarm"===c&&"jpg"!==T.val()?a('<li class="ui-custom-select-item" t="'+c+'"></li>').data("Flags",["Event"]).data("Events",["_LabelInfoAlarm_"]).data("TrueType",["Event"]).appendTo(e):a('<li class="ui-custom-select-item" t="'+(pb[c]||c)+'"></li>').data("Flags",["Event"]).data("Events",[c]).data("TrueType",["Event"]).appendTo(e)}));break;case"pla_alarm":a('<li class="ui-custom-select-item" t="per.Alarm"></li>').data("Flags",["Event"]).data("TrueType",["Alarm"]).appendTo(e),c.push("Event"),d.push(tl("per.Alarm"));break;case"pla_manual":a('<li class="ui-custom-select-item" t="med.Manual"></li>').data("Flags",["Manual"]).appendTo(e),c.push("Manual"),d.push(tl("med.Manual"))}}),c.length>1){var f=a('<li class="ui-custom-select-item">'+d.join(", ")+"</li>").data("Flags",c).data("TrueType","All");f.prependTo(e)}var g=e.translation().children(":first").addClass("ui-custom-select-item-current");g.length?g.click():S.calendar("select"),b&&b.Support||ob&&b.length?ab.$("#pla_recordtype").show():ab.$("#pla_recordtype").hide()}function t(c,d){function e(){F.MediaFileFind.findNextFile(h,hb).done(function(f){if(xb===h&&f.infos){var j=[],k=ab.$("#pla_recordtype .ui-custom-select-item-current");a.each(f.infos,function(a,e){var f;if(-1!==webApp.DeviceType.indexOf("TPC")?(f=e.FilePath.split("["),e[b]=f&&f[1].slice(0,1)):(f=e.FilePath.match(/\[[A-Z]\]/)||["[R]"],e[b]=f&&f[0].charAt(1)),d){var h=lb.find("#batch_download_type").val();("All"===h||"Picture"===h||"Timing"===h&&-1!==e.Flags.indexOf("Timing")||"Event"===h&&-1!==e.Flags.indexOf("Event")&&(-1!==e.Events.indexOf("VideoMotion")||e.Events.length>1||1===e.Events.length&&-1===e.Events.indexOf("AlarmLocal"))||"Alarm"===h&&-1!==e.Flags.indexOf("Event")&&-1!==e.Events.indexOf("AlarmLocal")||"Manual"===h&&-1!==e.Flags.indexOf("Manual"))&&d.table("add",e,-1),j.push(e)}else ab.$("#pla_normal").prop("checked")&&-1!==e.Flags.indexOf("Timing")&&g(e.Flags,c.Flags)?(Q.table("add",e,-1),j.push(e)):ab.$("#pla_motion").prop("checked")&&-1!==e.Flags.indexOf("Event")&&(-1!==e.Events.indexOf("VideoMotion")||e.Events.length>1||1===e.Events.length&&-1===e.Events.indexOf("AlarmLocal"))&&g(e.Flags,c.Flags)&&k.data("TrueType")&&(-1!==k.data("TrueType").indexOf("Event")||-1!==k.data("TrueType").indexOf("All"))?(Q.table("add",e,-1),j.push(e)):ab.$("#pla_alarm").prop("checked")&&-1!==e.Flags.indexOf("Event")&&-1!==e.Events.indexOf("AlarmLocal")&&g(e.Flags,c.Flags)&&k.data("TrueType")&&(-1!==k.data("TrueType").indexOf("Alarm")||-1!==k.data("TrueType").indexOf("All"))?(Q.table("add",e,-1),j.push(e)):ab.$("#pla_manual").prop("checked")&&-1!==e.Flags.indexOf("Manual")&&-1!==c.Flags.indexOf("Manual")&&g(e.Flags,c.Flags)&&(Q.table("add",e,-1),j.push(e))}),"jpg"!==i&&void 0===d&&R.timeslider("data",a.extend(!0,[],j),!0),f.found===hb?e():(F.MediaFileFind.close(xb),F.MediaFileFind.destroy(xb),xb=0),Z||($=d?a.extend(!0,[],jb):a.extend(!0,[],ib))}})}function f(a){function b(a,c){F.FileStream.positionMatch(a,f,c).done(function(e){e?f===e.info.length?(u(e),d||R.timeslider("data",ib),b(a,c)):(u(e),d||R.timeslider("data",ib),F.FileStream.destroy(c),X.find("#setPositionTip").tip("success",tl("com.OperateSuccessTip")),H.cover("#pla_videozone",function(){H.close(!0)}),setTimeout(function(){X.dialog("close")},1e3)):(F.FileStream.destroy(c),0!==ib.length?(X.find("#setPositionTip").tip("success",tl("com.OperateSuccessTip")),H.cover("#pla_videozone",function(){H.close(!0)}),setTimeout(function(){X.dialog("close")},1e3)):X.find("#setPositionTip").tip("error",tl("com.TheTimePeriodHasNoRecordFile")))}).fail(function(){F.FileStream.destroy(c),0===ib.length&&X.find("#setPositionTip").tip("error",tl("per.SearchFail"))})}var c,e=X.find("[name=pla_srch_name][searchMode=preset]").prop("checked"),f=parseInt(10),g=e?"point":"range";e?F.PtzFunc.setFileMatchPosition(fb,g).done(function(d){d.result&&F.FileStream.create(a).done(function(a){a.result?(c=a.result,X.find("#setPositionTip").tip("warning",tl("com.SearchingTip"),-1),b(g,c)):X.find("#setPositionTip").tip("error",tl("per.SearchFail"))})}).fail(function(){X.find("#setPositionTip").tip("error",tl("per.SetPositionFail"))}):F.FileStream.create(a).done(function(a){a.result?(c=a.result,X.find("#setPositionTip").tip("warning",tl("com.SearchingTip"),-1),b(g,c)):X.find("#setPositionTip").tip("error",tl("per.SetPositionFail"))}).fail(function(){X.find("#setPositionTip").tip("error",tl("per.SetPositionFail"))}),Z=!1}function g(a,b){if(void 0===b)return!0;for(var c=0;c<b.length;c++)if(-1!==a.indexOf(b[c]))return!0;return!1}var h,i=T.val(),j=a.extend(!0,{Channel:fb,Dirs:[ab.$("#pla_dataSrc").val()],Types:[i],Order:"Ascent",Redundant:"Exclusion",Events:null},c),k=a.extend(!0,{Channel:fb,Types:[i],streamType:"All",RecordType:"All"},c);if(d?(jb.length=0,d.table("option","currentPage",1),d.table("dataSource",jb)):(ib.length=0,Q.table("option","currentPage",1),Q.table("dataSource",ib),R.timeslider("data",ib),P.attr("src","/image/black.png")),"jpg"===i?p():n(),Z)Z&&f(k);else{if(0!==xb&&(F.MediaFileFind.close(xb),F.MediaFileFind.destroy(xb),xb=0),void 0===c)return;F.MediaFileFind.create().done(function(a){xb=h=a,F.MediaFileFind.findFile(h,j).done(function(){ab.$(".plaback-SDEncrypt-conflict").hide(),xb===h&&e()}).fail(function(a){a.error&&285409409===a.error.code?ab.$(".plaback-SDEncrypt-conflict").show():ab.$(".plaback-SDEncrypt-conflict").hide()})})}}function u(b){a.each(b.info,function(b,c){for(var d=v(c.StartTime),e=0;e<$.length;e++)if(d>=v($[e].StartTime)&&d<v($[e].EndTime)){var f={};f.startTime=c.StartTime,f.endTime=c.EndTime;var g=a.extend(!1,$[e],f);return void Q.table("add",g,-1)}})}function v(a){for(var b=a.split(" ")[1].split(":"),c="",d=0;d<b.length;d++)c+=b[d];return c}function w(){var a=Math.max(document.documentElement.clientWidth-30-15-210,750),b=Math.max(document.documentElement.clientHeight-56-52-121,390),c={width:a,height:b},d=webApp.resolution.rate;if(_.hasFishEye?H.SetShowMode(1):b>a/d?(c.width=a,c.height=a/d):(c.width=b*d,c.height=b),c.height<390&&(c.height=390,H.SetShowMode(1)),P.css(c),"h5"===webApp.playMode){var e={width:a,height:b},f={left:"50%",top:"50%","margin-left":0-c.width/2,"margin-top":0-c.height/2};O.css(e),P.css(f)}else O.css(c);return"jpg"===T.val()||webApp.hide_by_dialog||("hls"===webApp.playMode?K.cover(O):"flash"===webApp.playMode?L.cover(O):"h5"===webApp.playMode?M.cover(O):H.cover(O)),ab.$(".playback-right-container").height(c.height),-1!==webApp.DeviceType.indexOf("TPC")&&W.table("setHeight",Math.min(370,c.height-215)),Q.table("setHeight",Math.min(370,c.height-215)),!1}function x(b){H.hide(),webApp.hide_by_dialog=!0,a.alert(b,function(){0===a(".u-dialog:visible").length?(webApp.hide_by_dialog=!1,"jpg"!==T.val()&&("hls"===webApp.playMode?K.cover(O):"flash"===webApp.playMode?L.cover(O):"h5"===webApp.playMode?M.cover(O):H.cover(O))):a(".u-dialog:visible").dialog("show")})}function y(b,c){H.hide(),webApp.hide_by_dialog=!0,a.confirm(tl("com.Ok"),b,function(){a.isFunction(c)&&c(),webApp.hide_by_dialog=!1,"jpg"!==T.val()&&("hls"===webApp.playMode?K.cover(O):"flash"===webApp.playMode?L.cover(O):"h5"===webApp.playMode?M.cover(O):H.cover(O))},function(){webApp.hide_by_dialog=!1,"jpg"!==T.val()&&("hls"===webApp.playMode?K.cover(O):"flash"===webApp.playMode?L.cover(O):"h5"===webApp.playMode?M.cover(O):H.cover(O))})}function z(){var a;H.addEvent("LocalFileList",function(b){if(a=b,gb=[],a){a=a=JSON.parse(a).RecordFileList;for(var c=0;c<a.length;c++)gb.push({localfile:a[c]});W.table("dataSource",gb)}}),H.GetLocalRecordFileList(0).done(function(){})}function A(a){H.state("partialEnlarged")&&H.state("partialEnlarged",!1);for(var b=[],c=a.localfile.split(".")[0].split(""),d=c.getLast(),e=c.erase(d).join(""),f=0;f<gb.length;f++)-1!==gb[f].localfile.split(".")[0].indexOf(e)&&b.push(gb[f].localfile);b.length>1?H.SetVisibleVideoWnd(2,0):H.SetVisibleVideoWnd(1,0);var g={RecordFileList:b};H.PlaybackByFile(JSON.stringify(g),eb,fb,null,"local").done(function(b){b?(ab.$('[btn-for="onSwitchSound"]').hasClass("play-bottom-iconbg-disabled")||H.PlayOpenSound(eb),h(1),W.find("tbody tr[data-index="+a._index+"]").removeClass("error")):(W.find("tbody tr[data-index="+a._index+"]").addClass("error"),setTimeout(function(){W.table("selectRow",(W.table("getSelectedRow")+1)%gb.length)},1e3))})}function B(a){var b=qb[a];F.EventManager.attach(b.events).done(function(a){b.sid=a})}function C(a){var b=qb[a];F.EventManager.detach(b.sid,b.events)}function D(a){return rb?void(rb=!1):void(a.SID===qb.StorageNotExist.sid&&(T.change(),S.calendar("select")))}function E(){I.devNotify.reconnect(),B("StorageNotExist")}var F=require("jsCore/rpc"),G=require("jsCore/ability"),H=require("jsCore/plugin"),I=require("common/common"),J=require("jsCore/rpcLogin"),K=require("jsCore/hlsplayer"),L=require("jsCore/flashplayer"),M=require("jsCore/h5player"),N=require("jsCore/pageBase");require("widget/js/dui.timeslider"),require("widget/js/dui.slider"),require("widget/js/dui.calendar"),require("jsCore/modules/ptzSetControl");var O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_=require("fisheye"),ab=null,bb=".playback",cb=null,db=null,eb=0,fb=0,gb=[],hb=13,ib=[],jb=[],kb=!1,lb=null,mb=null,nb=[],ob=!1,pb=null,qb={StorageNotExist:{events:["StorageNotExist"],sid:-1}},rb=!0,sb=!1,tb=0;f.exports=N.extend({init:function(){if(ab=this,pb={HumanTrait:"ivs.PeopleDetect",TumbleDetection:"StereoFallDetection",StayDetection:"StereoManStayDetection",FightDetection:"StereoFightDetection",DistanceDetection:"StereoApproachDetection",ManNumDetection:"appEventManNumDetection",TailDetection:"StereoTailDetection"},cb=a.Deferred(function(a){F.Storage.getCaps().done(function(b){b.SupportEventCaps?(ob=!0,a.resolve(b.SupportEventCaps)):G.get("QueryDatabase").done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)})}).fail(function(b){a.reject(b)})}).promise(),O=ab.$("#pla_video"),T=ab.$("[sel-for=onChangeType]"),U=ab.$("[sel-for=onChangeSrc]"),V=ab.$("#pb_fileChannel"),P=ab.$("#pla_pic").on("click",function(a){if("/image/black.png"===P.attr("src"))return!1;var b=ab.$(a.target),c=b.width(),d=b.offset().left,e=a.pageX,f=Q.table("getSelectedRow");f=c/2>e-d?--f<0?f+ib.length:f:++f%ib.length,Q.table("selectRow",f)}),-1!==webApp.DeviceType.indexOf("TPC")){ab.$(".not-tpc").remove(),ab.$("[sel-for=onChangeChannel]").parent().remove(),U.append('<option value="local" t="com.Local"></option>').translation();var e=J.chkAuthority("Replay_01"),f=J.chkAuthority("Replay_02");webApp.CHANNEL_NUMBER>1?(V.removeClass("fn-hide"),V.find("input").show(),e&&f||(e&&!f||!e&&f&&(fb=1),V.find("input[value="+~~!fb+"]").next().hide(),V.find("input[value="+~~!fb+"]").hide())):1===webApp.CHANNEL_NUMBER&&V.remove()}else if(webApp.CHANNEL_NUMBER>1){var g=ab.$("[sel-for=onChangeChannel]"),h="";g.parent().removeClass("fn-hide");for(var k=0;k<webApp.CHANNEL_NUMBER;k++)h+=J.chkAuthority("Replay_0"+(k+1))?"<option value="+k+">"+(k+1)+"</option>":"";g.empty().append(h)}else ab.$("[sel-for=onChangeChannel]").parent().remove();for(var o=0;o<webApp.CHANNEL_NUMBER;o++)d[d.length]=o;webApp.AUDIO_IN_NUMBER>0&&(ab.$(".playback-sound-slider,[btn-for=onSwitchSound]").removeClass("fn-hide"),ab.$(".playback-sound-slider").slider({min:0,max:100,value:50,snap:!1,prompt:!1,icons:!1,change:function(a,b){"h5"===webApp.playMode?M.setAudioVolume(b.value/100):H.PlaySetVolume(eb,b.value-100)}})),G.is("DSPConflict").done(function(a){a||!webApp.IsIPCIntel&&!webApp.IsSDIntel||ab.$("[btn-for=onIVS]").show()}),G.get("IPCRecordBatchDownload").done(function(a){a&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode||(ab.$("[btn-for=onShowBatch]").remove(),ab.$("[btn-for=onToRecord],[btn-for=onToCalendar]").removeClass("fn-width90"))}),R=ab.$("#pla_timeslider").timeslider({typeKey:b,typeColors:c,channels:d,complete:function(b,c,d){-1===d?n():(R.data("time",a.pad(b.getHours(),2)+":"+a.pad(b.getMinutes(),2)+":"+a.pad(b.getSeconds(),2)),Q.table("selectRow",d),R.data("time",null))}}),Q=ab.$("#pla_records").table({height:200,pageSize:hb,pageable:!0,columns:[{width:"18%",render:function(a){return a._index+1}},{t:"sys.StartTime",width:"28%",render:function(a){return a.startTime?a.startTime.split(" ")[1]:a.StartTime.split(" ")[1]}},{t:"sto.FileType",width:"25%",render:function(a){return'<i class="type-color" style="background-color:'+c[a[b]]+'"></i>'}},{width:"10%",action:"download",render:function(b){return a.isNumeric(b.Process)?'<a data-action="download" class="i-stopdown"></a>':'<a data-action="download" class="i-download"></a>'},handle:function(b,c){var d=a(c.target),e=d.hasClass("i-stopdown");if(c.stopPropagation(),!J.chkAuthority("Backup"))return x(tl("com.NoRightTip"));if("jpg"===T.val())d.attr({target:"_download",href:"/RPC_Loadfile"+b.FilePath});else if("flash"==webApp.playMode||"h5"===webApp.playMode)d.attr({target:"_download",href:"/RPC_Loadfile"+b.FilePath});else if(e)j();else{if(-2===tb)return x(tl("com.AnotherRecordDownloadingTip"));if(0!==tb)return x(tl("com.PlayAndLoadNotTogetherTip"));i(b)}}},{width:"19%",render:function(b){return a.isNumeric(b.Process)?b.Process+"%":""}}],onRowSelect:function(a,b){if("jpg"===b.data.Type)q(b.data);else if("hls"===webApp.playMode){var c="";c=c+K.protocol+"//"+K.ip+":"+K.playbackport+"/vod/"+F.getSession(),c=c+b.data.FilePath+".m3u8",c=c+"?sessionId="+F.getSession(),K.stopLoad(),K.init("playback","",F.getSession()),K.beginPlay(c,ab.$(this).find("tr.current"))}else"flash"===webApp.playMode?L.playback(b.data.FilePath):"h5"===webApp.playMode?(M.hide(),ab.$('[btn-for="onPlay"]').addClass("pause"),ab.$('[btn-for="onPlay"]').removeClass("play-bottom-bigicon-current"),M.playback(b.data,O,ab._setPlayButtonClassStop,ab.setPlayStatusForH5Player),ab.$('[btn-for="onSwitchSound"]').hasClass("play-bottom-iconbg-disabled")?M.setAudioVolume(0,!0):M.setAudioVolume(ab.$(".playback-sound-slider").slider("value")/100,!0)):m(b.data,R.data("time"))},onRowEnter:function(a,b){I.Cookie.set("DhWebClientSessionID",F.getSession()),b.data.startTime&&b.data.endTime?(ab.$("#pla_detail_begin").text(b.data.startTime),ab.$("#pla_detail_end").text(b.data.endTime),ab.$("#pla_detail_size").text((b.data.Length/1024).round()+"(KB)")):(ab.$("#pla_detail_begin").text(b.data.StartTime),ab.$("#pla_detail_end").text(b.data.EndTime),ab.$("#pla_detail_size").text((b.data.Length/1024).round()+"(KB)"))}}).on("mouseleave",function(){var a=Q.table("getSelectedRow");-1!==a?ib[a].startTime&&ib[a].endTime?(ab.$("#pla_detail_begin").text(ib[a].startTime),ab.$("#pla_detail_end").text(ib[a].endTime),ab.$("#pla_detail_size").text((ib[a].Length/1024).round()+"(KB)")):(ab.$("#pla_detail_begin").text(ib[a].StartTime),ab.$("#pla_detail_end").text(ib[a].EndTime),ab.$("#pla_detail_size").text((ib[a].Length/1024).round()+"(KB)")):(ab.$("#pla_detail_begin").text(""),ab.$("#pla_detail_end").text(""),ab.$("#pla_detail_size").text(""))}),Q.table("widget").children(":first").off("click","tbody tr").on("dblclick","tbody tr",function(b){return"download"!==ab.$(b.target).attr("data-action")&&Q.table("selectRow",a(b.currentTarget).attr("data-index")-0),!1}),W=ab.$("#pla_localfiles").table({pageSize:hb,pageable:!0,columns:[{width:"8%",render:function(a){return a._index+1}},{t:"com.FileName",width:"92%",render:function(a){return'<span class="playback-localfile" id="li_localfile'+a._index+'">'+a.localfile+"</span>"}}],onRowSelect:function(a,b){A(b.data)}}),W.off("click","tbody tr").on("click","tbody tr",function(b){return eb=a(b.currentTarget).attr("data-index")-0,W.find("tbody tr").removeClass("error"),W.find("tbody tr[data-index="+eb+"]").addClass("error"),!1}),W.table("widget").children(":first").off("click","tbody tr").on("dblclick","tbody tr",function(b){return W.table("selectRow",a(b.currentTarget).attr("data-index")-0),!1}),ab.$("#pla_begin").timefield().timefield("value","00:00:00").find("input").on("blur",function(a){2===ab.$(a.target).data("index")&&ab.$("#pla_end").find("input:eq(0)").select();var b=ab.$("#pla_begin").timefield("value").split(":"),c=ab.$("#pla_end").timefield("value").split(":");3600*b[0]+60*b[1]+1*b[2]>3600*c[0]+60*c[1]+1*c[2]&&ab.$("#pla_end").timefield("value",b.join(":"))}),ab.$("#pla_end").timefield().timefield("value","23:59:59").find("input").on("blur",function(){var a=ab.$("#pla_begin").timefield("value").split(":"),b=ab.$("#pla_end").timefield("value").split(":");3600*a[0]+60*a[1]+1*a[2]>3600*b[0]+60*b[1]+1*b[2]&&ab.$("#pla_begin").timefield("value",b.join(":"))}),S=ab.$("#pla_calendar").calendar({maxYear:2037,minYear:2e3,change:function(){S&&T.change()},select:function(b,c,d){var e=c.year+"-"+a.pad(c.month,2)+"-"+a.pad(c.day,2)+" ",f=ab.$("#pla_recordtype .ui-custom-select-item-current");if(f.length){var g={StartTime:e+ab.$("#pla_begin").timefield("value"),EndTime:e+ab.$("#pla_end").timefield("value"),Events:f.data("Events")},h={StartTime:e+ab.$("#pla_begin").timefield("value"),EndTime:e+ab.$("#pla_end").timefield("value")};g.Flags=f.data("Flags"),g=d?h:g,t(g)}else t()}}),ab.$("#pla_recordtype").on("click",".ui-custom-select-input",function(b){if(kb)return!1;var c=ab.$(b.currentTarget).toggleClass("ui-custom-select-input-current");return c.hasClass("ui-custom-select-input-current")?(a(document).on("click"+bb,function(){a(document).off("click"+bb),c.toggleClass("ui-custom-select-input-current"),c.next().hide()}),c.next().show()):(a(document).off("click"+bb),c.next().hide()),!1}),ab.$("#pla_recordtype").on("click",".ui-custom-select-item",function(a){var b=ab.$(a.currentTarget);return b.addClass("ui-custom-select-item-current").siblings().removeClass("ui-custom-select-item-current"),b.parent().hide().prev().removeClass("ui-custom-select-input-current").find(".ui-custom-select-inputbox").text(b.text()),j(),S.calendar("select"),!1}),ab.$("#pla_all,#pla_typechks :checkbox").prop("checked",!0),G.get("RecordCaps").done(function(b){if(b&&a.isArray(b.Format)&&(T.empty(),a.each(b.Format,function(a,b){T.append('<option value="'+b+'" t="'+b+'"></option>')}),T.append('<option value="jpg" t="jpg"></option>')),b&&b.SupportPositionPalyBack){var c=J.chkAuthority("Replay_01"),d=J.chkAuthority("AuthManuCtr");c&&d&&(Y=!0,Q.find('[data-col="3"]').append('<a class="playback-buttonSD" btn-for="onSearchSD" data-rel="#pla_recordSD" t="title::itc.SearchPosition"><i class="playback-button-icon-searchSD"></i></a>'),Q.find('[data-col="3"] [btn-for=onSearchSD]').parent().translation(),Q.find('[data-col="3"] [btn-for=onSearchSD]').on("click",function(){return-2===tb?(Q.table("selectRow",-1),x(tl("per.NotSearchRecTip"))):void ab.onSearchSD()}),X=ab.$("#pla_recordSD").dialog({confirm:function(){webApp.hide_by_dialog=!1,H.cover(O,function(){H.close(!0),H.SetModuleMode(1),a.browser.ie8&&ab.$("[btn-for=onToRecord]").focus()})},searchPlay:function(){Z=!0,S.calendar("select")},close:function(){webApp.hide_by_dialog=!1,a(window).off("resize.playback"),H.cover(O,function(){H.close(!0),H.SetModuleMode(1),a.browser.ie8&&ab.$("[btn-for=onToRecord]").focus()})}}).detach().appendTo(document.body),X.dialog("setPosition",[310,615]))}else ab.$("#pla_recordSD").remove();T.translation()}),ab.$(".playback-cut").on("mouseover","[btn-for=onCutRegion]",function(a){var b=ab.$(a.target);return"general"!==H.type?void ab.disabled(a.target):(ab.disabled(a.target,!1),0===tb||-2===tb?b.attr("title",""):void(b.hasClass("playback-cut-begin-time")?b.addClass("playback-cut-begin-time-hover").attr("title",tl("ivs.SelectStartTime")):b.addClass("playback-cut-end-time-hover").attr("title",tl("ivs.SelectEndTime"))))}),ab.$(".playback-cut").on("mouseout","[btn-for=onCutRegion]",function(a){ab.$(a.target).removeClass("playback-cut-begin-time-hover").removeClass("playback-cut-end-time-hover")}),ab.$("#pla_cut_time span:eq(0),#pla_cut_time span:eq(2)").text("00:00:00"),ab.$("#pla_cut_time").show(),ab.$("#pla_cut_status").hide(),ab.$("#pla_percent").width(0),ab.$(".playback-cut").on("mouseover","[btn-for=onCut]",function(a){var b=ab.$(a.target);return"general"!==H.type?void ab.disabled(a.target):(ab.disabled(a.target,!1),void(b.hasClass("playback-cut-download-cancel")?b.attr("title",tl("com.Cancel")):b.attr("title",tl("sto.Download"))))}),ab.$("[btn-for=onCut]").removeClass("playback-cut-download-cancel"),ab.$("#pb_fileChannel input").on("click",function(b){fb=~~a(b.target).val(),S.calendar("clearmark");var c=S.calendar("getDay");r({Year:c.year,Month:c.month}),S.calendar("select")}),G.get("VideoInputCaps").done(function(a){a&&a.FishEye&&_.bind(ab)}),lb=ab.$("#pla_batchDownload_dialog").dialog({close:function(){0!==xb&&(F.MediaFileFind.close(xb),F.MediaFileFind.destroy(xb),xb=0),$bd_file_table.table("dataSource",[]),lb.find("#batch_file_size").text(""),webApp.hide_by_dialog=!1,l(),"jpg"!==T.val()&&H.cover(O,function(){H.close(!0),H.SetModuleMode(1),a.browser.ie8&&ab.$("[btn-for=onToRecord]").focus()}),ab.appEventStorageLowSpaceAlert&&(ab.appEventStorageLowSpaceAlert.close(),ab.appEventStorageLowSpaceAlert=null)},stopBubble:!1}).detach().appendTo(document.body),$bd_st_date=lb.find("#bd_st_date").datepicker({change:function(a,b){if(b.value>$bd_en_date.datepicker("value")){var c=$bd_st_time.timefield("value");$bd_en_time.timefield("value",c).timefield("beginTime",c)}$bd_en_date.datepicker("minDate",b.value)}}),$bd_en_date=lb.find("#bd_en_date").datepicker({change:function(a,b){var c=$bd_en_time.timefield("value"),d=$bd_st_date.datepicker("value").replace(/-/g,"/")+"/"+$bd_st_time.timefield("value"),e=b.value.replace(/-/g,"/")+"/"+c;d>=e?($bd_en_time.timefield("beginTime",c),$bd_st_time.timefield("value",c)):$bd_en_time.timefield("beginTime","00:00:00")}}),$bd_st_time=lb.find("#bd_st_time").timefield({change:function(a,b){var c=$bd_st_date.datepicker("value").replace(/-/g,"/")+"/"+b.value,d=$bd_en_date.datepicker("value").replace(/-/g,"/")+"/"+$bd_en_time.timefield("value");c>=d?($bd_en_time.timefield("beginTime",b.value),$bd_en_time.timefield("value",b.value)):$bd_en_time.timefield("beginTime","00:00:00")}}),$bd_en_time=lb.find("#bd_en_time").timefield({change:function(a,b){var c=$bd_en_date.datepicker("value").replace(/-/g,"/")+"/"+b.value,d=$bd_st_date.datepicker("value").replace(/-/g,"/")+"/"+$bd_st_time.timefield("value");d>=c?($bd_st_time.timefield("beginTime",b.value),$bd_st_time.timefield("value",b.value)):$bd_st_time.timefield("beginTime","00:00:00")}}),$bd_file_table=lb.find("#batch_download_table").table({height:300,pageable:!0,selectSingle:!1,pageSize:13,columns:[{check:"Enable",width:"5%",checkItem:function(){for(var a=0,b=$bd_file_table.table("getMultiChecked","Enable"),c=0;c<b.length;c++)a=parseInt(b[c].Length)+a;lb.find("#batch_file_size").text((a/1024).toFixed(2)+"Kb")},checkAll:function(){for(var a=0,b=$bd_file_table.table("getMultiChecked","Enable"),c=0;c<b.length;c++)a=parseInt(b[c].Length)+a;lb.find("#batch_file_size").text((a/1024).toFixed(2)+"Kb")}},{t:"com.Number",width:"10%",render:function(a){return a._index+1}},{t:"med.FileSize+(Kb)",width:"15%",render:function(a){return(a.Length/1024).toFixed(2)}},{fields:"StartTime",t:"sys.BeginTime",width:"20%"},{fields:"EndTime",t:"com.EndTime",width:"20%"},{fields:"Type",t:"sto.FileType",width:"15%"},{fields:"Process",t:"com.DownloadProgress",width:"15%",render:function(a){return a.Process&&100==a.Process?tl("com.Accomplished"):"00"===a.Process?tl("sys.CloudUpgStateDownloadFailed"):"-1"===a.Process?tl("com.NoSupport"):a.Process?a.Process+"%":"--"}}]}),"h5"===webApp.playMode&&M.initControlsBar(O),ab.render()},render:function(){a(window).off("resize"+bb),a(window).on("resize"+bb,w),w(),H.state("recordVideo")&&H.state("recordVideo",!1),ab.$("#pla_begin").timefield("value","00:00:00"),ab.$("#pla_end").timefield("value","23:59:59"),V&&V.find("input[value="+fb+"]").prop("checked",!0),"hls"===webApp.playMode?(ab.$("div.main-top").addClass("play_hls_type"),ab.$(".playback-iconbar").hide(),ab.$("#pla_timeslider_container").hide(),ab.$("#pla_play_tip").hide(),ab.$("#playback-time-rate").hide(),ab.$('[btn-for="onEnlarge"]').hide(),ab.$('[btn-for="onSnap"]').hide(),K.init("playback","",F.getSession()),K.cover(O)):"flash"===webApp.playMode?(ab.$("div.main-top").addClass("play_hls_type"),ab.$(".playback-iconbar").hide(),ab.$("#pla_timeslider_container").hide(),ab.$("#pla_play_tip").hide(),ab.$("#playback-time-rate").hide(),ab.$('[btn-for="onEnlarge"]').hide(),ab.$('[btn-for="onSnap"]').hide(),L.destroy(),L.init(),L.cover(O)):"h5"===webApp.playMode?(ab.$("div.main-top").addClass("play_hls_type"),ab.$("#pla_timeslider_container").hide(),ab.$("#pla_play_tip").hide(),ab.$("#playback-time-rate").hide(),ab.$(".playback-sound-slider").show().nextAll().hide(),ab.$('[btn-for="onCutRegion"]').parent().hide(),ab.$('[btn-for="onEnlarge"]').hide(),ab.$('[btn-for="onSnap"]').hide(),ab.$('[btn-for="onNextFrame"]').hide(),ab.$('[btn-for="onFast"]').hide(),ab.$('[btn-for="onSlow"]').hide(),ab.$('[btn-for="onPlay"]').removeClass("pause").removeClass("play-bottom-bigicon-current"),M.mode="canvas",ab.$('[btn-for="onSwitchSound"]').hasClass("play-bottom-iconbg-disabled")?M.setAudioVolume(0,!0):M.setAudioVolume(ab.$(".playback-sound-slider").slider("value")/100,!0)):H.cover(O,function(){H.close(!0),H.SetModuleMode(3),-1!==webApp.DeviceType.indexOf("TPC")&&(H.SetVisibleVideoWnd(1,0),H.SetVideoWndTip(0,tl(""))),a.browser.ie8&&ab.$("[btn-for=onToRecord]").focus()}),db=F.Storage.getDeviceAllInfo().done(function(b){a.isArray(b)&&(b=a.grep(b,function(a){return!!a.Detail}),b.length>1?(U.empty(),a.each(b,function(a,b){b.Detail&&b.Detail[0]&&U.append("<option value="+b.Detail[0].Path+" t=w_sd+"+(a+1)+"></option>")}),U.append('<option value="All" t="com.All"></option>').translation()):1===b.length&&b[0].Detail&&b[0].Detail[0]&&b[0].Detail[0].Path&&U.empty().append("<option value="+b[0].Detail[0].Path+' t="sto.SDCard"></option>').translation()),rb=!1,sb=!0}).fail(function(){rb=!0,sb=!1}).always(function(){F.ConfigManager.getConfig("StorageNotExist").done(function(b){b&&b.Enable&&(I.devNotify.subscribe("client.notifyEventStream",D),B("StorageNotExist"),a.subscribe("RECONNECTION",E))}),-1!==webApp.DeviceType.indexOf("TPC")&&(sb&&U.append('<option value="local" t="com.Local"></option>').translation(),ab.onChangeSrc())}),a.when(db,G.get("RecordCaps")).always(function(){T.change(),"jpg"!==T.val()&&ab.$('[btn-for="onTimeMode"][data-for="24"]').click()}),"jpg"===T.val()&&(H.hide(),"hls"===webApp.playMode?K.hideAndStopLoad():"flash"===webApp.playMode?L.hide():"h5"===webApp.playMode&&M.hide()),"local"===U.val()&&ab.$(".not-jpg.not-forLocal").hide(),("qt"===H.type||"vlc"===H.type)&&a("#video").find("qt").hide(),H.addEvent("PlaybackRecordfileFailed",function(){var a=Q.table("getSelectedRow");
Q.find("tbody tr[data-index="+a+"]").addClass("error"),Q.table("selectRow",(a+1)%ib.length)}),H.addEvent("CurPlayTime",function(a){R.timeslider("value",a)}),H.addEvent("PlayBackOneFileEnd",function(){if("local"===U.val()){var a=W.table("getSelectedRow");W.find("tbody tr[data-index="+a+"]").removeClass("current"),H.cover(O,function(){H.close(!0),-1!==webApp.DeviceType.indexOf("TPC")&&H.SetVisibleVideoWnd(1,0)})}else Q.table("selectRow",(Q.table("getSelectedRow")+1)%ib.length)}),H.addEvent("ResolutionChangePlayBack",w),H.addEvent("FeInstallMode",function(a){_.playbackHasFe(a)}),H.addEvent("RecordDiskFullPlayback",function(){H.hide(),webApp.hide_by_dialog=!0,lb.find("[btn-for=onBatchDownload]").text(tl("com.StartDownload")),l(),ab.appEventStorageLowSpaceAlert=a.alert(tl("pfm.StorageLowSpace"),function(){0===a(".u-dialog:visible").length?H.cover(O):a(".u-dialog:visible").dialog("show"),tb=0})}),w(),_.hasFishEye&&H.addEvent("StateChangedPlayBack",function(){_.fitMode>0&&_.reBackFisheye()}),O.parent().disableSelection()},leave:function(){a(window).off("resize"+bb),("hls"===webApp.playMode||"flash"===webApp.playMode||"h5"===webApp.playMode)&&("hls"===webApp.playMode?K.hideAndStopLoad():"flash"===webApp.playMode?L.hide():"h5"===webApp.playMode&&M.hide(),ab.$("div.main-top").removeClass("play_hls_type"),ab.$(".playback-iconbar").show(),ab.$("#pla_timeslider_container").show(),ab.$("#pla_play_tip").show(),ab.$("#playback-time-rate").show(),ab.$('[btn-for="onEnlarge"]').show(),ab.$('[btn-for="onSnap"]').show()),"qt"===H.type||"vlc"===H.type?a("#video").find("qt").show():H.hide(),H.addEvent("PlaybackRecordfileFailed",null),H.addEvent("CurPlayTime",null),H.addEvent("PlayBackOneFileEnd",null),H.addEvent("ResolutionChangePlayBack",null),H.addEvent("FeInstallMode",null),H.addEvent("StateChangedPlayBack",null),H.addEvent("LocalFileList",null),H.addEvent("RecordDiskFullPlayback",null),a("[btn-for=onIVS]").hasClass("play-bottom-iconbg-current")&&(a("[btn-for=onIVS]").removeClass("play-bottom-iconbg-current"),H.SetIVSEnable(!1)),p(),n(),j(),_.fitMode>0&&(_.closeFisheEye(),ab.$("#onFishEye").show()),"hls"===webApp.playMode?K.hideAndStopLoad():"flash"===webApp.playMode?L.hide():"h5"===webApp.playMode&&M.hide(),0!==xb&&(F.MediaFileFind.close(xb),F.MediaFileFind.destroy(xb),xb=0),fb=0;var b=I.devNotify.topics["client.notifyEventStream"];b&&b.some(function(a){return a===D})&&(C("StorageNotExist"),I.devNotify.detach("client.notifyEventStream",D),a.unsubscribe("RECONNECTION",E))},destory:function(){a(window).off("resize"+bb),p(),n(),j(),"hls"===webApp.playMode?K.hideAndStopLoad():"flash"===webApp.playMode?L.destroy():"h5"===webApp.playMode&&M.destroy(),-2===tb&&(H.StopDownload(ab.$("[btn-for=onCut]").data("savename")),tb=0),d=[],R.timeslider("destroy"),S=null},onToRecord:function(){S.calendar("select"),ab.$("#pla_page1").hide(),ab.$("#pla_page2").show(),Q.table("setHeight",Math.min(370,ab.$(".playback-right-container").height()-215)),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(ab.$('[btn-for="onSearchSD"]').hide(),ab.$("#pla_formatdav").prop("checked",!0),ab.$("#pla_formatmp4").prop("disabled",!0).hide(),ab.$("[for=pla_formatmp4]").hide())},onShowBatch:function(){lb.dialog("show"),H.hide(),H.close(),"jpg"===T.val()?p():n(),H.GetConfigPath("PlaybackRecord").done(function(a){lb.find("#batch_down_path").val(a)}),lb.find("#batch_download_type").val("All").change(),webApp.hide_by_dialog=!0,F.ConfigManager.getConfig("Locales").done(function(a){switch(a.TimeFormat.split(" ")[0]){case"MM-dd-yyyy":$bd_st_date.datepicker("format","mm-dd-yyyy"),$bd_en_date.datepicker("format","mm-dd-yyyy");break;case"dd-MM-yyyy":$bd_st_date.datepicker("format","dd-mm-yyyy"),$bd_en_date.datepicker("format","dd-mm-yyyy");break;default:$bd_st_date.datepicker("format","yyyy-mm-dd"),$bd_en_date.datepicker("format","yyyy-mm-dd")}switch(a.TimeFormat.split(" ")[1]){case"HH:mm:ss":$bd_st_time.timefield("format","24"),$bd_en_time.timefield("format","24");break;default:$bd_st_time.timefield("format","12"),$bd_en_time.timefield("format","12")}var b=S.calendar("getDay"),c=new Date(b.year,b.month-1,b.day);$bd_st_date.datepicker("value",c),$bd_st_time.timefield("value","00:00:00"),$bd_en_date.datepicker("value",c).datepicker("minDate",c.format()),$bd_en_time.timefield("value","23:59:59")})},onChoosePath:function(){H.ShowFileBrowse().done(function(a){lb.find("#batch_down_path").val(a)})},onBatchTypeChange:function(b){var c=a(b.target),d=lb.find("#batch_down_path").val();0!==xb&&(F.MediaFileFind.close(xb),F.MediaFileFind.destroy(xb),xb=0),l(),$bd_file_table.table("dataSource",[]),lb.find("#batch_file_size").text("0Kb"),a.when(H.GetConfigPath("PlaybackRecord"),H.GetConfigPath("PlaybackSnapshot")).done(function(a,b){"Picture"===c.val()?(lb.find("#batch_media_type").empty(),lb.find("#batch_media_type").append('<option value="jpg" t="com.Jpg" selected>jpg</option>'),d===a&&lb.find("#batch_down_path").val(b)):(lb.find("#batch_media_type").empty(),lb.find("#batch_media_type").append('<option value="dav" t="com.Dav" selected>dav</option><option value="mp4" t="mp4">mp4</option>'),d===b&&lb.find("#batch_down_path").val(a))})},onBatchSearch:function(){var a=lb.find("#batch_download_type").val(),b=$bd_st_date.datepicker("value")+" ",c=$bd_st_time.timefield("value"),d=$bd_en_date.datepicker("value")+" ",e=$bd_en_time.timefield("value"),f={StartTime:b+c,EndTime:d+e,Types:["dav"],Flags:[""],Events:null};switch(a){case"All":f.Types=["dav"],f.Flags=["Timing","Event","Event","Manual"];break;case"Timing":f.Types=["dav"],f.Flags=["Timing"];break;case"Event":f.Types=["dav"],f.Flags=["Event"];break;case"Alarm":f.Types=["dav"],f.Flags=["Event"];break;case"Manual":f.Types=["dav"],f.Flags=["Manual"];break;case"Picture":f.Types=["jpg"],f.Flags=["Timing","Event","Event"]}t(f,$bd_file_table)},onBatchDownload:function(){mb?(lb.find("[btn-for=onBatchDownload]").text(tl("com.StartDownload")),l()):(nb=$bd_file_table.table("getMultiChecked","Enable"),mb=nb.shift(),mb&&(k(mb),lb.find("[btn-for=onBatchDownload]").text(tl("com.StopDownload"))))},onToCalendar:function(){ab.$("#pla_page2").hide(),ab.$("#pla_page1").show(),j()},onTimeMode:function(a){var b=ab.$(a.currentTarget),c=60*b.attr("data-for");b.addClass("ui-button-current").siblings().removeClass("ui-button-current"),R.timeslider("total",c)},onSwitchSound:function(a){var b="play-bottom-iconbg-disabled",c=ab.$(a.currentTarget);"h5"===webApp.playMode?c.hasClass(b)?(M.setAudioVolume(ab.$(".playback-sound-slider").slider("value")/100,!0),c.removeClass(b).attr("t","title::med.Sound").parent().translation(),ab.$(".playback-sound-slider").slider("enable")):(M.setAudioVolume(0,!0),c.addClass(b).attr("t","title::med.Quite").parent().translation(),ab.$(".playback-sound-slider").slider("disable")):c.hasClass(b)?H.PlayOpenSound(eb).done(function(){c.removeClass(b).attr("t","title::med.Sound").parent().translation(),ab.$(".playback-sound-slider").slider("enable")}):H.PlayStopSound(eb).done(function(){c.addClass(b).attr("t","title::med.Quite").parent().translation(),ab.$(".playback-sound-slider").slider("disable")})},onSearch:function(){S.calendar("select")},onChangeSrc:function(){"local"===U.val()?(ab.$("#playBack_filelist").show(),ab.$(".not-forLocal").hide(),T.prop("disabled",!0),V.addClass("fn-hide"),z()):(ab.$("#playBack_filelist").hide(),ab.$(".not-forLocal").show(),T.prop("disabled",!1),T.change(),-1!==webApp.DeviceType.indexOf("TPC")&&V.removeClass("fn-hide")),n()},onChangeChannel:function(b){fb=~~a(b.target).val(),S.calendar("select")},onChangeType:function(b){0!==xb&&(F.MediaFileFind.close(xb),F.MediaFileFind.destroy(xb),xb=0);var c=ab.$(b.target).val();ab.$("#pla_type_tip").attr("t","jpg"===c?"med.SnapType":"med.VideoType").parent().translation(),"jpg"===c?(Y&&Q.find('[data-col="3"] [btn-for=onSearchSD]').addClass("fn-hide"),ab.$(".not-jpg").hide(),ab.$("#pla_type_tip").addClass("fn-padl100"),ab.$("#pla_format").hide(),-1!==webApp.DeviceType.indexOf("TPC")&&U.prop("disabled",!0),P.show(),H.hide(),n(),"hls"===webApp.playMode?K.hideAndStopLoad():"flash"===webApp.playMode?(L.hide(),ab.$("#pla_type_tip").removeClass("fn-padl100")):"h5"===webApp.playMode&&(M.hide(),ab.$("#pla_type_tip").removeClass("fn-padl100"))):(Y&&Q.find('[data-col="3"] [btn-for=onSearchSD]').removeClass("fn-hide"),ab.$(".not-jpg").show(),b.isTrigger||ab.$("#pla_timeslider").show("fast",function(){R.timeslider("total",60*ab.$(".ui-button-current[btn-for=onTimeMode]").attr("data-for"))}),("hls"===webApp.playMode||"flash"===webApp.playMode||"h5"===webApp.playMode)&&("h5"===webApp.playMode?(ab.$("div.main-top").addClass("play_hls_type"),ab.$("#pla_timeslider_container").hide(),ab.$("#pla_play_tip").hide(),ab.$("#playback-time-rate").hide(),ab.$(".playback-sound-slider").show().nextAll().hide(),ab.$('[btn-for="onCutRegion"]').parent().hide(),ab.$('[btn-for="onEnlarge"]').hide(),ab.$('[btn-for="onSnap"]').hide(),ab.$('[btn-for="onNextFrame"]').hide(),ab.$('[btn-for="onFast"]').hide(),ab.$('[btn-for="onSlow"]').hide(),ab.$('[btn-for="onPlay"]').removeClass("pause").removeClass("play-bottom-bigicon-current")):(ab.$(".playback-iconbar").hide(),ab.$("#pla_timeslider_container").hide(),ab.$("#pla_play_tip").hide(),ab.$("#playback-time-rate").hide(),ab.$('[btn-for="onEnlarge"]').hide(),ab.$('[btn-for="onSnap"]').hide())),U.prop("disabled",!1),G.get("RecordCaps").done(function(b){b&&-1!==a.inArray("mp4",b.Format)?ab.$("#pla_format").hide():ab.$("#pla_format").show()}),P.hide(),"hls"===webApp.playMode?K.cover(O):"flash"===webApp.playMode?L.cover(O):"h5"===webApp.playMode||(ab.$("#pla_type_tip").removeClass("fn-padl100"),H.cover(O,function(){H.SetModuleMode(3),a.browser.ie8&&ab.$("[btn-for=onToRecord]").focus()})),p()),S.calendar("clearmark");var d=S.calendar("getDay");r({Year:d.year,Month:d.month}),ab.$("#pla_all").prop("checked",ab.$("#pla_typechks :checkbox:checked:visible").length===ab.$("#pla_typechks :checkbox:visible").length),cb.done(s)},onPlay:function(a){var b=ab.$(a.currentTarget),c=T.val(),d=b.hasClass("pause");if("jpg"===c&&ib.length)d?p():o();else if("h5"===webApp.playMode){if(-1===Q.table("getSelectedRow"))return;var e;d?(e=M.pause(),b.removeClass("pause").attr("title",tl("com.Play"))):(e=M.play(),b.addClass("pause").attr("title",tl("Pause")))}else 1===tb?H.PausePlayBack(eb).done(function(a){a&&h(-1)}):0!==tb&&-2!==tb?H.ResumePlayBack(eb).done(function(a){a&&h(1)}):"local"===U.val()?W.table("selectRow",eb):Q.table("selectRow",-1===Q.table("getSelectedRow")?0:Q.table("getSelectedRow"))},setPlayStatusForH5Player:function(){-1!==Q.table("getSelectedRow")&&ab.$('[btn-for="onPlay"]').addClass("pause")},_setPlayButtonClassStop:function(){ab.$('[btn-for="onPlay"]').removeClass("pause").removeClass("play-bottom-bigicon-current"),Q.table("selectRow",-1)},onStop:function(){"h5"===webApp.playMode?(ab.$('[btn-for="onPlay"]').removeClass("pause").removeClass("play-bottom-bigicon-current"),M.hide(),Q.table("selectRow",-1)):n()},onNextFrame:function(){H.PlayPreFrame(eb).done(function(a){a&&h(-1)})},onSlow:function(){tb===1/16?H.ResumePlayBack(eb).done(function(a){a&&h(1)}):H.SlowPlayBack(eb).done(function(a){a&&h(tb/2)})},onFast:function(){"h5"===webApp.playMode?ab.$('[btn-for="onFast"]').hasClass("play-bottom-bigicon-current")?(M.playFF(1),ab.$('[btn-for="onFast"]').removeClass("play-bottom-bigicon-current")):(M.playFF(2),ab.$('[btn-for="onFast"]').addClass("play-bottom-bigicon-current")):16===tb?H.ResumePlayBack(eb).done(function(a){a&&h(1)}):H.FastPlayBack(eb).done(function(a){a&&h(2*tb)})},onTypeAll:function(a){ab.$("#pla_typechks :checkbox").prop("checked",ab.$(a.target).prop("checked")),ab._filterFile()},onTypeNormal:function(){ab.$("#pla_all").prop("checked",ab.$("#pla_typechks :checkbox:checked:visible").length===ab.$("#pla_typechks :checkbox:visible").length),ab._filterFile()},onTypeEvent:function(){ab.$("#pla_all").prop("checked",ab.$("#pla_typechks :checkbox:checked:visible").length===ab.$("#pla_typechks :checkbox:visible").length),ab._filterFile()},onTypeAlarm:function(){ab.$("#pla_all").prop("checked",ab.$("#pla_typechks :checkbox:checked:visible").length===ab.$("#pla_typechks :checkbox:visible").length),ab._filterFile()},onTypeManual:function(){ab.$("#pla_all").prop("checked",ab.$("#pla_typechks :checkbox:checked:visible").length===ab.$("#pla_typechks :checkbox:visible").length),ab._filterFile()},_filterFile:function(){cb.done(s)},onCutRegion:function(b){var c=ab.$(b.target),d=ab.$("#pla_cut_time span").eq(0),e=ab.$("#pla_cut_time span").eq(2),f=d.text(),g=e.text(),h=R.timeslider("value")[fb],i=a.pad(h.getHours(),2)+":"+a.pad(h.getMinutes(),2)+":"+a.pad(h.getSeconds(),2);ab.$("#pla_cut_time").show(),ab.$("#pla_cut_status").hide(),ab.$("#pla_percent").width(0),c.hasClass("playback-cut-begin-time")?(c.removeClass("playback-cut-begin-time playback-cut-begin-time-hover").addClass("playback-cut-end-time playback-cut-end-time-hover").attr("title",tl("ivs.SelectEndTime")),f=i):(c.removeClass("playback-cut-end-time playback-cut-end-time-hover").addClass("playback-cut-begin-time playback-cut-begin-time-hover").attr("title",tl("ivs.SelectStartTime")),g=i);var j=f.split(":"),k=g.split(":");if(23==j[0]&&59==j[1]&&j[2]>=54)g="23:59:59";else if(3600*k[0]-3600*j[0]+60*k[1]-60*j[1]+1*k[2]-1*j[2]<5){var l=new Date("2000/1/1 "+f).addSeconds(5);g=a.pad(l.getHours(),2)+":"+a.pad(l.getMinutes(),2)+":"+a.pad(l.getSeconds(),2)}d.text(f),e.text(g)},onCut:function(b){function c(){var a=k.replace(/[-:\s]/g,"")+"-"+l.replace(/[-:\s]/g,"")+"."+ab.$("#pla_format input:checked").val();H.DownloadByTime(m,k,l,"VideoClips",a).done(function(b){b?(tb=-2,d.data("savename",a).addClass("playback-cut-download-cancel").attr("title",tl("com.Cancel")),e.hide(),f.show().text(tl("com.DownLoadingTip")),H.addEvent("DownloadPos",function(a){g.width(148*a/100),100===a?(tb=0,d.removeClass("playback-cut-download-cancel").attr("title",tl("sto.Download")),f.text(tl("com.DownloadCompletelyTip")),H.addEvent("DownloadPos",null)):f.text(tl("com.DownLoadingTip")+"  "+a+"%")}),H.addEvent("DownLoadError",function(){ab.$("[btn-for=onCut]").click(),x(tl("com.NoSupportMp4Tip"))})):x(tl("com.NoWriteRightTip"))})}var d=ab.$(b.target),e=ab.$("#pla_cut_time"),f=ab.$("#pla_cut_status"),g=ab.$("#pla_percent"),h=d.hasClass("playback-cut-download-cancel");if(!J.chkAuthority("Backup"))return x(tl("com.NoRightTip"));if(h)H.StopDownload(d.data("savename")),e.show(),f.hide(),g.width(0),tb=0,d.removeClass("playback-cut-download-cancel"),H.addEvent("DownLoadError",null);else{if(-2===tb)return x(tl("com.AnotherRecordDownloadingTip"));if(!e.is(":visible"))return;var i=S.calendar("getDay"),j=i.year+"-"+a.pad(i.month,2)+"-"+a.pad(i.day,2)+" ",k=j+e.children(":first").text(),l=j+e.children(":last").text();if(k===l)return x(tl("com.StartTimeNotSameTimeTip"));var m=a.grep(ib,function(a){return a.StartTime<l&&a.EndTime>k});if(0===m.length)return x(tl("com.TheTimePeriodHasNoRecordFile"));0!==tb?y(tl("com.CantDownloadFilePlaybackOfflayerTip"),function(){n(),c()}):c()}},onSnap:function(){H.CatchPicture(6,"PlaybackSnapshot")},onEnlarge:function(a){G.is("DSPConflict").done(function(b){H.partialEnlarged(ab.$(a.target)).done(function(){H.state("partialEnlarged")?(H.addEvent("RButtonDown",function(a){b||!webApp.IsIPCIntel&&!webApp.IsSDIntel||ab.$("[btn-for=onIVS]").show().hasClass("play-bottom-iconbg-current")&&H.SetIVSEnable(!0),0===a&&H.state("partialEnlarged",!1)}),b||!webApp.IsIPCIntel&&!webApp.IsSDIntel||ab.$("[btn-for=onIVS]").hide().hasClass("play-bottom-iconbg-current")&&H.SetIVSEnable(!1),_.reFishEye()):(H.addEvent("RButtonDown",null),b||!webApp.IsIPCIntel&&!webApp.IsSDIntel||ab.$("[btn-for=onIVS]").show().hasClass("play-bottom-iconbg-current")&&H.SetIVSEnable(!0).done(function(a){a||ab.$("[btn-for=onIVS]").removeClass("play-bottom-iconbg-current")}))})})},onIVS:function(a){var b=ab.$(a.currentTarget);H.SetIVSEnable(!b.hasClass("play-bottom-iconbg-current")).done(function(a){a&&b.toggleClass("play-bottom-iconbg-current")})},onSearchSD:function(){n(),X.dialog("show"),a(window).on("resize.playback",function(){H.cover("#pla_videozone")}),webApp.hide_by_dialog=!0,X.find("#plaSearch_PTZ").ptzSetControl(),H.cover("#pla_videozone",function(){H.open()}),X.find("[name=pla_srch_name][searchMode=preset]").prop("checked",!0);var b=X.find("#plaSearchPreset"),c="";F.PTZ.getPresets().done(function(a){var d=a||[];b.empty();for(var e=0;e<d.length;e++)c+='<option value="'+d[e].Index+'">'+d[e].Name+"</option>";if(b.append(c),d.length>0){var f=X.find('select[sel-for="onChangePID"]');F.PTZ.gotoPreset(f.val()-0)}}),X.find("[name=pla_srch_name][searchMode=preset]").prop("checked")?(X.find("#plaRangeSetBtn").hide(),X.find("#plaSearchPreset").parent().parent().show()):(X.find("#plaRangeSetBtn").show(),X.find("#plaSearchPreset").parent().parent().hide()),X.find("[name=pla_srch_name][searchMode]").on("change",function(){X.find("[name=pla_srch_name][searchMode=preset]").prop("checked")?(X.find("#plaRangeSetBtn").hide(),X.find("#plaSearchPreset").parent().parent().show()):(X.find("#plaRangeSetBtn").show(),X.find("#plaSearchPreset").parent().parent().hide())})},onChangePID:function(){var a=X.find('select[sel-for="onChangePID"]');F.PTZ.gotoPreset(a.val()-0)},onSetBegPoint:function(){F.PtzFunc.setFileMatchPosition(fb,"begin").done(function(a){a.result?X.find("#setPositionTip").tip("success",tl("com.OperateSuccessTip")):X.find("#setPositionTip").tip("error",tl("com.OperateFailTip"))})},onSetEndPoint:function(){F.PtzFunc.setFileMatchPosition(fb,"end").done(function(a){a.result?X.find("#setPositionTip").tip("success",tl("com.OperateSuccessTip")):X.find("#setPositionTip").tip("error",tl("com.OperateFailTip"))})}});var ub=null,vb=0,wb=0,xb=0}),define("fisheye",function(require,b,c){var d=null;c.exports={hasFishEye:!1,me:null,fitMode:0,showMode:0,oldFitMode:0,MountModeArr:["CeilMode","WallMode","FloorMode","WallMode"],bind:function(a){me=a,d=this,me.$("#onFishEye").on("click",function(){me.$("#playback-fisheye-mode").show()}),me.$("#playback-fisheye-fitMode").delegate("li","click",this.onFitModeChange),me.$("#playback-fisheye-playMode").delegate("li","click",this.onPlayModeChange),me.$("#playback-fisheye-mode").on("mouseleave",function(){me.$("#playback-fisheye-mode").hide()}),this.hasFishEye=!0},onFitModeChange:function(b){var c=a(b.target);c.siblings(".current").removeClass("current"),c.addClass("current"),d.fitMode=c.attr("data-for")-0;var e=c.attr("id").split("_");d.showPlayModeByFitMode(e[1]),plugin.SetFeInstallMode(d.fitMode),me.$("#playback-fisheye-playMode li[data-for= "+d.showMode+"]").click()},onPlayModeChange:function(b){var c=a(b.target);c.siblings(".current").removeClass("current"),c.addClass("current");var e=c.attr("data-for")-0;d.showMode=e,e>0&&(me.$("[btn-for = onIVS]").hasClass("play-bottom-iconbg-current")&&me.$("[btn-for = onIVS]").click(),plugin.state("partialEnlarged")&&plugin.state("partialEnlarged",!1)),plugin.SetFeShowMode(e)},showPlayModeByFitMode:function(b){a("#playback-fisheye-playMode li").each(function(c,d){a(d).attr("support-for").indexOf(b)>-1?a(d).show():a(d).hide()})},playbackHasFe:function(a){if(d)if(a>0){d.showMode=0;var b=d.oldFitMode;d.oldFitMode=d.fitMode=a;var c=d.MountModeArr[a-1];d.showPlayModeByFitMode(c),4==a&&me.$("#playback-fisheye-fitMode").hide(),me.$("#onFishEye").show(),a!=b&&me.$("#playback_"+c).click()}else d.fitMode=a,d.closeFisheEye()},closeFisheEye:function(){me.$("#onFishEye").hide(),me.$("#playback-fisheye-mode").hide(),plugin.ControlFe(!1)},reFishEye:function(){d.fitMode>0&&me.$("#playback-fisheye-playMode li:first").click()},reBackFisheye:function(){d.oldFitMode!=d.fitMode&&(d.showMode=0),me.$("#playback-fisheye-fitMode li[data-for = "+d.oldFitMode+"]").click()}}})}(jQuery);