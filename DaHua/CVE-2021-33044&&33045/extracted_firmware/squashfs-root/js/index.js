!function(a){define(function(require,b,c){function d(){p.PeripheralChip.getCaps().done(function(b){b&&b[0]&&b[0].type&&p.PeripheralChip.getVersion(b[0].type).done(function(b){b[0].isMatching||(webApp.peripheralNoMatch=!0,a("[data-for=set]").addClass("noted"))})}),o.get("SystemService").then(function(b){b&&b.Support?a.when(p.ConfigManager.getConfig("MediaEncrypt"),p.ConfigManager.getConfig("RTSP"),p.ConfigManager.getConfig("Https")).then(function(a,b,c){var d=webCaps.HttpPort,f=a.RTSPOverTls.Enable;d=f?c&&c.Enable?webCaps.HttpsPort:{InnerPort:b.Port}:webCaps.HttpPort,d.ServerPort=c&&c.Enable?webCaps.HttpsPort.InnerPort:webCaps.HttpPort.InnerPort,webApp.CustomerInfo=JSON.stringify({info:{svrPort:d.ServerPort,rtspPort:d.InnerPort,StreamEncrypted:f,SetSocketType:"DhtsSocket",DisorderWindow:{Type:0,Value:100}}}),plugin.SetCustomerInfo(webApp.CustomerInfo),e()},function(){e()}):(webApp.CustomerInfo=JSON.stringify({info:{SetSocketType:"DhtsSocket",DisorderWindow:{Type:0,Value:100}}}),plugin.SetCustomerInfo(webApp.CustomerInfo),e())},function(){e()})}function e(){var b=q.getLoginInfo(),c=b.username,d=b.password,e=b.logintype,f=0;"ActiveDirectory"===e&&(f=13),"LDAP"===e&&(f=12),plugin.login(c,d,f).done(function(){a("#login_find2")&&a("#login_find2").dialog("close"),s.leave(),webApp.IsSDIntel&&p.DevIntelliTracker.start(),require.async("index_page",function(b){s.indexPage=new b({element:a("#main").translation()})})})}function f(){s.indexPage.destory(),plugin.logout(),q.logout()}function g(a,b){var c=b.children("li");if(c.removeClass("current"),a){var d=common.newPwdStrenthValidator(a),e=b.find("."+d);e.addClass("current"),b.prop("class","ui-pwd-strength "+d)}else b.prop("class","ui-pwd-strength")}function h(b,c){var d=a(c).attr("data-pwd"),e=[];return a("input[data-pwd="+d+"]").each(function(b,c){e.push(a(c).val())}),e[0]===e[1]}var i,j,k=require("/jsCore/pageBase"),l=require("common/common"),m=l.Cookie,n=l.Check,o=require("/jsCore/ability"),p=require("/jsCore/rpc"),q=require("/jsCore/rpcLogin"),r=require("/jsCore/mTokenOperator"),s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null;c.exports=k.extend({init:function(){function b(a,b){if(!a.length)return!1;this.dialogs=a,this.currentDialog=null,this.currentIndex=0,this.confirm=b;for(var c=0;c<this.dialogs.length-1;c++)this.dialogs[c].find("[data-action=confirm]").attr("t","com.next").parent().translation();this.dialogs[this.dialogs.length-1].find("[data-action=confirm]").attr("t","com.Save").parent().translation()}if(s=this,global.supportH5Player()&&"nacl"!=plugin.type){webApp.playMode="h5",plugin.type="";var c=["/module/hashMap","/module/h264Session","/module/Decode/h264Decoder","/module/h265Session","/module/Decode/h265Decoder","/module/mjpegSession","/module/Decode/MjpegDecoder","/module/Decode/jsFFMPEG","/module/g711Session.js","/module/g726Session.js","/module/aacSession.js","/module/Decode/audioDecoderG711.js","/module/Decode/audioDecoderG726x.js"],e=[];e[0]=["/module/public","/module/Sylvester"],e[1]=["/module/mp4remux","/module/WebGLCanvas","/module/audioPlayer"].concat(c),e[2]=["/module/streamDrawer","/module/videoMediaSource"],e[3]=["/module/workerManager"],e[4]=["/module/WebsocketServer"],e[5]=["/module/playerControl"],require.async(e[0],function(){require.async(e[1],function(){require.async(e[2],function(){require.async(e[3],function(){require.async(e[4],function(){require.async(e[5],function(){})})})})})})}i=!0,navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Edge")?(s.$("#login_psw").prop("type","text"),s.$("#login_psw").css("-webkit-text-security","disc")):(s.$("#login_psw").remove(),jQuery('<input id="login_psw" type="password" maxlength="64" class="fn-width163 fn-mart3" />').insertBefore(s.$("[btn-for=onFindPwd]"))),$logoutDialog=a("#timeout_logout").dialog({zIndex:10005,confirm:function(){a.unsubscribe("SessionInvalid",null),a("body").off("mousedown"),$logoutDialog.dialog("close"),webApp.hide_by_dialog=!1,s.onLogout()}}).detach().appendTo(document.body),s.$("#login_user").textfield(),s.$("#login_psw").textfield().on({keydown:function(a){13===a.keyCode&&(s.$("#login_psw").blur(),s.$("[btn-for=onLogin]").click())},keyup:function(){var a=l.newPwdStrenthValidator(this.value),b=s.$(".ui-pwd-strength");b.find("li").removeClass("current"),this.value?(b.find("li."+a).addClass("current"),b.removeClass().addClass("ui-pwd-strength").addClass(a)):b.removeClass().addClass("ui-pwd-strength")}}),webCaps.is_show_Ushield&&s.$("#login_pin").textfield().on({keydown:function(a){13===a.keyCode&&(s.$("#login_pin").blur(),s.$("[btn-for=onLogin]").click())}}),u=s.$("#device_init").dialog({confirm:function(){if(validatorInit.isInvalid())return validatorInit.validate();var a={};a.name="admin",a.pwd=u.find("[name=newpwd]").val(),u.find("#devInit_phone_enable").prop("checked")&&(a.CellPhone=u.find("#devInit_bindPhone").val()),u.find("#devInit_mail_enable").prop("checked")&&(a.Mail=u.find("#devInit_bindMail").val()),p.PasswdFind.getPub().done(function(b){var c=b.params.pub;common.EncryptInfo(c,a).done(function(a){p.DevInit.account(a.salt,a.cipher,a.content).done(function(){u.find(".u-tip").tip("success",tl("sys.DevInitSuccess")),setTimeout(function(){u.dialog("close"),s.$("#login_user").textfield("value",""),s.$("#login_psw").textfield("value",""),webCaps.SplayDev||p.DevInit.getStatus().done(function(a){B=a.params,B.Step[0]<B.Step[1]&&s.InitDialogChain.next()})},2e3)}).fail(function(){})})}).fail(function(){})}}).detach().appendTo(document.body);var f=[];if((webApp.Vendor===Base64.decode("RGFodWE=")||webApp.Vendor===Base64.decode("RVpJUA==")||"LC"===webApp.Vendor||"Lechange"===webApp.Vendor)&&(x=s.$("#login_permission1").dialog({confirm:function(){s.InitDialogChain.next()}}).detach().appendTo(document.body),x=a.extend(!0,x,{init:function(){x.find("#login_permission_container").html(tl("sys.SoftwareLicenceContent")),x.find("[data-action=confirm]").addClass("disabled"),x.find("[name=licence_check]").on("click",function(){x.find("[name=licence_check]").prop("checked")?x.find("[data-action=confirm]").removeClass("disabled"):x.find("[data-action=confirm]").addClass("disabled")})},next:function(){x.Config=null}}),f.push(x)),(1===webCaps.is_show_CloudAccess||2===webCaps.is_show_CloudAccess)&&(y=s.$("#login_permission2").dialog({confirm:function(){s.InitDialogChain.next()}}).detach().appendTo(document.body),y=a.extend(!0,y,{init:function(){var b;1===webCaps.is_show_CloudAccess?b="http://a.app.qq.com/o/simple.jsp?pkgname=com.mm.android.lc":2===webCaps.is_show_CloudAccess&&(b="http://mobile.easy4ipcloud.com/easy4ip/detect.html",webCaps.isNewPaas&&(b="http://www.dahuatech.com/download/detect.html","General"===webApp.Vendor&&(b="http://mobile.easy4ipcloud.com/EasyViewer/EasyViewer.html")),y.find(".cloud-access-note").attr("t","T2UServer").parent().translation()),a.getScript("../jsBase/lib/qrcode.js",function(){y.find("#Le_QR").html(create_qrcode(b,8,"L",3)),y.show()}),y.find("[name=access_check]").on("click",function(){jQuery(this).prop("checked")||jQuery.alert('<span style="width:600px; display:inline-block">'+tl("com.CancelP2PSelectTips")+"</span>")})},next:function(){y.Config={NetAccess:y.find("[name=access_check]").prop("checked")?2:1}}}),f.push(y)),webCaps.isHideCloudUpgrade||(z=s.$("#login_permission3").dialog({confirm:function(){s.InitDialogChain.next()}}).detach().appendTo(document.body),z=a.extend(!0,z,{init:function(){z.find("#login_online_AutocheckNote").html(tl("sys.AutocheckNote"))},next:function(){z.Config={UpgradeCheck:z.find("[name=autocheck_check]").prop("checked")?2:1}}}),f.push(z)),webCaps.is_show_InitPN&&(A=s.$("#login_permission4").dialog({confirm:function(){s.InitDialogChain.next()}}).detach().appendTo(document.body),A=a.extend(!0,A,{init:function(){var b=A.find("#nation_select_wrap .ui-custom-select-inputbox"),c=A.find("#nation_select_wrap .ui-custom-select-content");c.empty();var d="";webCaps.Nation2Language&&a.each(webCaps.Nation2Language,function(a,b){d+='<li class="ui-custom-select-item" value="'+b[0]+'">'+a+"</li>"}),c.append(d);var e=".login";if(A.find("#nation_select_wrap").on("click",".ui-custom-select-input",function(d){var f=a(d.currentTarget);return c.is(":hidden")?f.addClass("ui-custom-select-input-current"):a(d.target).hasClass("ui-custom-select-inputbtn")&&f.removeClass("ui-custom-select-input-current"),f.hasClass("ui-custom-select-input-current")?(a(document).on("click"+e,function(){a(document).off("click"+e),f.toggleClass("ui-custom-select-input-current"),f.next().hide()}),f.next().show(),b.trigger("keyup",!webCaps.Nation2Language[f.children(".ui-custom-select-inputbox")[0].value])):(a(document).off("click"+e),f.next().hide()),!1}),A.find("#nation_select_wrap").on("click",".ui-custom-select-item",function(b){var c=a(b.currentTarget);return c.addClass("ui-custom-select-item-current").siblings().removeClass("ui-custom-select-item-current"),c.parent().hide().prev().removeClass("ui-custom-select-input-current").find(".ui-custom-select-inputbox").val(c.text()),A.find("#video_standard").val(webCaps.Nation2Language[c.text()][2]).prop("disabled",!1),A.find("#init_language").val(webCaps.Nation2Language[c.text()][1]).prop("disabled",!1),A.find("[data-action=confirm]").removeClass("disabled"),!1}),b.on("keyup",function(b,e){void 0===e&&(e=!0);var f=a(b.currentTarget);return c.empty(),d="",webCaps.Nation2Language&&a.each(webCaps.Nation2Language,function(a,b){(a.toLowerCase().indexOf(f.val().toLowerCase())>-1||e!==!0)&&(d+='<li class="ui-custom-select-item" value="'+b[0]+'">'+a+"</li>")}),d||(d='<li class="ui-custom-select-item" value="none"></li>'),c.append(d),f.val()||(A.find("#video_standard").prop("disabled",!0),A.find("#init_language").prop("disabled",!0),A.find("[data-action=confirm]").addClass("disabled")),!1}),webCaps.MultiLanguage){A.find("#init_language").empty();var f="";a.each(webCaps.MultiLanguage,function(a,b){f+=0===a?'<option value="'+b+'" selected>'+b+"</option>":'<option value="'+b+'">'+b+"</option>"}),A.find("#init_language").append(f)}},next:function(){A.find(".ui-custom-select-item-current").attr("value")&&(A.Config={Country:A.find(".ui-custom-select-item-current").attr("value"),Language:A.find("#init_language").val(),VideoStandard:A.find("#video_standard").val()},global.getlang(A.find("#init_language").val()))}}),f.push(A)),s.InitDialogChain=new b(f,function(){for(var b={NetAccess:0,UpgradeCheck:0},c=f.length-1;c>=0;c--)b=a.extend(!0,b,f[c].Config);p.PasswdFind.getPub().done(function(a){var c=a.params.pub;common.EncryptInfo(c,b).done(function(a){p.DevInit.access(a.salt,a.cipher,a.content).done(function(){f[f.length-1].dialog("close"),B.Step[0]=B.Step[1],s.$("#login_user").textfield("value")?s.$("#login_psw").focus():s.$("#login_user").focus()}).fail(function(){})})}).fail(function(){})}),s.DialogChain=b,b.prototype.next=function(){this.dialogs.length>this.currentIndex?(this.currentIndex&&(this.currentDialog.next(),this.currentDialog.dialog("close")),this.currentIndex++,this.currentDialog=this.dialogs[this.currentIndex-1],this.currentDialog.init(),this.currentDialog.dialog("show")):(this.currentDialog.next(),this.confirm())},b.prototype.recover=function(a){this.dialogs=a,this.currentIndex=0},validatorInit=a.validator([{element:u.find("[name=newpwd]"),check:[common.Check.noQuotationColonAndASCII,common.Check.noQuotationColonAndASCII,common.Check.noQuotationColonAnd,common.Check.noQuotationColonAnd,function(a){return a.length>=8},function(a){return a.length>=8},l.getPasswordStrong,l.getPasswordStrong],errorMsg:["com.PwdTip2","com.PwdTip2","com.PwdTip2","com.PwdTip2","com.BadlengtPassword8Tip","com.BadlengtPassword8Tip","itc.PasswordTowWordTip","itc.PasswordTowWordTip"],events:["keyup","blur","keyup","blur","keyup","blur","keyup","blur"],errorElem:".u-input-error"},{element:u.find("[name=newpwdcfm]"),check:[h,h],errorMsg:["com.PwdDifTip","com.PwdDifTip"],events:["keyup","blur"],errorElem:".u-input-error"},{element:u.find("#devInit_bindPhone"),check:[function(a){return u.find("#devInit_phone_enable").prop("checked")?11===a.length:!0}],errorMsg:["sys.PhoneLength"],events:["blur"],errorElem:".fn-color-red"},{element:u.find("#devInit_bindMail"),check:[function(a){return u.find("#devInit_mail_enable").prop("checked")?common.Check.email(a):!0}],errorMsg:["com.WrongEmailFormatTip"],events:["blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),u.find("#devInit_phone_enable").change(function(){u.find("#devInit_bindPhone").prop("disabled",!a(this).prop("checked")),validatorInit.validate()}),u.find("#devInit_mail_enable").change(function(){u.find("#devInit_bindMail").prop("disabled",!a(this).prop("checked")),validatorInit.validate()}),u.find("#devInit_bindPhone").textfield({type:"number",errorHandle:"prevent"}),u.find("[name=newpwd]").on({keydown:function(a){return 32===a.keyCode?!1:void 0},keyup:function(){var b=a(this).val(),c=a(this).offsetParent().find(".ui-pwd-strength");g(b,c)}}),t=s.$("#login_modify").dialog({confirm:function(){return j.isInvalid()?j.validate():(t.closeFlag=!0,t.dialog("close"),t.closeFlag=!1,void p.MagicBox.getSerialNo().done(function(b){var c,e,f,g,h="Login to "+b,i=q.getLoginInfo(),j=t.find("[name=newpwd]").textfield("value");webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&webCaps.OnvifSync?(c=j,e=i.password,f=j,g=i.password):(c=hex_md5(i.username+":"+h+":"+j),e=hex_md5(i.username+":"+h+":"+i.password),f=Base64.encode(j),g=Base64.encode(e)),webCaps.Customize&&"DockUser"===webCaps.Customize.OnvifStrategy&&(f=j,g=i.password),p.UserManager.modifyPassword(i.username,c,e).done(function(){webCaps.Customize&&webCaps.Customize.Onvif&&("DockUser"===webCaps.Customize.OnvifStrategy?common.EncryptInfo(webApp.EncryptInfo.pub,{name:i.username,pwd:f,pwdOld:g}).done(function(a){p.DockUser.modifyPassword(a.salt,a.cipher,a.content)}):p.UserManager.onvifmodifyPassword(i.username,f,g)),q.getLoginInfo().password=t.find("[name=newpwd]").textfield("value"),d()}).fail(function(b){var c=b.error.code,d="com.ChangePwdFailTip";switch(c){case 604:d="com.InputNotValidTip";break;case 605:d="com.IndexOverlapUserTip";break;case 606:case 607:d="com.UesrNonentityTip";break;case 608:d="com.UsemannageErrUserTip";break;case 609:d="com.SubsetOverlapUserTip";break;case 610:d="com.SaveCfgErrorTip";break;case 611:d="com.PasswordNoTureTip";break;case 612:d="com.PasswordNoMatchTip";break;case 613:d="com.AccountReserveTip";break;case 614:d="com.AddSoMuchGroupTip";break;case 615:d="com.AddSoMuchUserTip"}a.alert(tl(d))})}))},close:function(){t.closeFlag||d()}}).detach().appendTo(document.body),t.find(":checkbox").on("change",function(a){m.set("pwdNoTip",a.target.checked?1:0,{expires:365})}),t.find("[name=newpwd2]").textfield({success:a.noop}),t.find("[name=newpwd]").textfield({success:a.noop}).on({keydown:function(a){return 32===a.keyCode?!1:void 0},keyup:function(){var a=l.newPwdStrenthValidator(this.value),b=t.find(".ui-pwd-strength");b.find("li").removeClass("current"),this.value?(b.find("li."+a).addClass("current"),b.removeClass().addClass("ui-pwd-strength").addClass(a)):b.removeClass().addClass("ui-pwd-strength")}}),v=s.$("#login_find1").dialog({next:function(){var b={};v.auth=v.find("#security_code").val(),b.authCode=v.auth,p.PasswdFind.getPub().done(function(c){var d=c.params.pub;common.EncryptInfo(d,b).done(function(b){p.PasswdFind.checkAuthCode(b.salt,b.cipher,b.content).done(function(){v.find("#security_code").val(""),v.dialog("close"),w.dialog("show"),a.browser.ie8&&(w.css({position:"absolute",top:0,left:0,bottom:0,right:0,height:w.height(),margin:"auto"}),a(window).off("resize"+w.data("duiDialog").eventNamespace),a(".u-mask").css({width:"100%",height:"100%"}))}).fail(function(b){var c="sys.AuthCodeError";switch(b.error.code){case 287571980:c="sys.AuthCodeRefused";break;case 287506444:c="sys.PswResetClosed"}a.alert(tl(c),function(){v.find("[data-action]").removeClass("disabled"),v.find("#security_code").prop("disabled",!1),"sys.PswResetClosed"===c&&(v.closeFlag=!0,v.dialog("close"),v.closeFlag=!1)},!1,{title:tl("com.Prompt"),mask:"body",iframe:!0}),v.find("[data-action]").addClass("disabled"),v.find("#security_code").prop("disabled",!0)})})})},close:function(){v.find("#FP_QR").empty()}}).detach().appendTo(document.body),v.find("#security_code").on("input propertychange",function(){v.find("#security_code").val().length>=8?v.find("[data-action=next]").removeClass("disabled"):v.find("[data-action=next]").addClass("disabled")}),w=s.$("#login_find2").dialog({confirm:function(){if(validator1.isInvalid())return validator1.validate();var b={user:"admin",auth:v.auth,pwd:w.find("[data-pwd=resetUser]").val()};p.PasswdFind.getPub().done(function(c){var d=c.params.pub;common.EncryptInfo(d,b).done(function(b){p.PasswdFind.resetPassword(b.salt,b.cipher,b.content).done(function(){w.find(".u-tip").tip("success",tl("com.PwdResetSuccessTip")),s.$("#login_user").textfield("value","admin"),s.$("#login_psw").textfield("value",""),setTimeout(function(){w.dialog("close")},1e3)}).fail(function(b){var c="com.PwdResetFailRepirTip",d=function(){w.find("[data-action]").removeClass("disabled"),w.find(".ui-input").prop("disabled",!1),p.PasswdFind.getDescript().done(function(b){var c=b.desc,d=b.contact,e="itc.BoundPhone",f=webApp.Vendor;v.find("#QR_edition_wrap").removeClass("fn-hide"),a.getScript("../jsBase/lib/qrcode.js",function(){v.find("#FP_QR").html(create_qrcode(c,12,"L",4))}),webCaps.SN&&(v.find("#FP_SN").text(webCaps.SN),v.find("#FP_SN").parent("div").removeClass("fn-hide"));var g="com.QrScanNote1Tip";"General"===f&&(g="com.QrScanNote2Tip"),f===Base64.decode("RVpJUA==")&&(g="sys.QrScanNote3"),2===b.mode&&(e="sys.BindMail"),v.find("#FP_QRTip").text(tl("com.QRTip").replace("XXXX",d)),v.find("#QR_ScanNote").text(tl(g)),v.find("#security_code").val(""),v.dialog("show"),v.find("[data-action=next]").addClass("disabled"),w.closeFlag=!0,w.dialog("close"),w.closeFlag=!1,a.browser.ie8&&(v.css({position:"absolute",top:0,left:0,bottom:0,right:0,height:v.height(),margin:"auto"}),a(window).off("resize"+v.data("duiDialog").eventNamespace),a(".u-mask").css({width:"100%",height:"100%"}))})},e=function(){w.find("[data-action]").removeClass("disabled"),w.find(".ui-input").prop("disabled",!1),w.closeFlag=!0,w.dialog("close"),w.closeFlag=!1};switch(w.find("[data-action]").addClass("disabled"),w.find(".ui-input").prop("disabled",!0),b.error.code){case 287506444:c="sys.PswResetClosed",a.alert(tl(c),e,!1,{title:tl("com.Prompt")});break;default:a.confirm(tl("com.Prompt"),tl(c),d,e,!0)}})})})},close:function(){w.find("[data-pwd=resetUser]").val(""),w.find("[data-pwd=resetUserCfm]").val(""),w.find(".u-input-error").hide(),w.find("li").removeClass("current"),w.find(".ui-pwd-strength").removeClass().addClass("ui-pwd-strength")}}).detach().appendTo(document.body),w.find("[data-pwd=resetUser]").textfield({success:a.noop}).on({keydown:function(a){return 32===a.keyCode?!1:void 0},keyup:function(){var a=l.newPwdStrenthValidator(this.value),b=w.find(".ui-pwd-strength");b.find("li").removeClass("current"),this.value?(b.find("li."+a).addClass("current"),b.removeClass().addClass("ui-pwd-strength").addClass(a)):b.removeClass().addClass("ui-pwd-strength")}}),j=a.validator([{element:t.find("[name=newpwd]"),check:[n.noQuotationColonAndASCII,n.noQuotationColonAnd,function(a){return a.length>=8},l.getPasswordStrong],errorMsg:["com.PwdTip2","com.PwdTip2","com.BadlengtPassword8Tip","itc.PasswordTowWordTip"],events:["keyup","keyup","keyup","keyup"],errorElem:".u-input-error"},{element:t.find("[name=newpwd2]"),check:[function(a){return a===t.find("[name=newpwd]").val()}],errorMsg:["com.PwdDifTip"],events:["keyup"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),validator1=a.validator([{element:w.find("[data-pwd=resetUser]"),check:[common.Check.noQuotationColonAndASCII,common.Check.noQuotationColonAndASCII,common.Check.noQuotationColonAnd,common.Check.noQuotationColonAnd,function(a){return a.length>=8},function(a){return a.length>=8},l.getPasswordStrong,l.getPasswordStrong],errorMsg:["com.PwdTip2","com.PwdTip2","com.PwdTip2","com.PwdTip2","com.BadlengtPassword8Tip","com.BadlengtPassword8Tip","itc.PasswordTowWordTip","itc.PasswordTowWordTip"],events:["keyup","blur","keyup","blur","keyup","blur","keyup","blur"],errorElem:".u-input-error"},{element:w.find("[data-pwd=resetUserCfm]"),check:[function(a){return a===w.find("[data-pwd=resetUser]").val()},function(a){return a===w.find("[data-pwd=resetUser]").val()}],errorMsg:["com.PwdDifTip","com.PwdDifTip"],events:["keyup","blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),webApp.Vendor===Base64.decode("RGFodWE="))s.$("#login_logo").addClass("login-logo-dhtech"),a("#main_logo").addClass("main-logo-dhtech");else if(webApp.Vendor===Base64.decode("RVpJUA=="))s.$("#login_logo").addClass("login-logo-ezip"),a("#main_logo").addClass("main-logo-ezip");else if("LC"===webApp.Vendor)s.$("#login_logo").addClass("login-logo-lechange"),a("#main_logo").addClass("main-logo-lechange");else if("Lechange"===webApp.Vendor)"SimpChinese"===global.currentLanguage?(s.$("#login_logo").addClass("login-logo-lechange-CN"),a("#main_logo").addClass("main-logo-lechange-CN")):(s.$("#login_logo").addClass("login-logo-lechange"),a("#main_logo").addClass("main-logo-lechange"));else if(-1!==webApp.DeviceType.indexOf("TPC"))s.$("#login_logo").addClass("login-logo-tpc"),a("#main_logo").addClass("main-logo-tpc");else if(-1===webApp.DeviceType.indexOf("SD"))s.$("#login_logo").addClass("login-logo"),a("#main_logo").addClass("main-logo");else switch(webApp.DeviceSubClass){case"SDC":s.$("#login_logo").addClass("login-logo-ipptz"),a("#main_logo").addClass("main-logo-ipptz");break;case"SD_CA":case"SD_CA_ICT":s.$("#login_logo").addClass("login-logo"),a("#main_logo").addClass("main-logo");break;case"SD_PTZ":s.$("#login_logo").addClass("login-logo-ipptz"),a("#main_logo").addClass("main-logo-ipptz");break;default:s.$("#login_logo").addClass("login-logo-ipdome"),a("#main_logo").addClass("main-logo-ipdome")}isEnable("is_show_LDAP")||s.$("#login_type").remove(),isEnable("is_show_secrityCheck")&&s.$("#login_psw").parent().next().removeClass("fn-hide"),global.supportHls()&&require.async("lib/hls.js",function(){}),function(b){function c(a,b,c){var e=new Date(a),f=b.split(":"),g=parseInt(/[-|\+]\d+/g.exec(f[0])[0].replace(/(^\+|^-)(0)(\d)/,"$1$3")),h=parseInt(f[1]);e.setTime(0>g?e.getTime()+60*g*60*1e3-60*h*1e3:e.getTime()+60*g*60*1e3+60*h*1e3);for(var i=c.split(""),j={y:e.getUTCFullYear(),m:d(e.getUTCMonth()+1),d:d(e.getUTCDate())},k="",l=[],m=0,n=i.length;n>m;m++)l.push(j[i[m]]);return k+=l.join("-"),k+=" ",k+=d(e.getUTCHours()),k+=":",k+=d(e.getUTCMinutes()),k+=":",k+=d(e.getUTCSeconds())}function d(a){return 10>a?"0"+a:a}function e(a){var b=$initDevTimeZone.find("#time_zone_select").val(),d=/\((.*?)\)/.exec(b)[1].replace(/\s/g,"");"UTC"==d&&(d="UTC+00:00");var e=$initDevTimeZone.find("#time_zone_date_format").val();e=e.replace(/-/g,""),e=e.replace(/(y)+|(m)+|(d)+/gi,"$1$2$3");var f=c(a,d,e.toLowerCase());$initDevTimeZone.find("#sys_time_will_be").text(f)}var f=window.timeZoneKey;$initDevTimeZone=b.$("#devinit_time_zone").dialog().detach().appendTo(document.body),$initDevTimeZone=a.extend(!0,$initDevTimeZone,{init:function(){function b(){$initDevTimeZone.find("#sys_time_his").find("input").on("focus",function(){clearInterval($initDevTimeZone.dateTimer)}),$initDevTimeZone.find("#sys_time_his").on("blue",function(){f()})}function c(a){var b=d(a.getHours())+":"+d(a.getMinutes())+":"+d(a.getSeconds());$time_zone_ymd.datepicker("value",a),$time_zone_his.timefield("value",b),e(a)}function f(){var a=$initDevTimeZone.find("#sys_time_ymd").datepicker("value"),b=$initDevTimeZone.find("#sys_time_his").timefield("value"),d=g(a,b),e=d.getTime();clearInterval($initDevTimeZone.dateTimer),$initDevTimeZone.dateTimer=setInterval(function(){e+=1e3;var a=new Date(e);c(a)},1e3)}function g(b,c){var d={};if(a.browser.ie){var e=c.split(":"),f=b.split("-");d=new Date,d.setFullYear(f[0]),d.setMonth(f[1]-1),d.setDate(f[2]),d.setHours(e[0]),d.setMinutes(e[1]),d.setSeconds(e[2])}else d=new Date(b+" "+c);return d}var h=$initDevTimeZone.find("#time_zone_select");h.empty();for(var i=A.find("#nation_select input").val(),j=webCaps.Nation2Language[i][3],k="",l=0,m=TimeZoneExcel.length;m>l;l++){var n=TimeZoneExcel[l].replace(/\s+/g,""),o=jQuery.trim(TimeZoneExcel[l]);k+='<option value="'+n+'">'+o+"</option>"}h.append(k),h.val(j.replace(/\s+/g,"")),p.DevInit.getCurrentTime().done(function(a){var b=a.params.time,d=b.split(" ")[0],e=b.split(" ")[1],h=g(d,e);$initDevTimeZone.dateObj=h,c(h),f()}),function(){$initDevTimeZone.find("#time_zone_select").on("change",function(){f()}),$initDevTimeZone.find("#time_zone_date_format").on("change",function(){var b=a(this).val();$time_zone_ymd.datepicker("format",b.toLowerCase()),f()}),$initDevTimeZone.find("#syncPCBtn").on("click",function(){var a=$initDevTimeZone.find(this);clearTimeout(a.syncTimer),a.syncTimer=setTimeout(function(){var a=new Date;c(a),f()},100)})}(),function(){$time_zone_ymd=$initDevTimeZone.find("#sys_time_ymd").datepicker({change:function(){f()}}),$time_zone_his=$initDevTimeZone.find("#sys_time_his").timefield({change:function(){f()}});var a=new Date;c(a),f(),b()}()},next:function(b,c){function d(a){for(var b in f)if(f[b]==a)return b;return 0}if(c){for(var e=$initDevTimeZone.find("#time_zone_date_format").val(),g=$initDevTimeZone.find("#sys_time_will_be").text().split(/\s+/),h=g[0],i=g[1],j=$initDevTimeZone.find("#time_zone_select").val(),k=e.split("-"),l=h.split("-"),m={},n=0,o=k.length;o>n;n++)k[n]=k[n].charAt(0).toLowerCase(),m[k[n].charAt(0)]=l[n];k.sort(function(a,b){return b>a?1:-1}),h="";for(var n=0;o>n;n++)h+=m[k[n]]+"-";h=h.substr(0,h.length-1);var q=/\((.*?)\)/g.exec(j)[1].replace(/\s/g,""),r=d(q)-0,s=j.replace(/\((.*?)\)/,""),t={Country:A.Config.Country,Language:A.Config.Language,VideoStandard:A.Config.VideoStandard,NTP:{TimeZone:r,TimeZoneDesc:s},Locales:{TimeFormat:e+" HH:mm:ss"}};p.DevInit.setCurrentTime(h+" "+i,5),p.PasswdFind.getPub().done(function(c){var d=c.params.pub;common.EncryptInfo(d,t).done(function(c){p.DevInit.setLocalityConfig(c.salt,c.cipher,c.content).done(function(c){c.result?(clearInterval($initDevTimeZone.dateTimer),b()):a.alert(tl("com.SaveCfgErrorTip"))}).fail(function(){a.alert(tl("com.SaveCfgErrorTip"))})})}).fail(function(){$initDevTimeZone.find('[data-action="confirm"]').removeClass("disabled"),a.alert(tl("com.SaveCfgErrorTip"))})}}})}(s),s.render()},render:function(b){if(b&&a.unsubscribe("SessionInvalid",null),a("body").off("mousedown"),a("#main").hide(),s.element.css("top","50%").show(),"anonymity"!==m.get("username")&&s.$("#login_user").textfield("value",m.get("username")),s.$("#login_psw").textfield("value",""),webCaps.is_show_Ushield&&s.$("#login_pin").textfield("value",""),(global.isDDNS()||webCaps.Anonymous&&!window.isPSS)&&b!==!0?setTimeout(s.onLogin,100):s.$("#login_user").textfield("value")?s.$("#login_psw").focus():s.$("#login_user").focus(),webCaps.is_show_DevInit&&(webCaps.is_show_InitPages_adjust&&"SimpChinese"!=global.currentLanguage?s._renderDeviceInit():p.DevInit.getStatus().done(function(b){if(B=b.params,(B.Find.indexOf("A")>-1||B.Find.indexOf("B")>-1)&&(s.$("[btn-for=onFindPwd]").show(),u.find("#devInit_split").removeClass("fn-hide")),1===B.Init)-1!==B.Find.indexOf("A")&&(u.find("#devInit_phone_container").removeClass("fn-hide"),u.find("#devInit_phone_enable").prop("checked",!0)),-1!==B.Find.indexOf("B")&&(u.find("#devInit_mail_container").removeClass("fn-hide"),u.find("#devInit_mail_enable").prop("checked",!0)),u.dialog("show"),u.find("[name=newpwd]").focus();else if(B.Step&&B.Step[0]<B.Step[1]){if(s.$("#login_user").blur(),s.$("#login_psw").blur(),webCaps.SplayDev)return;s.InitDialogChain.next()}a(window).resize()})),webCaps.is_show_Ushield){s.$("#GM_deviceName,#GM_PIN").removeClass("fn-hide"),s.$("#login_psw").parent().addClass("fn-hide"),s.$("#login_pin").textfield({charset:"utf-8",length:40,validReg:/^[\da-zA-Z]+$/,errorHandle:"prevent"});var c=s.$("#login_pin_deviceName"),d=r.listDevice();d.success?(c.empty(),a.isArray(d.message)&&(a.each(d.message,function(a,b){c.append('<option value="'+b+'"" t="'+b+'"></option>').translation()}),s.disabled(a("#login_pin"),!1))):(c.empty(),c.append('<option value="'+d.message+'" t="'+d.message+'"></option>').translation(),s.disabled(a("#login_pin"),!0))}document.title=tl("com.Login")},_renderDeviceInit:function(){var b=[];if(A){A.dialog("setting",{confirm:function(){A.next(function(){d.next()},!0)}});var c=A.next;A.next=function(a,b){return b?void global.getlang(A.find("#init_language").val(),function(){a()}):void c()},b.push(A)}x&&(x.dialog("setting",{confirm:function(){d.next()}}),b.push(x)),$initDevTimeZone&&($initDevTimeZone.dialog("setting",{confirm:function(){$initDevTimeZone.find('[data-action="confirm"]').addClass("disabled"),$initDevTimeZone.next(function(){d.next()},!0)}}),b.push($initDevTimeZone)),u&&(u.dialog("setting",{confirm:function(){if(validatorInit.isInvalid())return validatorInit.validate();var a={};a.name="admin",a.pwd=u.find("[name=newpwd]").val(),u.find("#devInit_phone_enable").prop("checked")&&(a.CellPhone=u.find("#devInit_bindPhone").val()),u.find("#devInit_mail_enable").prop("checked")&&(a.Mail=u.find("#devInit_bindMail").val()),p.PasswdFind.getPub().done(function(b){var c=b.params.pub;common.EncryptInfo(c,a).done(function(a){p.DevInit.account(a.salt,a.cipher,a.content).done(function(){u.find(".u-tip").tip("success",tl("sys.DevInitSuccess")),setTimeout(function(){u.dialog("close"),s.$("#login_user").textfield("value",""),s.$("#login_psw").textfield("value",""),webCaps.SplayDev||p.DevInit.getStatus().done(function(a){B=a.params,B.Step[0]<B.Step[1]&&d.next()})},2e3)}).fail(function(){})})}).fail(function(){})}}),b.push(u),u.init=function(){u.find("[name=newpwd]").focus()}),y&&(y.dialog("setting",{confirm:function(){d.next()}}),b.push(y)),z&&(z.dialog("setting",{confirm:function(){d.next()}}),b.push(z));var d=new s.DialogChain(b,function(){for(var c={NetAccess:0,UpgradeCheck:0},d=b.length-1;d>=0;d--)c=a.extend(!0,c,b[d].Config);p.PasswdFind.getPub().done(function(a){var d=a.params.pub;common.EncryptInfo(d,c).done(function(a){p.DevInit.access(a.salt,a.cipher,a.content).done(function(){b[b.length-1].dialog("close"),B.Step[0]=B.Step[1],s.$("#login_user").textfield("value")?s.$("#login_psw").focus():s.$("#login_user").focus()}).fail(function(){s.tip("error","com.SaveConfigFailTip")})})}).fail(function(){s.tip("error","com.SaveConfigFailTip")})});p.DevInit.getStatus().done(function(c){if(B=c.params,(B.Find.indexOf("A")>-1||B.Find.indexOf("B")>-1)&&(s.$("[btn-for=onFindPwd]").show(),u.find("#devInit_split").removeClass("fn-hide")),1===B.Init)-1!==B.Find.indexOf("A")&&(u.find("#devInit_phone_container").removeClass("fn-hide"),u.find("#devInit_phone_enable").prop("checked",!0)),-1!==B.Find.indexOf("B")&&(u.find("#devInit_mail_container").removeClass("fn-hide"),u.find("#devInit_mail_enable").prop("checked",!0)),d.next();else if(B.Step&&B.Step[0]<B.Step[1]){if(s.$("#login_user").blur(),s.$("#login_psw").blur(),webCaps.SplayDev)return;b=b.slice(b.length-2),d.recover(b),d.next()}a(window).resize()})},leave:function(){s.element.css("top","-100000").hide(),a("#main").show(),s.$("#login_psw").textfield("value","")},destory:function(){t.remove()},onLogin:function(b){var c=s.$("#login_user").textfield("value"),e=s.$("#login_psw").textfield("value"),f=s.$("#login_selType").val()||"Direct";if(s.$("[btn-for=onLogin]").blur(),!b)if(global.isDDNS()){var g=global.getDDNSMessage();c=g.username,e=g.password}else webCaps.Anonymous&&(c="anonymity",e="anonymity");if(!i)return!1;if(webCaps.is_show_Ushield){e="******";var h=s.$("#login_pin_deviceName").val(),j=s.$("#login_pin").textfield("value"),k=r.loginDevice(h,j);if(!k.success)return a.alert(k.message),void s.$("#login_pin").textfield("value","");var l=r.getSignCertSN();if(!l.success)return void a.alert(l.message)
}q.login(c,e,f).done(function(){i=!0,d()}).fail(function(b,c){switch(i=!0,b){case 268632070:a.alert(tl("com.AccoutNonentityTip"));break;case 268632071:a.alert(tl("com.UsernameOrPwdErrorTip"));break;case 268632073:a.alert(tl("com.AccoutBlackedTip"));break;case 268632074:a.alert(tl("com.AccoutLogedTip"));break;case 268632075:a.alert(tl("com.MaximumConnectTip"));break;case 268632081:var d=c&&c.remainLockSecond?tl("com.AccoutLockTip")+tl("sys.lockedSecond").replace("XXXX",c.remainLockSecond):tl("com.AccoutLockTip");a.alert(d);break;case 268632085:var e=c&&c.remainLoginTimes?tl("com.UsernameOrPwdErrorTip")+tl("com.LoginTimes").replace("XXXX"," "+c.remainLoginTimes+" "):tl("com.UsernameOrPwdErrorTip");a.alert(e);break;case 268632090:a.alert(tl("com.LoginFailedPleaseRefresh"));break;case 268632093:a.alert(tl("com.LoginByPrevent"));break;default:a.alert(tl("com.LogInFailTip"))}}),i=!1},onFindPwd:function(){p.PasswdFind.getDescript().done(function(b){function c(){v.find("#QR_edition_wrap").removeClass("fn-hide"),a.getScript("../jsBase/lib/qrcode.js",function(){v.find("#FP_QR").html(create_qrcode(d,12,"L",4))}),webCaps.SN&&(v.find("#FP_SN").text(webCaps.SN),v.find("#FP_SN").parent("div").removeClass("fn-hide"));var c="com.QrScanNote1Tip";"General"===g&&(c="com.QrScanNote2Tip"),g===Base64.decode("RVpJUA==")&&(c="sys.QrScanNote3"),2===b.mode&&(f="sys.BindMail"),v.find("#FP_QRTip").text(tl("com.QRTip").replace("XXXX",e)),v.find("#QR_ScanNote")[0].innerHTML=tl(c),v.find("#security_code").val(""),v.dialog("show"),v.find("[data-action=next]").addClass("disabled"),a.browser.ie8&&(v.css({position:"absolute",top:0,left:0,bottom:0,right:0,height:v.height(),margin:"auto"}),a(window).off("resize"+v.data("duiDialog").eventNamespace),a(".u-mask").css({width:"100%",height:"100%"}))}var d=b.desc,e=b.contact,f="itc.BoundPhone",g=webApp.Vendor;return e?void(webCaps.is_show_ResetPsw?a.confirm(tl("com.Prompt"),tl("com.ResetPswTip"),c,function(){return!1},!1,{width:"800px"}):c()):void a.alert(tl("sys.NoContactBonud"),null,!1,{title:tl("com.Prompt")})}).fail(function(b){var c=b.error.code;switch(c){case 287506435:a.alert(tl("sys.NoContactBonud"),null,!1,{title:tl("com.Prompt")});break;case 287506444:a.alert(tl("sys.PswResetClosed"),null,!1,{title:tl("com.Prompt")})}})},onCancel:function(){s.$("#login_user").textfield("value",""),s.$("#login_psw").textfield("value",""),webCaps.is_show_Ushield&&s.$("#login_pin").textfield("value","")},onLogout:function(){a("div.set-menu-noted").remove(),a("[data-for=set]").removeClass("noted"),webApp.CloudUpgraderInfo=null,webCaps.Anonymous=!1,webApp.IsSDIntel&&p.DevIntelliTracker.start(),s.indexPage.leave(),s.indexPage.destory(),plugin.logout(),s.render(!0),q.logout()}}),a(window).on("unload",f)}),define("index_page",function(require,b,c){var d=require("/jsCore/pageBase"),e=require("jsCore/rpcLogin"),f=(require("/jsCore/plugin"),require("common/common")),g=f.Cookie,h=webCaps.WebVersion?"?version="+webCaps.WebVersion:"";c.exports=d.extend({init:function(){var b=this,c=b.element.children(".u-tab"),d=b.element.children(".u-tab-content");b.tabs={},b.current=null,c.find("[data-for=ptz]").show(),a.when(ability.get("VideoInputCaps"),ability.get("ExternalSensorCaps"),ability.get("SupportPtzFunction")).always(function(a,b,d){var f=b&&b.Support&&"RS-485"==b.NetworkingMode;webApp.isSpecialPtz=!(!webApp.HasPtz||!d);for(var g=["IPC-HDBW8331E","IPC-HDB8331E"],h=!1,i=0,j=g.length;j>i;i++)webApp.DeviceType.indexOf(g[i])>-1&&(h=!0);(a&&a.ElectricFocus||f||h)&&(webApp.isSpecialPtz=!1,c.find("[data-for=ptz]").hide()),(-1!==webApp.DeviceType.indexOf("SD")||!e.chkAuthority("MPTZ")||!webApp.HasPtz||isEnable("is_8M_Flash")||webApp.isSpecialPtz)&&c.find("[data-for=ptz]").hide()}),ability.get("IsLocalStore").then(function(a){var b=!e.chkAuthority("Replay_01")&&!e.chkAuthority("Replay_02")||!a||isEnable("is_8M_Flash"),d=!e.chkAuthority("Replay_01")||!a||isEnable("is_8M_Flash");-1!==webApp.DeviceType.indexOf("TPC")?b&&d?c.find("[data-for=playback]").hide():c.find("[data-for=playback]").show():d?c.find("[data-for=playback]").hide():c.find("[data-for=playback]").show()}),ability.get("RadioMetry").then(function(a){a&&a.Support?c.find("[data-for=report]").show():c.find("[data-for=report]").hide()}),webCaps&&webCaps.traffic_show_PicDownload&&"anonymity"!==g.get("username")?c.find("[data-for=pictures]").show():c.find("[data-for=pictures]").hide(),a(document.body).css("background",'#373737 url("image/setbg.png") repeat-x'),c.tab({switched:function(a,e){var f=b.tabs[e.from],g=b.tabs[e.to];if(document.title=c.find("[data-for="+e.to+"] span").text(),f&&f.leave(),g)g.render(),b.current=g;else{var i=["/js/"+e.to+".js"+h];switch(e.to){case"logout":return webApp.loginPage.onLogout();case"playback":case"report":case"pictures":case"alarm":i.push("/html/"+e.to+".htm"+h);break;case"preview":case"ptz":case"set":}require.async(i,function(a,c){var f=d.find("[data-page="+e.to+"]");c?f.empty().append(c).translation():f.translation(),b.tabs[e.to]=new a({element:f}),b.current=b.tabs[e.to]})}}})},render:function(){this.current&&this.current.render()},leave:function(){this.current&&this.current.leave()},destory:function(){a.each(this.tabs,function(b,c){a.isFunction(c.destory)&&c.destory()}),this.current=null,this.tabs=null,this.element.children(".u-tab").tab("destroy"),a(document.body).css("background","#373737")}})})}(jQuery);