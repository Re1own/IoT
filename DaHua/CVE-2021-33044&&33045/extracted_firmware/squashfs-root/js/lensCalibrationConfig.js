!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("lensAngleCali",function(require,b,c){var d,e,f=require("jsCore/rpc"),g=require("jsCore/pageBase"),h=null,i=null,j=[],k=null,l=null;c.exports=g.extend({init:function(){me=this,e=me.$("#lens_AddPointDlg").dialog({confirm:function(a,b){me._onAddPoint(b)}}).detach().appendTo(document.body),d=me.$("#lensCaliTable").table({height:200,selectSingle:!1,columns:[{t:"com.Numbers",width:"10%",render:function(a){return a._index+1}},{t:"per.LensOriginal",width:"40%",fields:"original",editor:function(){return a('<input type="text" class="u-input"/>').numberfield({min:0,max:100,allowDecimal:!0,allowNegative:!1})}},{t:"per.LensCalibrate",width:"40%",fields:"calibrate",editor:function(){return a('<input type="text" class="u-input"/>').numberfield({min:0,max:100,allowDecimal:!0,allowNegative:!1})}},{t:"com.Delete",width:"10%",action:"delete",icon:"ui-table-icon-del",handle:function(a){me.onDeletePoint(a)}}],onblurEditor:function(a,b){var c=b.field;b.field&&b.data&&(k=b.data[c],l=b.editVal-0,k!==l&&(j[b.data._index][c]=l))}}),ability.get("VideoInImageGird").done(function(b){if(b){var c=0;b.SupportPoint&&b.SupportGird?c=3:b.SupportGird&&!b.SupportPoint?c=2:!b.SupportGird&&b.SupportPoint&&(c=1),me.$("#lens_video_enable").click(function(){var b=me.$("#lens_video_enable").prop("checked");b?(a("#video_gird").addClass("current"),plugin.NetShowMode(c)):(a("#video_gird").removeClass("current"),plugin.NetShowMode(0))})}}),me.render()},render:function(){me._getConfig()},onRefresh:function(){me._getConfig(!0)},_getConfig:function(a){f.PTZBase.getCurrentFovValue().done(function(a){if(a&&a.value){var b=(.01*a.value).toFixed(2);me.$("#lens_angle_config").text(b-0)}}),f.ConfigManager.getConfig("FovCalibration").done(function(b){h=b,i=h.CalibrationValue,me.changePointToObj(i),d.table("dataSource",j),a&&me.$("#lens_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){me.$("#lens_tip").tip("error",tl("com.OperateFailTip"))})},changePointToObj:function(b){j=[],a.each(b,function(a,b){j[a]={original:b[0],calibrate:b[1]}})},renderAddPoint:function(){var a={},b=j.length+1;a._index=b,a._id=b,a.original=0,a.calibrate=0,d.table("add",a,-1).table("selectRow",j.length-1)},onDeletePoint:function(a){d.table("del",a).table("selectRow",j.length-1)},onConfirm:function(){i=[],a.each(j,function(a,b){i[a]=[b.original-0,b.calibrate-0]}),h.CalibrationValue=i,f.ConfigManager.setConfig("FovCalibration",h).done(function(){me.$("#lens_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){me.$("#lens_tip").tip("error",tl("com.SaveConfigFailTip"))})},onDefault:function(){f.ConfigManager.getDefault("FovCalibration").done(function(a){h=a,i=h.CalibrationValue,me.changePointToObj(i),d.table("dataSource",j),me.$("#lens_tip").tip("success",tl("com.DefaultSuccessTip"))}).fail(function(){me.$("#lens_tip").tip("error",tl("com.DefaultfailureTip"))})}})})}(jQuery);