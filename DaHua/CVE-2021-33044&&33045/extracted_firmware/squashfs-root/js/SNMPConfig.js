!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("snmp",function(require,b,c){function d(a){return a=a||"",a.length>7}var e=require("jsCore/rpc"),f=require("jsCore/pageBase"),g=null,h=!1,i=null,j=null,k=null,l=null,m=null,n={},o=require("common/common"),p=o.Check;c.exports=f.extend({init:function(){g=this,k=g.$("#snmp_v1_enable"),l=g.$("#snmp_v2_enable"),m=g.$("[chk-for=onV3Enable]"),$tipDialog=a("#snmp_tip_dialog").dialog({confirm:function(){$tipDialog.dialog("close"),g.onConfirm(!0)},close:function(){}}).detach().appendTo(document.body),k.click(function(){i.validate()}),l.click(function(){i.validate()}),i=a.validator([{element:g.$("[cfg=ReadCommon]"),check:[p.alphaNumLine,p.alphaNumLine,function(a){return k.prop("checked")||l.prop("checked")?""!==a:!0}],errorMsg:["com.BadstringServerNameTip","com.BadstringServerNameTip","com.Necessary"],events:["keyup","blur","blur"]},{element:g.$("[cfg=WriteCommon]"),check:[p.alphaNumLine,p.alphaNumLine,function(a){return k.prop("checked")||l.prop("checked")?""!==a:!0}],errorMsg:["com.BadstringServerNameTip","com.BadstringServerNameTip","com.Necessary"],events:["keyup","blur","blur"]}],function(a){a.parent().translation()}),j=a.validator([{element:g.$("[cfg=User]"),check:[p.alphaNumUnderline,p.alphaNumUnderline,o.Check.require,o.Check.require],errorMsg:["com.IncludeTpye6Tip","com.IncludeTpye6Tip","com.Necessary","com.Necessary"],events:["keyup","blur","keyup","blur"]},{element:g.$("[cfg=V3ReadUser]"),check:[p.alphaNumUnderline,p.alphaNumUnderline,o.Check.require,o.Check.require],errorMsg:["com.IncludeTpye6Tip","com.IncludeTpye6Tip","com.Necessary","com.Necessary"],events:["keyup","blur","keyup","blur"]},{element:g.$("[cfg=TrapPort]"),check:[function(){return g.$("[cfg=TrapPort]").val()!==g.$("[cfg=Port]").val()}],errorMsg:["pfm.SamePort"],events:["blur"]},{element:g.$("[cfg=TrapServer]"),check:[function(){return!(!p.ip(g.$("[cfg=TrapServer]").val())&&!p.ipv6(g.$("[cfg=TrapServer]").val())&&g.$("[cfg=TrapServer]").val())},function(){return!(!p.ip(g.$("[cfg=TrapServer]").val())&&!p.ipv6(g.$("[cfg=TrapServer]").val())&&g.$("[cfg=TrapServer]").val())},function(){if(p.ip(g.$("[cfg=TrapServer]").val())){var a=g.$("[cfg=TrapServer]").val().split(".");if(a[0]=parseInt(a[0]),a[3]=parseInt(a[3]),127===a[0]||0===a[0]||a[0]>223||0===a[3]||a[3]>254)return!1}return!0},function(){if(p.ip(g.$("[cfg=TrapServer]").val())){var a=g.$("[cfg=TrapServer]").val().split(".");if(a[0]=parseInt(a[0]),a[3]=parseInt(a[3]),127===a[0]||0===a[0]||a[0]>223||0===a[3]||a[3]>254)return!1}return!0}],errorMsg:["com.TrapAddressTip","com.TrapAddressTip","com.TrapAddressTip","com.TrapAddressTip"],events:["blur","keyup","blur","keyup"]},{element:g.$("input[type=password]"),check:[d],errorMsg:["com.BadlengtPassword8Tip"],events:["blur"]},{element:g.$("[cfg=V3ReadEncryPwd]"),check:[p.noQuotation,p.noQuotation,d,d],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip","com.BadlengtPassword8Tip","com.BadlengtPassword8Tip"],events:["blur","keyup","blur","keyup"]},{element:g.$("[cfg=V3ReadAuthPwd]"),check:[p.noQuotation,p.noQuotation,d,d],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip","com.BadlengtPassword8Tip","com.BadlengtPassword8Tip"],events:["blur","keyup","blur","keyup"]},{element:g.$("[cfg=Password]"),check:[p.noQuotation,p.noQuotation,d,d],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip","com.BadlengtPassword8Tip","com.BadlengtPassword8Tip"],events:["blur","keyup","blur","keyup"]},{element:g.$("[cfg=V3RWEncryPwd]"),check:[p.noQuotation,p.noQuotation,d,d],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip","com.BadlengtPassword8Tip","com.BadlengtPassword8Tip"],events:["blur","keyup","blur","keyup"]}],function(a){a.parent().translation()}),g.$("[cfg=Port], [cfg=TrapPort]").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),g.$("[cfg=KeepAlivePeriod]").numberfield({min:60,max:300,allowDecimal:!1,allowNegative:!1}),e.MagicBox.getProductDefinition("SNMPKeepAlive").done(function(a){h=!1,g.$("#snmp_live").hide(),a&&(h=!0,g.$("#snmp_live").show())}).fail(function(){h=!1,g.$("#snmp_live").hide()}),webCaps.SNMPSupportAES&&(g.$("#snmp_re_CBC-DES").prop("id","snmp_re_CFB-AES").next("span").text("CFB-AES"),g.$("#snmp_rwe_CBC-DES").prop("id","snmp_rwe_CFB-AES").next("span").text("CFB-AES")),g.bind(),g.render()},bind:function(){a("[cfg='V3ReadAuthPwd'],[cfg='V3ReadEncryPwd'],[cfg='Password'],[cfg='V3RWEncryPwd']").textfield({length:60,asciiByte:2,validReg:/^[^\'\"\u4E00-\u9FA5\u0020\\]*$/,errorHandle:"prevent",error:function(b){b.stopPropagation(),a(this).off("keyup"),a(this).parent().children("span").css({display:"inline"}).text(tl("com.noInputChMarksSpaceSlash"))}})},onV3Enable:function(){m.is(":checked")?(g.$("#snmp_v3_table").show(),k.prop("checked",!1),l.prop("checked",!1),j.validate(),g.disabled("#snmp_v1_enable, #snmp_v2_enable")):(g.$("#snmp_v3_table").hide(),g.disabled("#snmp_v1_enable, #snmp_v2_enable",!1)),i.validate()},onKeepAlive:function(){g.$("[chk-for=onKeepAlive]").is(":checked")?g.$("#snmp_IntervalDiv").show():g.$("#snmp_IntervalDiv").hide()},render:function(){e.ConfigManager.getConfig("SNMP").done(function(a){n=a,g._renderElements()})},_renderElements:function(){k.prop("checked",n.V1Enable),l.prop("checked",n.V2Enable),g.$("[chk-for=onKeepAlive]").prop("checked",n.KeepAliveEnable),g.onKeepAlive(),a.each(g.$("[cfg]"),function(a,b){var c=g.$(b).attr("cfg");g.$(b).val(n[c])}),n.V3Enable?(g.$("#snmp_v3_table").show(),k.prop("checked",!1),l.prop("checked",!1),m.prop("checked",!0),g.disabled("#snmp_v1_enable, #snmp_v2_enable")):(g.$("#snmp_v3_table").hide(),m.prop("checked",!1),g.disabled("#snmp_v1_enable, #snmp_v2_enable",!1)),a.each(g.$("[id^=snmp_rd], [id^=snmp_rw], [id^=snmp_re], [id^=snmp_rwe]"),function(a,b){var c=g.$(b).attr("id").split("_");"rd"===c[1]?g.$(b).prop("checked",n.V3ReadAuthType===c[2]):"re"===c[1]?g.$(b).prop("checked",n.V3ReadEncryType===c[2]):"rwe"===c[1]?g.$(b).prop("checked",n.V3RWEncryType===c[2]):g.$(b).prop("checked",n.V3RWAuthType===c[2])}),i.validate(),j.validate()},onDefault:function(){e.ConfigManager.getDefault("SNMP").done(function(a){n=a,g._renderElements(),g.tip("success","com.DefaultSuccessTip")}).fail(function(){g.tip("error","com.DefaultfailureTip")})},onRefresh:function(){e.ConfigManager.getConfig("SNMP").done(function(a){n=a,g._renderElements(),g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})},onConfirm:function(b){var c="";if(i.isInvalid())return i.validate(),g.tip("warning",i.errors()[0].errorMsg);if(""!==g.$("[cfg=TrapServer]").val()){if(!p.ip(g.$("[cfg=TrapServer]").val())&&!p.ipv6(g.$("[cfg=TrapServer]").val()))return g.tip("warning","com.TrapAddressTip");if(p.ip(g.$("[cfg=TrapServer]").val())){var f=g.$("[cfg=TrapServer]").val().split(".");if(127===parseInt(f[0])||0===parseInt(f[0])||parseInt(f[0])>223||0===parseInt(f[3])||parseInt(f[3])>254)return g.tip("warning","com.TrapAddressTip")}}if(g.$("[cfg=Port]").val()==g.$("[cfg=TrapPort]").val())return g.tip("warning","pfm.SamePort");if(a.each(g.$("[cfg]"),function(a,b){var c=g.$(b).attr("cfg");n[c]=c.indexOf("Port")>-1||"KeepAlivePeriod"===c?g.$(b).val()-0:g.$(b).val()}),n.V1Enable=k.is(":checked"),n.V2Enable=l.is(":checked"),n.V3Enable=m.is(":checked"),h&&(n.KeepAliveEnable=g.$("[chk-for=onKeepAlive]").is(":checked")),n.V3Enable){if(j.isInvalid())return g.tip("warning",j.errors()[0].errorMsg);if(0===a.trim(g.$("[cfg=User]").val()).length||0===a.trim(g.$("[cfg=V3ReadUser]").val()).length)return g.tip("warning","com.Necessary");if(!p.alphaNumUnderline(g.$("[cfg=User]").val())||!p.alphaNumUnderline(g.$("[cfg=V3ReadUser]").val()))return g.tip("warning","com.IncludeTpye6Tip");if(!d(g.$("input[type=password]").val()))return g.tip("warning","com.BadlengtPassword8Tip");if(a.each(g.$("[id^=snmp_rd], [id^=snmp_rw], [id^=snmp_re], [id^=snmp_rwe]"),function(a,b){var c=g.$(b).attr("id").split("_");g.$(b).is(":checked")&&("rd"===c[1]?n.V3ReadAuthType=c[2]:"re"===c[1]?n.V3ReadEncryType=c[2]:"rwe"===c[1]?n.V3RWEncryType=c[2]:n.V3RWAuthType=c[2])}),n.User===n.V3ReadUser)return g.tip("warning","com.NameNoSameTip")}else n.V1Enable?c=n.V2Enable?"net.SNMP12RiskTip":"net.SNMP1RiskTip":n.V2Enable&&(c="net.SNMP2RiskTip");return b!==!0&&"public"===g.$("[cfg=ReadCommon]").val()?$tipDialog.dialog("show"):b!==!0&&"private"===g.$("[cfg=WriteCommon]").val()?$tipDialog.dialog("show"):void(c?a.confirm(tl("com.Prompt"),tl(c),function(){e.ConfigManager.setConfig("SNMP",n).done(function(){g.tip("success","com.SaveSuccessTip")}).fail(function(){g.tip("error","com.SaveConfigFailTip")})},function(){return!1},!1):e.ConfigManager.setConfig("SNMP",n).done(function(){g.tip("success","com.SaveSuccessTip")}).fail(function(){g.tip("error","com.SaveConfigFailTip")}))}})})}(jQuery);