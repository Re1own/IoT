!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab"),b.exports.prototype.iss_ipc=-1===webApp.DeviceType.indexOf("SD")||!!webApp.NoIntelliPreset,b.exports.prototype.iss_sd=-1!==webApp.DeviceType.indexOf("SD")&&!webApp.NoIntelliPreset,b.exports.prototype.iss_plan=!!webCaps.is_show_newIntelli&&!!webApp.IsSDTraficIntel}),define("iss_ipc",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("jsCore/rpcLogin");require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect");var g,h,i,j,k,l,m,n=0,o=!1,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,v=!1;c.exports=d.extend({init:function(){i=this,o="thermal"===webApp.CHANNEL_TYPE[1]&&f.chkAuthority("FireWarning"),webApp.CHANNEL_NUMBER>1&&(a("#iExc_channel").parent().removeClass("fn-hide"),a("#iExc_channel").parent().next("div").removeClass("fn-hide"),$channel=a("#iExc_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){var c;n=b.ch,-1!==webApp.DeviceType.indexOf("TPC")?(i.initTemplate(n?m:g),o&&(c=i.$(".ivsSche"),i.$('[data-sch="Normal"]').next().removeClass("tiplong"),i.$('[data-sch="Normal"]').next().attr("t","ivs.IVSRule;title::ivs.IVSRule"),c.translation())):(c=i.$(".ivsSche"),i.$('[data-sch="FaceDetection"]').parent().is(":hidden")&&i.$('[data-sch="FaceDetection"]').parent().show()),i.renderElement(n)}}),$channel.iconSelect("index",n)),g=[],m=[],a.when(ability.get("IVSCaps"),ability.is("DSPConflict")).then(function(b,c){for(var d in b.SupportedScenes)g.push(d);i.initTemplate(g),h=b.SupportedComp||[],p=!c&&(webCaps.is_new_IVSUI?!0:webApp.IsIPCIntel)&&b&&(-1!==a.inArray("StereoNumber",b.SupportedScene)||-1!==a.inArray("StereoNumber",b.SupportedScene))}),"thermal"===webApp.CHANNEL_TYPE[1]&&e.DevVideoAnalyse.getCaps(1).done(function(a){for(var b in a.SupportedScenes)m.push(b)}),e.VideoInAnalyse.getTemplateGlobal().done(function(a){l=a});var b=a.Deferred();ability.get("VideoInputCapsEx").done(function(a){-1!==a.VideoInBacklight.Modes.indexOf("WideDynamic")&&(q=!0)}).always(function(){b.resolve()}),a.when(b).always(function(){i.render()})},render:function(){g_videoInConflict.DSP.hasConflict().then(function(){i.tip("warning","com.DspTvoutConflictTip")}),i.onRefresh(!1)},initTemplate:function(b){var c=i.$(".ivsSche"),d={Normal:"ivs.IVSRule",FaceDetection:"appEventFaceDetection",NumberStat:"ivs.PtzNumberStat",NumberStatPlan:"ivs.PtzNumberStat",HeatMap:"HeatMap",Track:"Track",Traffic:"Traffic",VideoDiagnosis:"VideoDiagnosis",WideView:"WideView",SDFaceDetect:"appEventFaceDetection",HeatMapPlan:"HeatMap",Gate:isEnable("is_numberOK_Gate")?"ANPR":"Gate",SCR:"ShootingScoreRecognition",StereoVision:"com.ipcStereopsis",StereoNumber:"ivs.PtzNumberStat",FaceAnalysis:"FaceAnalysis",ObjectDetect:"ivs.VideoStructrue",StereoBehavior:"StereoBehavior",SmokeFire:"ivs.SmokeFire",ParkingSpace:"ivs.CarposManager"};if(c.empty(),webCaps.NewGlobalCamera)for(var e=0;e<b.length;e++)c.append("ObjectDetect"===b[e]?'<li><div data-for="choose" class="img ObjectDetect1" data-sch="'+b[e]+'"></div><span class= "notip" t="'+d[b[e]]+";title::"+d[b[e]]+'"></span></li>':'<li><div data-for="choose" class="img '+b[e]+'" data-sch="'+b[e]+'"></div><span class= "notip" t="'+d[b[e]]+";title::"+d[b[e]]+'"></span></li>');else for(var e=0;e<b.length;e++)c.append('<li><div class="img '+b[e]+'" data-sch="'+b[e]+'"></div><span class="tip" t="'+d[b[e]]+";title::"+d[b[e]]+'"></span></li>');c.translation(),c.off().on("click",function(b){i.onChooseIvs(a(b.target))})},onChooseIvs:function(a){return a.hasClass("disable")||!a.attr("data-sch")?!1:(a.toggleClass("select"),i._checkDisable(n),"SmokeFire"===a.attr("data-sch")&&(u=a.hasClass("select")?!0:!1,q&&s&&t&&r&&u?(v=!0,i.tip("error","ivs.WDFireConflictTip")):v=!1),void 0)},_checkDisable:function(b){var c=[],d=i.$(".ivsSche .select");a.each(d,function(b,d){c.push(a(d).attr("data-sch"))});for(var e=[],f=0;f<h.length;f++)i.arrInclude(h[f],c)&&(e=e.concat(h[f]));var j=b?m:g;a.each(j,function(b,c){-1===a.inArray(c,e)?i.$('[data-sch="'+c+'"]').addClass("disable"):i.$('[data-sch="'+c+'"]').removeClass("disable")})},arrInclude:function(b,c){var d=!0;return a.each(c,function(c,e){-1===a.inArray(e,b)&&(d=!1)}),d},renderElement:function(b){j[b]&&j[b].Scene||(j[b]=jQuery.extend(!0,{},l)),j[b].Scene.TypeList||(j[b].Scene.TypeList=[]);var c=j[b].Scene.TypeList;c.push(j[b].Scene.Type),i.$(".ivsSche [data-sch]").removeClass("select").removeClass("disable"),a.each(c,function(a,b){i.$('.ivsSche [data-sch="'+b+'"]').addClass("select")}),i._checkDisable(b)},saveElement:function(){j[n].Scene.TypeList||(j[n].Scene.TypeList=[]);var b=[],c=i.$(".ivsSche .select");return 0===c.length?(j[n].Scene.Type=null,void(j[n].Scene.TypeList=null)):(a.each(c,function(c,d){b.push(a(d).attr("data-sch"))}),j[n].Scene.Type=b.shift(),j[n].Scene.TypeList=0!==b.length?b:null,void(j[n].Scene.PtzPresetId=0))},onDefault:function(){e.ConfigManager.getDefault("VideoAnalyseGlobal").done(function(a){j=a,i.renderElement(n),i.tip("success","com.DefaultSuccessTip"),i.handlerFireConflict(a)}).fail(function(){i.tip("error","com.DefaultfailureTip")})},onRefresh:function(a){e.ConfigManager.getConfig("VideoAnalyseGlobal").done(function(b){j=b,i.renderElement(n),a!==!1&&i.tip("success","com.OperateSuccessTip"),i.handlerFireConflict(b)}).fail(function(){i.tip("error","com.OperateFailTip")}),p&&e.ConfigManager.getConfig("VideoImageControl").done(function(a){k=a}).fail(function(){})},handlerFireConflict:function(b){var c=a.Deferred(),d=a.Deferred();if(s=!1,t=!1,u=!1,v=!1,r=-1!==g.indexOf("SmokeFire")?!0:!1,q?e.ConfigManager.getConfig("VideoInBacklight").done(function(a){s=q&&a[0]&&"WideDynamic"===a[0][0].Mode?!0:!1}).always(function(){c.resolve()}):c.resolve(),r){if(b[0]&&b[0].Scene){var f=b[0].Scene;(f.Type&&-1!==f.Type.indexOf("SmokeFire")||f.TypeList&&-1!==f.TypeList.indexOf("SmokeFire"))&&(u=!0)}e.ConfigManager.getConfig("VideoAnalyseRule").done(function(a){a[0]&&"FireDetection"===a[0][0].Type&&a[0][0].Enable===!0&&(t=!0)}).always(function(){d.resolve()})}else d.resolve();a.when(c,d).always(function(){q&&s&&t&&r&&u&&(v=!0,i.tip("error","ivs.WDFireConflictTip"))})},onSave:function(){if(v)return void i.tip("error","ivs.WDFireConflictTip");i.saveElement();var a=j[n].Scene.Type;return p&&("StereoNumber"===a||"StereoVision"===a)&&k[n].Stable?(i.tip("warning","ivs.StereoStabilizeConflict"),!1):void e.ConfigManager.setConfig("VideoAnalyseGlobal",j).done(function(a){i.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(a)&&webApp.reboot("com.RebootingTip")}).fail(function(){i.tip("error","com.SaveConfigFailTip")})},leave:function(){}})}),define("iss_sd",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("jsCore/rpcLogin");require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect");var g,h,i,j,k,l,m,n=0,o=null,p=!1,q="",r=!1,s=!0,t=255,u=!1,v=!1,w=["ObjectDetect","FaceAnalysis","Normal","TrafficPark","IntelliCityMgr"];c.exports=d.extend({init:function(){j=this,webCaps.is_show_newIntelli&&webApp.IsSDTraficIntel&&(r=!0),webApp.CHANNEL_NUMBER>1&&(a("#iExc_channel").parent().removeClass("fn-hide"),a("#iExc_channel").parent().next("div").removeClass("fn-hide"),o=a("#iExc_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){n=b.ch,j.renderElement()}}),o.iconSelect("index",n)),k=j.$('[data-list="scheme"]'),g=[],m=[],ability.get("PTZCaps").done(function(a){t=a.PresetMax||255}),ability.get("IVSCaps").done(function(b){for(var c in b.SupportedScenes)g.push(c);h=b.SupportedComp||[],a.each(h,function(a,b){h[a]=j.protocolChange(b)}),-1!==g.indexOf("HeatMapPlan")&&-1!==g.indexOf("NumberStatPlan")&&(a('div[data-cap="HeatMap"]').addClass("fn-hide"),a('div[data-cap="HeatNumber"]').removeClass("fn-hide"),g.splice(g.indexOf("NumberStatPlan"),1)),-1===g.indexOf("HeatMapPlan")?j.$('[data-cap="HeatMap"]').remove():g.splice(g.indexOf("HeatMapPlan"),1)}),"thermal"===webApp.CHANNEL_TYPE[1]&&e.DevVideoAnalyse.getCaps(1).done(function(a){for(var b in a.SupportedScenes)m.push(b)}),e.VideoInAnalyse.getTemplateGlobal().done(function(a){l=a,r?"TrafficPark"===webApp.SDTraficIntelType&&(l.Scene1.Detail.Lanes=[]):l.Scene.Detail.Lanes=[]}),j.bind(),j.render()},render:function(){g_videoInConflict.DSP.hasConflict().then(function(){j.tip("warning","com.DspTvoutConflictTip")}),e.ConfigManager.getConfig("VideoImageControl").done(function(a){u=a[n]&&a[n].Stable}),e.PTZ.getPresets().done(function(b){var c=j.$('[data-list="presets"]').empty();b&&a.each(b,function(a,b){c.append('<li title="'+b.Name+'" value="'+b.Index+'">'+b.Name+"</li>")}),r&&c.append('<li title="'+tl("ivs.ForifyPreset")+'" value="0">'+tl("ivs.ForifyPreset")+"</li>"),j.presets=b||[],j.onRefresh(!1)})},protocolChange:function(a,b){return b?(-1!==a.indexOf("FaceDetection")&&a.splice(a.indexOf("FaceDetection"),1,"SDFaceDetect"),-1!==a.indexOf("HeatMap")&&a.splice(a.indexOf("HeatMap"),1,"HeatMapPlan"),-1!==a.indexOf("NumberStat")&&a.splice(a.indexOf("NumberStat"),1,"NumberStatPlan")):(-1!==a.indexOf("SDFaceDetect")&&a.splice(a.indexOf("SDFaceDetect"),1,"FaceDetection"),-1!==a.indexOf("HeatMapPlan")&&a.splice(a.indexOf("HeatMapPlan"),1,"HeatMap"),-1!==a.indexOf("NumberStatPlan")&&a.splice(a.indexOf("NumberStatPlan"),1,"NumberStat")),a},bind:function(){j.$('ul[data-list="presets"]').on("click",function(b){if(k.data("heatmapPlan")!==!0){var c=a(b.target).val();if(r){var d=0;if(0===c){for(var e=a('ul[data-list="presets"] li').length,f=0;e>f;f++)if(a('ul[data-list="presets"] li')[f].value!==f+1){d=f+1;break}0===d&&(d=e+1);var g={Index:d,Name:tl("ivs.Preset")+d};if(51===d)return void j.tip("error","com.TempeAddMax");if(!s)return void j.tip("error","com.AddPresetBeforeSave");q=a.extend(!0,{},g),1===a('ul[data-list="presets"] li').length?a('<li title="'+g.Name+'" value="'+g.Index+'">'+g.Name+"</li>").insertBefore(a('ul li[value="0"]')).click():a('<li title="'+g.Name+'" value="'+g.Index+'">'+g.Name+"</li>").insertAfter(a('ul li[value="'+(d-1)+'"]')).click(),s=!1}}if(void 0==j.$('[data-presetId="'+c+'"]').attr("data-global")){var h="";for(var m in i[n])-1!==m.indexOf("Scene")&&(h+=m);for(var o,f=0;t>=f&&(o=0===f?"Scene":"Scene"+f,-1!==h.indexOf(o));f++);var p=o.replace("Scene","CalibrateArea");r?("TrafficPark"===webApp.SDTraficIntelType||"IntelliCityMgr"===webApp.SDTraficIntelType)&&(i[n][o]=jQuery.extend(!0,{},l.Scene1)):i[n][o]=jQuery.extend(!0,{},l.Scene),i[n][p]=null!==l.CalibrateArea?jQuery.extend(!0,{},l.CalibrateArea):null,i[n][o].PtzPresetId=c,j.addShe(o)}j.$('div[data-list="preset"]').removeClass("select")}}),k.on("click",function(b){if(k.data("heatmapPlan")!==!0){var c=a(b.target);switch(c.attr("data-for")){case"choose":j.onChooseIvs(c),j.checkDisable(c.parents("[data-global]"));break;case"del":j.delShe(c.parents("[data-global]").attr("data-global"))}}}),j.element.on("click",function(){j.$('div[data-list="preset"]').removeClass("select")}),j.$("a[data-css]").on("click",function(b){var c=a(b.target).attr("data-css"),d=a(b.target).parent().hasClass("alarmconfig-flashbtn-on");"on"==c&&d||"off"==c&&!d||("on"==c?(a(b.target).parent().addClass("alarmconfig-flashbtn-on"),k.addClass("heatmapPlan").data("heatmapPlan",!0),j.$('a[btn-for="selectPreset"]').addClass("ui-button-disabled"),j.$('div[data-cap="HeatNumber"]').removeClass("heatmapPlan"),j.$("#heatNumberWrap div[data-sch]").removeClass("disable").removeClass("select"),j.$('div[data-for="choose"]').addClass("disable"),j.addHeatmapGlobal()):(a(b.target).parent().removeClass("alarmconfig-flashbtn-on"),k.removeClass("heatmapPlan").data("heatmapPlan",!1),j.$('a[btn-for="selectPreset"]').removeClass("ui-button-disabled"),j.$('div[data-cap="HeatNumber"]').addClass("heatmapPlan"),j.delHeatmapGlobal(),j.$("#heatNumberWrap").find("div.select").removeClass("select"),j.$('div[data-for="choose"]').hasClass("select")?j.$("div[data-global]").find("div.select").removeClass("disable"):j.$('div[data-for="choose"]').removeClass("disable")))}),j.$("div[data-sch]").on("click",function(){j.$("div[data-cap]").hasClass("heatmapPlan")||(j.$("#heatNumberWrap div[data-sch]").hasClass("select")?(j.$("div[data-sch]:not(.select)").addClass("disable"),a(this).hasClass("select")&&(a(this).removeClass("select"),j.$("div[data-sch]:not(.select)").removeClass("disable")),j.delHeatmapGlobal()):(a(this).addClass("select"),j.$("div[data-sch]:not(.select)").addClass("disable")))})},addHeatmapGlobal:function(){type=j.$('div[data-cap="HeatNumber"] .select').attr("data-sch")||"HeatMap",type="HeatMap"==type?"HeatMapPlan":type;var a=["","HeatMapPlan","NumberStatPlan",null],b="Scene";for(var c in i[n])if(-1!==c.indexOf("Scene")&&0==i[n][c].PtzPresetId){b=c;break}var d=i[n][b];d.TypeList=d.TypeList||[],d.Type=d.Type||"",-1===a.indexOf(d.Type)&&d&&d.TypeList.push(d.Type),d.Type=type},delHeatmapGlobal:function(){for(var a in i[n])-1!==a.indexOf("Scene")&&"HeatMapPlan"==i[n][a].Type&&(i[n][a].TypeList=i[n][a].TypeList||[],i[n][a].Type=i[n][a].TypeList.length>0?i[n][a].TypeList.shift():"")},onChooseIvs:function(a){return!a.attr("data-sch")||a.hasClass("disable")?!1:void a.toggleClass("select")},initSheTemplate:function(b,c){var d;b=j.protocolChange(b);var e=i[n][c],g=j.$('[data-template="scheme"]').clone(),h=[];for(g.removeClass("fn-hide").removeAttr("data-template"),g.attr("data-global",c).attr("data-presetId",e.PtzPresetId),0==e.PtzPresetId&&g.addClass("fn-hide"),d=0;d<j.presets.length;d++)if(h.push(j.presets[d].Index),j.presets[d].Index==e.PtzPresetId){g.find("label").text(j.presets[d].Name);break}e.PtzPresetId&&a.inArray(e.PtzPresetId,h)<0&&(1e3==e.PtzPresetId&&r?(g.find("label").attr("t",tl("ivs.NonPresetManualIntel")).parent().translation(),g.find('i[data-for="del"]').remove(),"IntelliCityMgr"===webApp.SDTraficIntelType&&g.addClass("fn-hide")):g.find("label").attr("t",tl("ivs.Preset")+e.PtzPresetId).parent().translation());var l=g.find("ul");p=-1!==webApp.DeviceType.indexOf("TPC")&&f.chkAuthority("FireWarning")&&0===n;var m={Normal:webCaps.NewGlobalCamera?"ivs.DeepIVS":"ivs.IVSRule",FaceDetection:"appEventFaceDetection",SDFaceDetect:"appEventFaceDetection",NumberStat:"ivs.PtzNumberStat",NumberStatPlan:"ivs.PtzNumberStat",HeatMap:"HeatMap",HeatMapPlan:"HeatMap",Track:"Track",Traffic:"Traffic",VideoDiagnosis:"VideoDiagnosis",WideView:"WideView",Gate:"TrafficTollGate",FaceAnalysis:"FaceAnalysis",ObjectDetect:webCaps.NewGlobalCamera?"ivs.VideoStructrue":"ObjectDetect",StereoBehavior:"StereoBehavior",SmokeFire:"ivs.SmokeFire",ParkingSpace:"ivs.CarposManager",TrafficPark:"ivs.IllegalParkCapture",IntelliCityMgr:"ivs.IntelliCityMgr"};for(d=0;d<b.length;d++)d==b.length-1&&g.css("margin-bottom","35px"),l.append(webCaps.NewGlobalCamera?p&&"Normal"===b[d]?'<li><div data-for="choose" class="img '+b[d]+'" data-sch="'+b[d]+'"></div><span class= "notip tiplong" t="'+m[b[d]]+";title::"+m[b[d]]+'"></span></li>':"ObjectDetect"===b[d]?'<li><div data-for="choose" class="img ObjectDetect1" data-sch="'+b[d]+'"></div><span class= "notip" t="'+m[b[d]]+";title::"+m[b[d]]+'"></span></li>':'<li><div data-for="choose" class="img '+b[d]+'" data-sch="'+b[d]+'"></div><span class= "notip" t="'+m[b[d]]+";title::"+m[b[d]]+'"></span></li>':p&&"Normal"===b[d]?'<li><div data-for="choose" class="img '+b[d]+'" data-sch="'+b[d]+'"></div><span class= "tip tiplong" t="'+m[b[d]]+";title::"+m[b[d]]+'"></span></li>':'<li><div data-for="choose" class="img '+b[d]+'" data-sch="'+b[d]+'"></div><span class= "tip" t="'+m[b[d]]+";title::"+m[b[d]]+'"></span></li>');l.translation(),g.appendTo(k)},renderShe:function(b){var c=i[n][b],d=j.$('[data-global="'+b+'"]'),e=jQuery.extend(!0,[],c.TypeList);c.Type&&e.push(c.Type),d.find("[data-sch]").removeClass("select").removeClass("disable"),e=j.protocolChange(e),a.each(e,function(a,b){b&&d.find("[data-sch="+b+"]").addClass("select")}),j.checkDisable(d)},checkDisable:function(b){var c=[],d=b.find(".select");a.each(d,function(b,d){c.push(a(d).attr("data-sch"))});for(var e=[],f=0;f<h.length;f++)j.arrInclude(h[f],c)&&(e=e.concat(h[f]));a.each(g,function(c,d){-1===a.inArray(d,e)?b.find('[data-sch="'+d+'"]').addClass("disable"):b.find('[data-sch="'+d+'"]').removeClass("disable")})},arrInclude:function(b,c){var d=!0;return a.each(c,function(c,e){-1===a.inArray(e,b)&&(d=!1)}),d},addShe:function(a){n?j.initSheTemplate(m,a):j.initSheTemplate(g,a),j.renderShe(a)},delShe:function(a){var b=j.$("[data-global="+a+"]");b.remove();var c=a.replace("Scene","CalibrateArea");delete i[n][a],delete i[n][c]},saveShe:function(b){var c={Type:"",TypeList:[]},d=[],e=j.$("#heatNumberWrap").find("div.select");return 0===e.length&&(e=j.$("[data-global="+b+"] .select")),0!==e.length&&(a.each(e,function(b,c){d.push(a(c).attr("data-sch"))}),d=j.protocolChange(d,!0),c.Type=d.shift(),c.TypeList=0!==d.length?d:[]),c},selectPreset:function(a){return k.data("heatmapPlan")!==!0?(j.$(a.currentTarget).parent().addClass("select"),!1):void 0},renderElement:function(){if(k.empty(),-1!==webApp.DeviceType.indexOf("TPC")&&(k.css("height","0px"),setTimeout(function(){k.css("height","auto")},100)),null==i[n])return void(i[n]={});var b=!1,c=["HeatMapPlan","NumberStatPlan"],d="",e=[];for(var f in i[n])e.push(f);for(var g=a.grep(e,function(a){return-1!==a.indexOf("Scene")}),h=0;h<g.length;h++)0===h?(j.addShe("Scene"),-1!==c.indexOf(i[n].Scene.Type)&&(d=i[n].Scene.Type,b=!0)):(j.addShe("Scene"+h),-1!==c.indexOf(i[n]["Scene"+h].Type)&&(d=i[n]["Scene"+h].Type,b=!0));"HeatMapPlan"==d?d="HeatMap":"NumberStatPlan"==d&&(d="NumberStatPlan"),j.$('div[data-list="preset"]').removeClass("select"),j.$("#heatNumberWrap div[data-sch]").addClass("disable"),j.$('div[data-sch="'+d+'"]').removeClass("disable").addClass("select"),b?(j.$("#iss_sd_heat").addClass("alarmconfig-flashbtn-on"),k.addClass("heatmapPlan").data("heatmapPlan",!0),j.$("#iss_sd_heatNumber").addClass("alarmconfig-flashbtn-on"),j.$('div[data-cap="HeatNumber"]').removeClass("heatmapPlan"),j.$('a[btn-for="selectPreset"]').addClass("ui-button-disabled")):(j.$("#iss_sd_heat").removeClass("alarmconfig-flashbtn-on"),k.removeClass("heatmapPlan").data("heatmapPlan",!1),j.$("#iss_sd_heatNumber").removeClass("alarmconfig-flashbtn-on"),j.$('div[data-cap="HeatNumber"]').addClass("heatmapPlan"),j.$('a[btn-for="selectPreset"]').removeClass("ui-button-disabled"))},saveElement:function(){r&&(e.PTZ.setPreset(q.Index,q.Name),q="",s=!0);var a,b=!1;if(!j.$("#heatNumberWrap").hasClass("fn-hide"))for(var c in i[n])-1!==c.indexOf("Scene")&&(i[n][c].Type="",i[n][c].TypeList=[]);if(0!==j.$("#heatNumberWrap").find("div.select").length)a=j.saveShe(c),i[n].Scene.Type=a.Type,i[n].Scene.TypeList=a.TypeList,b=!0;else for(var c in i[n])-1!==c.indexOf("Scene")&&(a=j.saveShe(c),0!==i[n][c].PtzPresetId&&(i[n][c].Type=a.Type,i[n][c].TypeList=a.TypeList),b=!0);b||(i[n]=null)},checkTable:function(b){for(var c,d,e,f,g=a.extend(!0,{},{}),h=k.children("div[data-global]"),i=["Scene","CalibrateArea","TimePeriod"],l=0;l<h.length;l++)c="Scene"+(0===l?"":l),d=j.$(h[l]).attr("data-global"),a.each(i,function(h,i){switch(e=c.replace("Scene",i),f=d.replace("Scene",i),a.type(b[f])){case"null":g[e]=null;break;case"undefined":break;case"array":g[e]=a.extend(!0,[],b[f]);break;default:g[e]=a.extend(!0,{},b[f])}}),j.$(h[l]).attr("data-global",c);return g},onDefault:function(){e.ConfigManager.getDefault("VideoAnalyseGlobal").done(function(a){i=a,j.renderElement(),j.tip("success","com.DefaultSuccessTip")}).fail(function(){j.tip("error","com.DefaultfailureTip")})},onRefresh:function(a){e.ConfigManager.getConfig("VideoAnalyseGlobal").done(function(b){i=b,j.renderElement(),a!==!1&&j.tip("success","com.OperateSuccessTip")}).fail(function(){j.tip("error","com.OperateFailTip")})},onSave:function(){j.saveElement(),i[n]=j.checkTable(i[n]),e.ConfigManager.setConfig("VideoAnalyseGlobal",i).done(function(){j.tip("success","com.SaveSuccessTip"),null==i[n]&&(i[n]={})}).fail(function(){for(var b in i[n])if(b.indexOf("Scene")>-1&&a.inArray(i[n][b].Type,w)>-1){v=!0;break}v&&u?j.tip("warning","ivs.IntellStableConflict"):j.tip("error","com.SaveConfigFailTip")})},leave:function(){s=!0,e.DevIntelliTracker.start()}})}),define("iss_plan",function(require,b,c){{var d=require("jsCore/pageBase"),e=require("jsCore/rpc");require("jsCore/rpcLogin")}require("widget/js/dui.schedule"),require("widget/js/dui.timefield");var f,g,h=null,j=null,k=null,l=null,m=null,n=null,o=!0,p={Duration:600,PresetID:1,Speed:7},q={TourPlan:[[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}],[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}],[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}],[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}],[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}],[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}],[{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]},{TimeSection:"1 00:00:00-00:00:00",TourPath:[]}]]},r=[{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"},{BeginTime:"00:00",EndTime:"00:00"}],s=[[],[],[],[],[],[],[]],t=[],u=null,v=null,w=[],x=[],y={};c.exports=d.extend({init:function(){n=this,webApp.IsSDTraficIntel&&n.$("#iss_PriorMode_Select").parent().removeClass("fn-hide"),n.$("#schedule_iss_plan_canvas").schedule({holiday:!1,type:["general"]}),n.$("#schedule_iss_plan_canvas").off("mousedown"),n.$("#schedule_iss_plan_canvas").css("cursor","default"),m=a("#iss_plan_Setting_dialog").dialog({close:function(){},confirm:function(a,b){b.ui.close();for(var c=[],d=0;d<x.length;d++){var e={};e.Duration=x[d].Duration-0,e.PresetID=x[d].PresetID-0,e.Speed=x[d].Speed-0,c.push(e)}t[g][f].TourPath=c}}).detach().appendTo(document.body),n.$("#iss_PriorMode_IdleTime").numberfield({min:10,max:3600,allowDecimal:!1,allowNegative:!1}),n.$("#iss_PriorMode_SceneChange").numberfield({min:15,max:600,allowDecimal:!1,allowNegative:!1}),n.bind(),n.render()},render:function(){n._getConfig(!1)},leave:function(){e.DevIntelliTracker.start(),y={}},bind:function(){n.$("#iss_plan_nav li").on("click",n._navChange),n.$("#iss_plan_input_dayall").on("click",n._inputAllDay),n.$("#iss_plan_copyConfig").on("click",n._copyConfig),n.$("#iss_plan_clear").on("click",n._allconfigReset),a("#iss_plan_add_item").on("click",n._addItem)},_navChange:function(b){if(!a(b.target).hasClass("ui-table-tab-current")){n.$("#iss_plan_nav li").removeClass("ui-table-tab-current"),a(b.target).addClass("ui-table-tab-current");var c=a(b.target).attr("data-li");g=c,n.$("#iss_plan_weeks input").attr("disabled",!1),n.$("#iss_plan_day"+c).attr("disabled",!0),n.$("#iss_plan_weeks input").prop("checked",!1),n.$("#iss_plan_day"+c).prop("checked",!0),n.$("#iss_plan_input_dayall").prop("checked",!1),u=t[c],n._dataRenderNavChange()}},_dataRenderNavChange:function(){for(var b=[],c=0;16>c;c++)b=n._dataChangeTI(u[c].TimeSection),a("#iss_plan_start"+(c+1)).timefield("value",b[0]),a("#iss_plan_end"+(c+1)).timefield("value",b[1])},_dataChangeTI:function(a){var b=[];return b[0]=a.substr(2,8),b[1]=a.substr(11),b},_inputAllDay:function(){if(n.$("#iss_plan_input_dayall").prop("checked"))for(i=0;i<7;i++)n.$("#iss_plan_day"+i).prop("checked",!0);else for(i=0;i<7;i++)n.$("#iss_plan_day"+i).prop("checked",!1)},_copyConfig:function(){for(var b=-1,c=[],d=n.$("#iss_plan_nav li").length,e=0;d>e;e++)if(a(n.$("#iss_plan_nav li")[e]).hasClass("ui-table-tab-current")){b=e;break}for(var e=0;7>e;e++)a("#iss_plan_day"+e).prop("checked")&&c.push(e);for(var e=0;e<c.length;e++)t[c[e]]=a.extend(!0,[],t[b]);n._schduleRender(),n.tip("success","com.CopySetSuccessAndSaveTip")},_allconfigReset:function(){t=a.extend(!0,[],q.TourPlan);for(var b=-1,c=n.$("#iss_plan_nav li").length,d=0;c>d;d++)if(a(n.$("#iss_plan_nav li")[d]).hasClass("ui-table-tab-current")){b=d;break}b>-1&&(u=t[b],n._dataRenderNavChange(),n._schduleRender()),n.tip("success","com.ClearAllsuccessTip")},_schduleRender:function(){for(var a=0;7>a;a++)for(var b=0;16>b;b++)s[a][b]=t[a][b].TimeSection;n.$("#schedule_iss_plan_canvas").schedule("render",s)},_initTable:function(){k=n.$("#plan_table").table({pageable:!1,height:220,columns:[{t:"ivs.AutoTour",width:"15%",render:function(a){return a._index+1}},{t:"com.BeginTime:",width:"15%",fields:"BeginTime",render:function(b){return a('<div class="iss-plan-timefield" id="iss_plan_start'+(b._index+1)+'"></div>')}},{t:"com.EndTime:",width:"15%",fields:"EndTime",render:function(b){return a('<div class="iss-plan-timefield" id="iss_plan_end'+(b._index+1)+'"></div>')}},{t:"ivs.TourSenceSet",width:"40%",action:"advance",icon:"i-advence",handle:function(b){f=b._index,m.dialog("show");for(var c=-1,d=n.$("#iss_plan_nav li").length,e=0;d>e;e++)if(a(n.$("#iss_plan_nav li")[e]).hasClass("ui-table-tab-current")){c=e,g=e;break}var h=b._index;n._dialogRenderDom(c,h)}},{t:"com.Delete",width:"15%",action:"delete",icon:"i-del",handle:function(b){a("#iss_plan_start"+(b._index+1)).timefield("value","00:00:00"),a("#iss_plan_end"+(b._index+1)).timefield("value","00:00:00"),t[g][b._index].TimeSection="1 00:00:00-00:00:00",n._schduleRender()}}],onRowSelect:function(){}}),l=a("#plan_Setting_dialog_table").table({pageable:!1,height:250,pressEnter:!1,columns:[{t:"ivs.TourOrder",width:"10%",render:function(a){return a._index+1}},{t:"ivs.Preset",width:"25%",fields:"PresetID",valueMap:y,editor:function(b,c){var d="",e=c.valueMap;if(e){d='<select style="overflow-wrap:initial">';for(var f in e)d+='<option value="'+f+'">'+e[f]+"</option>";d+="</select>"}return a(d)}},{t:"ivs.Duration",width:"30%",fields:"Duration",editor:function(){return a('<input type="text" class="u-input"/>').numberfield({min:30,max:900,allowDecimal:!1,allowNegative:!1})}},{t:"ivs.OrderPriority",width:"12.5%",action:"up",icon:"ui-set-icon-up",handle:function(a){n._dialogChangeDom("up",a._index)}},{t:"ivs.OrderPriority",width:"12.5%",action:"down",icon:"ui-set-icon-down",handle:function(a){n._dialogChangeDom("down",a._index)}},{t:"com.Delete",width:"10%",action:"delete",icon:"i-del",handle:function(a){this.del(a)}}]})},_dialogChangeDom:function(a,b){if("up"===a){if(0!==b){var c=x.splice(b,1);x.splice(b-1,0,c[0])}}else if("down"===a&&b!==x.length-1){var c=x.splice(b,1);x.splice(b+1,0,c[0])}l.table("dataSource",x)},_dialogRenderDom:function(b,c){u=t[b],v=u[c],w=v.TourPath,x=a.extend(!0,[],w),l.table("dataSource",x)},IssPriorModeSelect:function(b){"Tour"==a(b.target).val()||"Detect"==a(b.target).val()?("Tour"==a(b.target).val()?("TrafficPark"===webApp.SDTraficIntelType?n.$("#iss_PriorMode_Select_tip").attr("t","ivs.PriorModeTip").parent().translation():"IntelliCityMgr"===webApp.SDTraficIntelType&&n.$("#iss_PriorMode_Select_tip").attr("t","ivs.PriorModeTipOther").parent().translation(),n.$("#iss_PriorMode_Select_tip").removeClass("fn-hide")):"Detect"==a(b.target).val()&&n.$("#iss_PriorMode_Select_tip").addClass("fn-hide"),n.$("#iss_PriorMode_SceneChange_wrap").removeClass("fn-hide")):(n.$("#iss_PriorMode_Select_tip").addClass("fn-hide"),n.$("#iss_PriorMode_SceneChange_wrap").addClass("fn-hide"))
},onRefresh:function(){n._getConfig(!0)},_getConfig:function(b){a.when(e.ConfigManager.getConfig(["IntelliTour","VideoAnalyseGlobal"]),e.PTZ.getPresets()).done(function(c,d){h=c[0].params.table,j=c[1].params.table[0];var e=[];d&&a.each(d,function(a,b){return 0===b.Index||1e3===b.Index?!0:void e.push(b.Index)});for(var f=0;f<e.length;f++)y[e[f]]=tl("ivs.Preset")+e[f];n._initTable(),n.renderElements(h),b&&n.tip("success","com.OperateSuccessTip")}).fail(function(){n.tip("error","com.OperateFailTip")})},renderElements:function(b){k.table("dataSource",r),a('[id^="iss_plan_start"]').timefield({showS:!1,supportShow24:!0,change:n._startTimeChange}),a('[id^="iss_plan_end"]').timefield({showS:!1,supportShow24:!0,change:n._endTimeChange}),n.$("#planStartUsing").prop("checked",b[0].Enable),n.$("#iss_PriorMode_Select").val(b[0].TourPriMode).change(),n.$("#iss_PriorMode_IdleTime").val(b[0].IdleWaitingTime),n.$("#iss_PriorMode_SceneChange").val(b[0].SceneSwitchingTime),t=b[0].TourPlan;for(var c=-1,d=n.$("#iss_plan_nav li").length,e=0;d>e;e++)if(a(n.$("#iss_plan_nav li")[e]).hasClass("ui-table-tab-current")){c=e,g=c;break}c>-1&&(u=t[c],n._dataRenderNavChange(),n._schduleRender())},_addItem:function(){var b=l.table("dataSource").length;if(50===b)return void a("#ie_dialog_tip").tip("error",tl("com.TempeAddMax"));var c=a.extend(!0,{},p);l.table("add",c,b).table("selectRow",b)},_startTimeChange:function(b){var c=a(b.target).timefield("value"),d=a(b.target)[0].id.slice(14)-1;return c>a("#iss_plan_end"+(d+1)).timefield("value")?(o=!1,void n.tip("error","com.BeginTLessOrEqualThanEndTTip")):(o=!0,u[d].TimeSection="1 "+c+"-"+a("#iss_plan_end"+(d+1)).timefield("value"),void n._schduleRender())},_endTimeChange:function(b){var c=a(b.target).timefield("value"),d=a(b.target)[0].id.slice(12)-1;return a("#iss_plan_start"+(d+1)).timefield("value")>c?(o=!1,void n.tip("error","com.BeginTLessOrEqualThanEndTTip")):(o=!0,u[d].TimeSection="1 "+a("#iss_plan_start"+(d+1)).timefield("value")+"-"+c,void n._schduleRender())},onConfirm:function(){return o?(h[0].Enable=n.$("#planStartUsing").prop("checked"),h[0].TourPriMode=n.$("#iss_PriorMode_Select").val(),h[0].IdleWaitingTime=n.$("#iss_PriorMode_IdleTime").val()-0,h[0].SceneSwitchingTime=n.$("#iss_PriorMode_SceneChange").val()-0,h[0].TourPlan=t,void e.ConfigManager.setConfig("IntelliTour",h).done(function(){n.tip("success","com.SaveSuccessTip")}).fail(function(){n.tip("error","com.SaveConfigFailTip")})):void n.tip("error","com.BeginTLessOrEqualThanEndTTip")}})})}(jQuery);