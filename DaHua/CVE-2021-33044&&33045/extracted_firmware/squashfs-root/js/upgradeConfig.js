!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("upg_upgrade",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("jsCore/ability"),g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=!1,p=null;c.exports=d.extend({init:function(){g=this,h=g.$("#upg_upgrade"),i=g.$("#upg_path"),j=g.$("#upg_import"),k=g.$("#upg_probar"),l=g.$("#upg_process"),m=g.$("#upg_updating"),n=g.$("#upg_update"),h.on("change blur",g._onUpgradeChange),h.hover(function(){j.addClass("ui-button-hover")},function(){j.removeClass("ui-button-hover")}),f.get("CameraUpdatePowerOff").done(function(a){a&&a.Support&&(o=!0)}),g.render()},render:function(){window.downSucceed=function(){g._getStatus()},i.val("")},onSelectFile:function(){h.trigger("click")},_onUpgradeChange:function(){var b=a(this).val().split("\\");i.val(b[b.length-1])},onUpdate:function(){var a=h.val();""!==i.val()&&(a.test(".bin","i")?(g.disabled(n,!0),g.$("#upg_submit").trigger("click"),k.css("visibility","visible"),l.css("width","25px"),p=o&&a.test("packet","i")?tl("com.RebootingTip")+tl("com.ChipProgrmmaPowerOffTop"):tl("com.RebootingTip")):g.$(".u-tip").tip("warning",tl("com.WrongFileUpgradeTip")))},_getStatus:function(){e.Upgrader.getState().done(function(a){g._getStatusSuccess(a)}).fail(function(a){g._getStatusFails(a)})},_getStatusSuccess:function(a){switch(a.State){case"Invalid":g._upgradeFails("com.BadFiletoRebootTip");break;case"Failed":case"NotEnoughMemory":case"Cancelled":case"OEMNotCompare":g._upgradeFails("com.UpgradeFailedTip");break;case"FileUnmatch":g._upgradeFails("com.FileUnmatchTip");break;case"Noupgrade":g._upgradeFails("sys.Noupgrade");break;case"DownloadFailed":g._upgradeFails("sys.CloudUpgStateDownloadFailed");break;case"UnmatchVersion":g._uncatchVersion();break;default:g._upgrading(a.Progress)}},_getStatusFails:function(a){a.result===!1?(g.$(".u-tip").tip("warning",tl("com.OperateFailTip")),g.disabled(n,!1),k.css("visibility","hidden")):(l.css("width","255px"),m.text(tl("com.RebootingTip")),window.setTimeout(g._locationToIndex,2e4))},_uncatchVersion:function(){g.disabled(n,!1),k.css("visibility","hidden"),a.confirm(tl("com.Reboot"),tl("com.UpdatePackageLower"),function(){webApp.reboot("com.ConfEffectRestartTip",!0)})},_upgradeFails:function(a){g.disabled(n,!1),k.css("visibility","hidden"),webApp.reboot(a,!0)},_upgrading:function(a){10>a&&(a=10),l.css("width",255*a/100+"px"),100==a?(m.text(p),window.setTimeout(g._locationToIndex,2e4)):window.setTimeout(g._getStatus,1e3)},_locationToIndex:function(){a(window).unbind("unload"),a(window).unbind("beforeunload"),plugin.Reload()}})})}(jQuery);