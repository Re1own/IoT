!function(a){define(function(require,b,c){function d(){e(),"Original Rate"===webApp.DisplayMode&&setTimeout(e,100)}function e(){var a=10,b=l.$(".main-right-container").width()||-10,c=l.$(".main-bottom").width(),d=l.$(".main-right-container").parent(),e=c-a-b,f=Math.max(document.documentElement.clientHeight-56-54-33,390),i=webApp.DisplayMode;switch(o.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode&&(i="sys.AdaptedWindow"),o.videoBar("hasItem","video_fisheye")&&"Original Rate"==webApp.DisplayMode&&(i="sys.AdaptedWindow"),i){case"Original Size":webApp.resolution.x&&webApp.resolution.y&&("nacl"!==g.type||e>=webApp.resolution.x)&&(e=webApp.resolution.x,f=webApp.resolution.y),d.css({width:e+a+b,margin:"0 auto"});break;default:d.css({width:c,margin:"0"})}return n.css({width:e,height:f,background:"inherit"}),o.css("width",e),webApp.hide_by_dialog||("flash"===webApp.playMode?(j.cover(n),"flash"===webApp.playMode&&h.cover(n,webApp.resolution.x+"*"+webApp.resolution.y)):g.cover(n)),!1}var f=require("jsCore/rpc"),g=require("jsCore/plugin"),h=require("jsCore/pluginCanvas"),i=(require("jsCore/ability"),require("common/common").Cookie,require("jsCore/rpcLogin")),j=require("jsCore/flashplayer"),k=require("jsCore/pageBase");require("jsCore/modules/ptzControl"),require("jsCore/modules/ptzSetting"),require("jsCore/modules/zoomFocus"),require("jsCore/modules/videoBar");var l=null,m=".ptz",n=null,o=null,p=null;c.exports=k.extend({init:function(){l=this,n=l.$(".main-video"),o=l.$(".ui-video-bar").videoBar();var b={ptzJoystick:-1!==webApp.DeviceType.indexOf("SD")?!0:!1};-1!==webApp.DeviceType.indexOf("TPC")&&a.extend(b,{isPtzLocate:-1!==webApp.DeviceType.indexOf("SD")?!0:!1,channel:g.windowId,ptzJoystick:!1,autoFocus:!1,isLaserDistMeasure:!1}),p=l.$(".main-ptz-control").ptzControl(b),-1!==webApp.DeviceType.indexOf("TPC")&&p.ptzControl("changeChannel",g.windowId),l.$(".main-ptz-setting").ptzSetting(),l.$(".main-zoom-focus").zoomFocus("flash"===webApp.playMode?{type:"preview",noPlugin:!0}:{type:"preview"}),l.render()},render:function(){a(window).off("resize"+m),a(window).on("resize"+m,d),d(),"flash"===webApp.playMode?(j.cover(n),"flash"===webApp.playMode&&h.cover(n,webApp.resolution.x+"*"+webApp.resolution.y)):g.cover(n,function(b){g.SetModuleMode(0);var c=a(b?"a[btn-for=onConnectMain]":"a.current[btn-for^=onConnect]");a("a[btn-for^=onConnect]").removeClass("current"),c.click()}),l.$(".main-ptz-setting").ptzSetting("render");var b={showImage:!1,showTrigger:!1,showFace:!1,showTraffic:!1,showObject:!1,modeChange:d,zoomOn:function(){l.$(".main-zoom-focus").zoomFocus("render").show()},zoomOff:function(){l.$(".main-zoom-focus").zoomFocus("leave").hide()}};-1!==webApp.DeviceType.indexOf("TPC")&&a.extend(b,{showPtz:i.chkAuthority("MPTZ")&&webApp.HasPtz&&-1!==webApp.DeviceType.indexOf("SD"),showRayRight:!1,showTemperReport:!1,showWhRate:!1,showZoomFocus:!1,showOriginal:!1,showFluency:!1,showFullScreeny:!1,showAdjust:!1}),o.videoBar("render",b),o.videoBar("isCurrent","video_ivsRule",0)?g.SetIVSEnable(!0):o.videoBar("hasItem","video_triggerTrack")&&(g.SetIVSEnable(!0),g.ShowRuleState(!1)),o.videoBar("isCurrent","video_zoomFocus")?l.$(".main-zoom-focus").zoomFocus("render").show():l.$(".main-zoom-focus").zoomFocus("leave").hide(),"flash"===webApp.playMode&&(j.cover(n),j.playPreview(1,0),a("a.current[btn-for^=onConnect]").click(),l.$("div.ui-video-iconbar a").hide(),l.$("#video_zoomFocus").show(),f.ConfigManager.getConfig(["Encode","VideoImageControl"]).done(function(a){if(webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[1].params.table[0].Rotate90||2==a[1].params.table[0].Rotate90){var b;b=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=b}h.cover("#flashvideoplayer",webApp.resolution.x+"*"+webApp.resolution.y)})),g.addEvent("ResolutionChangePTZ",d),g.addEvent("DeviceReconnectedPTZ",function(){o.videoBar("isCurrent","video_ivsRule",0)&&g.SetIVSEnable(!0)}),g.addEvent("WndSwitch",function(a){g.windowId=a,webApp.CHANNEL_NUMBER>1&&p&&p.ptzControl("changeChannel",g.windowId)}),webApp.hideIVS===!0?l.$("#video_ivsRule").parent("div").hide():webApp.hideIVS===!1&&l.$("#video_ivsRule").parent("div").show()},leave:function(){a(window).off("resize"+m),o.videoBar("isCurrent","video_zoomFocus")&&l.$(".main-zoom-focus").zoomFocus("leave").hide(),g.SetIVSEnable(!1),g.hide(),g.close(),g.addEvent("ResolutionChangePTZ",null),g.addEvent("DeviceReconnectedPTZ",null),g.state("activePTZLocate")&&g.state("activePTZLocate",!1),"flash"===webApp.playMode&&(j.hide(),h.hide(),l.$("#ptz_locate").removeClass("current"))},destory:function(){a(window).off("resize"+m),o.videoBar("isCurrent","video_zoomFocus")&&l.$(".main-zoom-focus").zoomFocus("leave").hide(),o.videoBar("destroy")}})})}(jQuery);