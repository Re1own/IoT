!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("PPPoE",function(require,b,c){var d,e,f,g,h,i,j,k,l,m=require("jsCore/rpc"),n=require("jsCore/pageBase"),o=require("common/common").Check,p=!1,q=null,r=m.NetApp.getDialInfo;c.exports=n.extend({init:function(){var b=this;d=b.$("#pppoe_enable"),e=b.$("#pppoe_username").textfield(),f=b.$("#pppoe_password").textfield(),q=b.$("[sel-for=onSelectCard]"),b.$("#pppoe_password").on("paste",function(){return!1}),g=a.validator([{element:e,check:[o.noQuotation,o.noQuotation],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip"],events:["keyup","blur"]},{element:f,check:[o.noQuotation,o.noQuotation],errorMsg:["com.NoInputMarksTip","com.NoInputMarksTip"],events:["keyup","blur"]}],function(a){a.parent().translation()}),a.when(m.NetApp.getNetInterfaces(),ability.get("MulNetwokrDial")).done(function(c,d){var e=a.grep(c,function(a){return"Normal"===a.Type});l=e[0].Name,d&&(p=!0,q.parent().removeClass("fn-hide"),r=m.PppoeCli.getPPPoEDialInfo,a.each(e,function(a,b){var c=b.Name.substr(b.Name.length-1)-0;q.append('<option value="ppp'+c+'">'+(tl("net.Lineate")+(c+1))+"</option>")})),b.render()})},render:function(){this._getConfig()},_getConfig:function(a){var b=this;m.ConfigManager.getConfig("PPPoE").done(function(c){h=c,b._renderElement(),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","com.OperateSuccessTip")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")})},_renderElement:function(){var a=this;p?q.val(h.DefaultPPPoEInterface).change():(i=h,d.prop("checked",i.Enable),e.textfield("value",i.UserName),f.textfield("value",i.Password)),g.validate(),a.$("#pppoe_ip").closest(".ui-form-item").hide(),clearInterval(j),i.Enable&&(k&&l?a._getRegistedIP(l):j=setInterval(function(){a._getRegistedIP(l)},5e3))},_getRegistedIP:function(a){var b=this;r(a).done(function(a){a&&a.IPAddress&&(k=!0,b.$("#pppoe_ip").text(a.IPAddress).closest(".ui-form-item").show(),clearInterval(j))})},onSelectCard:function(a){var b=this,c=b.$(a.target).val(),j=c.substr(c.length-1);if(l="eth"+j,!a.isTrigger){if(g.isInvalid())return b.tip("warning",g.errors()[0].errorMsg);i.Enable=d.prop("checked"),i.UserName=e.textfield("value"),i.Password=f.textfield("value"),b.$("#pppoe_ip").closest(".ui-form-item").hide()}i="ppp0"===c?h:h["PPPOE"+j],d.prop("checked",i.Enable),e.textfield("value",i.UserName),f.textfield("value",i.Password),b.disabled("input",c!==h.DefaultPPPoEInterface)},onSave:function(){var b=this,c=a.Deferred();return g.isInvalid()?b.tip("warning",g.errors()[0].errorMsg):(p?m.ConfigManager.getConfig("PPPoE").done(function(a){c.resolve(a.DefaultPPPoEInterface===h.DefaultPPPoEInterface)}):c.resolve(!0),c.done(function(a){a?(i.Enable=d.prop("checked"),i.UserName=e.textfield("value"),i.Password=f.textfield("value"),m.ConfigManager.setConfig("PPPoE",h).done(function(){b._getConfig(),b.tip("success","com.SaveSuccessTip")}).fail(function(){b.tip("error","com.SaveConfigFailTip")})):b._getConfig()}),!1)},onRefresh:function(){var a=this;return a._getConfig(!0),!1},onDefault:function(){var a=this;return m.ConfigManager.getDefault("PPPoE").done(function(b){if(h.DefaultPPPoEInterface){var c=b;c.DefaultPPPoEInterface=h.DefaultPPPoEInterface,h=c}else h=b;a._renderElement(),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")}),!1}})})}(jQuery);