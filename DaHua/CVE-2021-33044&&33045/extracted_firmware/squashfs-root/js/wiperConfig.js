!function(a){define(function(require,b,c){var d=require("jsCore/rpcLogin");c.exports=require("jsCore/pageTab"),c.exports.prototype.wiper_config=function(){return ability.get("RainBrushControl").then(function(a){return d.chkAuthority("RainBrushConfig")&&a&&a.Support})},c.exports.prototype.heater_config=function(){return ability.get("PTZCaps").then(function(a){return d.chkAuthority("RainBrushConfig")&&-1===webApp.DeviceType.indexOf("TPC")&&!!(a&&a.PtzHeater&&a.PtzHeater.Support)})},c.exports.prototype.fan_config=function(){return ability.get("PTZCaps").then(function(a){return d.chkAuthority("RainBrushConfig")&&-1===webApp.DeviceType.indexOf("TPC")&&!!(a&&a.PtzFan&&a.PtzFan.Support)})},c.exports.prototype.comm_config=function(){return a.when(ability.get("IsProtectCover"),ability.get("SupportPtzFunction")).then(function(b,c){return c||a("[data-for=comm_config]").attr("t","per.PtzSetting").html(tl("per.PtzSetting")),(c&&d.chkAuthority("ComConf")||!c&&d.chkAuthority("PtzConfig"))&&b})},c.exports.prototype.brush_config=function(){return ability.get("IsProtectCover").then(function(a){return d.chkAuthority("RainBrushConfig")&&a})},c.exports.prototype.light_config=function(){return ability.get("IsProtectCover").then(function(a){return d.chkAuthority("RainBrushConfig")&&a})},c.exports.prototype.lora_config=ability.get("WireLessLora").then(function(a){return d.chkAuthority("RainBrushConfig")&&a&&a.Support}),c.exports.prototype.ClearFrostHeater_config=function(){return ability.get("PTZCaps").then(function(a){return d.chkAuthority("RainBrushConfig")&&-1===webApp.DeviceType.indexOf("TPC")&&!!a&&a.ClearFrostHeater&&a.ClearFrostHeater.Support})}}),define("wiper_config",function(require,b,c){var d=require("jsCore/rpc"),e=require("common/common"),f=require("jsCore/pageBase"),g=null,h=null,i=null,j=null;c.exports=f.extend({init:function(){g=this,g.$("#wiper_interval").numberfield({max:255,min:0,allowDecimal:!1,allowNegative:!1}),g.$("#wiper_maxRunTime").numberfield({max:1440,min:10,allowDecimal:!1,allowNegative:!1}),g.$("#wiper_time_begin").timefield(),g.$("#wiper_time_end").timefield(),-1!==webApp.DeviceType.indexOf("TPC")?(a.when(ability.get("LensControl"),ability.get("LensControlMix")).then(function(a,b){a&&a.Support||b&&b.Support?g.$("#wiper_sensitivity").slider({min:0,max:10,complete:function(a,b){h[0].Sensitivity=b.value-0}}):g.$("#wiper_sensitivity_wrap").remove()}),ability.get("RainBrushControl").then(function(a){j=a})):-1!==webApp.DeviceType.indexOf("SD")&&ability.get("PTZCaps").then(function(a){0===webApp.DeviceType.indexOf("SD")&&a&&a.RainBrushControl&&a.RainBrushControl.Support&&(j=a.RainBrushControl)}),g.render(),g.modelSelect()},modelSelect:function(){if(null!==j&&j.BrushMode){var a={Manual:"med.Manual",Timing:"ivs.Timing",Auto:"com.Auto"},b="";j.BrushMode.forEach(function(c){b+="<option value='"+c+"' t='"+tl(a[c])+"'>"+tl(a[c])+"</option>"}),g.$('[sel-for="onModeChange"]').empty().append(b)}},render:function(a){d.ConfigManager.getConfig(["RainBrushMode","RainBrush"]).done(function(b){h=b[0].params.table,i=b[1].params.table,g._renderElements(),a&&g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})},_renderElements:function(){g.$("[sel-for=onModeChange]").val(h[0].Mode).change(),g.$("#wiper_interval").numberfield("value",i.Interval),g.$("#wiper_enable").prop("checked",i.Enable);var a=i.TimeSchedule[0][0].split(" ")[1].split("-");g.$("#wiper_time_begin").timefield("value",a[0]),g.$("#wiper_time_end").timefield("value",a[1]),h[0]&&h[0].Sensitivity&&g.$("#wiper_sensitivity").slider("value",h[0].Sensitivity),g.$("#wiper_maxRunTimeEnable").prop("checked",i.ProtectEnable),g.$("#wiper_maxRunTime").numberfield("value",i.ProtectTime)},onModeChange:function(a){var b=g.$(a.target).val();"Manual"===b?(g.$("#wiper_timeCross_wrap,#wiper_config_wrap,#wiper_maxRunTime_wrap").show(),g.$("#wiper_time_wrap,#wiper_sensitivity_wrap,#wiper_rainfall_wrap").hide(),-1!==webApp.DeviceType.indexOf("TPC")&&(g.$("#wiper_control_wrap").show(),g.$("#wiper_config_wrap").hide(),g.onStop(!1))):"Timing"===b?(g.$("#wiper_timeCross_wrap,#wiper_time_wrap,#wiper_config_wrap").show(),g.$("#wiper_control_wrap,#wiper_sensitivity_wrap,#wiper_rainfall_wrap,#wiper_maxRunTime_wrap").hide()):"Auto"===b&&(-1!==webApp.DeviceType.indexOf("TPC")?g.$("#wiper_config_wrap,#wiper_sensitivity_wrap,#wiper_rainfall_wrap").show():g.$("#wiper_config_wrap,#wiper_sensitivity_wrap,#wiper_rainfall_wrap").hide(),g.$("#wiper_timeCross_wrap,#wiper_time_wrap,#wiper_control_wrap,#wiper_maxRunTime_wrap").hide()),-1!==webApp.DeviceType.indexOf("TPC")&&(g.$("#wiper_maxRunTime_wrap").hide(),g.$("#wiper_interval").prop("disabled",!1)),h[0].Mode=b,a.isTrigger||d.ConfigManager.setConfig("RainBrushMode",h).fail(function(){g.tip("error","com.SaveConfigFailTip")})},onDefault:function(){d.ConfigManager.getDefault(["RainBrushMode","RainBrush"]).done(function(a){h=a[0].params.table,i=a[1].params.table,g._renderElements(),g.tip("success","com.DefaultSuccessTip")}).fail(function(){g.tip("error","com.DefaultfailureTip")})},onRefresh:function(){g.render(!0)},onConfirm:function(a){i.Enable=g.$("#wiper_enable").prop("checked"),h[0].Mode=g.$("[sel-for=onModeChange]").val(),i.Interval=g.$("#wiper_interval").numberfield("value"),i.ProtectEnable=g.$("#wiper_maxRunTimeEnable").prop("checked"),i.ProtectTime=g.$("#wiper_maxRunTime").numberfield("value");var b=g.$("#wiper_time_begin").timefield("value").split(":"),c=g.$("#wiper_time_end").timefield("value").split(":"),f=3600*(b[0]-0)+60*(b[1]-0)+(b[2]-0),j=3600*(c[0]-0)+60*(c[1]-0)+(c[2]-0);if(f>=j)g.tip("error","com.BeginTLessThanEndTTip");else{for(var k=i.TimeSchedule[0][0].split(" "),l=k[0],m=l+" "+g.$("#wiper_time_begin").timefield("value")+"-"+g.$("#wiper_time_end").timefield("value"),n=0;7>n;n++)i.TimeSchedule[n][0]=m;d.ConfigManager.setConfig(["RainBrushMode","RainBrush"],[h,i]).done(function(b){e.chkMutilCallRet(b)?a&&g.tip("success","com.SaveSuccessTip"):a&&g.tip("error","com.SaveConfigFailTip")})}},onStart:function(){-1!==webApp.DeviceType.indexOf("TPC")&&(g.onConfirm(!1),g.$("#wiper_interval").prop("disabled",!0)),d.RainBrush.moveContinuously(g.$("#wiper_interval").numberfield("value")).done(function(){g.tip("success","com.OperateSuccessTip")}).fail(function(){-1!==webApp.DeviceType.indexOf("TPC")&&g.$("#wiper_interval").prop("disabled",!1),g.tip("error","com.OperateFailTip")})},onStop:function(a){d.RainBrush.stopMove().done(function(){a&&g.tip("success","com.OperateSuccessTip"),-1!==webApp.DeviceType.indexOf("TPC")&&g.$("#wiper_interval").prop("disabled",!1)}).fail(function(){g.tip("error","com.OperateFailTip")})},onOnce:function(){-1!==webApp.DeviceType.indexOf("TPC")&&g.onConfirm(!1),d.RainBrush.moveOnce().done(function(){g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})},onSelfCheck:function(){g.tip("warning",tl("com.LoadingTip"),-1),g.$("[sel-for=onModeChange],[btn-for]").prop("disabled",!0),d.RainBrush.rainfallSelfCheck().done(function(){g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")}).always(function(){g.$("[sel-for=onModeChange],[btn-for]").prop("disabled",!1)})}})}),define("heater_config",function(require,b,c){var d,e=require("jsCore/rpc"),f=require("jsCore/pageBase"),g=0;c.exports=f.extend({init:function(){var a=this;e.PTZ.getCurrentProtocolCaps().done(function(b){var c=b;a.$("#heater_on_temp").numberfield({max:c.PtzHeater.HeaterTempRange.LowRange[1]/10,min:c.PtzHeater.HeaterTempRange.LowRange[0]/10,allowDecimal:!1,allowNegative:!0}),a.$("#heater_on_temp").next("span").text("("+c.PtzHeater.HeaterTempRange.LowRange[0]/10+"~"+c.PtzHeater.HeaterTempRange.LowRange[1]/10+")"),a.$("#heater_shut_temp").numberfield({max:c.PtzHeater.HeaterTempRange.HighRange[1]/10,min:c.PtzHeater.HeaterTempRange.HighRange[0]/10,allowDecimal:!1,allowNegative:!1}),a.$("#heater_shut_temp").next("span").text("("+c.PtzHeater.HeaterTempRange.HighRange[0]/10+"~"+c.PtzHeater.HeaterTempRange.HighRange[1]/10+")")}),a.render()},render:function(){this._getConfig()},_getConfig:function(b){var c=this;e.ConfigManager.getConfig("PtzHeater").done(function(a){d=a,a?(c._renderElement(a),c.disabled(c.$("a[btn-for=onSave]"),!1),b&&c.tip("success","com.OperateSuccessTip")):(c.disabled(c.$("a[btn-for=onSave]"),!0),c.tip("error","com.OperateFailTip"))}).fail(function(){c.disabled(c.$("a[btn-for=onSave]"),!0),c.tip("error","com.OperateFailTip")}),e.ConfigManager.getConfig("PtzPowerLevel").done(function(b){"Saving"===b[0].Level?a("#heater_tip_remark").removeClass("fn-hide"):a("#heater_tip_remark").addClass("fn-hide")})},_renderElement:function(a){var b=this,c=a[g];b.$("[sel-for=onModeChange]").val(c.Mode).trigger("change"),b.$("#heater_manual_input").prop("checked",c.Enable),b.$("#heater_on_temp").numberfield("value",c.StartTemperature/10),b.$("#heater_shut_temp").numberfield("value",c.StopTemperature/10)},onModeChange:function(a){var b=this,c=b.$(a.target).val();return b.$("[mode]").hide(),b.$("[mode="+c+"]").show(),!1},onDefault:function(){var a=this;e.ConfigManager.getDefault("PtzHeater").done(function(b){d=b,a._renderElement(d),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.tip("error","com.DefaultfailureTip")})},onRefresh:function(){var a=this;a._getConfig(!0)},onSave:function(){var a=this;d[g].Enable=a.$("#heater_manual_input").prop("checked"),d[g].Mode=a.$('[sel-for="onModeChange"]').val(),d[g].StartTemperature=10*(a.$("#heater_on_temp").numberfield("value")-0),d[g].StopTemperature=10*(a.$("#heater_shut_temp").numberfield("value")-0),d[g].StopTemperature-d[g].StartTemperature<30?a.tip("error","com.StopTemStartTemTip"):e.ConfigManager.setConfig("PtzHeater",d).done(function(){a.tip("success","com.SaveSuccessTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")})}})}),define("fan_config",function(require,a,b){var c=require("jsCore/rpc"),d=require("jsCore/pageBase"),e=null,f=0,g=null;b.exports=d.extend({init:function(){e=this,ability.get("PTZCaps").then(function(a){a&&a.PtzFan&&a.PtzFan.ClearFog.Support&&e.$("#fan_clearFog_div").show()}),e.render(),e.bind()},bind:function(){e.$("#fan_clearFog").on("click",e.clearFog)},clearFog:function(){c.PtzPeripheral.clearFogStrongly(f).done(function(){e.tip("success","com.OperateSuccessTip")}).fail(function(){e.tip("error","com.OperateFailTip")})},render:function(){e._getConfig(!1)},_getConfig:function(a){c.ConfigManager.getConfig("PtzFan").done(function(b){g=b,e._renderElement(),a&&e.tip("success","com.OperateSuccessTip"),e.$("[btn-for=onConfirm]").disabled(!1)}).fail(function(){e.tip("error","com.OperateFailTip"),e.$("[btn-for=onConfirm]").disabled(!0)})},onTypeChange:function(a){e.$("#fan_manual_panel").toggle("Manual"===e.$(a.target).val())},_renderElement:function(){e.$("[sel-for=onTypeChange]").val(g[f].Mode).change(),e.$("#fan_manual_input").prop("checked",g[f].Enable)},onDefault:function(){c.ConfigManager.getDefault("PtzFan").done(function(a){g=a,e._renderElement(),e.tip("success","com.DefaultSuccessTip"),e.$("[btn-for=onConfirm]").disabled(!1)}).fail(function(){e.tip("error","com.DefaultfailureTip"),e.$("[btn-for=onConfirm]").disabled(!0)})},onRefresh:function(){e._getConfig(!0)},onConfirm:function(){g[f].Mode=e.$("[sel-for=onTypeChange]").val(),g[f].Enable=e.$("#fan_manual_input").prop("checked"),c.ConfigManager.setConfig("PtzFan",g).done(function(){e.tip("success","com.SaveSuccessTip")}).fail(function(){e.tip("error","com.SaveConfigFailTip")})}})}),define("comm_config",function(require,b,c){var d,e,f,g,h,i,j,k=require("jsCore/pageBase"),l=require("jsCore/rpc"),m=(require("common/common"),null),n=null,o=null,p="Ptz";c.exports=k.extend({init:function(){m=this,d=m.$("#ptz_protocol"),f=m.$("#ptz_baudrate"),g=m.$("#ptz_databit"),h=m.$("#ptz_stopbit"),i=m.$("#ptz_parity"),e=m.$("#ptz_addr").numberfield({min:0,max:255,allowDecimal:!1,allowNegative:!1}),o=-1!==webApp.DeviceType.indexOf("TPC")?l.PTZ.getProtocol().done(function(b){var c=b.RS;a.isArray(c)&&(d.empty(),a.each(c,function(a,b){d.append("<option value="+b+">"+tl(b)+"</option>")}))}):l.PTZ.getProtocolList().done(function(b){a.isArray(b)&&(d.empty(),a.each(b,function(a,b){d.append("<option value="+b+">"+tl(b)+"</option>")}))}),ability.get("SupportPtzFunction").done(function(a){a&&(p="Comm",d.parent().hide()),m.render()})},render:function(){this._getConfig()},_render:function(){if("Ptz"===p)j=n[0];else for(var b=0;b<n.length;b++)("485"===n[b].ProtocolName||"PTZ"===n[b].ProtocolName)&&(j=n[b]);o.done(function(b){-1!==webApp.DeviceType.indexOf("TPC")&&(b=b.RS),a.isArray(b)?-1!==a.inArray(j.ProtocolName,b)&&d.val(j.ProtocolName):d.html("<option value="+j.ProtocolName+">"+tl(j.ProtocolName)+"</option>").prop("disabled",!0)}),e.numberfield("value",j.Address),f.val(j.Attribute[0]),g.val(j.Attribute[1]),i.val(j.Attribute[2]),h.val(j.Attribute[3])},_getConfig:function(a){l.ConfigManager.getConfig(p).done(function(b){n=b,m._render(),a&&m.tip("success","com.OperateSuccessTip"),m.disabled("[btn-for=onSave]",!1)}).fail(function(){m.tip("error","com.OperateFailTip"),m.disabled("[btn-for=onSave]",!0)})},onSave:function(){return"Ptz"===p&&(j.ProtocolName=d.val()),j.Attribute[0]=f.val()-0,j.Attribute[1]=g.val()-0,j.Attribute[2]=i.val(),j.Attribute[3]=h.val(),j.Address=e.numberfield("value"),l.ConfigManager.setConfig(p,n).done(function(){m.tip("success","com.SaveSuccessTip")}).fail(function(){m.tip("error","com.SaveConfigFailTip")}),!1},onRefresh:function(){return this._getConfig(!0),!1},onDefault:function(){return l.ConfigManager.getDefault(p).done(function(a){n=a,m._render(),m.tip("success","com.DefaultSuccessTip"),m.disabled("[btn-for=onSave]",!1)}).fail(function(){m.tip("error","com.DefaultfailureTip"),m.disabled("[btn-for=onSave]",!0)}),!1}})}),define("light_config",function(require,b,c){var d,e,f,g=require("jsCore/rpc"),h=require("jsCore/pageBase"),i=require("jsCore/modules/timeSection"),j=require("jsCore/flashplayer"),k=require("jsCore/h5player"),l=null,m=0,n=0;c.exports=h.extend({init:function(){f=this,f.$("#light_slider").slider({icons:!0,min:1,max:255,complete:function(){f._saveData()}}),d=f.$("[sel-for=onSelectAutoMode]"),e=f.$("[sel-for=onSelectMode]"),f.render()},render:function(){f._getConfig(),"flash"===webApp.playMode?(j.cover("#light_video"),j.playPreview(1,0)):"h5"===webApp.playMode?k&&k.playPreview(1,0,a("#light_video")):plugin.cover("#light_video",function(){plugin.SetRegionNum(0),plugin.SetModuleMode(1),plugin.EnableVideoAnalyseModule(!0),plugin.open()})},_getConfig:function(a){g.ConfigManager.getConfig("DHRS").done(function(b){l=b,f._renderElements(),a&&f.$(".u-tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){f.$(".u-tip").tip("error",tl("com.OperateFailTip"))})},_renderElements:function(){for(var a=0;a<l.length;a++)if(l[a])for(var b=0;b<l[a].length;b++)l[a][b]&&"SteadyLight"===l[a][b].Type&&(m=a,n=b);e.val(l[m][n].Config.Mode),d.val(l[m][n].Config.AutoMode),f.$("#light_slider").slider("value",l[m][n].Config.Brightness),f.onSelectMode(!0)},_saveData:function(){l[m][n].Config.Mode=e.val(),l[m][n].Config.AutoMode=d.val(),l[m][n].Config.Brightness=f.$("#light_slider").slider("value")},onSelectMode:function(a){var b=f.$("[sel-for=onSelectMode]").val(),c=f.$("[sel-for=onSelectAutoMode]").val();return"Close"===b?(f.$("[sel-for=onSelectAutoMode]").parent("div").hide(),f.$("[btn-for=onSetPeriod]").parent("div").hide(),f.$("#light_slider").parent("div").hide()):"Auto"===b?(f.$("[sel-for=onSelectAutoMode]").parent("div").show(),f.$("#light_slider").parent("div").show(),"Timing"===c?f.$("[btn-for=onSetPeriod]").parent("div").show():"Brightness"===c&&f.$("[btn-for=onSetPeriod]").parent("div").hide()):"Open"===b&&(f.$("[sel-for=onSelectAutoMode]").parent("div").hide(),f.$("[btn-for=onSetPeriod]").parent("div").hide(),f.$("#light_slider").parent("div").show()),a===!0?!1:void f._saveData()},onSelectAutoMode:function(){var a=f.$("[sel-for=onSelectAutoMode]").val();"Timing"===a?f.$("[btn-for=onSetPeriod]").parent("div").show():"Brightness"===a&&f.$("[btn-for=onSetPeriod]").parent("div").hide(),f._saveData()},onSetPeriod:function(){l[m][n]&&l[m][n].Config&&l[m][n].Config.TimeSection&&(plugin.hide(),i.open(l[m][n].Config.TimeSection).done(function(b){l[m][n].Config.TimeSection=b,"flash"===webApp.playMode?(j.cover("#light_video"),j.playPreview(1,0)):"h5"===webApp.playMode?k.playPreview(1,0,a("#light_video")):plugin.cover("#light_video"),f._saveData()}).fail(function(){"flash"===webApp.playMode?(j.cover("#light_video"),j.playPreview(1,0)):"h5"===webApp.playMode?k.playPreview(1,0,a("#light_video")):plugin.cover("#light_video")}))},onRefresh:function(){f._getConfig(!0)},onDefault:function(){return g.ConfigManager.getDefault("DHRS").done(function(a){l[m][n]=a[m][n],f._renderElements(),f.$(".u-tip").tip("success",tl("com.DefaultSuccessTip"))}).fail(function(){f.$(".u-tip").tip("error",tl("com.DefaultfailureTip"))}),!1},onConfirm:function(){return f._saveData(),g.ConfigManager.setConfig("DHRS",l).done(function(){f.$(".u-tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){f.$(".u-tip").tip("error",tl("com.SaveConfigFailTip"))}),!1},leave:function(){plugin.hide(),plugin.close(),j&&j.hide(),k&&k.hide()}})}),define("brush_config",function(require,b,c){var d,e,f,g,h,i=require("jsCore/rpc"),j=require("jsCore/pageBase"),k=require("jsCore/flashplayer"),l=require("jsCore/h5player"),m=null,n=0,o=0,p=0;c.exports=j.extend({init:function(){h=this,d=h.$("#washing_interval").numberfield({min:0,max:255,allowDecimal:!1,allowNegative:!1}),e=h.$("[sel-for=onSelectDate]"),f=h.$("#washing_time").timefield({showS:!1}),g=h.$("#washing_enable").on("change",function(){var a=g.prop("checked")?!1:!0;e.prop("disabled",a),f.find("input").prop("disabled",a)}),h.render()},render:function(){h._getConfig(),"flash"===webApp.playMode?(k.cover("#washing_video"),k.playPreview(1,0)):"h5"===webApp.playMode?l&&l.playPreview(1,0,a("#washing_video")):plugin.cover("#washing_video",function(){plugin.SetRegionNum(0),plugin.SetModuleMode(1),plugin.EnableVideoAnalyseModule(!0),plugin.open()})},_getConfig:function(a){i.ConfigManager.getConfig("DHRS").done(function(b){m=b,h._renderElements(),a&&h.$(".u-tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){h.$(".u-tip").tip("error",tl("com.OperateFailTip"))})},_renderElements:function(){for(var a=0;a<m.length;a++)if(m[a])for(var b=0;b<m[a].length;b++)m[a][b]&&"RainBrush"===m[a][b].Type&&(n=a,o=b);d.numberfield("value",m[n][o].RainBrushConfig.Interval),g.prop("checked",m[n][o].RainBrushConfig.Wash.TimingEnable),e.val(m[n][o].RainBrushConfig.Wash.WashDay-0),f.timefield("value",m[n][o].RainBrushConfig.Wash.WashHour+":"+m[n][o].RainBrushConfig.Wash.WashMinute),g.trigger("change")},_saveData:function(){m[n][o].RainBrushConfig.Interval=d.numberfield("value"),m[n][o].RainBrushConfig.Wash.TimingEnable=g.prop("checked"),m[n][o].RainBrushConfig.Wash.WashDay=parseInt(e.val()),m[n][o].RainBrushConfig.Wash.WashHour=f.timefield("value").split(":")[0]-0,m[n][o].RainBrushConfig.Wash.WashMinute=f.timefield("value").split(":")[1]-0},onMoveContinuously:function(){var a=d.numberfield("value");i.RainBrush.moveContinuously(a,p)},onStopMove:function(){i.RainBrush.stopMove(p)},onMoveOnce:function(){i.RainBrush.moveOnce(p)},onWashOnce:function(){i.RainBrush.washOnce(p)},onRefresh:function(){return h._getConfig(!0),!1},onDefault:function(){return i.ConfigManager.getDefault("DHRS").done(function(a){m[n][o]=a[n][o],h._renderElements(),h.$(".u-tip").tip("success",tl("com.DefaultSuccessTip"))}).fail(function(){h.$(".u-tip").tip("error",tl("com.DefaultfailureTip"))}),!1},onConfirm:function(){return h._saveData(),i.ConfigManager.setConfig("DHRS",m).done(function(){h.$(".u-tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){h.$(".u-tip").tip("error",tl("com.SaveConfigFailTip"))}),!1},leave:function(){plugin.hide(),plugin.close(),k&&k.hide(),l&&l.hide()}})}),define("lora_config",function(require,b,c){var d,e=require("jsCore/rpc"),f=(require("common/common"),require("jsCore/pageBase")),g=null,h=null,i=null,j=[],k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null;c.exports=f.extend({init:function(){me=this,ability.get("WireLessLora").done(function(a){r=a.MaxConnectNum}),d=me.$("#wiper_lora_table").table({height:200,selectSingle:!1,columns:[{t:"com.Numbers",width:"10%",fields:"index"},{t:"sys.DeviceID",width:"20%",fields:"devID",editor:function(){return clearInterval(q),clearInterval(p),p=setInterval(me.everyTime,12e4),a('<input type="text" class="u-input"/>').textfield({length:8,asciiByte:2,notAsciiByte:3,value:"0",validReg:/^[\d|A-Z]*$/,errorHandle:"prevent",error:function(){me.$("#wiper_lora_tip").tip("error",tl("com.InputNotValidTip"))}})}},{t:"com.Connect",width:"12%",action:"Enable",icon:"ui-table-icon-connec",handle:function(a){n=a.index-1,m=a._index,me.onConnect(a)}},{t:"com.Status",width:"14%",action:"status",render:function(a){return 1===a.status?'<i data-action="Status" class="ui-table-icon-conneced"></i>':'<i data-action="Status" class="ui-table-icon-Noconnec"></i>'}},{t:"com.Delete",width:"14%",action:"delete",icon:"ui-table-icon-del",handle:function(a){me.onDeletePoint(a)}},{t:"com.Remark",width:"30%",fields:"remark",editor:function(){return clearInterval(q),clearInterval(p),p=setInterval(me.everyTime,12e4),a('<input type="text" class="u-input"/>').textfield({length:63,asciiByte:2,notAsciiByte:3,errorHandle:"prevent",error:function(){me.$("#wiper_lora_tip").tip("error",tl("com.BadstringServerNameTip"))}})}}],onblurEditor:function(a,b){clearInterval(q),clearInterval(p),p=setInterval(me.everyTime,12e4);var c=b.field;b.field&&b.data&&(k=b.data[c],l=b.editVal,k!==l&&"remark"!==b.field&&(j[b.data._index][c]=l,b.data.status=0)),"remark"===b.field&&(j[b.data._index][c]=l,m=b._index-0,me.onConnect(b))}}),me.render()},render:function(){clearInterval(p),p=setInterval(me.everyTime,12e4),me._getConfig()},onPresetRefresh:function(){me._getConfig(!0)},_getConfig:function(a){e.WireLessLora.getConnectstatus().done(function(b){b?(g=b,h=g.connectStatus,me.changePointToObj(h),d.table("dataSource",j)):(j=[],d.table("dataSource",j)),a&&me.$("#wiper_lora_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){me.$("#wiper_lora_tip").tip("error",tl("com.OperateFailTip"))})},changePointToObj:function(b){j=[],a.each(b,function(a,b){j[a]={index:b.Index,devID:b.DevID,remark:b.Remark,status:b.Status}})},renderAddPoint:function(){clearInterval(q),clearInterval(p),p=setInterval(me.everyTime,12e4);var b=0;j.sort(function(a,b){return a.index-b.index});for(var c=0;c<j.length;c++)if(j[c].index!=c+1){b=c+1;break}if(0===b&&(b=j.length+1),b>r)me.$("#wiper_lora_tip").tip("error",tl("com.MaximumConnectTip"));else{{var e={};j.length+1}e.index=b,e.remark="",e.devID="0",d.table("add",e,b-1).table("selectRow",b-1);var f=a("#wiper_lora_table .u-table-main").scrollTop(),g=a("#wiper_lora_table tbody").find('[data-index="'+(b-1)+'"]').offset().top;a("#wiper_lora_table .u-table-main").scrollTop(f+g)}},onDeletePoint:function(a){d.table("del",a).table("selectRow",j.length-1),0===j.length&&clearInterval(q),e.WireLessLora.remove(a.index).done(function(){me.$("#wiper_lora_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){me.$("#wiper_lora_tip").tip("error",tl("com.OperateFailTip"))})},onPresetClean:function(){e.WireLessLora.removeAll().done(function(){j=[],d.table("dataSource",j),clearInterval(q),me.$("#wiper_lora_tip").tip("success",tl("com.OperateSuccessTip"))}).fail(function(){me.$("#wiper_lora_tip").tip("error",tl("com.OperateFailTip"))})},onConnect:function(){i=[],a.each(j,function(a,b){i[a]=[b.index,b.devID,b.remark]}),e.WireLessLora.connect(i[m]).done(function(){o=m+1,me.$("#wiper_lora_tip").tip("success",tl("com.OperateSuccessTip")),clearInterval(q),q=setInterval(me.render,5e3)}).fail(function(){me.$("#wiper_lora_tip").tip("error",tl("com.OperateFailTip"))})},everyTime:function(){clearInterval(q),q=setInterval(me.render,5e3)},leave:function(){clearInterval(q),clearInterval(p)}})}),define("ClearFrostHeater_config",function(require,a,b){var c,d=require("jsCore/rpc"),e=(require("common/common"),require("jsCore/pageBase")),f=0,g=null;b.exports=e.extend({init:function(){g=this,d.PTZ.getCurrentProtocolCaps().done(function(a){a.ClearFrostHeater&&(g.$("#AuthPeripheral_WorkingTime").numberfield({max:a.ClearFrostHeater.WorkingTime[1]||120,min:a.ClearFrostHeater.WorkingTime[0]||10,allowDecimal:!1,allowNegative:!1}),g.$("#AuthPeripheral_WorkingTime").next("span").next("span").text("("+(a.ClearFrostHeater.WorkingTime[0]||10)+"~"+(a.ClearFrostHeater.WorkingTime[1]||120)+")")),g.render()})},render:function(){this._getConfig()},_getConfig:function(a){d.ConfigManager.getConfig("ClearFrostHeater").done(function(b){c=b,g._renderFrostElement(c),a&&g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})},_renderFrostElement:function(a){var b=a[f];g.$("#AuthPeripheral_WorkingTime").numberfield("value",b.MaxWorkingTime)},onDefault:function(){d.ConfigManager.getDefault("ClearFrostHeater").done(function(a){c=a,g._renderFrostElement(c),g.tip("success","com.DefaultSuccessTip")}).fail(function(){g.tip("error","com.DefaultfailureTip")})},onRefresh:function(){g._getConfig(!0)},onSave:function(){c[f].MaxWorkingTime=g.$("#AuthPeripheral_WorkingTime").numberfield("value"),d.ConfigManager.setConfig("ClearFrostHeater",c).done(function(){g.tip("success","com.SaveSuccessTip")}).fail(function(){g.tip("error","com.SaveConfigFailTip")})}})})}(jQuery);