!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab"),b.exports.prototype.aud_encode=!!webApp.AUDIO_IN_NUMBER,b.exports.prototype.aud_manage=ability.get("AudioFileManager").then(function(a){return!(!a||!(a.Support||a.SirenFileManager&&a.SirenFileManager.Support)||isEnable("is_hide_audManage"))})}),define("aud_encode",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("jsCore/ability"),g=require("common/common");require("widget/js/dui.slider");var h,i,j,k,l,m,n,o={},p=0,q=0,r=!1,s=!1;c.exports=e.extend({init:function(){h=this,h._getCaps().done(function(){h.render()}),a.when(f.get("AudioInputCaps"),f.get("AudioProperty")).done(function(a,b){r=a.Mic<2?!0:!1,b&&!b.Support&&h.$("#aud_property").remove()}),h.bind()},bind:function(){h.$("#au_InDenoise").on("change",function(){h.$("#au_noise").css(1==this.value&&s?{display:"block"}:{display:"none"})})},render:function(a){d.ConfigManager.getConfig(["Encode","AudioInputVolume","AudioOutputVolume","AudioInDenoise","AudioInput","AudioTouch"]).done(function(b){b[0].result&&(i=b[0].params.table),b[1].result&&(j=b[1].params.table),b[2].result&&(k=b[2].params.table),b[3].result&&(l=b[3].params.table),b[4].result&&(m=b[4].params.table),b[5].result&&(n=b[5].params.table),h._renderElements(),a&&h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},onSave:function(){var a=["Encode","AudioInDenoise"],b=[i,l];webApp.AUDIO_IN_NUMBER&&(a.push("AudioInputVolume"),b.push(j)),webApp.AUDIO_OUT_NUMBER&&(a.push("AudioOutputVolume"),b.push(k)),h.propertySupport&&(a.push("AudioInput"),b.push(m)),n&&(a.push("AudioTouch"),b.push(n)),h._saveElements(),d.ConfigManager.setConfig(a,b).done(function(a){g.chkMutilCallRet(a)?h.tip("success","com.SaveSuccessTip"):h.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){h.render(!0)},onDefault:function(){d.ConfigManager.getDefault(["Encode","AudioInputVolume","AudioOutputVolume","AudioInDenoise","AudioInput","AudioTouch"]).done(function(b){var c;b[0].result&&(c=b[0].params.table),b[1].result&&(j=b[1].params.table),b[2].result&&(k=b[2].params.table),b[3].result&&(l=b[3].params.table),b[4].result&&(m=b[4].params.table),b[5].result&&(n=b[5].params.table),a.each(i[p].MainFormat,function(a,b){b.Audio=c[p].MainFormat[a].Audio,b.AudioEnable=c[p].MainFormat[a].AudioEnable}),a.each(i[p].ExtraFormat,function(a,b){a>c[p].ExtraFormat.length-1||(b.Audio=c[p].ExtraFormat[a].Audio,b.AudioEnable=c[p].ExtraFormat[a].AudioEnable)}),h._renderElements(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},onFrequencyChange:function(a){var b=h.$(a.target).val(),c=h.$(a.target).attr("data-freq");b?h._renderFrequency(b,c):h._renderFrequency("PCM",c)},onExStreamChange:function(a){var b=h.$(a.target).val()-0;h._saveExtraAudio(q),q=b,h._renderExtraAudio(b),"Mic"==h.$("#au_source").val()&&r?(h.$("#au_e_eChan").addClass("fn-hide"),h.$("[for=au_e_eCh0]").removeClass("fn-width80"),h.$("[for=au_e_eCh1]").addClass("fn-hide")):"LineIn"==h.$("#au_source").val()&&r&&(h.$("#au_e_eChan").removeClass("fn-hide"),h.$("[for=au_e_eCh0]").addClass("fn-width80"),h.$("[for=au_e_eCh1]").removeClass("fn-hide"))},onDeviceChange:function(){r&&(h.$("#au_e_mCh1").toggleClass("fn-hide"),h.$("[for=au_e_mCh1]").toggleClass("fn-hide"),h.$("[for=au_e_eCh0]").toggleClass("fn-width80"),h.$("#au_e_eChan").toggleClass("fn-hide"),h.$("[for=au_e_eCh1]").toggleClass("fn-hide"))},_getCaps:function(){var b,c,e,g,m;return g=f.get("AudioProperties").done(function(a){a&&a.Support?h.propertySupport=!0:h.$('[data-cap="AudioProperties"]').remove()}),webApp.AUDIO_IN_NUMBER?h.$("#au_vol_slider").slider({min:0,max:100,complete:function(b,c){a.each(j,function(a){j[a]=c.value})}}):h.$("#au_vol").remove(),webApp.AUDIO_OUT_NUMBER?h.$("#au_devol_slider").slider({min:0,max:100,complete:function(b,c){a.each(k,function(a){k[a]=c.value})}}):h.$("#au_devol").remove(),e=f.get("AudioInputCaps").done(function(a){var b=h.$("#au_source"),c=0;for(var d in a)c++;for(var d in a)a[d]>0&&b.append('<option value="'+d+'" t="'+d+'"></option>');1==c&&b.prop("disabled",!0),webApp.GongAnDetect&&b.append('<option t="ivs.Stereo"></option>'),b.translation()}).fail(function(){h.$("#au_source").parent().remove()}),webApp.AUDIO_IN_NUMBER>1?(h.twoChannel=!0,h.$('[data-for="auIn0"]').remove(),h.$('[data-for="auInEx0"]').remove()):(h.$('[data-for="auIn1"]').remove(),h.$('[data-for="auInEx1"]').remove()),h._showRecordStream(),m=d.ConfigManager.getConfig("Encode").done(function(c){i=c,b=d.Encode.getConfigCaps(p,i).done(function(b){var c=h.$("#au_e_mList"),d=h.$("#au_extraAudioList"),e=b[0].MainFormat[0].Audio.CompressionTypes,f=[];null==b[0].ExtraFormat?h.$("#au_subStream_con").hide():f=b[0].ExtraFormat[0].Audio.CompressionTypes,isEnable("is_show_PCM")||(e.erase("PCM"),f.erase("PCM")),c.empty(),d.empty(),a.each(e,function(a,b){c.append("<option value="+b+">"+b+"</option>")}),a.each(f,function(a,b){d.append("<option value="+b+">"+b+"</option>")})})}),c=d.DevAudioEncode.getFormatCaps(p).done(function(b){a.each(b,function(b,c){void 0==o[c.Compression]&&(o[c.Compression]=[]),-1==a.inArray(c.Frequency,o[c.Compression])&&o[c.Compression].push(c.Frequency)})}),d.DevAudioEncode.getCaps(p).done(function(b){b&&b.SupportLevel?(s=!0,h.$("#au_noise").css({display:"block"}),h.$("#au_noise_slider").slider({min:1,max:100,complete:function(b,c){a.each(l,function(a){l[a].level=c.value})}})):h.$("#au_noise").remove()}),f.get("SupportAudioChangeVoice").done(function(b){b&&a("#au_voiceChange").removeClass("fn-hide")}),a.Deferred(function(c){a.when(g,m,e).done(function(){b.done(function(){c.resolve()})})})},_showRecordStream:function(){f.is("ExtraConflict").done(function(a){webApp.MaxExtraStream<2?h.$("#au_extraStreams").hide():h.$("#au_extraStreams").show(),h.$("#au_extraStreams").empty();for(var b=a?1:webApp.MaxExtraStream,c=0;b>c;c++)h.$("#au_extraStreams").append("<option value="+c+' t="med.AuxiliaryStream+'+(c+1)+'"></option>');h.$("#au_extraStreams").translation()})},_renderFrequency:function(b,c){var d,e=h.$("#"+c);e.empty();for(var f=0;f<o[b].length;f++)e.append("<option value="+o[b][f]+">"+o[b][f]+"</option>");switch(c){case"au_FreM":d=i[0].MainFormat[0].Audio.Frequency;break;case"au_FreE":var g=parseInt(h.$("#au_extraStreams").val())||0;d=i[0].ExtraFormat[g].Audio.Frequency}e.val(a.inArray(d,o[b])>-1?d:o[b][0])},_renderElements:function(){var b=i[p].MainFormat[0];h.twoChannel?(h.$("#au_e_mCh0").prop("checked",b.AudioEnable&&-1!==a.inArray(0,b.Audio.Channels)),h.$("#au_e_mCh1").prop("checked",b.AudioEnable&&-1!==a.inArray(1,b.Audio.Channels)),"Mic"==m[0].AudioSource&&r?(h.$("#au_e_mCh1").addClass("fn-hide"),h.$("[for=au_e_mCh1]").addClass("fn-hide")):(h.$("#au_e_mCh1").removeClass("fn-hide"),h.$("[for=au_e_mCh1]").removeClass("fn-hide"))):h.$("#au_e_mEnable").prop("checked",b.AudioEnable),h.$("#au_e_mList").val(b.Audio.Compression).change();var c=parseInt(h.$("#au_extraStreams").val())||0;h._renderExtraAudio(c),h.propertySupport===!0&&h.$("#au_source").val(m[0].AudioSource),h.$("#au_InDenoise").val(l[0].enable?1:0),webApp.AUDIO_IN_NUMBER&&h.$("#au_vol_slider").slider("value",j[0]),webApp.AUDIO_OUT_NUMBER&&h.$("#au_devol_slider").slider("value",k[0]),h.$("#au_noise").css(s&&1==h.$("#au_InDenoise").val()?{display:"block"}:{display:"none"}),s&&0!==h.$("#au_noise_slider").length&&h.$("#au_noise_slider").slider("value",l[0].level?l[0].level:50),n&&a("#au_ChangeVoiceEnable").val(n.Enable===!0?"on":"off")},_renderExtraAudio:function(b){var c=h.$("#au_e_eEnable"),d=h.$("#au_e_eCh0"),e=h.$("#au_e_eCh1"),f=i[p].ExtraFormat[b];h.twoChannel?(d.prop("checked",f.AudioEnable&&-1!==a.inArray(0,f.Audio.Channels)),e.prop("checked",f.AudioEnable&&-1!==a.inArray(1,f.Audio.Channels)),"Mic"==m[0].AudioSource&&r?(h.$("#au_e_eChan").addClass("fn-hide"),h.$("[for=au_e_eCh0]").removeClass("fn-width80"),h.$("[for=au_e_eCh1]").addClass("fn-hide")):(h.$("#au_e_eChan").removeClass("fn-hide"),h.$("[for=au_e_eCh0]").addClass("fn-width80"),h.$("[for=au_e_eCh1]").removeClass("fn-hide"))):c.prop("checked",i[p].ExtraFormat[b].AudioEnable),i[p].ExtraFormat[b].VideoEnable?(h.disabled(d,!1),h.disabled(e,!1),h.disabled(c,!1)):(h.disabled(d,!0),h.disabled(e,!0),h.disabled(c,!0),d.prop("checked",!1),e.prop("checked",!1),c.prop("checked",!1)),h.$("#au_extraAudioList").val(i[p].ExtraFormat[b].Audio.Compression).change()},_saveElements:function(){var b=i[p].MainFormat;if(h.twoChannel){var c=h.$("#au_e_mCh0").prop("checked"),d=h.$("#au_e_mCh1").prop("checked"),e=[];c&&e.push(0),d&&e.push(1);var f=c||d;f||e.push(0,1)}else var g=h.$("#au_e_mEnable").prop("checked");var j=h.$("#au_e_mList").val();a.each(b,function(a){h.twoChannel?(b[a].Audio.Channels=e,b[a].AudioEnable=f):b[a].AudioEnable=g,b[a].Audio.Compression=j,b[a].Audio.Frequency=h.$("#au_FreM").val()-0});var k=parseInt(h.$("#au_extraStreams").val())||0;h._saveExtraAudio(k),m[0].AudioSource=h.$("#au_source").val(),h.propertySupport===!0&&a.each(l,function(a,b){b.enable="1"===h.$("#au_InDenoise").val()?!0:!1}),n&&(n.Enable="on"===a("#au_ChangeVoiceEnable").val()?!0:!1)},_saveExtraAudio:function(a){var b=i[p].ExtraFormat[a];if(b.Audio.Compression=h.$("#au_extraAudioList").val(),b.Audio.Frequency=h.$("#au_FreE").val()-0,h.twoChannel){var c=h.$("#au_e_eCh0").prop("checked"),d=h.$("#au_e_eCh1").prop("checked");b.Audio.Channels=[],c?b.Audio.Channels.push(0):c=!1,d?b.Audio.Channels.push(1):d=!1,b.AudioEnable=c||d,b.AudioEnable||b.Audio.Channels.push(0,1)}else b.AudioEnable=h.$("#au_e_eEnable").prop("checked")},leave:function(){}})}),define("aud_manage",function(require,b,c){var d,e,f,g,h,i,j=require("jsCore/rpc"),k=require("jsCore/pageBase"),l={},m={},n=null;c.exports=k.extend({init:function(){d=this,h=d.$("#aud_diaAdd").dialog({switcher1:function(){h.find("div[data-show]").hide(),h.find("div[data-show=record]").show()},switcher2:function(){h.find("div[data-show]").hide(),h.find("div[data-show=upload]").show()},record:function(){d._recordAu()},stopRecord:function(){d._recordAuStop()},upload:function(){d._uploadAu()}}).detach().appendTo(document.body),webApp.AUDIO_IN_NUMBER||(h.find("[data-action=switcher1]").parent("label").hide(),h.find("[data-action=switcher2]").click()),i=d.$("#aud_diaEdit").dialog({confirm:function(){d._saveAudioModify()}}).detach().appendTo(document.body),h.dialog("setPosition",[200,600]),i.dialog("setPosition",[200,600]),d.table=d.$(".u-table").table({height:220,columns:[{t:"com.Choose",width:"10%",render:function(a){var b='<input type="radio"';return a.choosed&&(b+=' checked="checked"'),b+=">"}},{t:"com.Name",width:"30%",render:function(a){var b=a.path.split("/").pop();return b}},{t:"com.Play",width:"15%",action:"play",icon:"i-play",preventEvt:!0,handle:function(a){j.Speak.startPlay(a.path).done(function(a){"OK"===a?d.tip("success","per.PlayAudio"):d.tip("error","com.PlayAudioFailedTip")}).fail(function(){d.tip("error","com.PlayAudioFailedTip")})}},{t:"sto.Download",width:"15%",action:"down",icon:"i-down",preventEvt:!0,render:function(a){var b='<a href="/RPC2_Loadfile'+a.path+'" target="_download"><i data-action="down" class="i-down"></i></a>';return b}},{t:"com.Modify",width:"15%",action:"edit",icon:"i-edit",preventEvt:!0,render:function(a){var b="";b=a["default"]?" disabled":"";var c='<i data-action="edit" class="i-edit'+b+'"></i>';return c},handle:function(a){if(a["default"]);else{m=a,i.dialog("show");var b=a.path.split("/").pop().split(".");b.pop(),i.find("#au_modifyName").val(b.join("."))}}},{t:"com.Delete",width:"15%",action:"delete",icon:"i-del",preventEvt:!0,render:function(a){var b="";b=a["default"]?" disabled":"";var c='<i data-action="delete" class="i-del'+b+'"></i>';return c},handle:function(a){if(a["default"]);else{var b=a.path;j.FileManager.removeFiles([b]).done(function(){d.render(),d.tip("success","com.DelectSuccessTip")}).fail(function(){d.tip("error","com.Deletefail")})}}}],onRowSelect:function(b,c){var e=c.rowIndex;return a.each(f,function(a,b){b.choosed=!(a!==e)}),d.table.table("refresh"),d._audioPlayCheck(e),!1},trId:"audio_devList_"}),d.bind(),j.Speak.getCaps().done(function(a){n=a}).always(function(){var b;ability.get("AudioFileManager").done(function(c){n&&n.AudioPlayPath?a.each(n.AudioPlayPath,function(a,c){c.SupportUpload?(d.audio_url=c.Path,n.maxNum=c.MaxFileUploadNum):b=c.Path}):(d.audio_url=c.CustomAudioPath?c.CustomAudioPath.split(";")[0]:"",b=c.PlayRootPath?c.PlayRootPath.split(";")[0]:""),c.SupportRecordAudio===!1&&d.$("#upfile_audio").remove(),j.FileManager.list(b).done(function(b){e=[],a.each(b,function(a,c){"File"===b[a].type&&(c.file["default"]=!0,e.push(c.file))}),d.render()})})})},bind:function(){h.find("#au_scan").click(function(){h.find("#au_dhtechupload").click(),this.blur()}),h.find("#au_dhtechupload").bind({change:function(){d._changePath(this)},blur:function(){d._changePath(this)}})},onAddAudio:function(){h.dialog("show"),h.find("#au_path").val(""),h.find("#au_recordeName").val("")},render:function(){j.FileManager.list(d.audio_url).always(function(b){f=[],j.ConfigManager.getConfig("Sound").done(function(a){g=a}).always(function(){b&&b.length>0&&a.each(b,function(a,c){c.file.choosed=g&&g.AlarmSound==c.file.path?!0:!1,"File"===b[a].type&&f.push(c.file)}),d.disabled("[btn-for = onAddAudio]",f.length===n.maxNum),a.each(e,function(a,b){b.choosed=g&&g.AlarmSound==b.path?!0:!1}),f=f.concat(e);var c=f.map(function(a){return a.choosed}).indexOf(!0);d.table.table("dataSource",f),-1===c&&(c=0,d._audioPlayCheck(0)),d.table.table("selectRow",c)})})},destory:function(){h.remove(),i.remove()},_saveAudioModify:function(){var b=i.find("#au_modifyName").val();if(0===a.trim(b).length)return void d.tip("error","com.FilenameNotNullTip");var c=m.path,e=d.audio_url+b+"."+c.split(".").pop(),f=b+"."+c.split(".").pop();return d._isNameRepeat(f)?void d.tip("error","com.SameNameTip"):void j.FileManager.rename(c,e).done(function(){m.path=e,d.table.table("refresh");var a=d.table.table("getSelectedRow");m._index===a&&d._audioPlayCheck(a,0,1),i.dialog("close"),d.tip("success","com.ModifySuccessedTip")}).fail(function(a){409==a.error.code?d.tip("error","com.SameNameTip"):404==a.error.code?d.tip("error","com.ModifyFailTip"):d.tip("error","com.ModifyFailTip")})},_changePath:function(a){var b=a.value,c=b.lastIndexOf("\\");c>=0&&(b=b.slice(c+1)),h.find("#au_path").val(b)},_uploadAu:function(){var a=h.find("#au_path").val(),b="/RPC2_UploadFileWithName"+d.audio_url+a;if(h.find("#audioFileUpload").attr("action",b),0===a.length)return void d.tip("error","com.PleaseChooseFile");var c=a.split(".").getLast();return"pcm"!==c&&"wav"!==c?void d.tip("error","med.AudioNeedPcmWav"):void h.find("#au_submit").trigger("click")},_recordAu:function(){var b=h.find("#au_recordeName").val();if(0===a.trim(b).length)return void d.tip("error","com.FilenameNotNullTip");var c="Main",e=a.trim(h.find("#au_recordeName").val())+".pcm",f=d.audio_url+e;return d._isNameRepeat(e)?void d.tip("error","com.SameNameTip"):void j.AudioRecordManager.startChannel(c,f).done(function(){d.disabled("#audio_recordeName",!0),d.disabled("#audio_optionsUpload",!0),h.find("[data-action=record]").hide(),h.find("[data-action=stopRecord]").show(),d._audioRecordStatus.delay(500)}).fail(function(a){a.error&&506==a.error.code?d.tip("error","com.FileSizeLimitMaxTip"):d.tip("error","com.TranscribeFailFullTip")})},_recordAuStop:function(){d.audio_url+a.trim(h.find("#au_recordeName").val())+".pcm";j.AudioRecordManager.stopChannel("Main").done(function(){d.disabled("#audio_recordeName",!1),d.disabled("#audio_optionsUpload",!1),h.find("[data-action=record]").show(),h.find("[data-action=stopRecord]").hide(),d.tip("success","com.TranscribeSuccessTip"),h.dialog("close")}).fail(function(){d.tip("error","com.TranscribeFailFullTip")})},_audioRecordStatus:function(){j.AudioRecordManager.getStateAll().done(function(a){a[0].Main.State?d._audioRecordStatus.delay(500):(d.disabled("#audio_recordeName",!1),d.disabled("#audio_optionsUpload",!1),h.find("[data-action=record]").show(),h.find("[data-action=stopRecord]").hide(),d.render(),d.tip("success","com.TranscribeSuccessTip"),h.dialog("close"))}).fail(function(){h.find("[data-action=record]").show(),h.find("[data-action=stopRecord]").hide(),h.dialog("close"),d.tip("error","com.TranscribeFailFullTip")})},_audioDelInfo:function(a){d.$("#audio_devList_"+a+" td input:eq(0)").prop("checked")&&d._audioPlayCheck(a,1);var b=d.$("#audio_devList_"+a+" td:eq(2)").attr("file-name");j.FileManager.removeFiles([b]).done(function(){l._audioGetAll(),d.$("#audio_fileRemark").tip("success",tl("com.DelectSuccessTip"),3e3)}).fail(function(){d.$("#audio_fileRemark").tip("error",tl("com.Deletefail"),3e3)})},_audioPlayCheck:function(a,b,c){g.AlarmSound=b?d.$("#audio_devList_"+audioDefaultList[0]+" td:eq(2) a").attr("href"):d.$("#audio_devList_"+a+" td:eq(3) a").attr("href").split("/RPC2_Loadfile")[1],j.ConfigManager.setConfig("Sound",g).done(function(){b||c||d.$("#audio_fileRemark").tip("success",tl("com.ChooseAlarmAudioSuccTip"),3e3)}).fail(function(){d.$("#audio_fileRemark").tip("success",tl("com.ChooseAlarmAudioFailTip"),3e3)})},_isNameRepeat:function(a){var b=f.some(function(b){var c=b.path.split("/").pop();return a===c});return b},leave:function(){}}),window.audioUploadStatue=function(a){switch(a){case 1:d.tip("success","com.UpmoveSuccessTip");break;case 400:d.tip("error","itc.RequestError");break;case 401:case 286916614:d.tip("error","itc.WithoutPermission");break;case 409:d.tip("error","sto.FilesizeExist");break;case 413:d.tip("error","com.NoDiskSpaceTip");break;case 415:d.tip("error","com.PropertyFailedTip");break;case 506:d.tip("error","com.FileSizeLimitMaxTip");break;case 507:case 286916610:d.tip("error","com.FileSizeLimitTip");break;case 286916615:d.tip("error","com.FileFormatDefaultTip");break;default:d.tip("error","com.UpmoveFailTip")}h.dialog("close"),d.render()},window.audioUploadReason=function(a){switch(a){case 1:d.tip("error","com.FileSizeLimitMaxTip");break;case 2:d.tip("error","com.NoDiskSpaceTip");break;case 3:d.tip("error","com.FileSizeLimitTip");break;case 4:d.tip("error","com.FileFormatDefaultTip");break;case 5:d.tip("error","itc.WithoutPermission");break;case 6:d.tip("error","com.UpmoveFailTip");break;default:d.tip("error","com.UpmoveFailTip")}}})}(jQuery);