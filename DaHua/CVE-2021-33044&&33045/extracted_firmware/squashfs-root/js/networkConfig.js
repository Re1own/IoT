!function(a){define(function(require,b,c){c.exports=require("jsCore/pageTab"),c.exports.prototype.Net_P2P=function(){if(webApp.Vendor===Base64.decode("RVpJUA==")){var b="P2P";setTimeout(function(){a("[data-for=Net_P2P]").attr("t",b).text(b)},0)}return webCaps.is_platform_showOnvif&&-1===webApp.VSPs.indexOf("LechangePro")?!1:!!isEnable("is_show_T2UServer")}}),define("Net_Network",function(require,b,c){function d(b,c){var c=c.split(".");return a.map(b.split("."),function(a,b){return a&c[b]}).join(".")}function e(b){function c(a){return(a+256).toString(2).substring(1)}if("0.0.0.0"===b)return!1;var d=a.map(b.split("."),function(a){return c(a-0)}).join("");return-1===d.indexOf("01")}function f(){var b=g();b&&(a(window).off("unload"),M.Reload(b+":"+location.port))}function g(){for(var a=location.hostname.replace(/(^\[)|(\]$)/g,""),b="",c=0,d=B.length;d>c;c++){var e=B[c];if(G[e.Name].IPAddress===a&&G[e.Name].IPAddress!=D[e.Name].IPAddress){b=D[e.Name].IPAddress;break}if(K.v6ToCanonicalForm(H[e.Name].IPAddress)===K.v6ToCanonicalForm(a)&&K.v6ToCanonicalForm(H[e.Name].IPAddress)!==K.v6ToCanonicalForm(E[e.Name].IPAddress)){b="["+E[e.Name].IPAddress+"]";break}}if(!b){var f=D.DefaultInterface;G[f].IPAddress!==D[f].IPAddress&&(b=L.ipv6(a)?"["+a+"]":a)}return b}function h(a){var b=/(^(::)$)|(^(:(:[0]{1,4}){1,7})$)|(^(([0]{1,4}:){1,7}([0]{1,4}))$)|(^(ff[a-f\d]{2}))/;return!b.test(a)}var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=require("jsCore/pageBase"),J=require("jsCore/rpc"),K=require("common/common"),L=K.Check,M=require("jsCore/plugin"),N=!1,O=!1,P=!1,Q=null;c.exports=I.extend({init:function(){var b=this;i=b.$("#NN_hostname").textfield({validReg:/^[^'"|&<>]*$/,errorHandle:"prevent",success:a.noop,length:63,asciiByte:2,notAsciiByte:3}),j=b.$("[sel-for=onSelectCard]"),k=b.$("[btn-for=onSetDefault]"),ability.get("AroudWifiSearch").done(function(a){a&&a.Support&&(O=!0)}),l=b.$("[NN_mode]").click(function(c){var d=a(c.target),e=d.attr("NN_mode"),f=d.closest("div.ui-form-item").attr("ipver");"IPv6"===f?(b.disabled(t,"dhcp"===e),b.disabled(u,"dhcp"===e),b.disabled(v,"dhcp"===e)):(b.disabled(o.find("input"),"dhcp"===e),b.disabled(p.find("input"),"dhcp"===e),b.disabled(q.find("input"),"dhcp"===e))}),m=b.$("#NN_macadd input"),n=b.$("[sel-for=onIPVersionChange]"),o=b.$("#NN_IPV4_IP").ipfield({type:"ip",error:function(a,c){"prevent"===c.type?b.tip("warning","com.Ipv4127"):"firstIPError"==c.type?b.tip("warning","com.Ipv4Range"):"lastIPError"==c.type&&b.tip("warning","com.Ipv4RangeLast")}}),p=b.$("#NN_IPV4_SM").ipfield({type:"mask"}),q=b.$("#NN_IPV4_DG").ipfield({type:"ip",error:function(a,c){"prevent"===c.type?b.tip("warning","com.Ipv4127"):"firstIPError"==c.type?b.tip("warning","com.Ipv4Range"):"lastIPError"==c.type&&b.tip("warning","com.Ipv4RangeLast")}}),r=b.$("#NN_IPV4_DNS1").ipfield({type:"dns",error:function(a,c){"prevent"===c.type?b.tip("warning","com.Ipv4127"):"firstIPError"==c.type?b.tip("warning","com.Ipv4Range"):"lastIPError"==c.type&&b.tip("warning","com.Ipv4RangeLast")}}),s=b.$("#NN_IPV4_DNS2").ipfield({type:"dns",error:function(a,c){"prevent"===c.type?b.tip("warning","com.Ipv4127"):"firstIPError"==c.type?b.tip("warning","com.Ipv4Range"):"lastIPError"==c.type&&b.tip("warning","com.Ipv4RangeLast")}}),t=b.$("#NN_IPV6_IP").textfield(),u=b.$("#NN_IPV6_IPEx").numberfield({max:128,min:1,allowDecimal:!1,allowNegative:!1}),v=b.$("#NN_IPV6_DG").textfield(),w=b.$("#NN_IPV6_DNS1").textfield(),x=b.$("#NN_IPV6_DNS2").textfield(),y=b.$("#NN_EnableARP"),ability.get("NetModeList").done(function(c){c&&c.NetModeList?(N=!0,b.$("[sel-for='netCardType']").parent().removeClass("fn-hide"),b.$("[sel-for='netCardType']").empty(),a.each(c.NetModeList.eth0,function(a,c){return null==c?!0:void b.$("[sel-for='netCardType']").append("<option value="+c+">"+tl("net.NetModeTye"+c)+"</option>")})):b.$("[sel-for='netCardType']").parent().addClass("fn-hide")}),ability.get("MulNetwokrDial").done(function(a){a&&(P=!0)}),z=a.validator([{element:i,check:[L.require],events:["keyup"]},{element:t,check:[L.ipv6ornull,h],errorMsg:["com.BadFormatIPV6address","com.BadFormatIPV6address"],events:"blur",errorElem:".u-input-error"},{element:v,check:[L.ipv6ornull,h],errorMsg:["com.BadFormatIPV6address","com.BadFormatIPV6address"],events:"blur"},{element:w,check:[L.require,L.ipv6],errorMsg:["com.NotNoneTip","com.BadFormatIPV6address"],events:["keyup","blur"]},{element:x,check:[L.require,L.ipv6],errorMsg:["com.NotNoneTip","com.BadFormatIPV6address"],events:["keyup","blur"]}],function(a){a.parent().translation()}),b.$("#change_status").on("click",function(){b.$("#change_status").hasClass("speed-change-btn-on")?(b.$("#change_status").removeClass("speed-change-btn-on"),b.$("[cfg=low]").hide(),b.$("[cfg=high]").show(),b.$("[cfg=high]").css("margin-left","27px"),D.eth0.NetMode="longPoE100M"):(b.$("[cfg=high]").hide(),b.$("[cfg=low]").show(),b.$("#change_status").addClass("speed-change-btn-on"),D.eth0.NetMode="longPoE10M")}),b.$("a[speed-css]").on("click",function(){J.ConfigManager.setConfig("Network",D,"",["ForceNotify"]).done(function(){J.NetApp.getNetInterfaces().done(function(a){Status=a[0].Speed,b.$("#speed").text(Status>=100?tl("itc.SpeedUp"):tl("itc.SpeedDown"))})})}),b.render()},render:function(){var b=this;J.NetApp.getNetInterfaces().done(function(c){B=a.grep(c,function(a){return"3G"!==a.Name&&-1===a.Name.indexOf("wlan")}),c[0].SupportLongPoE?(b.$("#change_status").addClass("speed-change-btn"),b.$("#change_status").parent().show(),b.$("#speedx").parent().show()):(b.$("#change_status").parent().hide(),b.$("#speedx").parent().hide()),b._getConfig()}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")})},_getConfig:function(b){var c=this;J.ConfigManager.getConfig(["Network","IPv6","ARP&Ping"]).done(function(d){D=d[0].params.table,E=d[1].params.table,F=d[2].params.table,G=a.extend(!0,{},D),H=a.extend(!0,{},E),c._renderElement(b),c.disabled("[btn-for=onSave]",!1),b&&c.tip("success","com.OperateSuccessTip")}).fail(function(){c.disabled("[btn-for=onSave]",!0),c.tip("error","com.OperateFailTip")}),J.ConfigManager.getConfig("PPPoE").done(function(a){C=a,c._renderElement(b)})},_renderElement:function(b){var c=this;if(P){var d=C;if("ppp0"!==C.DefaultPPPoEInterface){var e=C.DefaultPPPoEInterface.substr(C.DefaultPPPoEInterface.length-1);d=C["PPPOE"+e]}c.disabled("[btn-for=onSetDefault],[btn-for=onDefault]",!(!d||!d.Enable))}else c.disabled("[NN_mode],div[ipver] input,[btn-for=onDefault],[btn-for=onSetDefault]",!(!C||!C.Enable));i.textfield("value",D.Hostname),y.prop("checked",F.SettingIP),D&&D.eth0&&("longPoE100M"===D.eth0.NetMode?(c.$("#change_status").removeClass("speed-change-btn-on"),c.$("[cfg=low]").hide(),c.$("[cfg=high]").show(),c.$("[cfg=high]").css("margin-left","27px"),c.$("[cfg=high]")[0].disabled=!0):(c.$("[cfg=high]").hide(),c.$("[cfg=low]").show(),c.$("[cfg=low]")[0].disabled=!0,c.$("#change_status").addClass("speed-change-btn-on")),N&&D&&c.$("[sel-for='netCardType']").val(D.eth0.NetMode||"adapt")),J.NetApp.getNetInterfaces().done(function(a){Status=a[0].Speed,c.$("#speed").text(Status>=100?tl("itc.SpeedUp"):tl("itc.SpeedDown"))});var f=j.val();j.empty(),P?a.each(B,function(a,b){var c="",d=b.Name.substr(b.Name.length-1)-0+1;c="Normal"===b.Type?tl("net.Lineate")+d:tl("net.Wireless"),b.Name===D.DefaultInterface&&(c+="("+tl("com.Default")+")"),j.append("<option value="+b.Name+">"+c+"</option>")}):a.each(B,function(a,b){var c=tl("eth0"===b.Name?"net.Lineate":"net.Wireless");b.Name===D.DefaultInterface&&(c+="("+tl("com.Default")+")"),O&&"Wireless"===b.Type||j.append("<option value="+b.Name+">"+c+"</option>")}),j.children("option").length>1?(k.show(),P&&k.attr("t","net.SegmentIP").parent().translation()):k.hide(),b?j.val(f):(j.val(D.DefaultInterface),n.val(/:/.test(location.hostname)?"IPv6":"IPv4").change()),A=null,j.children()&&j.val(j.children().val()),j.change()},onSave:function(){var b=this,c="com.IPCannotBetheame";if(P&&(c="pfm.SameIP"),z.isInvalid())return b.tip("warning",z.errors()[0].errorMsg||"com.SaveConfigFailTip");if(D.Hostname=i.textfield("value"),F.SettingIP=y.prop("checked"),N&&D&&(D.eth0.NetMode=b.$("[sel-for='netCardType']").val()),j.change(),!e(D[A].SubnetMask))return b.tip("warning","com.SubnetAddressesWrongTip");var g=d(D[A].IPAddress,D[A].SubnetMask);if(curS2=d(D[A].DefaultGateway,D[A].SubnetMask),g!==curS2)return b.tip("warning","com.SameNetTip");for(var h=0;h<B.length;h++){if(B[h].Name!==A){if(!e(D[B[h].Name].SubnetMask))return b.tip("warning","com.SubnetAddressesWrongTip");var k=d(D[B[h].Name].IPAddress,D[B[h].Name].SubnetMask),l=d(D[B[h].Name].DefaultGateway,D[B[h].Name].SubnetMask);if(k!==l)return b.tip("warning","com.SameNetTip")}for(var m=h+1;m<B.length;m++){if(D[B[h].Name].IPAddress===D[B[m].Name].IPAddress||E[B[h].Name].IPAddress===E[B[m].Name].IPAddress&&E[B[h].Name].IPAddress)return b.tip("warning",c);if(P){var n=d(D[B[m].Name].IPAddress,D[B[m].Name].SubnetMask);if(D[B[h].Name].SubnetMask===D[B[m].Name].SubnetMask&&k===n)return b.tip("warning","net.SameSegment")}}}var o=setTimeout(f,3e3);return J.ConfigManager.setConfig(["IPv6","ARP&Ping","Network"],[E,F,D]).done(function(c){global.isDDNS()?a.each(B,function(a,b){return G[b.Name].IPAddress!==D[b.Name].IPAddress||G[b.Name].DhcpEnable!==D[b.Name].DhcpEnable||H[b.Name].IPAddress!==E[b.Name].IPAddress||H[b.Name].DhcpEnable!==E[b.Name].DhcpEnable?(location.href="http://"+global.getDDNSMessage().ddnshost,!1):void 0}):K.chkMutilCallRet(c)?(b.tip("success","com.SaveSuccessTip"),f(),G=a.extend(!0,{},D),H=a.extend(!0,{},E)):b.tip("error","com.SaveConfigFailTip"),clearTimeout(o)}),!1},onRefresh:function(){return this._getConfig(!0),!1},onDefault:function(){var a=this;return J.ConfigManager.getDefault(["Network","IPv6","ARP&Ping"]).done(function(b){D=b[0].params.table,E=b[1].params.table,F=b[2].params.table,a._renderElement(),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")}),!1},onIPVersionChange:function(a){var b=this,c=b.$(a.target).val();return b.$("[ipver]").hide(),b.$("[ipver="+c+"]").show(),!1},onSelectCard:function(b){var c=this,d=a(b.target),e=d.val();if(P){if("eth0"===e)Q=C;else{var f=e.substr(e.length-1);Q=C["PPPOE"+f]}c.disabled("[NN_mode],div[ipver] input",!(!Q||!Q.Enable))}else Q=C;if(N&&"eth0"===e?c.$("[sel-for='netCardType']").parent().removeClass("fn-hide"):N&&"eth0"!==e&&c.$("[sel-for='netCardType']").parent().addClass("fn-hide"),A){if(z.isInvalid())return d.val(A),c.tip("warning",z.errors()[0].errorMsg);D[A].DhcpEnable="dhcp"===c.$("[name=NN_v4mode]:checked").attr("NN_mode")?!0:!1,D[A].IPAddress=o.ipfield("value"),D[A].SubnetMask=p.ipfield("value"),D[A].DefaultGateway=q.ipfield("value"),D[A].DnsServers[0]=r.ipfield("value"),D[A].DnsServers[1]=s.ipfield("value"),E[A].DhcpEnable="dhcp"===c.$("[name=NN_v6mode]:checked").attr("NN_mode")?!0:!1,E[A].IPAddress=t.textfield("value"),E[A].Prefix=u.numberfield("value"),E[A].DefaultGateway=v.textfield("value"),E[A].DnsServers[0]=w.textfield("value"),E[A].DnsServers[1]=x.textfield("value")}A=d.val();var g=D[A].PhysicalAddress.split(":");m.each(function(a,b){b.value=g[a]});var h=c.$("[name=NN_v4mode][NN_mode="+(D[A].DhcpEnable?"dhcp":"static")+"]").prop("checked",!0);Q&&Q.Enable||h.click(),o.ipfield("value",D[A].IPAddress),p.ipfield("value",D[A].SubnetMask),q.ipfield("value",D[A].DefaultGateway),r.ipfield("value",D[A].DnsServers[0]),s.ipfield("value",D[A].DnsServers[1]);var i=c.$("[name=NN_v6mode][NN_mode="+(E[A].DhcpEnable?"dhcp":"static")+"]").prop("checked",!0);return Q&&Q.Enable||i.click(),c.$("#NN_linkadd").text(E[A].LinkLocalAddress),t.textfield("value",E[A].IPAddress),u.numberfield("value",E[A].Prefix),v.textfield("value",E[A].DefaultGateway),w.textfield("value",E[A].DnsServers[0]),x.textfield("value",E[A].DnsServers[1]),z.validate(),!1},onSetDefault:function(){var a=this;return G.DefaultInterface=j.val(),P&&(C.DefaultPPPoEInterface="ppp"+G.DefaultInterface.substr(G.DefaultInterface.length-1),J.ConfigManager.setConfig("PPPoE",C)),J.ConfigManager.setConfig("Network",G).done(function(b){K.chkMutilCallRet(b)?(D.DefaultInterface=G.DefaultInterface,a._renderElement(),a.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(b)&&webApp.reboot("com.ConfEffectRestartTip")):a.tip("error","com.SaveConfigFailTip")}),!1}})}),define("Net_P2P",function(require,b,c){var d,e=require("jsCore/rpc"),f=require("jsCore/pageBase");c.exports=f.extend({init:function(){var b=this;a.getScript("../jsBase/lib/qrcode.js",function(){e.MagicBox.getSerialNo().done(function(a){a&&(b.$("#NP_SN").text(a),b.$("#NP_QR").html(create_qrcode(a)))})}),b.render()},render:function(){this._getConfig()},_getConfig:function(a){var b=this;e.ConfigManager.getConfig("T2UServer").done(function(c){d=c,b.$("#NP_T2UEnable").prop("checked",d.Enable),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","com.OperateSuccessTip")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")}),b._getStauts()},_getStauts:function(){var a=this;e.Nat.getTurnStatus().done(function(b){b.IsTurnChannel?a.$("#NP_Status").text(tl("itc.OnLine")).addClass("p2p_online"):a.$("#NP_Status").text(tl("com.NotOnline")).removeClass("p2p_online")})},onSave:function(){var a=this;return d.Enable=a.$("#NP_T2UEnable").prop("checked"),e.ConfigManager.setConfig("T2UServer",d).done(function(){a.tip("success","com.SaveSuccessTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")}),!1},onRefresh:function(){return this._getConfig(!0),!1},onDefault:function(){var a=this;return e.ConfigManager.getDefault("T2UServer").done(function(b){d=b,a.$("#NP_T2UEnable").prop("checked",d.Enable),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")}),a._getStauts(),!1}})})}(jQuery);