!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("parkCapture",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/plugin"),f=require("jsCore/pageBase"),g=require("jsCore/ability"),h=require("jsCore/modules/timeSection");require("jsCore/modules/ptzSetControl"),require("widget/js/dui.slider"),require("jsCore/modules/eventHandler");var i={},j={"Light-duty":tl("ivs.MotorLane"),NonMotor:tl("itc.NonMotorLane"),Bus:tl("itc.BusLane")},k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=[],x=null,y=null,z=null,A=null,B=null,C=null,D=0,E=null,F="TrafficPark",G=[],H=8,I=16,J=null,K=null,L=null,M=null,N={},O=!1,P=-1,Q=!0,R=!0,S=!1,T=null,U=null,V={},W={},X="",Y="",Z=null,$="",_="",ab="",bb="",cb=null,db=null,eb=null,fb=null,gb=null,hb=null,ib=null,jb=null,kb=null,lb=null,mb=null,nb=null,ob=null,pb=null,qb=null,rb=null,sb=null,tb=null,ub=null,vb=null,wb=null,xb=null,yb=null,zb=null,Ab=null,Bb=null,Cb=null,Db=null,Eb=null,Fb=null,Gb=[];c.exports=f.extend({init:function(){T=this,T.$("#ivs_parkCapture_ptz").ptzSetControl(),k=T.$("#advancedParams_dialog").dialog({close:function(){T._openVideo()},confirm:function(b,c){T._openVideo(),c.ui.close(),v.EventHandler=a("#ivsTrafficParkEventHandler").eventHandler("get"),"TrafficJam"===X&&(v.Config.JamLineMargin=a("#JamLineLimite").val()-0,v.Config.Interval=a("#AlarmWaitTime").val()-0),v.Config.Sensitivity=a("#parkCapture_slider").slider("value"),v.Config.ZoomEnable=a("#zoomGetEvidence").prop("checked"),x.Enable=a("#uploadViolationVideo_title_Enable").prop("checked"),x.UploadRecordEnable=a("#uploadViolationVideo").prop("checked"),B.NormalSnap.SaveSnap=a("#origpic_localSave").prop("checked"),B.NormalSnap.UploadSnap=a("#origpic_report").prop("checked"),B.NormalSnap.PicCompressRate=a('[sel-for="onChangeOrigPicQuality"]').val()-0,B.NormalSnap.ReduceRate=a('[sel-for="onChangeOrigPictureResolution"]').val()-0,B.CombinSnap.SaveSnap=a("#mergpic_localSave").prop("checked"),B.CombinSnap.UploadSnap=a("#mergpic_report").prop("checked"),B.CombinSnap.PicCompressRate=a('[sel-for="onChangeCompPicQuality"]').val()-0,B.CombinSnap.ReduceRate=a('[sel-for="onChangeCompPictureResolution"]').val()-0,y.UserImage.Enable=a("#privatePicReplace_enable").prop("checked"),y.UserImage.IndexInGroup=a('[sel-for="onReplacePicNum"]').val()-0,y.SnapTimeOutInterval=a("#longestCaptureInterval").val()-0,y.RepeatInterval=60*(a("#captureUploadingValue").val()-0),y.RepeatIntervalFlag=a("#zeroClearTime_enable").prop("checked"),y.SnapMode=a("#snapShot_enable").prop("checked")?1:0,y.SnapShotType.length=a('[sel-for="onChangeCaptureAmount"]').val()-0;for(var d=[],e=a('[sel-for="onChangeCaptureAmount"]').val()-0;e>0;e--)d.push(a("#number_"+e).prop("checked")?1:0);y.UploadMask=parseInt(d.join(""),2);for(var e=0;e<a('input[name="MosaicTwoMethod"]').length;e++)if(a(a('input[name="MosaicTwoMethod"]')[e]).prop("checked")){z.MosaicTwoMethod=a(a('input[name="MosaicTwoMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicThreeMethod"]').length;e++)if(a(a('input[name="MosaicThreeMethod"]')[e]).prop("checked")){z.MosaicThreeMethod=a(a('input[name="MosaicThreeMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicFourMethod"]').length;e++)if(a(a('input[name="MosaicFourMethod"]')[e]).prop("checked")){z.MosaicFourMethod=a(a('input[name="MosaicFourMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicFiveMethod"]').length;e++)if(a(a('input[name="MosaicFiveMethod"]')[e]).prop("checked")){z.MosaicFiveMethod=a(a('input[name="MosaicFiveMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicSixMethod"]').length;e++)if(a(a('input[name="MosaicSixMethod"]')[e]).prop("checked")){z.MosaicSixMethod=a(a('input[name="MosaicSixMethod"]')[e]).val()-0;break}}}).detach().appendTo(document.body),l=T.$("#advancedParams_picSetting_dialog").dialog({close:function(){k.dialog("show")},confirm:function(b,c){c.ui.close(),k.dialog("show"),y.SingleInterval[0]=a("#illegalAlarmOn").val()-0;for(var d=0;d<a('[sel-for="onChangeCaptureAmount"]').val()-0;d++)y.SnapShotType[d]=a('[sel-for="onChangePic_'+(d+1)+'"]').val();for(var d=1;d<a('[sel-for="onChangeCaptureAmount"]').val()-0;d++)y.SingleInterval[d]=60*(a("#ivs_snapT_m_"+d).val()-0)+(a("#ivs_snapT_s_"+d).val()-0);for(var d=0;d<y.SnapShotType.length;d++)a("#number_"+(d+1)).prop("disabled",!1),"Far"===y.SnapShotType[d]&&(a("#number_"+(d+1)).prop("disabled",!0),a("#number_"+(d+1)).prop("checked",!1));y.MediumRatio=a('[sel-for="onChangeMiddleRatio"]').val()-0,y.FeatureRatio=a('[sel-for="onChangeFeatureRatio"]').val()-0}}).detach().appendTo(document.body),a("#ivsTrafficParkEventHandler").eventHandler({RecordEnable:!1,RecordLatch:!1,SnapshotEnable:!1,PtzLinkEnable:!1,MailEnable:!1}),T.$("#illegalRuleCode").textfield({validReg:/^[a-z0-9A-Z]*$/,validRegRet:!0,errorHandle:"prevent"}),T.$("#ivs_cardsSize").numberfield({min:80,max:200,allowDecimal:!1,allowNegative:!1}),T.$("#ivs_levelRatio").numberfield({min:1,max:100,allowDecimal:!1,allowNegative:!1}),a("#longestCaptureInterval").numberfield({min:600,max:3600,allowDecimal:!1,allowNegative:!1}),a("#captureUploadingValue").numberfield({min:0,max:1440,allowDecimal:!1,allowNegative:!1}),a("#JamLineLimite").numberfield({min:1,max:100,allowDecimal:!1,allowNegative:!1}),a("#AlarmWaitTime").numberfield({min:5,max:200,allowDecimal:!1,allowNegative:!1}),a("[id^=ivs_snapT_s_]").numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),a("[id^=ivs_snapT_m_]").numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),a("#plateMatchingRatio_input").numberfield({min:0,max:100,allowDecimal:!1,allowNegative:!1}),T._getTemplates(),T.bind(),T._initSlider(),T.render()},bind:function(){a("#ivs_captureSetting").on("click",T._showPicSettingDialog),a("#ivs_copy").on("click",T._copyPicParam),a("#ivs_copy2").on("click",T._copySSSWithRule2),a('#advancedParams_picSetting_dialog [sel-for^="onChangePic_"]').on("change",function(){for(var b=a('[sel-for="onChangeCaptureAmount"]').val()-0,c=a('#advancedParams_picSetting_dialog [sel-for^="onChangePic_"]'),d=[],e=0;e<c.length;e++)d.push(c[e]);var f=d.slice(0,b).some(function(b){return"Medium"===a(b).val()}),g=d.slice(0,b).some(function(b){return"Feature"===a(b).val()});f?a('[sel-for="onChangeMiddleRatio"]').parent().removeClass("fn-hide"):a('[sel-for="onChangeMiddleRatio"]').parent().addClass("fn-hide"),g?a('[sel-for="onChangeFeatureRatio"]').parent().removeClass("fn-hide"):a('[sel-for="onChangeFeatureRatio"]').parent().addClass("fn-hide")}),e.addEvent("VideoAnalyzeConfig",function(a){var b=JSON.parse(a),c=b.EventParam.ShapeState;c&&3==c&&T._ocxEventDone(b.EventParam.ShapeID,b.EventName)})},render:function(){d.DevIntelliTracker.stop(),T._initRuleConfigureTable(),T._initVehicleLaneConfigTable(),a('[data-action="checkAll"]').hide(),T._getConfig()},leave:function(){w=[],e.hide(),e.SetModuleMode(1),e.EnableVideoAnalyseModule(!1),d.DevIntelliTracker.start()},_copyPicParam:function(){_=Z.Type,$=a('[sel-for="onCoptTo"]').val()},_copySSSWithRule2:function(){ab=Z.Type,bb=a('[sel-for="onCoptTo2"]').val()},_showPicSettingDialog:function(){k.dialog("close"),e.hide(),l.dialog("show");var b="";"TrafficBacking"===X||"TrafficCrossLane"===X||"TrafficOverLine"===X||"TrafficRetrograde"===X||"TrafficU-Turn"===X||"TrafficVehicleInBusRoute"===X?(b+='<option value="Far" t="ivs.DistantView"></option>',b+='<option value="Near" t="ivs.CloseView"></option>',b+='<option value="Feature" t="ivs.CarNumberFeature"></option>'):("TrafficParking"===X||"TrafficParkingB"===X||"TrafficParkingC"===X||"TrafficParkingD"===X)&&(b+='<option value="Far" t="ivs.DistantView"></option>',b+='<option value="Medium" t="ivs.MiddleView"></option>',b+='<option value="Near" t="ivs.CloseView"></option>',b+='<option value="Feature" t="ivs.CarNumberFeature"></option>'),a("#illegalAlarmOn").val(y.SingleInterval[0]),a('[sel-for="onChangeMiddleRatio"]').parent().addClass("fn-hide"),a('[sel-for="onChangeFeatureRatio"]').parent().addClass("fn-hide");for(var c=y.SingleInterval.length,d=y.SnapShotType.length,f=a('[sel-for="onChangeCaptureAmount"]').val()-0,g=0;f>g;g++)a('[sel-for="onChangePic_'+(g+1)+'"]').empty(),a('[sel-for="onChangePic_'+(g+1)+'"]').append(b).translation();for(var h=1;c>h;h++)a("#ivs_snapT_m_"+h).val(parseInt(y.SingleInterval[h]/60)),a("#ivs_snapT_s_"+h).val(y.SingleInterval[h]%60);for(var i=0;d>i;i++)a('[sel-for="onChangePic_'+(i+1)+'"]').val(y.SnapShotType[i]).change();a('[sel-for="onChangeMiddleRatio"]').val(y.MediumRatio),a('[sel-for="onChangeFeatureRatio"]').val(y.FeatureRatio)},_initSlider:function(){a("#parkCapture_slider").slider({min:0,max:10,complete:function(a){T.$(a.target)}})},_initRuleConfigureTable:function(){J=T.$("#tr_ruleConfigure_table").table({pageable:!1,reSelectRow:!0,pressEnter:!1,selectSingle:!1,height:140,columns:[{t:"com.Enable",width:"8%",check:"Enable"},{t:"com.Number",width:"8%",render:function(a){return a._index+1}},{t:"com.Name",width:"20%",fields:"Name"},{t:"com.Type",width:"19%",fields:"Type",valueMap:i,editor:function(b,c){var d="",e=c.valueMap;if(e){d='<select style="overflow-wrap:initial">';for(var f in e)d+='<option value="'+f+'">'+e[f]+"</option>";d+="</select>"}return a(d)}},{t:"ivs.Protract",width:"10%",action:"draw",icon:"i-draw",handle:function(a){T._onDrawRuleClick(a)}},{t:"ivs.AdvancedParams",action:"advance",icon:"i-advence",width:"20%",handle:function(b){e.hide(),k.dialog("show");var c=a("#ivsTrafficParkEventHandler").parent().parent().css("height");a("#parkCapture_slider").parent().parent().css("height",c),a(".violation-type-normal").removeClass("fn-hide"),a(".violation-type-jam").removeClass("fn-hide"),a(".violation-type-jam-show").addClass("fn-hide"),a("#ivs_captureSetting").removeClass("fn-hide"),a('[sel-for="onReplacePicNum"]').parent().hasClass("fn-hide")&&a('[sel-for="onReplacePicNum"]').parent().removeClass("fn-hide");var d=a('[sel-for="onChangeCaptureAmount"]'),f="";d.empty();for(var g=1;6>g;g++)f+='<option value="'+(g+1)+'">'+(g+1)+"</option>";d.append(f),X=b.Type,T._renderPresetDom('[sel-for="onCoptTo"]'),T._renderPresetDom('[sel-for="onCoptTo2"]'),Z=b;var h=tl("ivs.Preset")+b.PtzPresetId+" "+b.Name;if(a("#dialogTip").text(h),-1!==D)for(var i=o[0],g=0;g<i.length;g++)if(i[g].PtzPresetId===D&&i[g].Id===b.Id){v=i[g];break}if(-1!==D)for(var j=p[0].PresetRecord,g=0;g<j.length;g++)if(j[g].PtzPresetId===D)for(var l=0;l<j[g].Records.length;l++)if(j[g].Records[l].RuleId===b.Id){x=j[g].Records[l];break}if(-1!==D)for(var m=q[0].PresetImage,g=0;g<m.length;g++)if(m[g].PtzPresetId===D)for(var l=0;l<m[g].Images.length;l++)if(m[g].Images[l].RuleId===b.Id){B=m[g].Images[l];break}if(-1!==D)for(var n=r[0],g=0;g<n.length;g++)if(n[g].PresetID===D)for(var l=0;l<n[g].SnapShotWithRule.length;l++)if(n[g].SnapShotWithRule[l].RuleId===b.Id){y=n[g].SnapShotWithRule[l];break}if(-1!==D)for(var t=s[0],g=0;g<t.length;g++)if(t[g].PresetID===D)for(var l=0;l<t[g].MosaicWithRule.length;l++)if(t[g].MosaicWithRule[l].RuleId===b.Id){z=t[g].MosaicWithRule[l];break}if("TrafficBacking"===X||"TrafficCrossLane"===X||"TrafficOverLine"===X||"TrafficRetrograde"===X||"TrafficU-Turn"===X||"TrafficVehicleInBusRoute"===X)a(".violation-type-normal").addClass("fn-hide"),a('[sel-for="onReplacePicNum"]').parent().addClass("fn-hide");else if("TrafficJam"===X){a(".violation-type-jam").addClass("fn-hide"),a(".violation-type-jam-show").removeClass("fn-hide"),a("#JamLineLimite").val(v.Config.JamLineMargin),a("#AlarmWaitTime").val(v.Config.Interval),a('<option value="1">1</option>').insertBefore(d.find('option[value="2"]'));for(var u=d.find("option").length,g=1;u>g;g++)d.find('option[value="'+(g+1)+'"]').remove();a("#ivs_captureSetting").addClass("fn-hide"),a('[sel-for="onReplacePicNum"]').parent().addClass("fn-hide")}a("#ivsTrafficParkEventHandler").eventHandler("set",v.EventHandler),a('[sel-for="onChangeCaptureAmount"]').val(y.SnapShotType.length).change(),a("#parkCapture_slider").slider("value",v.Config.Sensitivity),a("#zoomGetEvidence").prop("checked",v.Config.ZoomEnable),a("#uploadViolationVideo_title_Enable").prop("checked",x.Enable),a("#uploadViolationVideo").prop("checked",x.UploadRecordEnable),a("#origpic_localSave").prop("checked",B.NormalSnap.SaveSnap),a("#origpic_report").prop("checked",B.NormalSnap.UploadSnap),a('[sel-for="onChangeOrigPictureResolution"]').val(B.NormalSnap.ReduceRate),a('[sel-for="onChangeOrigPicQuality"]').val(B.NormalSnap.PicCompressRate),a("#mergpic_localSave").prop("checked",B.CombinSnap.SaveSnap),a("#mergpic_report").prop("checked",B.CombinSnap.UploadSnap),a('[sel-for="onChangeCompPictureResolution"]').val(B.CombinSnap.ReduceRate),a('[sel-for="onChangeCompPicQuality"]').val(B.CombinSnap.PicCompressRate),a("#privatePicReplace_enable").prop("checked",y.UserImage.Enable),a('[sel-for="onReplacePicNum"]').val(y.UserImage.IndexInGroup),a("#longestCaptureInterval").val(y.SnapTimeOutInterval),a("#captureUploadingValue").val(y.RepeatInterval/60),a("#zeroClearTime_enable").prop("checked",y.RepeatIntervalFlag),a("#snapShot_enable").prop("checked",1===y.SnapMode?!0:!1);for(var g=0;g<y.SnapShotType.length;g++)a("#number_"+(g+1)).prop("checked",!1);for(var w=y.UploadMask||0,A=w.toString(2).split("").reverse(),g=0;g<A.length;g++)A[g]-0===1?a("#number_"+(g+1)).prop("checked",!0):a("#number_"+(g+1)).prop("checked",!1);for(var g=0;g<y.SnapShotType.length;g++)a("#number_"+(g+1)).prop("disabled",!1),"Far"===y.SnapShotType[g]&&(a("#number_"+(g+1)).prop("disabled",!0),a("#number_"+(g+1)).prop("checked",!1));a(a('input[name="MosaicTwoMethod"][value="'+z.MosaicTwoMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicThreeMethod"][value="'+z.MosaicThreeMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicFourMethod"][value="'+z.MosaicFourMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicFiveMethod"][value="'+z.MosaicFiveMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicSixMethod"][value="'+z.MosaicSixMethod+'"]')[0]).prop("checked",!0)}},{t:"com.Delete",width:"10%",action:"delete",icon:"i-clear",handle:function(a){this.del(a),T._delRuleLanes(a),T._delMultiSceneRecordItem(a),T._delTrafficImageItem(a),T._delSceneSnapShotWithRule2Item(a),T._delTrafficSnapMosaic2Item(a)}},{width:"5%",titleIcon:"i-add",titleAction:function(b){return a(b.target).hasClass("disabled")?void 0:T._onAddRuleClick()}}],onRowSelect:function(a,b){if(Y=b.data.Type,n_sel=b.rowIndex,-1!==D)for(var c=o[0],d=0;d<c.length;d++)if(c[d].PtzPresetId===D&&c[d].Id===b.data.Id){v=c[d];break}T._cancelAllHightLightRuleLanes(),T._hightLightRuleLanes(b.data)},onblurEditor:function(b,c){if("Type"===c.field){for(var d in V)if(d===c.editVal&&c.editVal!==Y){var f=T._changeRuleNameNumber(c.editVal);c.data.Name=V[d]+D+"_"+f}c.editVal!==Y&&c.data.ShapeID&&e.DeleteVideoAnalyseShape(c.data.ShapeID)}if(-1!==D)for(var g=r[0],d=0;d<g.length;d++)if(g[d].PresetID===D)for(var h=0;h<g[d].SnapShotWithRule.length;h++){if(g[d].SnapShotWithRule[h].RuleId===c.data.Id&&g[d].SnapShotWithRule[h].RuleType===c.editVal){y=g[d].SnapShotWithRule[h];break}if(g[d].SnapShotWithRule[h].RuleId===c.data.Id&&g[d].SnapShotWithRule[h].RuleType!==c.editVal){switch(c.editVal){case"TrafficBacking":y=a.extend(!0,{},ob.SnapShotWithRule[0]);break;case"TrafficCrossLane":y=a.extend(!0,{},pb.SnapShotWithRule[0]);break;case"TrafficJam":y=a.extend(!0,{},qb.SnapShotWithRule[0]);break;case"TrafficOverLine":y=a.extend(!0,{},rb.SnapShotWithRule[0]);break;case"TrafficParking":y=a.extend(!0,{},sb.SnapShotWithRule[0]);break;case"TrafficParkingB":y=a.extend(!0,{},tb.SnapShotWithRule[0]);break;case"TrafficParkingC":y=a.extend(!0,{},ub.SnapShotWithRule[0]);break;case"TrafficParkingD":y=a.extend(!0,{},vb.SnapShotWithRule[0]);break;case"TrafficParkingManual":y=a.extend(!0,{},wb.SnapShotWithRule[0]);break;case"TrafficRetrograde":y=a.extend(!0,{},xb.SnapShotWithRule[0]);break;case"TrafficU-Turn":y=a.extend(!0,{},yb.SnapShotWithRule[0]);break;case"TrafficVehicleInBusRoute":y=a.extend(!0,{},zb.SnapShotWithRule[0])}y.RuleId=c.data.Id,g[d].SnapShotWithRule[h]=y;break}}if(-1!==D)for(var i=o[0],d=0;d<i.length;d++){if(i[d].PtzPresetId===D&&i[d].Id===c.data.Id&&i[d].Type===c.editVal){v=i[d];break}if(i[d].PtzPresetId===D&&i[d].Id===c.data.Id&&i[d].Type!==c.editVal){switch(c.editVal){case"TrafficBacking":v=a.extend(!0,{},cb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficCrossLane":v=a.extend(!0,{},db),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficJam":v=a.extend(!0,{},eb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficOverLine":v=a.extend(!0,{},fb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficParking":v=a.extend(!0,{},gb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficParkingB":v=a.extend(!0,{},hb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficParkingC":v=a.extend(!0,{},ib),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficParkingD":v=a.extend(!0,{},jb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficParkingManual":v=a.extend(!0,{},kb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficRetrograde":v=a.extend(!0,{},lb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficU-Turn":v=a.extend(!0,{},mb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[];break;case"TrafficVehicleInBusRoute":v=a.extend(!0,{},nb),v.PtzPresetId=D,v.Id=c.data.Id,v.Config.DetectRegion=[]}i[d]=v;break}}}})},_initVehicleLaneConfigTable:function(){K=T.$("#tr_vehicleLaneConfig_table").table({pageable:!1,reSelectRow:!0,pressEnter:!1,height:140,columns:[{t:"com.Number",width:"15%",render:function(a){return a._index+1}},{t:"ivs.LaneLineName",width:"20%",fields:"Number",render:function(a){return tl("itc.LaneLine")+a.Number}},{t:"itc.CarWayType",fields:"Type",width:"28%",valueMap:j,editor:function(b,c){var d="",e=c.valueMap;if(e){d='<select style="overflow-wrap:initial">';for(var f in e)d+='<option value="'+f+'">'+e[f]+"</option>";d+="</select>"}return a(d)}},{t:"ivs.Protract",width:"16%",action:"draw",icon:"i-draw",handle:function(a){T._drawCarLanes("i-draw",a)}},{t:"com.Delete",width:"16%",action:"delete",icon:"i-clear",handle:function(b){e.hide();var c=(b.Number,this);a.confirm(tl("com.Save"),tl("com.SureDelLaneTip"),function(){c.del(b),T._openVideo(),T._delCarLanes(b)})}},{width:"5%",titleIcon:"i-add",titleAction:function(b){a(b.target).hasClass("disabled")||T._onAddLaneClick()}}],onRowSelect:function(a,b){T._cancelAllHightLightCarLanes(),P=b.data.Number,T._hightLightCarLanes(b.data),T._refreshLaneProperty()}})},_getTemplates:function(){d.VideoInAnalyse.getTemplateGlobal().done(function(a){L=a}),d.VideoInAnalyse.getTemplateRule("TrafficPark").done(function(a){M=a,cb=M.TrafficPark.TrafficBacking,db=M.TrafficPark.TrafficCrossLane,eb=M.TrafficPark.TrafficJam,fb=M.TrafficPark.TrafficOverLine,gb=M.TrafficPark.TrafficParking,hb=M.TrafficPark.TrafficParkingB,ib=M.TrafficPark.TrafficParkingC,jb=M.TrafficPark.TrafficParkingD,kb=M.TrafficPark.TrafficParkingManual,lb=M.TrafficPark.TrafficRetrograde,mb=M.TrafficPark["TrafficU-Turn"],nb=M.TrafficPark.TrafficVehicleInBusRoute,V.TrafficBacking=cb.Name,V.TrafficCrossLane=db.Name,V.TrafficJam=eb.Name,V.TrafficOverLine=fb.Name,V.TrafficParking=gb.Name,V.TrafficParkingB=hb.Name,V.TrafficParkingC=ib.Name,V.TrafficParkingD=jb.Name,V.TrafficParkingManual=kb.Name,V.TrafficRetrograde=lb.Name,V["TrafficU-Turn"]=mb.Name,V.TrafficVehicleInBusRoute=nb.Name}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficBacking").done(function(a){ob=a.TrafficPark.TrafficBacking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficCrossLane").done(function(a){pb=a.TrafficPark.TrafficCrossLane}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficJam").done(function(a){qb=a.TrafficPark.TrafficJam}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficOverLine").done(function(a){rb=a.TrafficPark.TrafficOverLine}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficParking").done(function(a){sb=a.TrafficPark.TrafficParking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficParkingB").done(function(a){tb=a.TrafficPark.TrafficParking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficParkingC").done(function(a){ub=a.TrafficPark.TrafficParking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficParkingD").done(function(a){vb=a.TrafficPark.TrafficParking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficParkingManual").done(function(a){wb=a.TrafficPark.TrafficParkingManual}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficRetrograde").done(function(a){xb=a.TrafficPark.TrafficRetrograde}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficU-Turn").done(function(a){yb=a.TrafficPark["TrafficU-Turn"]}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("TrafficPark",0,"TrafficVehicleInBusRoute").done(function(a){zb=a.TrafficPark.TrafficVehicleInBusRoute}),d.VideoInAnalyse.getTemplateTrafficViolationCode().done(function(a){Ab=a}),d.VideoInAnalyse.getTemplatePresetRecord().done(function(a){Bb=a}),d.VideoInAnalyse.getTemplatePresetImage().done(function(a){Cb=a}),d.VideoInAnalyse.getTemplateTrafficSnapMosaic2().done(function(a){Db=a}),d.VideoInAnalyse.getTemplateSnapOSD("TrafficPark").done(function(a){Eb=a}),d.VideoInAnalyse.getTemplateCalibrate().done(function(a){Fb=a})},_onDrawRuleClick:function(a){if(!T.$("#tr_ruleConfigure_table").find('[data-index="'+a._index+'"] [data-action="checkItem"]').prop("checked"))return void T.$("#tr_ruleConfigure_tip").tip("warning",tl("ivs.DrawLaneBeforeSelect"));var b=a.ShapeID||0;e.DeleteVideoAnalyseShape(b),e.CreateMainVideoAnalyseShape(0,a.Name,"Polygon","Polygon","","").done(function(b){a.ShapeID=b,e.SetVideoAnalyseContainerTip(0,tl("Please draw region")),Q=!1,R=!0})},_hightLightRuleLanes:function(a){var b=a.ShapeID||0;T.$("#tr_ruleConfigure_table").find('[data-index="'+n_sel+'"] [data-action="checkItem"]').prop("checked")?(e.ShowVideoAnalyseShape(b,!0),e.SelectCurVideoAnalyseShape(b,!0)):e.ShowVideoAnalyseShape(b,!1)},_delRuleLanes:function(a){Q===!1&&(Q=!0,e.SetVideoAnalyseContainerTip(0,tl("")));var b=a.ShapeID||0;e.DeleteVideoAnalyseShape(b);var c=0;o[0].forEach(function(b,d){return b.Id===a.Id?(c=d,!1):void 0}),c>-1&&o[0].splice(c,1)},_delMultiSceneRecordItem:function(a){for(var b=0,c=0,d=0;d<p[0].PresetRecord.length;d++)if(p[0].PresetRecord[d].PtzPresetId===D){b=d;break}p[0].PresetRecord[b].Records.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&p[0].PresetRecord[b].Records.splice(c,1)},_delTrafficImageItem:function(a){for(var b=0,c=0,d=0;d<q[0].PresetImage.length;d++)if(q[0].PresetImage[d].PtzPresetId===D){b=d;break}q[0].PresetImage[b].Images.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&q[0].PresetImage[b].Images.splice(c,1)},_delSceneSnapShotWithRule2Item:function(a){for(var b=0,c=0,d=0;d<r[0].length;d++)if(r[0][d].PresetID===D){b=d;break}r[0][b].SnapShotWithRule.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&r[0][b].SnapShotWithRule.splice(c,1)},_delTrafficSnapMosaic2Item:function(a){for(var b=0,c=0,d=0;d<s[0].length;d++)if(s[0][d].PresetID===D){b=d;break}s[0][b].MosaicWithRule.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&s[0][b].MosaicWithRule.splice(c,1)},_cancelAllHightLightRuleLanes:function(){for(var a=0;a<J.table("dataSource").length;a++){var b=J.table("dataSource")[a].ShapeID||0;e.SelectCurVideoAnalyseShape(b,!1)}},_onAddRuleClick:function(){for(var b=0,c=0;c<o[0].length;c++)o[0][c].PtzPresetId===D&&b++;if(b>=I)return void T.$("#tr_ruleConfigure_tip").tip("error",tl("com.NoMoreRule"));var d=T._findRuleNum(),e=a.extend(!0,{},gb),f=T._changeRuleNameNumber("TrafficParking");e.PtzPresetId=D,e.Id=d,e.Name=gb.Name+D+"_"+f,e.Config.DetectRegion=[],J.table("add",e,b).table("selectRow",b),o[0].push(e);for(var g=null,h=!1,c=0;c<p[0].PresetRecord.length;c++)if(p[0].PresetRecord[c].PtzPresetId===D){g=a.extend(!0,{},Bb.Records[0]),g.RuleId=d,p[0].PresetRecord[c].Records.push(g),h=!0;break}h||(g=a.extend(!0,{},Bb),g.PtzPresetId=D,g.Records[0].RuleId=d,p[0].PresetRecord.push(g));for(var i=null,j=!1,c=0;c<q[0].PresetImage.length;c++)if(q[0].PresetImage[c].PtzPresetId===D){i=a.extend(!0,{},Cb.Images[0]),i.RuleId=d,q[0].PresetImage[c].Images.push(i),j=!0;break}j||(i=a.extend(!0,{},Cb),i.PtzPresetId=D,i.Images[0].RuleId=d,q[0].PresetImage.push(i));for(var k=null,l=!1,c=0;c<r[0].length;c++)if(r[0][c].PresetID===D){k=a.extend(!0,{},sb.SnapShotWithRule[0]),k.RuleId=d,r[0][c].SnapShotWithRule.push(k),l=!0;break}l||(k=a.extend(!0,{},sb),k.PresetID=D,k.SnapShotWithRule[0].RuleId=d,r[0].push(k));for(var m=null,n=!1,c=0;c<s[0].length;c++)if(s[0][c].PresetID===D){m=a.extend(!0,{},Db.MosaicWithRule[0]),m.RuleId=d,s[0][c].MosaicWithRule.push(m),n=!0;break}n||(m=a.extend(!0,{},Db),m.PresetID=D,m.MosaicWithRule[0].RuleId=d,s[0].push(m))},_onAddLaneClick:function(){if(u.Detail.Lanes.length>=H)return void T.$("#tr_laneConfigure_tip").tip("error",tl("com.LaneMaxNumTip"));var b=T._findCarLaneNum(),c=a.extend(!0,{},L.Scene1.Detail.Lanes[0]);c.Number=b,c.Type="Light-duty";var d=u.Detail.Lanes.length;K.table("add",c,d).table("selectRow",d),T.$('[sel-for="onChangeLeftStyle"]').val(L.Scene1.Detail.Lanes[0].LeftLineType),T.$('[sel-for="onChangeRightStyle"]').val(L.Scene1.Detail.Lanes[0].RightLineType)},_drawCarLanes:function(a,b){var c=T._getLineColor(b),d=b.ShapeID||0;e.DeleteVideoAnalyseShape(d),e.CreateMainVideoAnalyseShape(0,tl("itc.LaneLine")+b.Number,"LaneShape","LaneShape",'{"LeftLine" : {"Color":['+c.leftColor+'],"LineType": ['+c.leftStyle+']}, "RightLine" : {"Color":['+c.rightColor+'],"LineType": ['+c.rightStyle+"]}}","").done(function(a){b.ShapeID=a,e.SetVideoAnalyseContainerTip(0,tl("Please draw region")),Q=!0,R=!1})},_ocxEventDone:function(a,b){R===!1?R=!0:Q===!1&&(Q=!0),e.GetVideoAnalyseShapeConfigData(a).done(function(c){var d=JSON.parse(c);if(d.Polygon){for(var f=0;f<o[0].length;f++)if(o[0][f].ShapeID===a&&o[0][f].PtzPresetId===D){v=o[0][f];break}T._saveRuleProperty(d.Polygon)}else if(d.LeftLine&&d.RightLine){for(var g=0;g<u.Detail.Lanes.length;g++)if(u.Detail.Lanes[g].ShapeID===a&&u.PtzPresetId===D){P=u.Detail.Lanes[g].Number;break}T._saveLaneProperty(d.LeftLine,d.RightLine)}e.SetVideoAnalyseShapeShowName(a,b)})},_refreshLaneProperty:function(){if(null!==u&&-1!==P)for(var a=u.Detail.Lanes,b=[],c=0;c<a.length;c++)if(b.push(a[c].Number),a[c].Number===P){T.$('[sel-for="onChangeLeftStyle"]').val(a[c].LeftLineType),T.$('[sel-for="onChangeRightStyle"]').val(a[c].RightLineType);break}},_saveLaneProperty:function(a,b){if(null!==u&&-1!==P)for(var c=0;c<u.Detail.Lanes.length;c++)if(u.Detail.Lanes[c].Number===P){u.Detail.Lanes[c].LeftLine[0]=a[0],u.Detail.Lanes[c].LeftLine[1]=a[1],u.Detail.Lanes[c].RightLine[0]=b[0],u.Detail.Lanes[c].RightLine[1]=b[1];break}},_saveRuleProperty:function(a){v.Config.DetectRegion=a},onChangeLeftStyle:function(){for(var a=0;a<u.Detail.Lanes.length;a++)if(u.Detail.Lanes[a].Number===P){u.Detail.Lanes[a].LeftLineType=T.$('[sel-for="onChangeLeftStyle"]').val();break}},onChangeRightStyle:function(){for(var a=0;a<u.Detail.Lanes.length;a++)if(u.Detail.Lanes[a].Number===P){u.Detail.Lanes[a].RightLineType=T.$('[sel-for="onChangeRightStyle"]').val();break}},_getLineColor:function(a){var b=a.LeftLineType,c="",d=0;"WhiteSolid"==b?(c="255,255,255,1",d=0):"WhiteDotted"==b?(c="255,255,255,1",d=1):(c="255,255,0,1",d=0);var e=a.RightLineType,f="",g=0;return"WhiteSolid"==e?(f="255,255,255,1",g=0):"WhiteDotted"==e?(f="255,255,255,1",g=1):(f="255,255,0,1",g=0),{leftColor:c,leftStyle:d,rightColor:f,rightStyle:g}},_hightLightCarLanes:function(a){var b=a.ShapeID||0;e.SelectCurVideoAnalyseShape(b,!0)},_delCarLanes:function(a){R===!1&&(R=!0,e.SetVideoAnalyseContainerTip(0,tl("")));var b=a.ShapeID||0;e.DeleteVideoAnalyseShape(b)},_cancelAllHightLightCarLanes:function(){for(var a=0;a<K.table("dataSource").length;a++){var b=K.table("dataSource")[a].ShapeID||0;e.SelectCurVideoAnalyseShape(b,!1)}},_changeRuleNameNumber:function(a){for(var b=1,c=0;c<J.table("dataSource").length;c++)if(J.table("dataSource")[c].Type===a){var d=J.table("dataSource")[c].Name.split("_")[1]-0;if(b!==d)return b;b++}return b},_findRuleNum:function(){for(var a=[],b=0;b<o[0].length;b++)a.push(o[0][b].Id);var c=a.sort(function(a,b){return a-b});return c[c.length-1]+1-0},_findCarLaneNum:function(){for(var b=[],c=[],d=a.extend(!0,[],u.Detail.Lanes),e=0;H>e;e++)b.push(e);for(var e=0;e<d.length;e++)c.push(d[e].Number);if(0==c.length)return 0;for(var e=0;e<c.length;e++)for(var f=0;f<b.length;f++)b[f]==c[e]&&(b.splice(f,1),f--);return b[0]},onWorkPeriod:function(){v&&v&&v.EventHandler&&v.EventHandler.TimeSection&&h.open(v.EventHandler.TimeSection).done(function(a){v.EventHandler.TimeSection=a})},_renderPresetDom:function(b){var c=a(b),d="",e="";for(var f in m[0]){var g=m[0][f];if(/Scene/.test(f)&&g.Type===F){if(e=m[0][f].PtzPresetId,0===e||e===D)continue;1e3===e||(d+="<option value='"+e+"' presetId='"+e+"'>"+tl("ivs.Preset")+e+"</option>")}}d+='<option value="all" t="com.All"></option>',c.empty().append(d).translation()},_getConfig:function(b){E=["VideoAnalyseGlobal","VideoAnalyseCalibrate","VideoAnalyseRule","MultiSceneRecord","TrafficImage","SceneSnapShotWithRule2","TrafficSnapMosaic2","TrafficViolationCode","SnapOSD"],a.when(d.ConfigManager.getConfig(E),g.get("VideoAnalyse",!0)).done(function(a,c){m=a[0].params.table,n=a[1].params.table,o=a[2].params.table,p=a[3].params.table,q=a[4].params.table,r=a[5].params.table,s=a[6].params.table,t=a[7].params.table,U=a[8].params.table,G=c.SupportedRules,b&&T.$("#parkCapture_tip").tip("success",tl("Operateingsuccess")),T._renderElements()})},_renderElements:function(){if(m&&m[0]){var a="",b="",c="";for(var d in m[0]){var e=m[0][d];if(/Scene/.test(d)&&e.Type===F){if(W[d]=e.PtzPresetId,b=m[0][d].PtzPresetId,0===b||1e3===b)continue;a+="<option value='"+b+"' presetId='"+b+"'>"+tl("ivs.Preset")+b+"</option>"}}if(G.TrafficPark){for(var f=0;f<G.TrafficPark.length;f++)"TrafficParkingManual"!==G.TrafficPark[f]&&("TrafficJam"===G.TrafficPark[f]?(i[G.TrafficPark[f]]=tl("itc.BreakJam"),c+="<option value='"+G.TrafficPark[f]+"'>"+tl("itc.BreakJam")+"</option>"):(i[G.TrafficPark[f]]=tl("appEventEx"+G.TrafficPark[f]),c+="<option value='"+G.TrafficPark[f]+"'>"+tl("appEventEx"+G.TrafficPark[f])+"</option>"));T.$('[sel-for="onChangeRuleType"]').empty().append(c)}""!==a?(T.$("[sel-for='onChangePreset']").empty().append(a),T.$(".existPreset").removeClass("disabled"),T.$("[data-action='titleAction']").removeClass("disabled"),T._gotoSence(T.$("[sel-for='onChangePreset']").val()-0),T.$('[sel-for="onChangeMode"]').parent().parent().removeClass("fn-hide"),T.$("select[sel-for='onChangePreset']").change(),T.$('[sel-for="onChangeRuleType"]').val(G.TrafficPark[0]).change(),u.Detail.Lanes[0]&&u.Detail.Lanes[0].LeftLineType&&u.Detail.Lanes[0]&&u.Detail.Lanes[0].RightLineType?(T.$('[sel-for="onChangeLeftStyle"]').val(u.Detail.Lanes[0].LeftLineType),T.$('[sel-for="onChangeRightStyle"]').val(u.Detail.Lanes[0].RightLineType)):(T.$('[sel-for="onChangeLeftStyle"]').val("Yellow"),T.$('[sel-for="onChangeRightStyle"]').val("Yellow"))):(T.$("[sel-for='onChangePreset']").empty().append("<option value='-1'>"+tl("com.AddPlanFirstTip")+"</option>"),T.$(".existPreset").addClass("disabled"),T.$("[data-action='titleAction']").addClass("disabled"),K.table("dataSource",[]),J.table("dataSource",[]),T.$('[sel-for="onChangeMode"]').parent().parent().addClass("fn-hide"),T.$("#provinceAbbreviation").val("")),T._openVideo()}},_openVideo:function(){e.cover("#ivs_parkCapture_video"),e.SetRegionNum(0),e.SetModuleMode(2),e.EnableVideoAnalyseModule(!0),e.ConnectRealVideo(0,1)},_gotoSence:function(a){d.PTZ.gotoPreset(a)
},onChangeRuleType:function(){var a=T.$('[sel-for="onChangeRuleType"]').val();T._changeIllegalRuleCode(a),T._changeIllegalRuleName(a)},_changeIllegalRuleCode:function(a){Object.keys(C.ViolationCode).forEach(function(b){b===a.slice(7)&&T.$("#illegalRuleCode").val(C.ViolationCode[b])})},_changeIllegalRuleName:function(a){Object.keys(C.ViolationCode).forEach(function(b){b===a.slice(7)&&T.$("#illegalRuleName").val(C.ViolationCode[b+"ShowName"])})},onChangeMode:function(){var a=T.$('[sel-for="onChangeMode"]').val();"Plate"===a?(T.$("[data-calibrateType]").addClass("fn-hide"),T.$('[data-calibrateType="ManualCalibrate"]').removeClass("fn-hide"),T.$("#ivs_cardsSize").val(A.CalibratePixel)):"Scale"===a&&(T.$("[data-calibrateType]").addClass("fn-hide"),T.$('[data-calibrateType="AutoCalibrate"]').removeClass("fn-hide"),T.$("#ivs_levelRatio").val(A.CalibrateArea[0].ObjectScale))},onChangePreset:function(b){w=[],D=T.$(b.target).val()-0,T._gotoSence(D);for(var c in m[0]){var d=m[0][c];/Scene/.test(c)&&d.Type===F&&d.PtzPresetId===D&&(u=m[0][c])}for(var e=[],f=0;f<n[0].length;f++){var d=n[0][f];e.push(d.PtzPresetID),d.PtzPresetID===D&&(A=n[0][f])}-1===e.indexOf(D)&&(A=a.extend(!0,{},Fb),A.PtzPresetID=D,n[0].push(A)),S?(T.$('[sel-for="onChangeMode"]').val("Plate").change(),S=!1):T.$('[sel-for="onChangeMode"]').val(A.CalibrateArea[0].Method).change(),"Plate"===A.CalibrateArea[0].Method?T.$("#ivs_cardsSize").val(A.CalibratePixel):"Scale"===A.CalibrateArea[0].Method&&T.$("#ivs_levelRatio").val(A.CalibrateArea[0].ObjectScale),T.$("#provinceAbbreviation").val(u.Detail.PlateHints.join(" ")||m[0].Scene.Detail.PlateHints.join(" ")),T.$("#reportNoLicenseCar").prop("checked","all"===u.Detail.ReportMode?!0:!1),T.$("#plateMatchingRatio_input").val(u.Detail.PlateMatch);for(var f=0;f<o[0].length;f++)o[0][f].PtzPresetId===D&&o[0][f].Class===F&&w.push(o[0][f]);for(var g=[],f=0;f<t[0].length;f++)g.push(t[0][f].PtzPresetId),t[0][f].PtzPresetId===D&&(C=t[0][f]);-1===g.indexOf(D)&&(C=a.extend(!0,{},Ab),C.PtzPresetId=D,t[0].push(C));for(var h=[],f=0;f<U[0].length;f++)h.push(U[0][f].PresetID),U[0][f].PresetID===D&&(Gb=U[0][f].OSDWithClass);if(-1===h.indexOf(D)){Gb=a.extend(!0,[],Eb.TrafficPark.OSDWithClass);var i={OSDWithClass:Gb,PresetID:D};U[0].push(i),i={}}T.onChangeRuleType(),T._renderRuleLaneOcx(w),T._renderCarLaneOcx(u.Detail.Lanes),J.table("dataSource",w).table("selectRow",w.length-1),K.table("dataSource",u.Detail.Lanes).table("selectRow",u.Detail.Lanes.length-1)},_renderRuleLaneOcx:function(a){e.DeleteAllVideoAnalyseShape();for(var b=0;b<a.length;b++){for(var c=[],d=0;d<a[b].Config.DetectRegion.length;d++)c[d]="["+a[b].Config.DetectRegion[d][0]+","+a[b].Config.DetectRegion[d][1]+"]";e.CreateMainVideoAnalyseShape(0,a[b].Name,"Polygon","Polygon",'{"Polygon":['+c+"]}","").done(function(c){e.SetVideoAnalyseShapeShowName(c,a[b].Name),a[b].ShapeID=c,a[b].Enable?e.ShowVideoAnalyseShape(c,!0):e.ShowVideoAnalyseShape(c,!1)})}},_renderCarLaneOcx:function(a){for(var b=0;b<a.length;b++){for(var c=[],d=[],f=0;f<a[b].LeftLine.length;f++)c[f]="["+a[b].LeftLine[f][0]+","+a[b].LeftLine[f][1]+"]",d[f]="["+a[b].RightLine[f][0]+","+a[b].RightLine[f][1]+"]";var g=T._getLineColor(a[b]);e.CreateMainVideoAnalyseShape(0,"","LaneShape","LaneShape",'{"LeftLine" : {"Point" : ['+c+'],"Color":['+g.leftColor+'],"LineType": ['+g.leftStyle+']}, "RightLine" : {"Point": ['+d+'],"Color":['+g.rightColor+'],"LineType": ['+g.rightStyle+"]}}","").done(function(c){e.SetVideoAnalyseShapeShowName(c,tl("itc.LaneLine")+a[b].Number),a[b].ShapeID=c})}},onChangeCaptureAmount:function(){T._renderUpPic(),T._renderReplacePic(),T._syncImageTable()},_renderUpPic:function(){var b=a('[sel-for="onChangeCaptureAmount"]').val()-0;a("[id^='number_']").css("display","none");for(var c=0;b>c;c++)a("#number_"+(c+1)).css("display",""),a("#number_span_"+(c+1)).css("display","");5===b?("Near"===y.SnapShotType[3]?(y.SnapShotType[4]="Far",a("#number_5").attr("disabled",!0),a("#number_5").attr("checked",!1)):"Far"===y.SnapShotType[3]&&(y.SnapShotType[4]="Near",a("#number_5").attr("disabled",!1)),y.SingleInterval[4]=y.SingleInterval[3]):6===b&&("Near"===y.SnapShotType[3]?(y.SnapShotType[4]="Far",a("#number_5").attr("disabled",!0),a("#number_5").attr("checked",!1),y.SnapShotType[5]="Near",a("#number_6").attr("disabled",!1)):"Far"===y.SnapShotType[3]&&(y.SnapShotType[4]="Near",a("#number_5").attr("disabled",!1),y.SnapShotType[5]="Far",a("#number_6").attr("disabled",!0),a("#number_6").attr("checked",!1)),y.SingleInterval[4]=y.SingleInterval[3],y.SingleInterval[5]=y.SingleInterval[3])},_renderReplacePic:function(){a('[sel-for="onReplacePicNum"]').empty();for(var b=a('[sel-for="onChangeCaptureAmount"]').val()-0,c="",d=0;b>d;d++)c+='<option value="'+d+'" t="'+(d+1)+'"></option>';a('[sel-for="onReplacePicNum"]').append(c).translation()},_syncImageTable:function(){var b=a('[sel-for="onChangeCaptureAmount"]').val()-0;a("[data-snapcap]").each(function(c,d){var e=a(d).attr("data-snapcap");e.indexOf(b)>-1?a(d).removeClass("fn-hide"):a(d).addClass("fn-hide")}),a(".TPMosaic").addClass("fn-hide"),a(".TPMosaic"+b).removeClass("fn-hide")},onRefresh:function(){return T.$('[sel-for="onChangePreset"]').val()-0===-1?void T.$("#parkCapture_tip").tip("warning",tl("com.AddPlanFirstTip")):void T._getConfig(!0)},onConfirm:function(){if(Q&&R){var b=T.$('[sel-for="onChangeMode"]').val();A.CalibrateArea[0].Method=b,"Plate"===b?A.CalibratePixel=T.$("#ivs_cardsSize").val()-0:"Scale"===b&&(A.CalibrateArea[0].ObjectScale=T.$("#ivs_levelRatio").val()-0);var c="";for(var e in W)if(W[e]===D){c=e;break}A.SceneID=c.slice(5)-0;for(var e=0;e<o[0].length;e++)for(var f=0;f<J.table("dataSource").length;f++)o[0][e].Id===J.table("dataSource")[f].Id&&(o[0][e].Enable=J.table("dataSource")[f].Enable,o[0][e].Name=J.table("dataSource")[f].Name,o[0][e].Type=J.table("dataSource")[f].Type);for(var e=0;e<r[0].length;e++)if(r[0][e].PresetID===D)for(var f=0;f<r[0][e].SnapShotWithRule.length;f++)for(var g=0;g<J.table("dataSource").length;g++)r[0][e].SnapShotWithRule[f].RuleId===J.table("dataSource")[g].Id&&(r[0][e].SnapShotWithRule[f].RuleType=J.table("dataSource")[g].Type);if(T.$('[sel-for="onChangePreset"]').val()-0===-1)return void T.$("#parkCapture_tip").tip("warning",tl("com.AddPlanFirstTip"));u.Detail.PlateHints=T.$("#provinceAbbreviation").val().split(" "),u.Detail.ReportMode=T.$("#reportNoLicenseCar").prop("checked")?"all":"plate",u.Detail.PlateMatch=T.$("#plateMatchingRatio_input").val()-0;var h=T.$('[sel-for="onChangeRuleType"]').val();if(Object.keys(C.ViolationCode).forEach(function(a){a===h.slice(7)&&(C.ViolationCode[a]=T.$("#illegalRuleCode").val(),C.ViolationCode[a+"ShowName"]=T.$("#illegalRuleName").val())}),""!==$)if("all"===$)for(var e=0;e<q[0].PresetImage.length;e++)!function(b){for(var c=0;c<q[0].PresetImage[b].Images.length;c++){var d=a.extend(!0,{},B),e=q[0].PresetImage[b].Images[c].RuleId;q[0].PresetImage[b].Images[c]=d,q[0].PresetImage[b].Images[c].RuleId=e}}(e);else for(var e=0;e<q[0].PresetImage.length;e++)if(q[0].PresetImage[e].PtzPresetId===$-0)for(var f=0;f<q[0].PresetImage[e].Images.length;f++){var i=a.extend(!0,{},B),j=q[0].PresetImage[e].Images[f].RuleId;q[0].PresetImage[e].Images[f]=i,q[0].PresetImage[e].Images[f].RuleId=j}if(""!==bb)if("all"===bb)for(var e=0;e<r[0].length;e++)!function(b){for(var c=0;c<r[0][b].SnapShotWithRule.length;c++)if(r[0][b].SnapShotWithRule[c].RuleType===ab){var d=a.extend(!0,{},y),e=r[0][b].SnapShotWithRule[c].RuleId;r[0][b].SnapShotWithRule[c]=d,r[0][b].SnapShotWithRule[c].RuleId=e}}(e);else for(var e=0;e<r[0].length;e++)if(r[0][e].PresetID===bb-0)for(var f=0;f<r[0][e].SnapShotWithRule.length;f++)if(r[0][e].SnapShotWithRule[f].RuleType===ab){var k=a.extend(!0,{},y),l=r[0][e].SnapShotWithRule[f].RuleId;r[0][e].SnapShotWithRule[f]=k,r[0][e].SnapShotWithRule[f].RuleId=l}if(""!==bb)if("all"===bb)for(var e=0;e<s[0].length;e++)!function(b){for(var c=0;c<s[0][b].MosaicWithRule.length;c++){var d=a.extend(!0,{},z),e=s[0][b].MosaicWithRule[c].RuleId;s[0][b].MosaicWithRule[c]=d,s[0][b].MosaicWithRule[c].RuleId=e}}(e);else for(var e=0;e<s[0].length;e++)if(s[0][e].PresetID===bb-0)for(var f=0;f<s[0][e].MosaicWithRule.length;f++){var v=a.extend(!0,{},z),l=s[0][e].MosaicWithRule[f].RuleId;s[0][e].MosaicWithRule[f]=v,s[0][e].MosaicWithRule[f].RuleId=l}var w=[m,n,o,p,q,r,s,t,U];d.ConfigManager.setConfig(E,w).done(function(){T.$("#parkCapture_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){T.$("#parkCapture_tip").tip("error",tl("com.SaveConfigFailTip"))}).always(function(){$="",_="",bb="",ab=""})}else{if(Q===!1)return void T.$("#parkCapture_tip").tip("error",tl("ivs.SaveBeforeDrawRule"));if(R===!1)return void T.$("#parkCapture_tip").tip("error",tl("ivs.SaveBeforeDrawLane"))}},onSavePreset:function(){if(-1!==D&&!T.$("[btn-for='onSavePreset']").hasClass("disabled")){var a=D,b=tl("ivs.Preset")+D;d.PTZ.setPreset(a,b).done(function(){T.$("#parkCapture_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){T.$("#parkCapture_tip").tip("error",tl("com.SaveConfigFailTip"))})}},onCalibrate:function(){if(T.$('[btn-for="onCalibrate"]').hasClass("ui-button-hover"))return T.$('[btn-for="onCalibrate"]').removeClass("ui-button-hover"),e.DeleteShape("DFilter"),S=!0,void T.$("select[sel-for='onChangePreset']").change();if(!T.$('[btn-for="onCalibrate"]').hasClass("ui-button-disabled")&&!T.$('[btn-for="onCalibrate"]').hasClass("ui-button-hover")){T.findConfig();var a=T.checkSceneSaved();if(!a)return void T.$("#parkCapture_tip").tip("warning",tl("com.PleaseSaveSenceTip"));for(var b=0;b<J.table("dataSource").length;b++)J.table("dataSource")[b].Enable&&e.ShowVideoAnalyseShape(J.table("dataSource")[b].ShapeID,!1);for(var c=0;c<K.table("dataSource").length;c++)K.table("dataSource")[c].ShapeID&&e.ShowVideoAnalyseShape(K.table("dataSource")[c].ShapeID,!1);T.varSetMarkflag(!0)}},checkSceneSaved:function(){var a=0===D?"Scene":"Scene"+D;return void 0!==m[0][a]?!0:!1},findConfig:function(){if(-1!==D){for(var a=!0,b=n[0],c={x:140,y:51},d={x:90,y:25},e=T.ocxNumChange(c,webApp.resolution),f=T.ocxNumChange(d,webApp.resolution),g=0;g<b.length;g++)if(b[g]&&b[g].PtzPresetID===D){N=b[g],N.CalibrateArea[0].Area=[e[0],e[1],f[0],f[1]],a=!1;break}if(a){var h={SceneID:1,Position:[-2,-2,-2],PtzPresetID:1,CalibrateArea:[{Area:[[3754,3868],[4437,3868],[3754,4323],[4437,4323]]}]};h.PtzPresetID=D,h.CalibrateArea[0].Area=[e[0],e[1],f[0],f[1]],b.push(h),T.findConfig()}}},ocxNumChange:function(a,b){var c=[],d=a.x,e=a.y,f=b.x,g=b.y,h=8191,i=8191,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;return j=(4096-h*d/(2*f)).toInt(),k=(4096-i*e/(2*g)).toInt(),n=(4096+h*d/(2*f)).toInt(),o=(4096+i*e/(2*g)).toInt(),l=n,m=k,p=j,q=o,c[0]=[j,k],c[1]=[n,o],c},varSetMarkflag:function(a){O=a,T.uiChange(a),T.ocxChange(a)},uiChange:function(a){a?T.$('[btn-for="onCalibrate"]').addClass("ui-button-hover"):T.$('[btn-for="onCalibrate"]').removeClass("ui-button-hover")},ocxChange:function(a){if(a){var b=T.ocxBulidString();e.SetCurPtzID(0),e.SetObjectConfig(b)}else e.DeleteShape("DFilter")},ocxBulidString:function(){var a="";if(N.CalibrateArea){var b={DFilter:[]},c=N.CalibrateArea[0].Area;b.DFilter=c,a=JSON.stringify(b)}else{var d={x:140,y:51},e={x:90,y:25},f=T.ocxNumChange(d,webApp.resolution),g=T.ocxNumChange(e,webApp.resolution);a='{"DFilter":[['+f[0]+"],["+f[1]+"],["+g[0]+"],["+g[1]+"]]}"}return a},onCalibrateComplete:function(){if(T.$('[btn-for="onCalibrateComplete"]').hasClass("ui-button-disabled"))return!1;var a=T.checkSceneSaved();return a?(S=!0,T.$("select[sel-for='onChangePreset']").change(),T.varSetMarkflag(!1),T.applyRefreshPtz(!0),void 0):void T.$("#parkCapture_tip").tip("warning",tl("com.PleaseSaveSenceTip"))},applyRefreshPtz:function(a){d.PTZ.getStatus().done(function(b){N.Position=b.Postion,d.PTZ.getMotorSteps().done(function(b){N.PtzMotorSteps=b,a===!0&&T.applySave()})})},applySave:function(){var a="",b=T.$('[sel-for="onChangeMode"]').val();A.CalibrateArea[0].Method=b,A.CalibratePixel=T.$("#ivs_cardsSize").val()-0;for(var c in W)if(W[c]===D){a=c;break}A.SceneID=a.slice(5)-0;var e=n;d.ConfigManager.setConfig("VideoAnalyseCalibrate",e).done(function(){T.$("#parkCapture_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){T.$("#parkCapture_tip").tip("error",tl("com.SaveConfigFailTip"))})},onCalibratePreview:function(){if(T.$('[btn-for="onCalibratePreview"]').hasClass("ui-button-disabled"))return!1;T.findConfig();var a=N.Position;if(a[0]<-1||a[1]<-1||a[2]<-1)return void T.$("#parkCapture_tip").tip("warning",tl("com.PleaseflogSenceTip"));S=!0,T.$('[btn-for="onCalibrate"]').hasClass("ui-button-hover")&&(T.$('[btn-for="onCalibrate"]').removeClass("ui-button-hover"),e.DeleteShape("DFilter"));N.PtzMotorSteps;d.PTZ.moveAbsolutely(a).done(function(){var a=T.ocxBulidString();e.SetCurPtzID(0),e.SetObjectConfig(a)});for(var b=0;b<J.table("dataSource").length;b++)J.table("dataSource")[b].Enable&&e.ShowVideoAnalyseShape(J.table("dataSource")[b].ShapeID,!1);for(var c=0;c<K.table("dataSource").length;c++)K.table("dataSource")[c].ShapeID&&e.ShowVideoAnalyseShape(K.table("dataSource")[c].ShapeID,!1);setTimeout(function(){e.DeleteShape("DFilter"),T.$("select[sel-for='onChangePreset']").change()},4e3)}})}),define("fileParam",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability"),g=null,h=null,i=[],j=null,k={},l="TrafficPark",m="",n=null,o={"File Transmit Error":"com.FileTransmitErrorTip","File too large":"com.PicFileTooLargeTip","File length error":"com.FileLengthErrorTip","File write error":"com.FileWriteErrorTip",PicTypeNotSupport:"com.PicTypeNotSupportTip",BPPTypeNotSupport:"com.BPPTypeNotSupportTip",ResolutionNotSupport:"com.ResolutionNotSupportTip",PicNotExist:"com.PicNotExistTip",FileOperateError:"com.FileOperateErrorTip",PicFileTooLarge:"com.PicFileTooLargeTip"},p="/sdtraffic/";c.exports=e.extend({init:function(){g=this,g._initFileParamTable(),g.render()},render:function(){d.DevIntelliTracker.stop(),g._getConfig(!1)},leave:function(){d.DevIntelliTracker.start()},_initFileParamTable:function(){h=g.$("#tr_pictureParameter_table").table({pageable:!1,reSelectRow:!0,pressEnter:!1,height:180,columns:[{t:"com.Number",width:"20%",render:function(a){return a._index+1}},{t:"ivs.Preset",width:"40%",fields:"PresetID",render:function(a){return tl("ivs.Preset")+a.PresetID}},{t:"ivs.IllegalRuleOfTypeEx",width:"40%",fields:"Type",valueMap:k,editor:function(b,c){var d="",e=c.valueMap;if(e){d='<select style="overflow-wrap:initial">';for(var f in e)d+='<option value="'+f+'">'+e[f]+"</option>";d+="</select>"}return a(d)}}],onRowSelect:function(){g._showPicture(!1)}})},_loadPicTable:function(){var a=[];for(var b in j[0]){var c=j[0][b];if(/Scene/.test(b)&&c.Type===l){if(presetId=j[0][b].PtzPresetId,0===presetId||1e3===presetId)continue;var d={PresetID:"",Type:"TrafficParking"};d.PresetID=presetId,a.push(d)}}h.table("dataSource",a).table("selectRow",0)},_showPicture:function(){var b=h.table("getSelectedData").PresetID,c=h.table("getSelectedData").Type,d="/sdtraffic/Preset"+b+"_"+c+".jpg";a.ajax({url:d,success:function(){g.$("#pic_image_preview").css({background:"url("+d+")","background-repeat":"no-repeat","background-size":"cover"})},error:function(){g.$("#pic_image_preview").css({background:"url('')","background-color":"#BBBBBB","background-repeat":"no-repeat","background-size":"cover"}),g.$("#paraPATips").tip("warning",tl("com.PicNotExistTip"))}})},_getConfig:function(){n=["VideoAnalyseGlobal"],a.when(d.ConfigManager.getConfig(n),f.get("VideoAnalyse",!0)).done(function(a,b){j=a[0].params.table,i=b.SupportedRules,g._renderElements()})},_renderElements:function(){var a="";if(i.TrafficPark){for(var b=0;b<i.TrafficPark.length;b++)("TrafficParking"===i.TrafficPark[b]||"TrafficParkingB"===i.TrafficPark[b]||"TrafficParkingC"===i.TrafficPark[b]||"TrafficParkingD"===i.TrafficPark[b])&&(k[i.TrafficPark[b]]=tl("appEventEx"+i.TrafficPark[b]),a+="<option value='"+i.TrafficPark[b]+"'>"+tl("appEventEx"+i.TrafficPark[b])+"</option>");g.$("#para_audio_sel").empty().append(a)}g._loadPicTable()},onPicFileChange:function(a){var b=0;if(a.value.test(/.jpg|.JPG$/i)){try{b=a.files[0].size}catch(c){}if(b>2097152)g.$("#paraPATips").tip("warning",tl("com.PicFileTooLargeTip"));else if(h.table("getSelectedData")){var d=h.table("getSelectedData").PresetID,e=h.table("getSelectedData").Type;m="Preset"+d+"_"+e,g.$("#pic_image_file_import").attr("name",m),g.$("#pic_image_submit").trigger("click")}else g.$("#paraPATips").tip("warning",tl("ivs.PresetOrRuleNoPic"))}else g.$("#paraPATips").tip("warning",tl("com.PicTypeNotSupportTip"))},onParaFileChange:function(b){if(b.value.test(/.wav$/i)){var c=a("#para_audio_sel").val();g.$("#paraPic_audio_file_import").attr("name",c),g.$("#paraPic_audio_submit").trigger("click")}else g.$("#paraPATips").tip("warning",tl("com.FileFormatDefaultTip"))},_imageFileUploadFinish:function(a){a.result?g.updateOverlayPicture():g.$("#paraPATips").tip("warning",tl(o[a.errorCode]))},updateOverlayPicture:function(){d.Encode.updateOverlayPicture([{Name:m+".jpg"}]).done(function(a){var b=a[0];if(""===b.Error){var c=b.Path.lastIndexOf("/"),d=b.Path.substring(c+1),e="url("+p+d+")";g.$("#pic_image_preview").css("background-image",e),g.$("#paraPATips").tip("success",tl("com.UpmoveSuccessTip"))}else g.$("#paraPATips").tip("warning",tl(o[b.Error]))})},_audioFileUploadFinish:function(a){a.result&&g.$("#paraPATips").tip("success",tl("com.UpmoveSuccessTip"))}}),window.paraImageUploadFinish=function(a){g._imageFileUploadFinish(a)},window.paraAudioUploadFinish=function(a){g._audioFileUploadFinish(a)},window.onPicFileChange=function(a){g.onPicFileChange(a)},window.onParaFileChange=function(a){g.onParaFileChange(a)}}),define("OSD",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability");require("widget/js/dui.colorpicker");var g=null,h=null;require.async("OSDPublic",function(a){g=a});var i=null,j=null,k=[],l=g.ArrWholeOSDName,m=null,n=null,o="TrafficPark",p=[],q=0,r=null,s="",t=[],u=null;c.exports=e.extend({init:function(){u=this,h=u.$("#osd_origOSD_dialog").dialog({close:function(){},confirm:function(a,b){b.ui.close(),u.onSaveOSDPreview()}}),g.setFontSize("osd",u),u._getTemplates(),u.render()},render:function(){d.DevIntelliTracker.stop(),u.osdRefreshClick(!1)},leave:function(){d.DevIntelliTracker.start(),s=""},_getTemplates:function(){d.VideoInAnalyse.getTemplateSnapOSD("TrafficPark").done(function(a){r=a})},renderSnapElements:function(){u.renderPreset()},renderPreset:function(){if(n&&n[0]){var a="",b="";s="";for(var c in n[0]){var d=n[0][c];if(/Scene/.test(c)&&d.Type===o){if(b=n[0][c].PtzPresetId,0===b)continue;if(1e3===b)continue;a+="<option value='"+b+"' presetId='"+b+"'>"+tl("ivs.Preset")+b+"</option>"}}for(var e=0;e<t.TrafficPark.length;e++)"TrafficParkingManual"!==t.TrafficPark[e]&&(s+="TrafficJam"===t.TrafficPark[e]?"<option value='"+t.TrafficPark[e]+"'>"+tl("itc.BreakJam")+"</option>":"<option value='"+t.TrafficPark[e]+"'>"+tl("appEventEx"+t.TrafficPark[e])+"</option>");u.$('[sel-for="onChangeRuleOSD"]').empty().append(s),""!==a?(u.$("[sel-for='onChangePresetOSD']").empty().append(a),u.$(".existPreset").removeClass("fn-hide"),u.$(".existPresetib").addClass("fn-ib"),u.$("#ivs_suggestOverlay").removeClass("disabled"),u.$('[btn-for="osdRefreshClick"]').parent().removeClass("fn-hide"),u.$("select[sel-for='onChangePresetOSD']").change(),u.$('[sel-for="onChangeRuleOSD"]').attr("disabled",!1),u.$('[sel-for="onChangeRuleOSD"]').change()):(u.$("[sel-for='onChangePresetOSD']").empty().append("<option value='-1'>"+tl("com.AddPlanFirstTip")+"</option>"),u.$(".existPresetib").removeClass("fn-ib"),u.$(".existPreset").addClass("fn-hide"),u.$("#ivs_suggestOverlay").addClass("disabled"),u.$('[btn-for="osdRefreshClick"]').parent().addClass("fn-hide"),u.$('[sel-for="onChangeRuleOSD"]').attr("disabled",!0)),u.bind()}},onChangeRuleOSD:function(){var b=u.$('[sel-for="onChangeRuleOSD"]').val();g.initOSDMaskItems("osd",u,b),u.$("#osd_snapPark_maskItems a").on("click",function(){var b=a(this).attr("data-type");u.addEleOrder(b);var c=g.getEleArr(i.OSD.OSDOrder);u.createOSDOrderItems(c)});for(var c=0;c<p.length;c++)p[c].RuleType===b&&(i=p[c]);k=i.OSD.OSDCustomizeSort,u.renderOSDElements(),u.renderGlobalParams()},onChangePresetOSD:function(){for(var b=u.$("select[sel-for='onChangePresetOSD']").val()-0,c=[],d=0;d<m[0].length;d++)if(c.push(m[0][d].PresetID),m[0][d].PresetID===b){p=m[0][d].OSDWithClass;for(var e=0;e<p.length;e++)p[e].RuleType===u.$('[sel-for="onChangeRuleOSD"]').val()&&(i=p[e]);k=i.OSD.OSDCustomizeSort}if(-1===c.indexOf(b)){p=a.extend(!0,[],r.TrafficPark.OSDWithClass);for(var d=0;d<p.length;d++)p[d].RuleType===u.$('[sel-for="onChangeRuleOSD"]').val()&&(i=p[d]);k=i.OSD.OSDCustomizeSort;var f={OSDWithClass:p,PresetID:b};m[0].push(f),f={}}u.renderOSDElements(),u.renderGlobalParams()},renderOSDElements:function(){if(k.length&&k[0]){var a=k[0].Element;q=a.length-1;var b=g.getEleArr(i.OSD.OSDOrder);u.createOSDOrderItems(b)}},renderGlobalParams:function(){var b=i.OSD.OSDBlackRegion;u.$('[sel-for="onChangeBlackPosition"]').val(b.Height>0?b.OSDPosition:"None"),u.$('[sel-for="onChangeBlackPosition"]').change(),u.$('[sel-for="onChangeFontSize"]').val(i.OSD.OSDWholeAttr.FontSize);var c=i.OSD.OSDWholeAttr.FontColor;a("#ivs_osd_font_picker_tip").css({"background-color":"rgb("+c[0]+","+c[1]+","+c[2]+")"});var d=i.OSD.OSDWholeAttr.Position||[0,0,0,0];u.$("#osd_osdPosition").val(d.toString());var e=u.$('[sel-for="onChangeBKColor"]');switch(i.OSD.OSDBlackRegion.BackColor[0]){case 0:e.val("black");break;case 255:e.val("white");break;case 128:e.val("gray")}u.$("#ivs_OSD_timeTitle").prop("checked",i.TimeTitle.Enable),u.$("#ivs_OSD_channelTitle").prop("checked",i.ChannelTitle.Enable)},bind:function(){u.$("#ivs_suggestOverlay").on("click",function(){if(!u.$("#ivs_suggestOverlay").hasClass("disabled")){for(var b=0;b<r.TrafficPark.OSDWithClass.length;b++)r.TrafficPark.OSDWithClass[b].RuleType===u.$('[sel-for="onChangeRuleOSD"]').val()&&(j=a.extend(!0,{},r.TrafficPark.OSDWithClass[b]));var c=g.getEleArr(j.OSD.OSDOrder);k=j.OSD.OSDCustomizeSort,i.OSD.OSDOrder=j.OSD.OSDOrder,i.OSD.OSDCustomizeSort=j.OSD.OSDCustomizeSort,u.createOSDOrderItems(c)}}),u.$("#origOSD_snap_modify, #origOSD_snap_delete").on("click",u.onOSDActionClick),a('[sel-for="onChangeBlackPosition"]').on("change",function(b){"None"!==a(b.target).val()?a("#osd_osdPosition").parent().addClass("fn-invisib"):a("#osd_osdPosition").parent().removeClass("fn-invisib")}),a("#ivs_osd_font_picker").colorpicker({onChange:function(b,c){a("#ivs_osd_font_picker_tip").css({"background-color":"#"+c})},onSubmit:function(b,c,d){a("#ivs_osd_font_picker_tip").css({"background-color":"#"+c});var e={r:0,g:1,b:2};for(index in e)i.OSD.OSDWholeAttr.FontColor[e[index]]=d[index];a("#ivs_osd_font_picker").colorpickerHide()}})},onOSDActionClick:function(){u.$("#osd_snapPark_orderItems .icon-right").each(function(a,b){"%|"===u.$(b).parent("a").attr("data-type")||"%~"===u.$(b).parent("a").attr("data-type")||(u.$("#origOSD_snap_modify").prop("checked")?u.$(b).removeClass("osd-icon-del").addClass("osd-icon-edit"):u.$(b).removeClass("osd-icon-edit").addClass("osd-icon-del"))})},onCleanAllClick:function(){a("#osd_snapPark_orderItems").html(""),i.OSD.OSDOrder=""},onAddNewLineClick:function(){u.addEleOrder("%|");var a=g.getEleArr(i.OSD.OSDOrder);u.createOSDOrderItems(a)},onAddBlockClick:function(){u.addEleOrder("%~");var a=g.getEleArr(i.OSD.OSDOrder);u.createOSDOrderItems(a)},addEleOrder:function(b){var c,d,e,f=i.OSD,g=a("#osd_snapPark_orderItems a"),h="";if(g.length){for(c=0;c<g.length;c++)if(a(g[c]).hasClass("osd-order-item-cur")){d=c;break}d++,b=b.replace("%",""),e=f.OSDOrder.split("%"),a("#origOSD_snap_front").prop("checked")?e.splice(d,1,b,e[d]):(e.splice(d,1,e[d],b),q=d),h=e.join("%")}else h+=b;f.OSDOrder=h},delOSDElement:function(b){a("#"+b).remove()},delEleOrder:function(b){var c=[];a("#osd_snapPark_orderItems li").each(function(a,b){c.push(b.id)});for(var d=0;d<c.length;d++)if(c[d]==b){num=d;break}var e,f=i.OSD;e=f.OSDOrder.split("%"),e.splice(num+1,1),f.OSDOrder=e.join("%")},createOSDOrderItems:function(b){if(0===b.length)return void a("#osd_snapPark_orderItems").html("");var c=a("#origOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del";a("#osd_snapPark_orderItems").html("");var d="";b.each(function(b,e){if(b){var f="";if(c=a("#origOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del",1===b.NameType)f=tl("sys.Custom");else if("%|"===b.Name)f=tl("com.Cewline"),c="osd-icon-del";else if("%~"===b.Name)f=tl("com.BlankSpace"),c="osd-icon-del";else if("%54"===b.Name)f=g.ttl("com_osd.TitleBit40")+1;else if("%113"===b.Name)f=g.ttl("com_osd.TitleBit40")+2;else if("%114"===b.Name)f=g.ttl("com_osd.TitleBit40")+3;else{var h=l.indexOf(b.Name);"%y%M%d%h%m%s"==b.Name&&(h=0),f=g.ttl("com_osd.TitleBit"+h)}d+='<li id="'+("osd_snap_order"+e+"_li")+'" class="">',d+='<a class="osd-button-icon fn-width68 fn-txtoverflow" data-type="'+b.Name+'">'+f,d+='<i class="icon-right '+c+'"></i>',d+="</a>",d+="</li>"}}),u.$("#osd_snapPark_orderItems").html(d),u.bindOSDOrderItems(),0!==u.$("#osd_snap_order"+q+"_li").length?u.$("#osd_snap_order"+q+"_li").click():u.$("#osd_snap_order0_li").click()},bindOSDOrderItems:function(){u.$("#osd_snapPark_orderItems li").on("click",function(a){q=this.id.replace(/[^\d]/g,"")-0,u.$("#osd_snapPark_orderItems li a").removeClass("osd-order-item-cur"),u.$(this).children("a").first().addClass("osd-order-item-cur");var b=u.$(this).children("a").first().attr("data-type"),a=a||event,c=a&&(a.target||a.srcElement),d=c&&c.className||"";if(-1!==d.indexOf("icon-right")){var e=k[0].Element,f=d.indexOf("osd-icon-del"),i=d.indexOf("osd-icon-edit");if(-1!==f){u.delEleOrder("osd_snap_order"+q+"_li"),u.delOSDElement("osd_snap_order"+q+"_li"),q--;var j=u.$("#osd_snap_order"+q+"_li");if(0===j.length){var m=u.$("#osd_snapPark_orderItems").children("li").first();q=m?m.prop("id").replace(/[^\d]/g,"")-0:0}j=u.$("#osd_snap_order"+q+"_li"),j&&(u.$("#osd_snapPark_orderItems li a").removeClass("osd-order-item-cur"),j.children("a").first().addClass("osd-order-item-cur"))}if(-1!==i){var n=-1,o=tl("sys.Custom"),e=k[0].Element,p=0;if(e.each(function(a,c){a.Name==b&&(p=c,u.$("#osd_origOSD_dialog [data-action='confirm']").attr("data-index",p))}),0===e[p].NameType){var r=e[p].Name;n=l.indexOf(r),"%y-%M-%d %h:%m:%s"==r&&(n=0),o=g.ttl("com_osd.TitleBit"+n),"%113"==r&&(o=g.ttl("com_osd.TitleBit40")+2),"%114"==r&&(o=g.ttl("com_osd.TitleBit40")+3)}u.$("#osd_origOSD_item").text(o),u.$("#osd_origOSD_prefix").val(e[p].Prefix||""),u.$("#osd_origOSD_postfix").val(e[p].Postfix||""),u.$("#osd_origOSD_seperater").val(e[p].SeperaterCount),h.dialog("show")}}})},osdRefreshClick:function(b){var c=["VideoAnalyseGlobal","SnapOSD"];a.when(d.ConfigManager.getConfig(c),f.get("VideoAnalyse",!0)).done(function(a,c){n=a[0].params.table,m=a[1].params.table,t=c.SupportedRules,u.renderSnapElements(),b!==!1&&u.tip("success","com.OperateSuccessTip")}).fail(function(){u.tip("error","com.OpearFaildTip")})},osdConfirmClick:function(){u.saveGlobalParams(),d.ConfigManager.setConfig("SnapOSD",m).done(function(){u.tip("success","com.SaveSuccessTip")}).fail(function(){u.tip("error","com.SaveConfigFailTip")})},saveGlobalParams:function(){var a=i.OSD.OSDBlackRegion;"None"===u.$('[sel-for="onChangeBlackPosition"]').val()?a.Height=0:(a.Height=32,a.OSDPosition=u.$('[sel-for="onChangeBlackPosition"]').val());var b=i.OSD.OSDWholeAttr;b.FontSize=~~u.$('[sel-for="onChangeFontSize"]').val(),b.Position=u.$("#osd_osdPosition").val().split(",").map(function(a){return a-0});var c=(i.OSD.OSDBlackRegion.BackColor,u.$('[sel-for="onChangeBKColor"]').val());switch(c){case"black":i.OSD.OSDBlackRegion.BackColor=[0,0,0,128];break;case"white":i.OSD.OSDBlackRegion.BackColor=[255,255,255,128];break;case"gray":i.OSD.OSDBlackRegion.BackColor=[128,128,128,128]}i.TimeTitle.Enable=u.$("#ivs_OSD_timeTitle").prop("checked"),i.ChannelTitle.Enable=u.$("#ivs_OSD_channelTitle").prop("checked")},onSaveOSDPreview:function(){{var a=k[0].Element,b=u.$("#osd_origOSD_dialog [data-action='confirm']").attr("data-index")-0;0===a[b].NameType,a[b].Name}a[b].Prefix=u.$("#osd_origOSD_prefix").val(),a[b].Postfix=u.$("#osd_origOSD_postfix").val(),a[b].SeperaterCount=u.$("#osd_origOSD_seperater").val()-0}})}),define("mergeOSD",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability");require("widget/js/dui.colorpicker");var g=null,h=null;require.async("OSDPublic",function(a){g=a});var i=null,j=null,k=[],l=g.ArrWholeOSDName,m=null,n=null,o="TrafficPark",p=null,q=[],r="",s=[],t=0,u=null;c.exports=e.extend({init:function(){u=this,h=u.$("#osd_mergeOSD_dialog").dialog({close:function(){},confirm:function(a,b){b.ui.close(),u.onSaveOSDPreview()}}),g.setFontSize("mergeOsd",u),u._getTemplates(),u.render()},render:function(){d.DevIntelliTracker.stop(),u.osdRefreshClick(!1)},leave:function(){d.DevIntelliTracker.start(),r=""},_getTemplates:function(){d.VideoInAnalyse.getTemplateSnapOSD("TrafficPark").done(function(a){p=a})},bind:function(){a("#ivs_mergeSuggestOverlay").on("click",function(){for(var b=0;b<p.TrafficPark.OSDWithClass.length;b++)p.TrafficPark.OSDWithClass[b].RuleType===u.$('[sel-for="onChangeRuleMergeOSD"]').val()&&(j=a.extend(!0,{},p.TrafficPark.OSDWithClass[b]));var c=g.getEleArr(j.MergeOSD.OSDOrder);k=j.MergeOSD.OSDCustomizeSort,i.MergeOSD.OSDOrder=j.MergeOSD.OSDOrder,i.MergeOSD.OSDCustomizeSort=j.MergeOSD.OSDCustomizeSort,u.createOSDOrderItems(c)}),u.$("#mergeOSD_snap_modify, #mergeOSD_snap_delete").on("click",u.onOSDActionClick),a('[sel-for="onChangeBlackPosition"]').on("change",function(b){"None"!==a(b.target).val()?a("#osd_mergeOsdPosition").parent().addClass("fn-invisib"):a("#osd_mergeOsdPosition").parent().removeClass("fn-invisib")}),a("#ivs_mergeOSD_font_picker").colorpicker({onChange:function(b,c){a("#ivs_mergeOSD_font_picker_tip").css({"background-color":"#"+c})},onSubmit:function(b,c,d){a("#ivs_mergeOSD_font_picker_tip").css({"background-color":"#"+c});var e={r:0,g:1,b:2};for(index in e)i.MergeOSD.OSDWholeAttr.FontColor[e[index]]=d[index];a("#ivs_mergeOSD_font_picker").colorpickerHide()}})},renderOSDElements:function(){if(k.length&&k[0]){var a=k[0].Element;t=a.length-1;var b=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(b)}},renderGlobalParams:function(){var b=i.MergeOSD.OSDBlackRegion;u.$('[sel-for="onChangeBlackPosition"]').val(b.Height>0?b.OSDPosition:"None"),u.$('[sel-for="onChangeBlackPosition"]').change(),u.$('[sel-for="onChangeFontSize"]').val(i.MergeOSD.OSDWholeAttr.FontSize);var c=i.MergeOSD.OSDWholeAttr.FontColor;a("#ivs_mergeOSD_font_picker_tip").css({"background-color":"rgb("+c[0]+","+c[1]+","+c[2]+")"});var d=i.MergeOSD.OSDWholeAttr.Position||[0,0,0,0];u.$("#osd_mergeOsdPosition").val(d.toString());var e=u.$('[sel-for="onChangeBKColor"]');switch(i.MergeOSD.OSDBlackRegion.BackColor[0]){case 0:e.val("black");break;case 255:e.val("white");break;case 128:e.val("gray")}u.$("#ivs_mergeOSD_timeTitle").prop("checked",i.TimeTitle.Enable),u.$("#ivs_mergeOSD_channelTitle").prop("checked",i.ChannelTitle.Enable)},renderSnapElements:function(){u.renderPreset()},renderPreset:function(){if(n&&n[0]){var a="",b="";r="";for(var c in n[0]){var d=n[0][c];if(/Scene/.test(c)&&d.Type===o){if(b=n[0][c].PtzPresetId,0===b)continue;if(1e3===b)continue;a+="<option value='"+b+"' presetId='"+b+"'>"+tl("ivs.Preset")+b+"</option>"}}for(var e=0;e<q.TrafficPark.length;e++)"TrafficParkingManual"!==q.TrafficPark[e]&&(r+="TrafficJam"===q.TrafficPark[e]?"<option value='"+q.TrafficPark[e]+"'>"+tl("itc.BreakJam")+"</option>":"<option value='"+q.TrafficPark[e]+"'>"+tl("appEventEx"+q.TrafficPark[e])+"</option>");u.$('[sel-for="onChangeRuleMergeOSD"]').empty().append(r),""!==a?(u.$("[sel-for='onChangePresetMergeOSD']").empty().append(a),u.$(".existPreset").removeClass("fn-hide"),u.$(".existPresetib").addClass("fn-ib"),u.$("#ivs_mergeSuggestOverlay").removeClass("disabled"),u.$('[btn-for="osdRefreshClick"]').parent().removeClass("fn-hide"),u.$("select[sel-for='onChangePresetMergeOSD']").change(),u.$('[sel-for="onChangeRuleMergeOSD"]').attr("disabled",!1),u.$('[sel-for="onChangeRuleMergeOSD"]').change()):(u.$("[sel-for='onChangePresetMergeOSD']").empty().append("<option value='-1'>"+tl("com.AddPlanFirstTip")+"</option>"),u.$(".existPresetib").removeClass("fn-ib"),u.$(".existPreset").addClass("fn-hide"),u.$("#ivs_mergeSuggestOverlay").addClass("disabled"),u.$('[btn-for="osdRefreshClick"]').parent().addClass("fn-hide"),u.$('[sel-for="onChangeRuleMergeOSD"]').attr("disabled",!0)),u.bind()
}},onChangeRuleMergeOSD:function(){var b=u.$('[sel-for="onChangeRuleMergeOSD"]').val();g.initOSDMaskItems("mergeOsd",u,b),u.$("#mergeOsd_snapPark_maskItems a").on("click",function(){var b=a(this).attr("data-type");u.addEleOrder(b);var c=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(c)});for(var c=0;c<s.length;c++)s[c].RuleType===b&&(i=s[c]);k=i.MergeOSD.OSDCustomizeSort,u.renderOSDElements(),u.renderGlobalParams()},onChangePresetMergeOSD:function(){for(var b=u.$("select[sel-for='onChangePresetMergeOSD']").val()-0,c=[],d=0;d<m[0].length;d++)if(c.push(m[0][d].PresetID),m[0][d].PresetID===b){s=m[0][d].OSDWithClass;for(var e=0;e<s.length;e++)s[e].RuleType===u.$('[sel-for="onChangeRuleMergeOSD"]').val()&&(i=s[e]);k=i.MergeOSD.OSDCustomizeSort}if(-1===c.indexOf(b)){s=a.extend(!0,[],p.TrafficPark.OSDWithClass);for(var d=0;d<s.length;d++)s[d].RuleType===u.$('[sel-for="onChangeRuleMergeOSD"]').val()&&(i=s[d]);k=i.MergeOSD.OSDCustomizeSort;var f={OSDWithClass:s,PresetID:b};m[0].push(f),f={}}u.renderOSDElements(),u.renderGlobalParams()},saveGlobalParams:function(){var a=i.MergeOSD.OSDBlackRegion;"None"===u.$('[sel-for="onChangeBlackPosition"]').val()?a.Height=0:(a.Height=32,a.OSDPosition=u.$('[sel-for="onChangeBlackPosition"]').val());var b=i.MergeOSD.OSDWholeAttr;b.FontSize=~~u.$('[sel-for="onChangeFontSize"]').val(),b.Position=u.$("#osd_mergeOsdPosition").val().split(",").map(function(a){return a-0});var c=(i.MergeOSD.OSDBlackRegion.BackColor,u.$('[sel-for="onChangeBKColor"]').val());switch(c){case"black":i.MergeOSD.OSDBlackRegion.BackColor=[0,0,0,128];break;case"white":i.MergeOSD.OSDBlackRegion.BackColor=[255,255,255,128];break;case"gray":i.MergeOSD.OSDBlackRegion.BackColor=[128,128,128,128]}i.TimeTitle.Enable=u.$("#ivs_mergeOSD_timeTitle").prop("checked"),i.ChannelTitle.Enable=u.$("#ivs_mergeOSD_channelTitle").prop("checked")},osdRefreshClick:function(b){var c=["VideoAnalyseGlobal","SnapOSD"];a.when(d.ConfigManager.getConfig(c),f.get("VideoAnalyse",!0)).done(function(a,c){n=a[0].params.table,m=a[1].params.table,q=c.SupportedRules,u.renderSnapElements(),b!==!1&&u.tip("success","com.OperateSuccessTip")}).fail(function(){u.tip("error","com.OpearFaildTip")})},osdConfirmClick:function(){u.saveGlobalParams(),d.ConfigManager.setConfig("SnapOSD",m).done(function(){u.tip("success","com.SaveSuccessTip")}).fail(function(){u.tip("error","com.SaveConfigFailTip")})},onCleanAllClick:function(){a("#mergeOsd_snapPark_orderItems").html(""),i.MergeOSD.OSDOrder=""},onAddNewLineClick:function(){u.addEleOrder("%|");var a=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(a)},onAddBlockClick:function(){u.addEleOrder("%~");var a=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(a)},addEleOrder:function(b){var c,d,e,f=i.MergeOSD,g=a("#mergeOsd_snapPark_orderItems a"),h="";if(g.length){for(c=0;c<g.length;c++)if(a(g[c]).hasClass("osd-order-item-cur")){d=c;break}d++,b=b.replace("%",""),e=f.OSDOrder.split("%"),a("#mergeOSD_snap_front").prop("checked")?e.splice(d,1,b,e[d]):(e.splice(d,1,e[d],b),t=d),h=e.join("%")}else h+=b;f.OSDOrder=h},onOSDActionClick:function(){u.$("#mergeOsd_snapPark_orderItems .icon-right").each(function(a,b){"%|"===u.$(b).parent("a").attr("data-type")||"%~"===u.$(b).parent("a").attr("data-type")||(u.$("#mergeOSD_snap_modify").prop("checked")?u.$(b).removeClass("osd-icon-del").addClass("osd-icon-edit"):u.$(b).removeClass("osd-icon-edit").addClass("osd-icon-del"))})},delOSDElement:function(b){a("#"+b).remove()},delEleOrder:function(b){var c=[];a("#mergeOsd_snapPark_orderItems li").each(function(a,b){c.push(b.id)});for(var d=0;d<c.length;d++)if(c[d]==b){num=d;break}var e,f=i.MergeOSD;e=f.OSDOrder.split("%"),e.splice(num+1,1),f.OSDOrder=e.join("%")},createOSDOrderItems:function(b){if(0===b.length)return void a("#mergeOsd_snapPark_orderItems").html("");var c=a("#mergeOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del";a("#mergeOsd_snapPark_orderItems").html("");var d="";b.each(function(b,e){if(b){var f="";if(c=a("#mergeOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del",1===b.NameType)f=tl("sys.Custom");else if("%|"===b.Name)f=tl("com.Cewline"),c="osd-icon-del";else if("%~"===b.Name)f=tl("com.BlankSpace"),c="osd-icon-del";else if("%54"===b.Name)f=g.ttl("com_osd.TitleBit40")+1;else if("%113"===b.Name)f=g.ttl("com_osd.TitleBit40")+2;else if("%114"===b.Name)f=g.ttl("com_osd.TitleBit40")+3;else{var h=l.indexOf(b.Name);"%y%M%d%h%m%s"==b.Name&&(h=0),f=g.ttl("com_osd.TitleBit"+h)}d+='<li id="'+("mergeOSD_snap_order"+e+"_li")+'" class="">',d+='<a class="osd-button-icon fn-width68 fn-txtoverflow" data-type="'+b.Name+'">'+f,d+='<i class="icon-right '+c+'"></i>',d+="</a>",d+="</li>"}}),u.$("#mergeOsd_snapPark_orderItems").html(d),u.bindOSDOrderItems(),0!==u.$("#mergeOSD_snap_order"+t+"_li").length?u.$("#mergeOSD_snap_order"+t+"_li").click():u.$("#mergeOSD_snap_order0_li").click()},bindOSDOrderItems:function(){u.$("#mergeOsd_snapPark_orderItems li").on("click",function(a){t=this.id.replace(/[^\d]/g,"")-0,u.$("#mergeOsd_snapPark_orderItems li a").removeClass("osd-order-item-cur"),u.$(this).children("a").first().addClass("osd-order-item-cur");var b=u.$(this).children("a").first().attr("data-type"),a=a||event,c=a&&(a.target||a.srcElement),d=c&&c.className||"";if(-1!==d.indexOf("icon-right")){var e=k[0].Element,f=d.indexOf("osd-icon-del"),i=d.indexOf("osd-icon-edit");if(-1!==f){u.delEleOrder("mergeOSD_snap_order"+t+"_li"),u.delOSDElement("mergeOSD_snap_order"+t+"_li"),t--;var j=u.$("#mergeOSD_snap_order"+t+"_li");if(0===j.length){var m=u.$("#mergeOSD_snapPark_orderItems").children("li").first();t=m?m.prop("id").replace(/[^\d]/g,"")-0:0}j=u.$("#mergeOSD_snap_order"+t+"_li"),j&&(u.$("#mergeOsd_snapPark_orderItems li a").removeClass("osd-order-item-cur"),j.children("a").first().addClass("osd-order-item-cur"))}if(-1!==i){var n=-1,o=tl("sys.Custom"),e=k[0].Element,p=0;if(e.each(function(a,c){a.Name==b&&(p=c,u.$("#osd_mergeOSD_dialog [data-action='confirm']").attr("data-index",p))}),0===e[p].NameType){var q=e[p].Name;n=l.indexOf(q),"%y-%M-%d %h:%m:%s"==q&&(n=0),o=g.ttl("com_osd.TitleBit"+n),"%113"==q&&(o=g.ttl("com_osd.TitleBit40")+2),"%114"==q&&(o=g.ttl("com_osd.TitleBit40")+3)}u.$("#osd_mergeOSD_item").text(o),u.$("#osd_mergeOSD_prefix").val(e[p].Prefix||""),u.$("#osd_mergeOSD_postfix").val(e[p].Postfix||""),u.$("#osd_mergeOSD_seperater").val(e[p].SeperaterCount),h.dialog("show")}}})},onSaveOSDPreview:function(){{var a=k[0].Element,b=u.$("#osd_mergeOSD_dialog [data-action='confirm']").attr("data-index")-0;0===a[b].NameType,a[b].Name}a[b].Prefix=u.$("#osd_mergeOSD_prefix").val(),a[b].Postfix=u.$("#osd_mergeOSD_postfix").val(),a[b].SeperaterCount=u.$("#osd_mergeOSD_seperater").val()-0}})}),define("manualEvidence",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=(require("jsCore/ability"),require("jsCore/modules/timeSection"));require("widget/js/dui.slider"),require("jsCore/modules/eventHandler");var g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u="TrafficParkingManual",v=null,w=-1;c.exports=e.extend({init:function(){g=this,a("#ivsManualEvidenceEventHandler").eventHandler({RecordEnable:!1,RecordLatch:!1,SnapshotEnable:!1,PtzLinkEnable:!1,MailEnable:!1}),v=g.$("#manualEvidence_picSetting_dialog").dialog({close:function(){},confirm:function(b,c){c.ui.close(),r.SingleInterval[0]=a("#illegalAlarmOnEx").val()-0;for(var d=0;d<a('[sel-for="onChangeCaptureAmountEx"]').val()-0;d++)r.SnapShotType[d]=a('[sel-for="onChangePic_'+(d+1)+'_Ex"]').val();for(var d=1;d<a('[sel-for="onChangeCaptureAmountEx"]').val()-0;d++)r.SingleInterval[d]=60*(a("#ivs_snapT_m_"+d+"_Ex").val()-0)+(a("#ivs_snapT_s_"+d+"_Ex").val()-0);for(var d=0;d<r.SnapShotType.length;d++)a("#number_"+(d+1)+"_Ex").prop("disabled",!1),"Far"===r.SnapShotType[d]&&(a("#number_"+(d+1)+"_Ex").prop("disabled",!0),a("#number_"+(d+1)+"_Ex").prop("checked",!1));r.MediumRatio=a('[sel-for="onChangeMiddleRatioEx"]').val()-0,r.FeatureRatio=a('[sel-for="onChangeFeatureRatioEx"]').val()-0}}).detach().appendTo(document.body),g.$("#ivs_cardsSizeEx").numberfield({min:80,max:200,allowDecimal:!1,allowNegative:!1}),g.$("#bodyProportion").numberfield({min:1,max:100,allowDecimal:!1,allowNegative:!1}),g.$("#longestCaptureIntervalEx").numberfield({min:600,max:3600,allowDecimal:!1,allowNegative:!1}),g.$("#captureUploadingValueEx").numberfield({min:0,max:1440,allowDecimal:!1,allowNegative:!1}),a("[id^=ivs_snapT_s_]").numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),a("[id^=ivs_snapT_m_]").numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),g._initSlider(),g.bind(),g.render()},bind:function(){g.$("#ivs_captureSettingEx").on("click",g._showPicSettingDialog),a('#manualEvidence_picSetting_dialog [sel-for^="onChangePic_"]').on("change",function(){for(var b=a('[sel-for="onChangeCaptureAmountEx"]').val()-0,c=a('#manualEvidence_picSetting_dialog [sel-for^="onChangePic_"]'),d=[],e=0;e<c.length;e++)d.push(c[e]);var f=d.slice(0,b).some(function(b){return"Medium"===a(b).val()}),g=d.slice(0,b).some(function(b){return"Feature"===a(b).val()});f?a('[sel-for="onChangeMiddleRatioEx"]').parent().removeClass("fn-hide"):a('[sel-for="onChangeMiddleRatioEx"]').parent().addClass("fn-hide"),g?a('[sel-for="onChangeFeatureRatioEx"]').parent().removeClass("fn-hide"):a('[sel-for="onChangeFeatureRatioEx"]').parent().addClass("fn-hide")})},_showPicSettingDialog:function(){v.dialog("show"),a("#illegalAlarmOnEx").val(r.SingleInterval[0]),a('[sel-for="onChangeMiddleRatioEx"]').parent().addClass("fn-hide"),a('[sel-for="onChangeFeatureRatioEx"]').parent().addClass("fn-hide");for(var b=r.SingleInterval.length,c=r.SnapShotType.length,d=(a('[sel-for="onChangeCaptureAmountEx"]').val()-0,1);b>d;d++)a("#ivs_snapT_m_"+d+"_Ex").val(parseInt(r.SingleInterval[d]/60)),a("#ivs_snapT_s_"+d+"_Ex").val(r.SingleInterval[d]%60);for(var e=0;c>e;e++)a('[sel-for="onChangePic_'+(e+1)+'_Ex"]').val(r.SnapShotType[e]).change();a('[sel-for="onChangeMiddleRatioEx"]').val(r.MediumRatio),a('[sel-for="onChangeFeatureRatioEx"]').val(r.FeatureRatio)},render:function(){d.DevIntelliTracker.stop(),g.$("#ivsManualEvidenceEventHandler").find('[class="ui-label"]').css({width:"200px","margin-left":"20px"}),g._getConfig()},leave:function(){d.DevIntelliTracker.start()},onWorkPeriodEx:function(){p&&p&&p.EventHandler&&p.EventHandler.TimeSection&&f.open(p.EventHandler.TimeSection).done(function(a){p.EventHandler.TimeSection=a})},_initSlider:function(){g.$("[slider]").slider({min:0,max:10,complete:function(a){g.$(a.target)}})},_getConfig:function(a){h=["VideoAnalyseGlobal","VideoAnalyseCalibrate","VideoAnalyseRule","MultiSceneRecord","TrafficImage","SceneSnapShotWithRule2","TrafficSnapMosaic2"],d.ConfigManager.getConfig(h).done(function(b){i=b[0].params.table,j=b[1].params.table,k=b[2].params.table,l=b[3].params.table,m=b[4].params.table,n=b[5].params.table,o=b[6].params.table,a&&g.$("#manualEvidence_tip").tip("success",tl("com.OperateSuccessTip")),g._renderElements()})},_renderElements:function(){g.$('[sel-for="onChangeModeEx"]').val(j[0][0].CalibrateArea[0].Method).change();for(var b=0;b<k[0].length;b++)1e3===k[0][b].PtzPresetId&&k[0][b].Type===u&&(p=k[0][b],w=k[0][b].Id);a("#ivsManualEvidenceEventHandler").eventHandler("set",p.EventHandler);for(var b=0;b<n[0].length;b++)1e3===n[0][b].PresetID&&(r=n[0][b].SnapShotWithRule[0]);a('[sel-for="onChangeCaptureAmountEx"]').val(r.SnapShotType.length).change(),g.$("#manualEvidence_slider").slider("value",p.Config.Sensitivity),g.$("#zoomGetEvidenceEx").prop("checked",p.Config.ZoomEnable);for(var b=0;b<m[0].PresetImage.length;b++)1e3===m[0].PresetImage[b].PtzPresetId&&(q=m[0].PresetImage[b].Images[0]);g.$("#origpic_localSaveEx").prop("checked",q.NormalSnap.SaveSnap),g.$("#origpic_reportEx").prop("checked",q.NormalSnap.UploadSnap),g.$('[sel-for="onChangeOrigPictureResolutionEx"]').val(q.NormalSnap.ReduceRate),g.$('[sel-for="onChangeOrigPicQualityEx"]').val(q.NormalSnap.PicCompressRate),g.$("#mergpic_localSaveEx").prop("checked",q.CombinSnap.SaveSnap),g.$("#mergpic_reportEx").prop("checked",q.CombinSnap.UploadSnap),g.$('[sel-for="onChangeCompPictureResolutionEx"]').val(q.CombinSnap.ReduceRate),g.$('[sel-for="onChangeCompPicQualityEx"]').val(q.CombinSnap.PicCompressRate),g.$("#privatePicReplace_enableEx").prop("checked",r.UserImage.Enable),g.$("#longestCaptureIntervalEx").val(r.SnapTimeOutInterval),g.$("#captureUploadingValueEx").val(r.RepeatInterval/60),g.$("#zeroClearTime_enableEx").prop("checked",r.RepeatIntervalFlag),g.$("#snapShot_enableEx").prop("checked",1===r.SnapMode?!0:!1);for(var c=r.UploadMask||0,d=c.toString(2).split("").reverse(),b=0;b<d.length;b++)d[b]-0===1?g.$("#number_"+(b+1)+"_Ex").prop("checked",!0):g.$("#number_"+(b+1)+"_Ex").prop("checked",!1);for(var b=0;b<r.SnapShotType.length;b++)a("#number_"+(b+1)+"_Ex").prop("disabled",!1),"Far"===r.SnapShotType[b]&&(a("#number_"+(b+1)+"_Ex").prop("disabled",!0),a("#number_"+(b+1)+"_Ex").prop("checked",!1));for(var b=0;b<o[0].length;b++)1e3===o[0][b].PresetID&&(s=o[0][b].MosaicWithRule[0]);a(a('input[name="MosaicTwoMethodEx"][value="'+s.MosaicTwoMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicThreeMethodEx"][value="'+s.MosaicThreeMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicFourMethodEx"][value="'+s.MosaicFourMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicFiveMethodEx"][value="'+s.MosaicFiveMethod+'"]')[0]).prop("checked",!0),a(a('input[name="MosaicSixMethodEx"][value="'+s.MosaicSixMethod+'"]')[0]).prop("checked",!0);for(var b=0;b<l[0].PresetRecord.length;b++)1e3===l[0].PresetRecord[b].PtzPresetId&&(t=l[0].PresetRecord[b].Records[0]);g.$("#illegalVideo").prop("checked",t.Enable),g.$("#UploadIllegalVideo").prop("checked",t.UploadRecordEnable)},onChangeModeEx:function(){var a=g.$('[sel-for="onChangeModeEx"]').val();"Plate"===a?(g.$("[data-calibrateType]").addClass("fn-hide"),g.$('[data-calibrateType="ManualCalibrate"]').removeClass("fn-hide"),g.$("#ivs_cardsSizeEx").val(j[0][0].CalibratePixel)):"Scale"===a&&(g.$("[data-calibrateType]").addClass("fn-hide"),g.$('[data-calibrateType="AutoCalibrate"]').removeClass("fn-hide"),g.$("#bodyProportion").val(j[0][0].CalibrateArea[0].ObjectScale))},onChangeCaptureAmountEx:function(){g._renderUpPic(),g._syncImageTable()},_renderUpPic:function(){var b=g.$('[sel-for="onChangeCaptureAmountEx"]').val()-0;g.$("[id^='number_']").css("display","none");for(var c=0;b>c;c++)g.$("#number_"+(c+1)+"_Ex").css("display",""),g.$("#number_span_"+(c+1)+"_Ex").css("display","");5===b?("Near"===r.SnapShotType[3]?(r.SnapShotType[4]="Far",a("#number_5_Ex").attr("disabled",!0),a("#number_5_Ex").attr("checked",!1)):"Far"===r.SnapShotType[3]&&(r.SnapShotType[4]="Near",a("#number_5_Ex").attr("disabled",!1)),r.SingleInterval[4]=r.SingleInterval[3]):6===b&&("Near"===r.SnapShotType[3]?(r.SnapShotType[4]="Far",a("#number_5_Ex").attr("disabled",!0),a("#number_5_Ex").attr("checked",!1),r.SnapShotType[5]="Near",a("#number_6_Ex").attr("disabled",!1)):"Far"===r.SnapShotType[3]&&(r.SnapShotType[4]="Near",a("#number_5_Ex").attr("disabled",!1),r.SnapShotType[5]="Far",a("#number_6_Ex").attr("disabled",!0),a("#number_6_Ex").attr("checked",!1)),r.SingleInterval[4]=r.SingleInterval[3],r.SingleInterval[5]=r.SingleInterval[3])},_syncImageTable:function(){var b=g.$('[sel-for="onChangeCaptureAmountEx"]').val()-0;a("[data-snapcapEx]").each(function(c,d){var e=a(d).attr("data-snapcapEx");e.indexOf(b)>-1?a(d).removeClass("fn-hide"):a(d).addClass("fn-hide")}),g.$(".TPMosaic").addClass("fn-hide"),g.$(".TPMosaic"+b).removeClass("fn-hide")},manualRefreshClick:function(){g._getConfig(!0)},manualConfirmClick:function(){var b=g.$('[sel-for="onChangeModeEx"]').val();j[0][0].CalibrateArea[0].Method=b,"Plate"===b?j[0][0].CalibratePixel=g.$("#ivs_cardsSizeEx").val()-0:"Scale"===b&&(j[0][0].CalibrateArea[0].ObjectScale=g.$("#bodyProportion").val()-0),p.EventHandler=a("#ivsManualEvidenceEventHandler").eventHandler("get"),p.Config.Sensitivity=g.$("#manualEvidence_slider").slider("value"),p.Config.ZoomEnable=g.$("#zoomGetEvidenceEx").prop("checked"),t.Enable=g.$("#illegalVideo").prop("checked"),t.UploadRecordEnable=g.$("#UploadIllegalVideo").prop("checked"),t.RuleId=w,q.NormalSnap.SaveSnap=g.$("#origpic_localSaveEx").prop("checked"),q.NormalSnap.UploadSnap=g.$("#origpic_reportEx").prop("checked"),q.NormalSnap.PicCompressRate=a('[sel-for="onChangeOrigPicQualityEx"]').val()-0,q.NormalSnap.ReduceRate=a('[sel-for="onChangeOrigPictureResolutionEx"]').val()-0,q.CombinSnap.SaveSnap=g.$("#mergpic_localSaveEx").prop("checked"),q.CombinSnap.UploadSnap=g.$("#mergpic_reportEx").prop("checked"),q.CombinSnap.PicCompressRate=a('[sel-for="onChangeCompPicQualityEx"]').val()-0,q.CombinSnap.ReduceRate=a('[sel-for="onChangeCompPictureResolutionEx"]').val()-0,q.RuleId=w,r.UserImage.Enable=g.$("#privatePicReplace_enableEx").prop("checked"),r.SnapTimeOutInterval=g.$("#longestCaptureIntervalEx").val()-0,r.RepeatInterval=60*(g.$("#captureUploadingValueEx").val()-0),r.RepeatIntervalFlag=g.$("#zeroClearTime_enableEx").prop("checked"),r.SnapMode=g.$("#snapShot_enableEx").prop("checked")?1:0,r.SnapShotType.length=a('[sel-for="onChangeCaptureAmountEx"]').val()-0;for(var c=[],e=g.$('[sel-for="onChangeCaptureAmountEx"]').val()-0;e>0;e--)c.push(g.$("#number_"+e+"_Ex").prop("checked")?1:0);r.UploadMask=parseInt(c.join(""),2),r.RuleId=w;for(var e=0;e<a('input[name="MosaicTwoMethodEx"]').length;e++)if(a(a('input[name="MosaicTwoMethodEx"]')[e]).prop("checked")){s.MosaicTwoMethod=a(a('input[name="MosaicTwoMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicThreeMethodEx"]').length;e++)if(a(a('input[name="MosaicThreeMethodEx"]')[e]).prop("checked")){s.MosaicThreeMethod=a(a('input[name="MosaicThreeMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicFourMethodEx"]').length;e++)if(a(a('input[name="MosaicFourMethodEx"]')[e]).prop("checked")){s.MosaicFourMethod=a(a('input[name="MosaicFourMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicFiveMethodEx"]').length;e++)if(a(a('input[name="MosaicFiveMethodEx"]')[e]).prop("checked")){s.MosaicFiveMethod=a(a('input[name="MosaicFiveMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="MosaicSixMethodEx"]').length;e++)if(a(a('input[name="MosaicSixMethodEx"]')[e]).prop("checked")){s.MosaicSixMethod=a(a('input[name="MosaicSixMethodEx"]')[e]).val()-0;break}s.RuleId=w;var f=[i,j,k,l,m,n,o];d.ConfigManager.setConfig(h,f).done(function(){g.$("#manualEvidence_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){g.$("#manualEvidence_tip").tip("error",tl("com.SaveConfigFailTip"))})}})}),define("OSDPublic",function(require,a,b){var c=b.exports={ArrWholeOSDName:["%y","%86","%09","%11","%05","%06","%30","%31","%32","%58","%04","%12","%57","%07","%25","%18","%33","%28","%41","%34","%03","%35","%36","%37","%38","%39","%40","%59","%42","%43","%44","%45","%46","%47","%48","%49","%50","%51","%52","%53","%54","%55","%56","%60","%61","%62","%63","%64","%107","%108","%109","%65","%66","%67","%110","%69","%~","%70","%71","%72","%73","%19"],ttl:function(a){var b={"com_osd.TitleBit-1":window.tl("ivs_osd.TitleBit-1"),"com_osd.TitleBit0":window.tl("ivs_osd.TitleBit0"),"com_osd.TitleBit1":window.tl("ivs_osd.TitleBit1"),"com_osd.TitleBit2":window.tl("ivs_osd.TitleBit2"),"com_osd.TitleBit3":window.tl("ivs_osd.TitleBit3"),"com_osd.TitleBit4":window.tl("ivs_osd.TitleBit4"),"com_osd.TitleBit6":window.tl("ivs_osd.TitleBit6"),"com_osd.TitleBit7":window.tl("ivs_osd.TitleBit7"),"com_osd.TitleBit8":window.tl("ivs_osd.TitleBit8"),"com_osd.TitleBit9":window.tl("ivs_osd.TitleBit9"),"com_osd.TitleBit10":window.tl("ivs_osd.TitleBit10"),"com_osd.TitleBit11":window.tl("ivs_osd.TitleBit11"),"com_osd.TitleBit12":window.tl("ivs_osd.TitleBit12"),"com_osd.TitleBit13":window.tl("ivs.TitleBit63"),"com_osd.TitleBit14":window.tl("ivs_osd.TitleBit14"),"com_osd.TitleBit15":window.tl("ivs.BreakRulesCode"),"com_osd.TitleBit16":window.tl("ivs_osd.TitleBit16"),"com_osd.TitleBit17":window.tl("ivs_osd.TitleBit17"),"com_osd.TitleBit18":window.tl("ivs_osd.TitleBit18"),"com_osd.TitleBit19":window.tl("ivs_osd.TitleBit19"),"com_osd.TitleBit20":window.tl("ivs_osd.TitleBit20"),"com_osd.TitleBit21":window.tl("ivs_osd.TitleBit21"),"com_osd.TitleBit22":window.tl("ivs_osd.TitleBit22"),"com_osd.TitleBit23":window.tl("ivs_osd.TitleBit23"),"com_osd.TitleBit24":window.tl("ivs_osd.TitleBit24"),"com_osd.TitleBit27":window.tl("ivs_osd.TitleBit27"),"com_osd.TitleBit28":window.tl("ivs_osd.TitleBit28"),"com_osd.TitleBit29":window.tl("ivs_osd.TitleBit29"),"com_osd.TitleBit30":window.tl("ivs_osd.TitleBit30"),"com_osd.TitleBit32":window.tl("ivs_osd.TitleBit32"),"com_osd.TitleBit35":window.tl("ivs_osd.TitleBit35"),"com_osd.TitleBit36":window.tl("ivs_osd.TitleBit36"),"com_osd.TitleBit37":window.tl("ivs_osd.TitleBit37"),"com_osd.TitleBit38":window.tl("ivs_osd.TitleBit38"),"com_osd.TitleBit40":window.tl("ivs_osd.TitleBit40"),"com_osd.TitleBit41":window.tl("ivs_osd.TitleBit41"),"com_osd.TitleBit42":window.tl("ivs_osd.TitleBit42"),"com_osd.TitleBit44":window.tl("ivs_osd.TitleBit44"),"com_osd.TitleBit48":window.tl("ivs.InspectionSticker"),"com_osd.TitleBit49":window.tl("ivs.Pendant"),"com_osd.TitleBit50":window.tl("ivs.Perfume"),"com_osd.TitleBit51":window.tl("ivs_osd.TitleBit51"),"com_osd.TitleBit52":window.tl("ivs_osd.TitleBit52"),"com_osd.TitleBit53":window.tl("ivs_osd.TitleBit53"),"com_osd.TitleBit54":window.tl("ivs.Tissue"),"com_osd.TitleBit55":window.tl("ivs_osd.TitleBit55"),"com_osd.TitleBit57":window.tl("ivs_osd.TitleBit57"),"com_osd.TitleBit58":window.tl("ivs_osd.TitleBit58"),"com_osd.TitleBit59":window.tl("ivs_osd.TitleBit59"),"com_osd.TitleBit60":window.tl("ivs_osd.TitleBit60"),"com_osd.TitleBit61":window.tl("ivs_osd.TitleBit61"),"com_osd.TitleBit~":window.tl("ivs_osd.TitleBit~")};return b[a]||a},setFontSize:function(a,b){var c=["16","32","48","64"];"osd"===a?c.each(function(a){b.$('[sel-for="onChangeFontSize"]').append("<option value='"+(a-0)+"'>"+a+"</option>")}):"mergeOsd"===a&&c.each(function(a){b.$('[sel-for="onChangeFontSize"]').append("<option value='"+(a-0)+"'>"+a+"</option>")})},getEleArr:function(a){var b,c=[];if(-1!==a.indexOf("%y%M%d%h%m%s")){var d;d=-1!==a.indexOf("%s")?{Name:"%y%M%d%h%m%s%S"}:{Name:"%y%M%d%h%m%s"},c.push(d)}return b=a.replace("%y%M%d%h%m%s","").replace("%S","").split("%"),b.each(function(a){if(a){var b={Name:"%"+a};c.push(b)}}),c},initOSDMaskItems:function(a,b,d){var e=[];e="TrafficParking"===d||"TrafficParkingB"===d||"TrafficParkingC"===d||"TrafficParkingD"===d?["%y","%86","%09","%58","%59","%12","%07","%18","%28","%41","%46","%61","%71"]:["%y","%86","%09","%58","%12","%07","%18","%28","%41","%46","%61","%71"],b.$("#"+a+"_snapPark_maskItems").empty();var f="",g=-1;e.each(function(b){g=c.ArrWholeOSDName.indexOf(b),f+='<li id="'+a+"snapPark_maskItems_"+g+'_li"><a id="'+a+"snapPark_maskItems_"+g+'" class="osd-button-order" t="'+c.ttl("com_osd.TitleBit"+g)+'" title="'+c.ttl("com_osd.TitleBit"+g)+'" data-type="'+b+'"></a></li>'});var h=c.ArrWholeOSDName.indexOf("%54");["%54","%113","%114"].each(function(b,d){f+='<li id="'+a+"snapPark_maskItems_"+(h+d)+'_li"><a id="'+a+"snapPark_maskItems_"+(h+d)+'" class="osd-button-order" t="'+(c.ttl("com_osd.TitleBit"+h)+(d+1))+'" title="'+(c.ttl("com_osd.TitleBit"+h)+(d+1))+'" data-type="'+b+'"></a></li>'}),b.$("#"+a+"_snapPark_maskItems").append(f).translation()}}})}(jQuery);