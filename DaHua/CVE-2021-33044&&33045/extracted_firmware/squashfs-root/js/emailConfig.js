!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("mail",function(require,b,c){function d(a){return a.lengthB()<=64}var e=require("jsCore/rpc"),f=require("jsCore/pageBase"),g=null,h=null,i=-1,j={},k=require("common/common"),l=k.Check;c.exports=f.extend({init:function(){g=this,h=a.validator([{element:g.$("[cfg=Address]"),check:[l.alphaNumLineDot,l.alphaNumLineDot,l.require],errorMsg:["com.WrongServerNameTip","com.WrongServerNameTip","com.Necessary"],events:["keyup","blur","blur"]},{element:g.$("[cfg=UserName]"),check:[function(a){return/^[\d|a-z|A-Z|_|\!|\?|\@|\#|\$|\%|\^|\&|\*|\-|\_|\||\:|\,|\.|\/|\s]*$/.test(a)},function(a){return/^[\d|a-z|A-Z|_|\!|\?|\@|\#|\$|\%|\^|\&|\*|\-|\_|\||\:|\,|\.|\/|\s]*$/.test(a)},d,d],errorMsg:["com.InputNotValidTip","com.InputNotValidTip","com.UsernameTooLongTip","com.UsernameTooLongTip"],events:["keyup","blur","keyup","blur"]},{element:g.$("[cfg=Title]"),check:[l.noQuotation],errorMsg:["com.NoInputMarksTip"],events:["keyup"]}],function(a){a.parent().translation()}),g.$("[cfg=SendInterv]").numberfield({min:0,max:3600,allowDecimal:!1,allowNegative:!1}),g.$("[cfg=Title]").textfield({charset:"utf-8",asciiByte:2,notAsciiByte:3,length:120,validReg:/^[^\'\"]*$/,validRegRet:!0}),g.$("#mail_HI").numberfield({min:1,max:3600,allowDecimal:!1,allowNegative:!1}),g.$("[cfg=Port]").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),g.$("[cfg=Enable]").on("click",function(){g.disabled("#mail_HI",!g.$("[cfg=Enable]").is(":checked"))}),g.disabled("[btn-for=onReceiverAdd]"),g.$("#mail_receiver").on("keyup mouseout",function(){this.value.length>0?(g.$("[btn-for=onReceiverAdd]").removeClass("ui-set-control-icon-disabled"),g.disabled("[btn-for=onReceiverAdd]",!1)):(g.$("[btn-for=onReceiverAdd]").addClass("ui-set-control-icon-disabled"),g.disabled("[btn-for=onReceiverAdd]"))}),ability.get("EmailIntervalVisible").done(function(a){!!a==!1&&g.$("#mail_interv_wrap").hide()}),g.render()},render:function(){e.ConfigManager.getConfig("Email").done(function(a){j=a,g._renderElements()})},_renderElements:function(){g._bindCutomTitle(),g.$("#mail_receiver").val(""),a.each(g.$("[cfg]"),function(a,b){var c=g.$(b).attr("cfg"),d=g.$(b).attr("type");"checkbox"===d&&("Enable"===c?g.$(b).prop("checked",j.HealthReport[c]):g.$(b).prop("checked",j[c])),g.$(b).val(j[c])}),webCaps.show_extended_emailtitle?(g.$("#mail_HI").numberfield({min:30,max:1440,allowDecimal:!1,allowNegative:!1}),g.$("#mail_HI").numberfield("value",parseInt(j.HealthReport.Interval/60))):g.$("#mail_HI").val(j.HealthReport.Interval),g.disabled("#mail_HI",!g.$("[cfg=Enable]").is(":checked")),g.$("#mail_auth").val("None"),j.TlsEnable&&g.$("#mail_auth").val("TLS"),j.SslEnable&&g.$("#mail_auth").val("SSL"),g._renderReceiverList(),h.validate()},onReceiverAdd:function(){return 3==j.Receivers.length?void g.tip("warning",tl("com.Emailrevnum3Tip")):a.inArray(g.$("#mail_receiver").val(),j.Receivers)>-1?void g.tip("warning",tl("com.SameEmailTip")):l.email(g.$("#mail_receiver").val())?(j.Receivers.push(g.$("#mail_receiver").val()),g.$("#mail_receiver").val(""),g.$("[btn-for=onReceiverAdd]").addClass("ui-set-control-icon-disabled"),g.disabled("[btn-for=onReceiverAdd]"),void g._renderReceiverList()):g.tip("warning",tl("com.EmailreverrorTip"))},onReceiverDel:function(){0>i||i>=j.Receivers.length||(j.Receivers.splice(i,1),g._renderReceiverList())},onTest:function(){e.NetApp.sendTestMail().done(function(){g.tip("success","com.Succeed")}).fail(function(){g.tip("error","com.Fail")})},_renderReceiverList:function(){var b="",c=a.grep(j.Receivers,function(a){return""!==a});j.Receivers=c,i=-1,g.$("[btn-for=onReceiverDel]").addClass("ui-set-control-icon-disabled"),g.disabled("[btn-for=onReceiverDel]"),a.each(c,function(a,c){var d=8*c.length>204?8*c.length:204;b+='<a id="mail_receiver_address_'+a+'" class="ui-receiver-address" style="width:'+d+'px">'+c+"&nbsp</a>"}),g.$("#mail_receiver_list").html(b),g.$(".ui-receiver-address:first").length>0&&(g.$(".ui-receiver-address:first").addClass("ui-receiver-address-current"),i=g.$(".ui-receiver-address:first").attr("id").replace(/[^\d]/g,""),g.$("[btn-for=onReceiverDel]").removeClass("ui-set-control-icon-disabled"),g.disabled("[btn-for=onReceiverDel]",!1)),g.$(".ui-receiver-address").on("click",function(){g.$(".ui-receiver-address").removeClass("ui-receiver-address-current"),i=this.id.replace(/[^\d]/g,""),g.$(this).addClass("ui-receiver-address-current"),g.$("[btn-for=onReceiverDel]").removeClass("ui-set-control-icon-disabled"),g.disabled("[btn-for=onReceiverDel]",!1)})},onDefault:function(){e.ConfigManager.getDefault("Email").done(function(a){j=a,g._renderElements(),g.tip("success","com.DefaultSuccessTip")}).fail(function(){g.tip("error","com.DefaultfailureTip")})},onRefresh:function(){e.ConfigManager.getConfig("Email").done(function(a){j=a,g._renderElements(),g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})},onSave:function(){if(h.isInvalid())return g.tip("warning",h.errors()[0].errorMsg);if(""!==a("[cfg=SendAddress]").val()&&"none"!==a("[cfg=SendAddress]").val()&&!l.email(g.$("[cfg=SendAddress]").val()))return g.tip("warning","com.EmailsendererrorTip");a.each(g.$("[cfg]"),function(a,b){var c=g.$(b).attr("cfg"),d=g.$(b).attr("type");"checkbox"===d?"Enable"===c?j.HealthReport[c]=g.$(b).is(":checked"):j[c]=g.$(b).is(":checked"):"Port"===c||"SendInterv"===c?j[c]=g.$(b).val()-0:("text"===d||"password"===d)&&(j[c]=g.$(b).val())}),j.HealthReport.Interval=webCaps.show_extended_emailtitle?60*(g.$("#mail_HI").val()-0):g.$("#mail_HI").val()-0,j.CustomTitle=g._getCustomTitleConfig();var b=g.$("#mail_auth").val();"SSL"==b?(j.SslEnable=!0,j.TlsEnable=!1):"TLS"==b?(j.SslEnable=!1,j.TlsEnable=!0):"None"==b&&(j.SslEnable=!1,j.TlsEnable=!1),e.ConfigManager.setConfig("Email",j).done(function(){g.tip("success","com.SaveSuccessTip")}).fail(function(){g.tip("error","com.SaveConfigFailTip")})},_bindCutomTitle:function(){function a(a){a>=1?(g.$("#main_custom_title_del").removeClass("fn-hide"),1==a&&g.$("#main_custom_title_add").removeClass("fn-hide"),2==a&&g.$("#main_custom_title_add").addClass("fn-hide")):(g.$("#main_custom_title_del").addClass("fn-hide"),g.$("#main_custom_title_add").removeClass("fn-hide"))}function b(){"undefined"==typeof j.CustomTitle&&(j.CustomTitle=[]),e=j.CustomTitle.length;for(var b=0;e>b;b++)d.append(f);for(var c=0;e>c;c++)d.find("li").eq(c).find("select").val(j.CustomTitle[c]);a(e),g.$("#mail_HI").next("span").text(tl("com.Minute")+"(30~1440)")}function c(){g.$("#main_custom_title_add").off("click").on("click",function(){e++,d.append(f),a(e)}),g.$("#main_custom_title_del").off("click").on("click",function(){e--,a(e),d.find("li").last().remove()})}if(!webCaps.show_extended_emailtitle)return void g.$("#mail_custom_title_wrap").remove();var d=g.$("#mail_custom_title"),e=0,f=['<li class="fn-left">','<select class="ui-select fn-width100">','<option value="MachineName">'+tl("sto.DeviceName")+"</option>",'<option value="IP">'+tl("sto.DeviceIP")+"</option>",'<option value="EventName">'+tl("sto.EventType")+"</option>","</select>","</li>"].join("");d.empty(),b(),c()},_getCustomTitleConfig:function(){for(var a=g.$("#mail_custom_title li"),b=[],c=0,d=a.length;d>c;c++)b.push(a.eq(c).find("select").val());return b}})})}(jQuery);