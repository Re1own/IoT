!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("developer",function(require,b,c){var d,e=require("jsCore/rpc"),f=(require("common/rpcBase"),require("jsCore/pageBase")),g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=0;c.exports=f.extend({init:function(){g=this,k=a("#dev_uploadLicense").dialog({onLicenseUpload:function(){k.find("#dev_lic_upgrade").val();""!==k.find("#dev_lic_path").val()&&(g.disabled(k.find("#dev_lic_upload"),!0),k.find("[name=AppName]").val(j.AppName),k.find("#dev_lic_submit").trigger("click"))}}).detach().appendTo(document.body),l=a("#dev_setArea").dialog({confirm:function(a,b){l.find("#dev_face_form").attr("action",location.href+"DHOP_API/"+j.AppName+"/"),l.find("[name=SizeFilter]").attr("value",JSON.stringify(m)),l.find("#dev_face_submit").trigger("click"),dialoOpened=!1,plugin.SetGridNum(0,0),plugin.close(),plugin.hide(),b.ui.close(),plugin.addEvent("StateChangedCutZone",null)},onDrawTarget:function(){g._targetRule()}}),$progressDialog=a("#dev_progress").dialog({}).detach().appendTo(document.body),$devProcess=a("#dev_progress").find("#dev_process"),plugin.addEvent("OutPutStringInfo",function(a,b){if("OutPutObjectRect"===a){var c=JSON.parse(b);c.MinRect?m.MinSize=c.MinRect:c.MaxRect&&(m.MaxSize=c.MaxRect),g._renderSizeFilter(m,!0),g.$("#i_f_max, #i_f_min").prop("disabled",!1)}}),a("#dev_upgrade").on("change blur",g._onUpgradeChange),k.find("#dev_lic_upgrade").on("change blur",g._onLicenseUpgradeChange),a("#dev_upgrade").hover(function(){a("#dev_browse").addClass("ui-button-hover")},function(){a("#dev_browse").removeClass("ui-button-hover")}),k.find("#dev_lic_upgrade").hover(function(){a("#dev_lic_browse").addClass("ui-button-hover")},function(){a("#dev_lic_browse").removeClass("ui-button-hover")}),h=a("#developer_appTable").table({height:180,columns:[{t:"com.Numbers",width:"5%",render:function(a){return a._index+1}},{fields:"AppName",t:"com.Name",width:"5%"},{fields:"RunStateString",t:"sys.RunningState",width:"10%"},{fields:"Version",t:"sys.Version",width:"10%"},{fields:"LicenseState",t:"sys.CertState",width:"10%"},{fields:"ExpiredDate",t:"sys.ExpiredDate",width:"10%"},{action:"edit",t:"",actionField:"sys.UploadCert",width:"10%",handle:function(a,b){j=a,k.dialog("show"),b.stopPropagation()}},{fields:"Url",t:"sys.AppLink",type:"url",width:"10%"},{t:"com.Operation",width:"8%",action:"start/stop",icon:"ui-table-icon-state-",iconLink:"RunState",handle:function(a){j=a,"stop"===j.RunState?e.InstallManager.start(j.AppName,j.AppID).done(function(){g.render(),g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")}):"running"===j.RunState&&e.InstallManager.stop(j.AppName,j.AppID).done(function(){g.render(),g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})}},{t:"com.Delete",width:"8%",action:"delete",icon:"ui-table-icon-del",handle:function(a){j=a,e.InstallManager.remove(j.AppName,j.AppID).done(function(){g.render(),g.tip("success","com.DelectSuccessTip")}).fail(function(){g.tip("error","com.Deletefail")})}},{fields:"Extend",t:"com.Extend",width:"14%"}],dataSource:[],onRowSelect:function(a,b){j=b.data,j.AppID?"running"===j.RunState?(g.disabled(g.$("[btn-for=onStart]"),!0),g.$("[btn-for=onStart]").addClass("ui-button-disabled"),g.disabled(g.$("[btn-for=onStop]"),!1),g.$("[btn-for=onStop]").removeClass("ui-button-disabled"),g.disabled(g.$("[btn-for=onRemove]"),!1),g.$("[btn-for=onRemove]").removeClass("ui-button-disabled")):"stop"===j.RunState&&(g.disabled(g.$("[btn-for=onStart]"),!1),g.$("[btn-for=onStart]").removeClass("ui-button-disabled"),g.disabled(g.$("[btn-for=onStop]"),!0),g.$("[btn-for=onStop]").addClass("ui-button-disabled"),g.disabled(g.$("[btn-for=onRemove]"),!1),g.$("[btn-for=onRemove]").removeClass("ui-button-disabled")):(g.disabled(g.$("[btn-for=onStart]"),!0),g.disabled(g.$("[btn-for=onStop]"),!0),g.disabled(g.$("[btn-for=onRemove]"),!0),g.$("[btn-for=onStart]").addClass("ui-button-disabled"),g.$("[btn-for=onStop]").addClass("ui-button-disabled"),g.$("[btn-for=onRemove]").addClass("ui-button-disabled"))}}),g.render()},render:function(){m={MaxSize:[],MinSize:[]},plugin.SetRegionNum(0),plugin.SetModuleMode(2),window.downSucceed=function(){k.dialog("close"),$progressDialog.dialog("show"),e.UpgraderInstall.getState().done(function(b){var c,d=b.params.Progress;switch(b.params.State){case"Preparing":case"Downloading":case"Upgrading":c="access";break;case"DownloadFailed":case"Invalid":case"Cancelled":case"NotEnoughMemory":case"Failed":c="failed";break;case"Succeeded":c="success";break;default:c="failed"}"success"===c?(g.render(),a("#dev_path").val(""),a("#dev_upgrade").val(""),a("#dev_lic_upgrade").val(""),$devProcess.css("width","0px"),$progressDialog.dialog("close"),k.find("#dev_lic_path").val(""),g.tip("success","com.UpmoveSuccessTip")):"access"===c?($devProcess.css("width",321*d/100+"px"),downSucceed()):"failed"===c&&(a("#dev_path").val(""),a("#dev_upgrade").val(""),a("#dev_lic_upgrade").val(""),k.find("#dev_lic_path").val(""),$devProcess.css("width","0px"),$progressDialog.dialog("close"),g.tip("error","sys.Platform"+b.params.State))})},window.downFailed=function(){k.dialog("close"),g._uploadRes(!1)},window.downLicSucceed=function(){k.dialog("close"),n=3,g._uploadRes(!0)},window.downLicFailed=function(a){k.dialog("close"),a=a.replace("DHOP_","sys.Platform"),g._uploadRes(!1,a)},e.InstallManager.getInstallProcInfo().done(function(a){i=a.params.ListInfo,i?h.table("dataSource",i):h.table("dataSource",[])}),a(window).on("resize.encode",function(){plugin.cover("#dev_setzone")})},onSelectFile:function(){a("#dev_browse").trigger("click")},onSelectLicenseFile:function(){k.find("#dev_lic_browse").trigger("click")},_onUpgradeChange:function(){var b=a(this).val().split("\\");a("#dev_path").val(b[b.length-1])},_onLicenseUpgradeChange:function(){var b=a(this).val().split("\\");k.find("[name=dev_lic_form]").attr("action","/DHOP/"+j.AppName),k.find("#dev_lic_path").val(b[b.length-1])},onUpload:function(){var b=a("#dev_upgrade").val();""!==a("#dev_path").val()&&(b.test(".bin","i")?a("#dev_submit").trigger("click"):(g.tip("warning",tl("com.WrongFileUpgradeTip")),a("#dev_path").val("")))},_uploadRes:function(b,c){b?(g.tip("success","com.UpmoveSuccessTip"),d=setInterval(function(){0===n?clearInterval(d):(g.render(),n-=1)},2e3)):void 0!==c?g.tip("error",c):g.tip("error","com.UpmoveFailTip"),a("#dev_path").val(""),a("#dev_upgrade").val(""),a("#dev_lic_upgrade").val(""),k.find("#dev_lic_path").val("")},destory:function(){},_targetRule:function(){a("#dev_f_max").prop("checked")?m.MaxSize.length?plugin.SetCurShape("MaxRect"):plugin.AddShape(5,"","MaxRect",0,-1):m.MinSize.length?plugin.SetCurShape("MinRect"):plugin.AddShape(5,"","MinRect",0,-1)},_renderSizeFilter:function(b){a.each(a("#dev_f_target").find("input[type=text]"),function(c,d){var e=d.name.split("-");a(this).val(b[e[0]][parseInt(e[1])])})}})})}(jQuery);