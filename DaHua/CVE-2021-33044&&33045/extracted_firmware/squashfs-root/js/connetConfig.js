!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab"),b.exports.prototype.Conn_Onvif=function(){return!webCaps.is_platform_showOnvif}}),define("Conn_Connect",function(require,b,c){function d(a,b){var c=b.attr("id"),d=b.attr("exceptport")-0;return!x.chkPort(a,d)||"con_udp_port"===c&&a===l.numberfield("value")-1||"con_http_port"===c&&a===l.numberfield("value")-1||"con_rtsp_port"===c&&a===l.numberfield("value")-1?!1:!0}function e(a,b){for(var c=0;c<s.length;++c)if(b[0]!==s[c]&&a===s[c].value)return!1;return!0}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=require("jsCore/pageBase"),v=require("jsCore/rpc"),w=require("common/rpcBase"),x=require("common/common");c.exports=u.extend({init:function(){var b=this;k=b.$("#con_max_cons").numberfield({max:20,min:1,allowDecimal:!1,allowNegative:!1}),webApp.GongAnDetect&&(b.$("#con_max_cons").numberfield("max",28),b.$("#con_max_20").addClass("fn-hide"),b.$("#con_max_28").removeClass("fn-hide")),isEnable("is_hide_connectHttpsEnable")&&b.$("#https_enable_wrap").addClass("fn-hide"),l=b.$("#con_tcp_port"),m=b.$("#con_udp_port"),n=b.$("#con_http_port"),o=b.$("#con_rtsp_port"),p=b.$("#con_rtmp_port"),q=b.$("#con_https_port"),r=b.$("#con_https_enable"),s=b.$("input[name=ports]"),s.numberfield({max:65534,allowDecimal:!1,allowNegative:!1}),r.on("change",function(){i.ServerCertificate&&""===i.ServerCertificate.CommonName&&(b.tip("error","pfm.CertificateNotAvailible"),r.prop("checked",i.Enable))}),t=a.validator([{element:l,check:[e,d],errorMsg:["com.PortNoSameTip","com.PortInUseTip"],events:["blur","blur"],errorElem:".u-input-error"},{element:m,check:[e,d],errorMsg:["com.PortNoSameTip","com.PortInUseTip"],events:["blur","blur"],errorElem:".u-input-error"},{element:n,check:[e,d],errorMsg:["com.PortNoSameTip","com.PortInUseTip"],events:["blur","blur"]},{element:o,check:[e,d],errorMsg:["com.PortNoSameTip","com.PortInUseTip"],events:["blur","blur"]},{element:p,check:[e,d],errorMsg:["com.PortNoSameTip","com.PortInUseTip"],events:["blur","blur"],errorElem:".u-input-error"},{element:q,check:[e,d],errorMsg:["com.PortNoSameTip","com.PortInUseTip"],events:["blur","blur"]}],function(a){a.parent().translation()}),void function(){for(var a=[l,m,n,o,p,q],b=0,c=a.length;c>b;b++)a[b].on("blur",function(){t.validate()})}(),b.render()},render:function(){this._getConfig()},_render:function(a,b,c,d,e){k.numberfield("value",a.MaxConnections),l.numberfield("value",a.TCPPort),m.numberfield("value",a.UDPPort),n.numberfield("value",b.Port),o.numberfield("value",c.Port),q.numberfield("value",d.Port),r.prop("checked",d.Enable),null!=e?p.numberfield("value",e.Port):(p.numberfield("value",1935),p.parent().addClass("fn-hide")),"https:"===window.location.protocol.toLowerCase()&&r.prop("disabled",!0),t.validate()},_getConfig:function(a){var b=this;v.ConfigManager.getConfig(["DVRIP","Web","RTSP","Https","RTMP"]).done(function(c){f=c[0].params.table,g=c[1].params.table,h=c[2].params.table,i=c[3].params.table,j=c[4].params.table,b._render(f,g,h,i,j),a&&b.tip("success","com.OperateSuccessTip"),b.disabled("[btn-for=onSave]",!1)}).fail(function(){b.tip("error","com.OperateFailTip"),b.disabled("[btn-for=onSave]",!0)})},onSave:function(){var a=this;return t.isInvalid()?(a.tip("warning",t.errors()[0].errorMsg),void t.validate()):void v.ConfigManager.getConfig("DVRIP").done(function(b){var c=["DVRIP","Web","RTSP"];f=b,f.MaxConnections=k.numberfield("value"),i.Enable=r.prop("checked"),f.TCPPort=l.numberfield("value"),f.UDPPort=m.numberfield("value"),g.Port=n.numberfield("value"),i.Port=q.numberfield("value"),h.Port=o.numberfield("value");var d=[f,g,h];null!=j&&(j.Port=p.numberfield("value"),c.push("RTMP"),d.push(j)),v.ConfigManager.setConfig(c,d).done(function(b){x.chkMutilCallRet(b)?(a.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(b)&&webApp.reboot("com.ConfEffectRestartTip")):a.tip("error","com.SaveConfigFailTip")}),i.Enable&&i.ServerCertificate?w.CertManager.getSvrCertInfo().done(function(){v.ConfigManager.setConfig("Https",i).done(function(b){a.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(b)&&webApp.reboot("com.ConfEffectRestartTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")}),a.tip("success","com.SaveSuccessTip")}).fail(function(){a.tip("error","pfm.CertificateNotAvailible")}):v.ConfigManager.setConfig("Https",i).done(function(b){a.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(b)&&webApp.reboot("com.ConfEffectRestartTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")})})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;v.ConfigManager.getDefault(["DVRIP","Web","RTSP","Https","RTMP"]).done(function(b){var c=i;if(f=b[0].params.table,g=b[1].params.table,h=b[2].params.table,i=b[3].params.table,j=b[4].params.table,isEnable("is_hide_connectHttpsEnable")){var d=c;c=i,i=d,i.Port=c.Port}a._render(f,g,h,i,j),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")})}})}),define("Conn_Onvif",function(require,a,b){var c,d=require("jsCore/rpc"),e=require("jsCore/pageBase");b.exports=e.extend({init:function(){var a=this;a.render()},render:function(){this._getConfig()},_render:function(a){this.$("input[name=ra_login][loginchk="+(a.OnvifLoginCheck?1:0)+"]").prop("checked",!0)},_getConfig:function(a){var b=this;d.ConfigManager.getConfig("UserGlobal").done(function(d){c=d||{},b._render(c),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","com.OperateSuccessTip")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")})},onSave:function(){var a=this;c.OnvifLoginCheck=Boolean(a.$("input[name=ra_login]:checked").attr("loginchk")-0),d.ConfigManager.setConfig("UserGlobal",c).done(function(){a.tip("success","com.SaveSuccessTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;d.ConfigManager.getDefault("UserGlobal").done(function(b){c=b||{},a._render(c),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")})}})})}(jQuery);