!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("intelliCityMgr",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/plugin"),f=require("jsCore/pageBase"),g=require("jsCore/ability"),h=require("jsCore/modules/timeSection");require("jsCore/modules/ptzSetControl"),require("widget/js/dui.slider"),require("jsCore/modules/eventHandler");var i=null,j=null,k=0,l=[],m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v="IntelliCityMgr",w=[],x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=!1,L=null,M={},N=null,O=null,P=null,Q=null,R=null,S=[],T={},U=16,V=-1,W="",X=-1,Y=!0,Z={},$=null,_=null,ab=null,bb="",cb="",db="",eb="",fb=null,gb=[],hb="",ib=/^[0-9]+$/;c.exports=f.extend({init:function(){i=this,i.$("#ivs_intelliCityMgr_ptz").ptzSetControl(),ab=i.$("#cityMgrAdvancedParams_dialog").dialog({close:function(){i._openVideo()},confirm:function(b,c){i._openVideo(),c.ui.close(),_.EventHandler=a("#ivsCityMgrTrafficParkEventHandler").eventHandler("get"),"CityNonMotorParking"===hb&&(_.Config.Interval=a("#cityMgrAlarmWaitTime").val()-0),a(".ui-CityMgr-ShopPresence").hasClass("fn-hide")||(_.Config.ShopAddress=a("#cityMgrShopID").val()),a(".ui-CityMgr-CityNonMotorParking").hasClass("fn-hide")||(_.Config.AlarmNum=a("#alarmNumberThreshold").val()-0),_.Config.Sensitivity=a("#cityMgr_slider").slider("value"),curPresetRuleRecord.Enable=a("#cityMgrUploadViolationVideo_title_Enable").prop("checked"),curPresetRuleRecord.UploadRecordEnable=a("#cityMgrUploadViolationVideo").prop("checked"),curPresetRuleImage.NormalSnap.SaveSnap=a("#cityMgrOrigpic_localSave").prop("checked"),curPresetRuleImage.NormalSnap.UploadSnap=a("#cityMgrOrigpic_report").prop("checked"),curPresetRuleImage.NormalSnap.PicCompressRate=a('[sel-for="onCityMgrChangeOrigPicQuality"]').val()-0,curPresetRuleImage.NormalSnap.ReduceRate=a('[sel-for="onCityMgrChangeOrigPictureResolution"]').val()-0,curPresetRuleImage.CombinSnap.SaveSnap=a("#cityMgrMergpic_localSave").prop("checked"),curPresetRuleImage.CombinSnap.UploadSnap=a("#cityMgrMergpic_report").prop("checked"),curPresetRuleImage.CombinSnap.PicCompressRate=a('[sel-for="onCityMgrChangeCompPicQuality"]').val()-0,curPresetRuleImage.CombinSnap.ReduceRate=a('[sel-for="onCityMgrChangeCompPictureResolution"]').val()-0,$.UserImage.Enable=a("#cityMgrPrivatePicReplace_enable").prop("checked"),$.UserImage.IndexInGroup=a('[sel-for="onCityMgrReplacePicNum"]').val()-0,$.SnapTimeOutInterval=a("#cityMgrLongestCaptureInterval").val()-0,$.RepeatInterval=60*(a("#cityMgrCaptureUploadingValue").val()-0),$.RepeatIntervalFlag=a("#cityMgrZeroClearTime_enable").prop("checked"),$.SnapMode=a("#cityMgrSnapShot_enable").prop("checked")?1:0,$.SnapShotType.length=a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0;for(var d=[],e=a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0;e>0;e--)d.push(a("#cityMgrNumber_"+e).prop("checked")?1:0);$.UploadMask=parseInt(d.join(""),2);for(var e=0;e<a('input[name="cityMgrMosaicTwoMethod"]').length;e++)if(a(a('input[name="cityMgrMosaicTwoMethod"]')[e]).prop("checked")){curPresetRuleSnapMosaic2.MosaicTwoMethod=a(a('input[name="cityMgrMosaicTwoMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicThreeMethod"]').length;e++)if(a(a('input[name="cityMgrMosaicThreeMethod"]')[e]).prop("checked")){curPresetRuleSnapMosaic2.MosaicThreeMethod=a(a('input[name="cityMgrMosaicThreeMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicFourMethod"]').length;e++)if(a(a('input[name="cityMgrMosaicFourMethod"]')[e]).prop("checked")){curPresetRuleSnapMosaic2.MosaicFourMethod=a(a('input[name="cityMgrMosaicFourMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicFiveMethod"]').length;e++)if(a(a('input[name="cityMgrMosaicFiveMethod"]')[e]).prop("checked")){curPresetRuleSnapMosaic2.MosaicFiveMethod=a(a('input[name="cityMgrMosaicFiveMethod"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicSixMethod"]').length;e++)if(a(a('input[name="cityMgrMosaicSixMethod"]')[e]).prop("checked")){curPresetRuleSnapMosaic2.MosaicSixMethod=a(a('input[name="cityMgrMosaicSixMethod"]')[e]).val()-0;break}}}).detach().appendTo(document.body),$picSettingDialog=i.$("#cityMgrAdvancedParams_picSetting_dialog").dialog({close:function(){ab.dialog("show")},confirm:function(b,c){c.ui.close(),ab.dialog("show"),$.SingleInterval[0]=a("#cityMgrIllegalAlarmOn").val()-0;for(var d=0;d<a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0;d++)$.SnapShotType[d]=a('[sel-for="onCityMgrChangePic_'+(d+1)+'"]').val();for(var d=1;d<a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0;d++)$.SingleInterval[d]=60*(a("#ivs_cityMgrSnapT_m_"+d).val()-0)+(a("#ivs_cityMgrSnapT_s_"+d).val()-0);for(var d=0;d<$.SnapShotType.length;d++)a("#cityMgrNumber_"+(d+1)).prop("disabled",!1),"Far"===$.SnapShotType[d]&&(a("#cityMgrNumber_"+(d+1)).prop("disabled",!0),a("#cityMgrNumber_"+(d+1)).prop("checked",!1));$.MediumRatio=a('[sel-for="onCityMgrChangeMiddleRatio"]').val()-0,$.FeatureRatio=a('[sel-for="onCityMgrChangeFeatureRatio"]').val()-0}}).detach().appendTo(document.body),a("#ivsCityMgrTrafficParkEventHandler").eventHandler({RecordEnable:!1,RecordLatch:!1,SnapshotEnable:!1,PtzLinkEnable:!1,MailEnable:!1}),a("#cityMgrAlarmWaitTime").numberfield({min:20,max:3600,allowDecimal:!1,allowNegative:!1}),a("#alarmNumberThreshold").numberfield({min:1,max:100,allowDecimal:!1,allowNegative:!1}),a("#cityMgrIllegalRuleCode").textfield({validReg:ib,errorHandle:"prevent",error:function(){i.$("#intelliCityMgr_tip").tip("error",tl("com.OnlyInputNumber"))}}),i._getTemplates(),i.bind(),i._initSlider(),i.render()},render:function(){d.DevIntelliTracker.stop(),i._initCityMgrRuleConfigureTable(),a('[data-action="checkAll"]').hide(),i._getConfig()},bind:function(){a("#ivs_cityMgrCaptureSetting").on("click",i._showPicSettingDialog),a("#ivs_cityMgrCopy").on("click",i._copyPicParam),a("#ivs_cityMgrCopy2").on("click",i._copySSSWithRule2),a('#cityMgrAdvancedParams_picSetting_dialog [sel-for^="onCityMgrChangePic_"]').on("change",function(){for(var b=a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0,c=a('#cityMgrAdvancedParams_picSetting_dialog [sel-for^="onCityMgrChangePic_"]'),d=[],e=0;e<c.length;e++)d.push(c[e]);var f=d.slice(0,b).some(function(b){return"Medium"===a(b).val()}),g=d.slice(0,b).some(function(b){return"Feature"===a(b).val()});f?a('[sel-for="onCityMgrChangeMiddleRatio"]').parent().removeClass("fn-hide"):a('[sel-for="onCityMgrChangeMiddleRatio"]').parent().addClass("fn-hide"),g?a('[sel-for="onCityMgrChangeFeatureRatio"]').parent().removeClass("fn-hide"):a('[sel-for="onCityMgrChangeFeatureRatio"]').parent().addClass("fn-hide")}),e.addEvent("VideoAnalyzeConfig",function(a){var b=JSON.parse(a),c=b.EventParam.ShapeState;c&&3==c&&i._ocxEventDone(b.EventParam.ShapeID,b.EventName)})},leave:function(){S=[],e.hide(),e.SetModuleMode(1),e.EnableVideoAnalyseModule(!1),d.DevIntelliTracker.start()},_copyPicParam:function(){cb=fb.Type,bb=a('[sel-for="onCityMgrCoptTo"]').val()},_copySSSWithRule2:function(){db=fb.Type,eb=a('[sel-for="onCityMgrCoptTo2"]').val()},_initSlider:function(){a("#cityMgr_slider").slider({min:0,max:10,complete:function(a){i.$(a.target)}})},_getConfig:function(b){l=["VideoAnalyseGlobal","VideoAnalyseCalibrate","VideoAnalyseRule","MultiSceneRecord","TrafficImage","SceneSnapShotWithRule2","TrafficSnapMosaic2","TrafficViolationCode","SnapOSD"],a.when(d.ConfigManager.getConfig(l),g.get("VideoAnalyse",!0)).done(function(a,c){m=a[0].params.table,n=a[1].params.table,o=a[2].params.table,p=a[3].params.table,q=a[4].params.table,r=a[5].params.table,s=a[6].params.table,t=a[7].params.table,u=a[8].params.table,w=c.SupportedRules,b&&i.$("#intelliCityMgr_tip").tip("success",tl("Operateingsuccess")),i._renderElements()})},_getTemplates:function(){d.VideoInAnalyse.getTemplateGlobal().done(function(a){x=a}),d.VideoInAnalyse.getTemplateRule("IntelliCityMgr").done(function(a){y=a,N=y.IntelliCityMgr.CityMotorParking,O=y.IntelliCityMgr.CityNonMotorParking,P=y.IntelliCityMgr.FlowBusiness,Q=y.IntelliCityMgr.ShopPresence,Z.CityMotorParking=N.Name,Z.CityNonMotorParking=O.Name,Z.FlowBusiness=P.Name,Z.ShopPresence=Q.Name}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("IntelliCityMgr",0,"CityMotorParking").done(function(a){z=a.IntelliCityMgr.CityMotorParking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("IntelliCityMgr",0,"CityNonMotorParking").done(function(a){A=a.IntelliCityMgr.CityNonMotorParking}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("IntelliCityMgr",0,"FlowBusiness").done(function(a){B=a.IntelliCityMgr.FlowBusiness}),d.VideoInAnalyse.getTemplateSceneSnapShotWithRule2("IntelliCityMgr",0,"ShopPresence").done(function(a){C=a.IntelliCityMgr.ShopPresence}),d.VideoInAnalyse.getTemplateTrafficViolationCode().done(function(a){D=a}),d.VideoInAnalyse.getTemplatePresetRecord().done(function(a){E=a}),d.VideoInAnalyse.getTemplatePresetImage().done(function(a){F=a}),d.VideoInAnalyse.getTemplateTrafficSnapMosaic2().done(function(a){G=a}),d.VideoInAnalyse.getTemplateSnapOSD("IntelliCityMgr").done(function(a){H=a}),d.VideoInAnalyse.getTemplateCalibrate().done(function(a){I=a})},_renderElements:function(){if(m&&m[k]){var a="",b="",c="";for(var d in m[k]){var e=m[k][d];if(/Scene/.test(d)&&e.Type===v){if(M[d]=e.PtzPresetId,b=m[k][d].PtzPresetId,0===b||1e3===b)continue;a+="<option value='"+b+"' presetId='"+b+"'>"+tl("ivs.Preset")+b+"</option>"}}if(w&&w.IntelliCityMgr){for(var f=0;f<w.IntelliCityMgr.length;f++)"CityMotorParkingManual"!==w.IntelliCityMgr[f]&&(T[w.IntelliCityMgr[f]]=tl("appEvent"+w.IntelliCityMgr[f]),c+="<option value='"+w.IntelliCityMgr[f]+"'>"+tl("appEvent"+w.IntelliCityMgr[f])+"</option>");i.$('[sel-for="onCityMgrChangeRuleType"]').empty().append(c)}""!==a?(i.$("[sel-for='onCityMgrChangePreset']").empty().append(a),i.$(".existPreset").removeClass("disabled"),i.$("[data-action='titleAction']").removeClass("disabled"),i._gotoSence(i.$("[sel-for='onCityMgrChangePreset']").val()-0),i.$('[sel-for="onCityMgrChangeMode"]').parent().parent().removeClass("fn-hide"),i.$("select[sel-for='onCityMgrChangePreset']").change(),i.$('[sel-for="onCityMgrChangeRuleType"]').val(w.IntelliCityMgr[0]).change()):(i.$("[sel-for='onCityMgrChangePreset']").empty().append("<option value='-1'>"+tl("com.AddPlanFirstTip")+"</option>"),i.$(".existPreset").addClass("disabled"),i.$("[data-action='titleAction']").addClass("disabled"),j.table("dataSource",[]),i.$('[sel-for="onCityMgrChangeMode"]').parent().parent().addClass("fn-hide")),i._openVideo()}},_openVideo:function(){e.cover("#ivs_intelliCityMgr_video"),e.SetRegionNum(0),e.SetModuleMode(2),e.EnableVideoAnalyseModule(!0),e.ConnectRealVideo(0,1)},_gotoSence:function(a){d.PTZ.gotoPreset(a)},_initCityMgrRuleConfigureTable:function(){j=i.$("#tr_cityMgrRuleConfigure_table").table({pageable:!1,reSelectRow:!0,pressEnter:!1,selectSingle:!1,height:140,columns:[{t:"com.Enable",width:"8%",check:"Enable"},{t:"com.Number",width:"8%",render:function(a){return a._index+1}},{t:"com.Name",width:"20%",fields:"Name"},{t:"com.Type",width:"19%",fields:"Type",valueMap:T,editor:function(b,c){var d="",e=c.valueMap;if(e){d='<select style="overflow-wrap:initial">';for(var f in e)d+='<option value="'+f+'">'+e[f]+"</option>";d+="</select>"}return a(d)}},{t:"ivs.Protract",width:"10%",action:"draw",icon:"i-draw",handle:function(a){i._onDrawRuleClick(a)}},{t:"ivs.AdvancedParams",action:"advance",icon:"i-advence",width:"20%",handle:function(b){e.hide(),ab.dialog("show"),a(".ui-CityMgr-ShopPresence").addClass("fn-hide"),a(".ui-CityMgr-CityNonMotorParking").addClass("fn-hide"),"ShopPresence"===b.Type?a(".ui-CityMgr-ShopPresence").removeClass("fn-hide"):"FlowBusiness"===b.Type||("CityNonMotorParking"===b.Type?a(".ui-CityMgr-CityNonMotorParking").removeClass("fn-hide"):"CityMotorParking"===b.Type);var c=a("#ivsCityMgrTrafficParkEventHandler").parent().parent().css("height");a("#cityMgr_slider").parent().parent().css("height",c);var d=a('[sel-for="onCityMgrChangeCaptureAmount"]'),f="";if(d.empty(),"CityNonMotorParking"===b.Type)f+='<option value="1">1</option>';else for(var g=1;6>g;g++)f+='<option value="'+(g+1)+'">'+(g+1)+"</option>";a("#cityMgrCaptureUploadingValue").parent().removeClass("fn-hide"),a("#cityMgrZeroClearTime_enable").parent().parent().removeClass("fn-hide"),a("#cityMgrZoomGetEvidence").parent().addClass("fn-hide"),a('[sel-for="onCityMgrReplacePicNum"]').parent().removeClass("fn-hide"),a("#cityMgrLongestCaptureInterval").parent().removeClass("fn-hide"),a("#singlePicPreUploadForm").removeClass("fn-hide"),a("#ivs_cityMgrCaptureSetting").removeClass("fn-hide"),a("#cityMgrAlarmWaitTime").parent().addClass("fn-hide"),"ShopPresence"===b.Type||"FlowBusiness"===b.Type?a('[sel-for="onCityMgrReplacePicNum"]').parent().addClass("fn-hide"):"CityNonMotorParking"===b.Type&&(a("#cityMgrCaptureUploadingValue").parent().addClass("fn-hide"),a("#cityMgrZeroClearTime_enable").parent().parent().addClass("fn-hide"),a('[sel-for="onCityMgrReplacePicNum"]').parent().addClass("fn-hide"),a("#cityMgrLongestCaptureInterval").parent().addClass("fn-hide"),a("#singlePicPreUploadForm").addClass("fn-hide"),a("#ivs_cityMgrCaptureSetting").addClass("fn-hide"),a("#cityMgrAlarmWaitTime").parent().removeClass("fn-hide"),a("#cityMgrAlarmWaitTime").val(_.Config.Interval)),d.append(f),hb=b.Type,i._renderPresetDom('[sel-for="onCityMgrCoptTo"]'),i._renderPresetDom('[sel-for="onCityMgrCoptTo2"]'),fb=b;var h=tl("ivs.Preset")+b.PtzPresetId+" "+b.Name;if(a("#cityMgrDialogTip").text(h),-1!==V)for(var j=o[0],g=0;g<j.length;g++)if(j[g].PtzPresetId===V&&j[g].Id===b.Id){_=j[g];break}if(-1!==V)for(var k=p[0].PresetRecord,g=0;g<k.length;g++)if(k[g].PtzPresetId===V)for(var l=0;l<k[g].Records.length;l++)if(k[g].Records[l].RuleId===b.Id){curPresetRuleRecord=k[g].Records[l];break}if(-1!==V)for(var m=q[0].PresetImage,g=0;g<m.length;g++)if(m[g].PtzPresetId===V)for(var l=0;l<m[g].Images.length;l++)if(m[g].Images[l].RuleId===b.Id){curPresetRuleImage=m[g].Images[l];break}if(-1!==V)for(var n=s[0],g=0;g<n.length;g++)if(n[g].PresetID===V)for(var l=0;l<n[g].MosaicWithRule.length;l++)if(n[g].MosaicWithRule[l].RuleId===b.Id){curPresetRuleSnapMosaic2=n[g].MosaicWithRule[l];break}if(-1!==V)for(var t=r[0],g=0;g<t.length;g++)if(t[g].PresetID===V)for(var l=0;l<t[g].SnapShotWithRule.length;l++)if(t[g].SnapShotWithRule[l].RuleId===b.Id){$=t[g].SnapShotWithRule[l];break}a("#ivsCityMgrTrafficParkEventHandler").eventHandler("set",_.EventHandler),a('[sel-for="onCityMgrChangeCaptureAmount"]').val($.SnapShotType.length).change(),a("#cityMgr_slider").slider("value",_.Config.Sensitivity),a("#cityMgrUploadViolationVideo_title_Enable").prop("checked",curPresetRuleRecord.Enable),a("#cityMgrUploadViolationVideo").prop("checked",curPresetRuleRecord.UploadRecordEnable),a("#cityMgrOrigpic_localSave").prop("checked",curPresetRuleImage.NormalSnap.SaveSnap),a("#cityMgrOrigpic_report").prop("checked",curPresetRuleImage.NormalSnap.UploadSnap),a('[sel-for="onCityMgrChangeOrigPictureResolution"]').val(curPresetRuleImage.NormalSnap.ReduceRate),a('[sel-for="onCityMgrChangeOrigPicQuality"]').val(curPresetRuleImage.NormalSnap.PicCompressRate),a("#cityMgrMergpic_localSave").prop("checked",curPresetRuleImage.CombinSnap.SaveSnap),a("#cityMgrMergpic_report").prop("checked",curPresetRuleImage.CombinSnap.UploadSnap),a('[sel-for="onCityMgrChangeCompPictureResolution"]').val(curPresetRuleImage.CombinSnap.ReduceRate),a('[sel-for="onCityMgrChangeCompPicQuality"]').val(curPresetRuleImage.CombinSnap.PicCompressRate),a("#cityMgrPrivatePicReplace_enable").prop("checked",$.UserImage.Enable),a('[sel-for="onCityMgrReplacePicNum"]').val($.UserImage.IndexInGroup),a("#cityMgrLongestCaptureInterval").val($.SnapTimeOutInterval),a("#cityMgrCaptureUploadingValue").val($.RepeatInterval/60),a("#cityMgrZeroClearTime_enable").prop("checked",$.RepeatIntervalFlag),a("#cityMgrSnapShot_enable").prop("checked",1===$.SnapMode?!0:!1);for(var g=0;g<$.SnapShotType.length;g++)a("#cityMgrNumber_"+(g+1)).prop("checked",!1);for(var u=$.UploadMask||0,v=u.toString(2).split("").reverse(),g=0;g<v.length;g++)v[g]-0===1?a("#cityMgrNumber_"+(g+1)).prop("checked",!0):a("#cityMgrNumber_"+(g+1)).prop("checked",!1);for(var g=0;g<$.SnapShotType.length;g++)a("#cityMgrNumber_"+(g+1)).prop("disabled",!1),"Far"===$.SnapShotType[g]&&(a("#cityMgrNumber_"+(g+1)).prop("disabled",!0),a("#cityMgrNumber_"+(g+1)).prop("checked",!1));a(a('input[name="cityMgrMosaicTwoMethod"][value="'+curPresetRuleSnapMosaic2.MosaicTwoMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicThreeMethod"][value="'+curPresetRuleSnapMosaic2.MosaicThreeMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicFourMethod"][value="'+curPresetRuleSnapMosaic2.MosaicFourMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicFiveMethod"][value="'+curPresetRuleSnapMosaic2.MosaicFiveMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicSixMethod"][value="'+curPresetRuleSnapMosaic2.MosaicSixMethod+'"]')[0]).prop("checked",!0),a(".ui-CityMgr-ShopPresence").hasClass("fn-hide")||a("#cityMgrShopID").val(_.Config.ShopAddress),a(".ui-CityMgr-CityNonMotorParking").hasClass("fn-hide")||a("#alarmNumberThreshold").val(_.Config.AlarmNum)}},{t:"com.Delete",width:"10%",action:"delete",icon:"i-clear",handle:function(a){this.del(a),i._delRuleLanes(a),i._delMultiSceneRecordItem(a),i._delTrafficImageItem(a),i._delSceneSnapShotWithRule2Item(a),i._delTrafficSnapMosaic2Item(a)}},{width:"5%",titleIcon:"i-add",titleAction:function(b){return a(b.target).hasClass("disabled")?void 0:i._onAddRuleClick()}}],onRowSelect:function(a,b){if(W=b.data.Type,X=b.rowIndex,-1!==V)for(var c=o[0],d=0;d<c.length;d++)if(c[d].PtzPresetId===V&&c[d].Id===b.data.Id){_=c[d];break}i._cancelAllHightLightRuleLanes(),i._hightLightRuleLanes(b.data)},onblurEditor:function(b,c){if("Type"===c.field){for(var d in Z)if(d===c.editVal&&c.editVal!==W){var f=i._changeRuleNameNumber(c.editVal);c.data.Name=Z[d]+V+"_"+f}c.editVal!==W&&c.data.ShapeID&&e.DeleteVideoAnalyseShape(c.data.ShapeID)}if(-1!==V)for(var g=r[0],d=0;d<g.length;d++)if(g[d].PresetID===V)for(var h=0;h<g[d].SnapShotWithRule.length;h++){if(g[d].SnapShotWithRule[h].RuleId===c.data.Id&&g[d].SnapShotWithRule[h].RuleType===c.editVal){$=g[d].SnapShotWithRule[h];break}if(g[d].SnapShotWithRule[h].RuleId===c.data.Id&&g[d].SnapShotWithRule[h].RuleType!==c.editVal){switch(c.editVal){case"CityMotorParking":$=a.extend(!0,{},z.SnapShotWithRule[0]);break;case"CityNonMotorParking":$=a.extend(!0,{},A.SnapShotWithRule[0]);break;case"FlowBusiness":$=a.extend(!0,{},B.SnapShotWithRule[0]);break;case"ShopPresence":$=a.extend(!0,{},C.SnapShotWithRule[0])}$.RuleId=c.data.Id,g[d].SnapShotWithRule[h]=$;break}}if(-1!==V)for(var j=o[0],d=0;d<j.length;d++){if(j[d].PtzPresetId===V&&j[d].Id===c.data.Id&&j[d].Type===c.editVal){_=j[d];break}if(j[d].PtzPresetId===V&&j[d].Id===c.data.Id&&j[d].Type!==c.editVal){switch(c.editVal){case"CityMotorParking":_=a.extend(!0,{},N),_.PtzPresetId=V,_.Id=c.data.Id,_.Config.DetectRegion=[];break;case"CityNonMotorParking":_=a.extend(!0,{},O),_.PtzPresetId=V,_.Id=c.data.Id,_.Config.DetectRegion=[];break;case"FlowBusiness":_=a.extend(!0,{},P),_.PtzPresetId=V,_.Id=c.data.Id,_.Config.DetectRegion=[];break;case"ShopPresence":_=a.extend(!0,{},Q),_.PtzPresetId=V,_.Id=c.data.Id,_.Config.DetectRegion=[]}j[d]=_;break}}}})},_renderPresetDom:function(b){var c=a(b),d="",e="";for(var f in m[0]){var g=m[0][f];if(/Scene/.test(f)&&g.Type===v){if(e=m[0][f].PtzPresetId,0===e||e===V||1e3===e)continue;d+="<option value='"+e+"' presetId='"+e+"'>"+tl("ivs.Preset")+e+"</option>"}}d+='<option value="all" t="com.All"></option>',c.empty().append(d).translation()},_cancelAllHightLightRuleLanes:function(){for(var a=0;a<j.table("dataSource").length;a++){var b=j.table("dataSource")[a].ShapeID||0;e.SelectCurVideoAnalyseShape(b,!1)}},_hightLightRuleLanes:function(a){var b=a.ShapeID||0;j.find('[data-index="'+X+'"] [data-action="checkItem"]').prop("checked")?(e.ShowVideoAnalyseShape(b,!0),e.SelectCurVideoAnalyseShape(b,!0)):e.ShowVideoAnalyseShape(b,!1)},_delRuleLanes:function(a){Y===!1&&(Y=!0,e.SetVideoAnalyseContainerTip(0,tl("")));var b=a.ShapeID||0;e.DeleteVideoAnalyseShape(b);var c=0;o[0].forEach(function(b,d){return b.Id===a.Id?(c=d,!1):void 0}),c>-1&&o[0].splice(c,1)},_delMultiSceneRecordItem:function(a){for(var b=0,c=0,d=0;d<p[0].PresetRecord.length;d++)if(p[0].PresetRecord[d].PtzPresetId===V){b=d;break}p[0].PresetRecord[b].Records.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&p[0].PresetRecord[b].Records.splice(c,1)},_delTrafficImageItem:function(a){for(var b=0,c=0,d=0;d<q[0].PresetImage.length;d++)if(q[0].PresetImage[d].PtzPresetId===V){b=d;break}q[0].PresetImage[b].Images.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&q[0].PresetImage[b].Images.splice(c,1)},_delSceneSnapShotWithRule2Item:function(a){for(var b=0,c=0,d=0;d<r[0].length;d++)if(r[0][d].PresetID===V){b=d;break}r[0][b].SnapShotWithRule.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&r[0][b].SnapShotWithRule.splice(c,1)},_delTrafficSnapMosaic2Item:function(a){for(var b=0,c=0,d=0;d<s[0].length;d++)if(s[0][d].PresetID===V){b=d;break}s[0][b].MosaicWithRule.forEach(function(b,d){return b.RuleId===a.Id?(c=d,!1):void 0}),c>-1&&s[0][b].MosaicWithRule.splice(c,1)},_onDrawRuleClick:function(a){if(!j.find('[data-index="'+a._index+'"] [data-action="checkItem"]').prop("checked"))return void i.$("#tr_ruleConfigure_tip").tip("warning",tl("ivs.DrawLaneBeforeSelect"));var b=a.ShapeID||0;e.DeleteVideoAnalyseShape(b),e.CreateMainVideoAnalyseShape(0,a.Name,"Polygon","Polygon","","").done(function(b){a.ShapeID=b,e.SetVideoAnalyseContainerTip(0,tl("Please draw region")),Y=!1})},_onAddRuleClick:function(){for(var b=0,c=0;c<o[0].length;c++)o[0][c].PtzPresetId===V&&b++;if(b>=U)return void i.$("#tr_cityMgrRuleConfigure_tip").tip("error",tl("com.NoMoreRule"));var d=i._findRuleNum(),e=a.extend(!0,{},Q),f=i._changeRuleNameNumber("ShopPresence");e.PtzPresetId=V,e.Id=d,e.Name=Q.Name+V+"_"+f,e.Config.DetectRegion=[],j.table("add",e,b).table("selectRow",b),o[0].push(e);for(var g=null,h=!1,c=0;c<p[0].PresetRecord.length;c++)if(p[0].PresetRecord[c].PtzPresetId===V){g=a.extend(!0,{},E.Records[0]),g.RuleId=d,p[0].PresetRecord[c].Records.push(g),h=!0;break}h||(g=a.extend(!0,{},E),g.PtzPresetId=V,g.Records[0].RuleId=d,p[0].PresetRecord.push(g));for(var k=null,l=!1,c=0;c<q[0].PresetImage.length;c++)if(q[0].PresetImage[c].PtzPresetId===V){k=a.extend(!0,{},F.Images[0]),k.RuleId=d,q[0].PresetImage[c].Images.push(k),l=!0;break}l||(k=a.extend(!0,{},F),k.PtzPresetId=V,k.Images[0].RuleId=d,q[0].PresetImage.push(k));for(var m=null,n=!1,c=0;c<s[0].length;c++)if(s[0][c].PresetID===V){m=a.extend(!0,{},G.MosaicWithRule[0]),m.RuleId=d,s[0][c].MosaicWithRule.push(m),n=!0;break}n||(m=a.extend(!0,{},G),m.PresetID=V,m.MosaicWithRule[0].RuleId=d,s[0].push(m));for(var t=null,u=!1,c=0;c<r[0].length;c++)if(r[0][c].PresetID===V){t=a.extend(!0,{},C.SnapShotWithRule[0]),t.RuleId=d,r[0][c].SnapShotWithRule.push(t),u=!0;break}u||(t=a.extend(!0,{},C),t.PresetID=V,t.SnapShotWithRule[0].RuleId=d,r[0].push(t))},_changeRuleNameNumber:function(a){for(var b=1,c=0;c<j.table("dataSource").length;c++)if(j.table("dataSource")[c].Type===a){var d=j.table("dataSource")[c].Name.split("_")[1]-0;if(b!==d)return b;b++}return b},_findRuleNum:function(){for(var a=[],b=0;b<o[0].length;b++)a.push(o[0][b].Id);var c=a.sort(function(a,b){return a-b});return c[c.length-1]+1-0},onCityMgrChangeMode:function(){var a=i.$('[sel-for="onCityMgrChangeMode"]').val();"Plate"===a?(i.$("[data-calibrateType]").addClass("fn-hide"),i.$('[data-calibrateType="CityMgrManualCalibrate"]').removeClass("fn-hide"),i.$("#ivs_cityMgrCardsSize").val(L.CalibratePixel)):"Scale"===a&&(i.$("[data-calibrateType]").addClass("fn-hide"),i.$('[data-calibrateType="CityMgrAutoCalibrate"]').removeClass("fn-hide"),i.$("#ivs_cityMgrLevelRatio").val(L.CalibrateArea[0].ObjectScale))},onCityMgrChangePreset:function(b){S=[],V=a(b.target).val()-0;var c=null;i._gotoSence(V);for(var d in m[0])c=m[0][d],/Scene/.test(d)&&c.Type===v&&c.PtzPresetId===V&&(J=m[0][d]);for(var e=[],f=0;f<n[0].length;f++){var c=n[0][f];e.push(c.PtzPresetID),c.PtzPresetID===V&&(L=n[0][f])}-1===e.indexOf(V)&&(L=a.extend(!0,{},I),L.PtzPresetID=V,n[0].push(L)),K?(i.$('[sel-for="onCityMgrChangeMode"]').val("Plate").change(),K=!1):i.$('[sel-for="onCityMgrChangeMode"]').val(L.CalibrateArea[0].Method).change(),"Plate"===L.CalibrateArea[0].Method?i.$("#ivs_cityMgrCardsSize").val(L.CalibratePixel):"Scale"===L.CalibrateArea[0].Method&&i.$("#ivs_cityMgrLevelRatio").val(L.CalibrateArea[0].ObjectScale),i.$("#cityMgrReportNoLicenseCar").prop("checked","all"===J.Detail.ReportMode?!0:!1),i.$("#cityMgrPlateMatchingRatio_input").val(J.Detail.PlateMatch);for(var f=0;f<o[0].length;f++)o[0][f].PtzPresetId===V&&o[0][f].Class===v&&S.push(o[0][f]);for(var g=[],f=0;f<t[0].length;f++)g.push(t[0][f].PtzPresetId),t[0][f].PtzPresetId===V&&(R=t[0][f]);-1===g.indexOf(V)&&(R=a.extend(!0,{},D),R.PtzPresetId=V,t[0].push(R));for(var h=[],f=0;f<u[0].length;f++)h.push(u[0][f].PresetID),u[0][f].PresetID===V&&(gb=u[0][f].OSDWithClass);if(-1===h.indexOf(V)){gb=a.extend(!0,[],H.IntelliCityMgr.OSDWithClass);var k={OSDWithClass:gb,PresetID:V};u[0].push(k),k={}}i.onCityMgrChangeRuleType(),i._renderRuleLaneOcx(S),j.table("dataSource",S).table("selectRow",S.length-1)},_renderRuleLaneOcx:function(a){e.DeleteAllVideoAnalyseShape();for(var b=0;b<a.length;b++){for(var c=[],d=0;d<a[b].Config.DetectRegion.length;d++)c[d]="["+a[b].Config.DetectRegion[d][0]+","+a[b].Config.DetectRegion[d][1]+"]";e.CreateMainVideoAnalyseShape(0,a[b].Name,"Polygon","Polygon",'{"Polygon":['+c+"]}","").done(function(c){e.SetVideoAnalyseShapeShowName(c,a[b].Name),a[b].ShapeID=c,a[b].Enable?e.ShowVideoAnalyseShape(c,!0):e.ShowVideoAnalyseShape(c,!1)})}},onCityMgrChangeRuleType:function(){var a=i.$('[sel-for="onCityMgrChangeRuleType"]').val();"CityNonMotorParking"===a?a="NonMotorParking":"CityMotorParking"===a&&(a="MotorParking"),i._changeIllegalRuleCode(a),i._changeIllegalRuleName(a)},_changeIllegalRuleCode:function(a){Object.keys(R.ViolationCode).forEach(function(b){b===a&&i.$("#cityMgrIllegalRuleCode").textfield("value",R.ViolationCode[b])})},_changeIllegalRuleName:function(a){Object.keys(R.ViolationCode).forEach(function(b){b===a&&i.$("#cityMgrIllegalRuleName").val(R.ViolationCode[b+"ShowName"])})},onCityMgrChangeCaptureAmount:function(){i._renderUpPic(),i._renderReplacePic(),i._syncImageTable()},_renderUpPic:function(){var b=a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0;a("[id^='cityMgrNumber_']").css("display","none");for(var c=0;b>c;c++)a("#cityMgrNumber_"+(c+1)).css("display",""),a("#cityMgrNumber_span_"+(c+1)).css("display","");5===b?$.SnapShotType[4]||("Near"===$.SnapShotType[3]?($.SnapShotType[4]="Far",a("#cityMgrNumber_5").attr("disabled",!0),a("#cityMgrNumber_5").attr("checked",!1)):"Far"===$.SnapShotType[3]&&($.SnapShotType[4]="Near",a("#cityMgrNumber_5").attr("disabled",!1)),$.SingleInterval[4]=$.SingleInterval[3]):6===b&&($.SingleInterval[5]||("Near"===$.SnapShotType[3]?($.SnapShotType[4]="Far",a("#cityMgrNumber_5").attr("disabled",!0),a("#cityMgrNumber_5").attr("checked",!1),$.SnapShotType[5]="Near",a("#cityMgrNumber_6").attr("disabled",!1)):"Far"===$.SnapShotType[3]&&($.SnapShotType[4]="Near",a("#cityMgrNumber_5").attr("disabled",!1),$.SnapShotType[5]="Far",a("#cityMgrNumber_6").attr("disabled",!0),a("#cityMgrNumber_6").attr("checked",!1)),$.SingleInterval[4]=$.SingleInterval[3],$.SingleInterval[5]=$.SingleInterval[3]))},_renderReplacePic:function(){a('[sel-for="onCityMgrReplacePicNum"]').empty();for(var b=a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0,c="",d=0;b>d;d++)c+='<option value="'+d+'" t="'+(d+1)+'"></option>';a('[sel-for="onCityMgrReplacePicNum"]').append(c).translation()},_syncImageTable:function(){var b=a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0;a("[data-snapcap]").each(function(c,d){var e=a(d).attr("data-snapcap");e.indexOf(b)>-1?a(d).removeClass("fn-hide"):a(d).addClass("fn-hide")}),a(".TPMosaic").addClass("fn-hide"),a(".TPMosaic"+b).removeClass("fn-hide")},_showPicSettingDialog:function(){ab.dialog("close"),e.hide(),$picSettingDialog.dialog("show"),a("#cityMgrIllegalAlarmOn").val($.SingleInterval[0]),a('[sel-for="onCityMgrChangeMiddleRatio"]').parent().addClass("fn-hide"),a('[sel-for="onCityMgrChangeFeatureRatio"]').parent().addClass("fn-hide");var b=$.SingleInterval.length,c=$.SnapShotType.length,d=(a('[sel-for="onCityMgrChangeCaptureAmount"]').val()-0,"");"CityNonMotorParking"===hb?d+='<option value="Far" t="ivs.DistantView"></option>':(d+='<option value="Far" t="ivs.DistantView"></option>',d+='<option value="Medium" t="ivs.MiddleView"></option>',d+='<option value="Near" t="ivs.CloseView"></option>',d+='<option value="Feature" t="ivs.CarNumberFeature"></option>'),a('[sel-for="onCityMgrChangePic_1"]').empty(),a('[sel-for="onCityMgrChangePic_1"]').append(d).translation();for(var f=1;b>f;f++)a("#ivs_cityMgrSnapT_m_"+f).val(parseInt($.SingleInterval[f]/60)),a("#ivs_cityMgrSnapT_s_"+f).val($.SingleInterval[f]%60);for(var g=0;c>g;g++)a('[sel-for="onCityMgrChangePic_'+(g+1)+'"]').val($.SnapShotType[g]).change();a('[sel-for="onCityMgrChangeMiddleRatio"]').val($.MediumRatio),a('[sel-for="onCityMgrChangeFeatureRatio"]').val($.FeatureRatio)},_ocxEventDone:function(a,b){Y===!1&&(Y=!0),e.GetVideoAnalyseShapeConfigData(a).done(function(c){var d=JSON.parse(c);if(d.Polygon){for(var f=0;f<o[0].length;f++)if(o[0][f].ShapeID===a&&o[0][f].PtzPresetId===V){_=o[0][f];break}i._saveRuleProperty(d.Polygon)}e.SetVideoAnalyseShapeShowName(a,b)})},_saveRuleProperty:function(a){_.Config.DetectRegion=a},onCityMgrRefresh:function(){return i.$('[sel-for="onCityMgrChangePreset"]').val()-0===-1?void i.$("#intelliCityMgr_tip").tip("warning",tl("com.AddPlanFirstTip")):void i._getConfig(!0)},onCityMgrConfirm:function(){if(Y){var b=i.$('[sel-for="onCityMgrChangeMode"]').val();L.CalibrateArea[0].Method=b,"Plate"===b?L.CalibratePixel=i.$("#ivs_cityMgrCardsSize").val()-0:"Scale"===b&&(L.CalibrateArea[0].ObjectScale=i.$("#ivs_cityMgrLevelRatio").val()-0);var c="";for(var e in M)if(M[e]===V){c=e;break}L.SceneID=c.slice(5)-0;for(var e=0;e<o[0].length;e++)for(var f=0;f<j.table("dataSource").length;f++)o[0][e].Id===j.table("dataSource")[f].Id&&(o[0][e].Enable=j.table("dataSource")[f].Enable,o[0][e].Name=j.table("dataSource")[f].Name,o[0][e].Type=j.table("dataSource")[f].Type);for(var e=0;e<r[0].length;e++)if(r[0][e].PresetID===V)for(var f=0;f<r[0][e].SnapShotWithRule.length;f++)for(var g=0;g<j.table("dataSource").length;g++)r[0][e].SnapShotWithRule[f].RuleId===j.table("dataSource")[g].Id&&(r[0][e].SnapShotWithRule[f].RuleType=j.table("dataSource")[g].Type);if(i.$('[sel-for="onCityMgrChangePreset"]').val()-0===-1)return void i.$("#intelliCityMgr_tip").tip("warning",tl("com.AddPlanFirstTip"));J.Detail.ReportMode=i.$("#cityMgrReportNoLicenseCar").prop("checked")?"all":"plate",J.Detail.PlateMatch=i.$("#cityMgrPlateMatchingRatio_input").val()-0;var h=i.$('[sel-for="onCityMgrChangeRuleType"]').val();if("CityNonMotorParking"===h?h="NonMotorParking":"CityMotorParking"===h&&(h="MotorParking"),Object.keys(R.ViolationCode).forEach(function(a){a===h&&(R.ViolationCode[a]=i.$("#cityMgrIllegalRuleCode").textfield("value"),R.ViolationCode[a+"ShowName"]=i.$("#cityMgrIllegalRuleName").val())}),""!==bb)if("all"===bb)for(var e=0;e<q[0].PresetImage.length;e++)!function(b){for(var c=0;c<q[0].PresetImage[b].Images.length;c++){var d=a.extend(!0,{},curPresetRuleImage),e=q[0].PresetImage[b].Images[c].RuleId;q[0].PresetImage[b].Images[c]=d,q[0].PresetImage[b].Images[c].RuleId=e}}(e);else for(var e=0;e<q[0].PresetImage.length;e++)if(q[0].PresetImage[e].PtzPresetId===bb-0)for(var f=0;f<q[0].PresetImage[e].Images.length;f++){var k=a.extend(!0,{},curPresetRuleImage),v=q[0].PresetImage[e].Images[f].RuleId;q[0].PresetImage[e].Images[f]=k,q[0].PresetImage[e].Images[f].RuleId=v
}if(""!==eb)if("all"===eb)for(var e=0;e<r[0].length;e++)!function(b){for(var c=0;c<r[0][b].SnapShotWithRule.length;c++)if(r[0][b].SnapShotWithRule[c].RuleType===db){var d=a.extend(!0,{},$),e=r[0][b].SnapShotWithRule[c].RuleId;r[0][b].SnapShotWithRule[c]=d,r[0][b].SnapShotWithRule[c].RuleId=e}}(e);else for(var e=0;e<r[0].length;e++)if(r[0][e].PresetID===eb-0)for(var f=0;f<r[0][e].SnapShotWithRule.length;f++)if(r[0][e].SnapShotWithRule[f].RuleType===db){var w=a.extend(!0,{},$),x=r[0][e].SnapShotWithRule[f].RuleId;r[0][e].SnapShotWithRule[f]=w,r[0][e].SnapShotWithRule[f].RuleId=x}if(""!==eb)if("all"===eb)for(var e=0;e<s[0].length;e++)!function(b){for(var c=0;c<s[0][b].MosaicWithRule.length;c++){var d=a.extend(!0,{},curPresetRuleSnapMosaic2),e=s[0][b].MosaicWithRule[c].RuleId;s[0][b].MosaicWithRule[c]=d,s[0][b].MosaicWithRule[c].RuleId=e}}(e);else for(var e=0;e<s[0].length;e++)if(s[0][e].PresetID===eb-0)for(var f=0;f<s[0][e].MosaicWithRule.length;f++){var y=a.extend(!0,{},curPresetRuleSnapMosaic2),x=s[0][e].MosaicWithRule[f].RuleId;s[0][e].MosaicWithRule[f]=y,s[0][e].MosaicWithRule[f].RuleId=x}var z=[m,n,o,p,q,r,s,t,u];d.ConfigManager.setConfig(l,z).done(function(){i.$("#intelliCityMgr_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){i.$("#intelliCityMgr_tip").tip("error",tl("com.SaveConfigFailTip"))}).always(function(){bb="",cb="",eb="",db=""})}else if(Y===!1)return void i.$("#intelliCityMgr_tip").tip("error",tl("ivs.SaveBeforeDrawRule"))},onCityMgrSavePreset:function(){if(-1!==V&&!i.$("[btn-for='onCityMgrSavePreset']").hasClass("disabled")){var a=V,b=tl("ivs.Preset")+V;d.PTZ.setPreset(a,b).done(function(){i.$("#intelliCityMgr_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){i.$("#intelliCityMgr_tip").tip("error",tl("com.SaveConfigFailTip"))})}},onCityMgrCalibrate:function(){if(i.$('[btn-for="onCityMgrCalibrate"]').hasClass("ui-button-hover"))return i.$('[btn-for="onCityMgrCalibrate"]').removeClass("ui-button-hover"),e.DeleteShape("DFilter"),K=!0,void i.$("select[sel-for='onCityMgrChangePreset']").change();if(!i.$('[btn-for="onCityMgrCalibrate"]').hasClass("ui-button-disabled")&&!i.$('[btn-for="onCityMgrCalibrate"]').hasClass("ui-button-hover")){i.findConfig();var a=i.checkSceneSaved();if(!a)return void i.$("#intelliCityMgr_tip").tip("warning",tl("com.PleaseSaveSenceTip"));for(var b=0;b<j.table("dataSource").length;b++)j.table("dataSource")[b].Enable&&e.ShowVideoAnalyseShape(j.table("dataSource")[b].ShapeID,!1);i.varSetMarkflag(!0)}},checkSceneSaved:function(){var a=0===V?"Scene":"Scene"+V;return void 0!==m[0][a]?!0:!1},findConfig:function(){if(-1!==V){for(var a=!0,b=n[0],c={x:140,y:51},d={x:90,y:25},e=i.ocxNumChange(c,webApp.resolution),f=i.ocxNumChange(d,webApp.resolution),g=0;g<b.length;g++)if(b[g]&&b[g].PtzPresetID===V){singleCalibrate=b[g],singleCalibrate.CalibrateArea[0].Area=[e[0],e[1],f[0],f[1]],a=!1;break}if(a){var h={SceneID:1,Position:[-2,-2,-2],PtzPresetID:1,CalibrateArea:[{Area:[[3754,3868],[4437,3868],[3754,4323],[4437,4323]]}]};h.PtzPresetID=V,h.CalibrateArea[0].Area=[e[0],e[1],f[0],f[1]],b.push(h),i.findConfig()}}},ocxNumChange:function(a,b){var c=[],d=a.x,e=a.y,f=b.x,g=b.y,h=8191,i=8191,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;return j=(4096-h*d/(2*f)).toInt(),k=(4096-i*e/(2*g)).toInt(),n=(4096+h*d/(2*f)).toInt(),o=(4096+i*e/(2*g)).toInt(),l=n,m=k,p=j,q=o,c[0]=[j,k],c[1]=[n,o],c},varSetMarkflag:function(a){markFlag=a,i.uiChange(a),i.ocxChange(a)},uiChange:function(a){a?i.$('[btn-for="onCityMgrCalibrate"]').addClass("ui-button-hover"):i.$('[btn-for="onCityMgrCalibrate"]').removeClass("ui-button-hover")},ocxChange:function(a){if(a){var b=i.ocxBulidString();e.SetCurPtzID(0),e.SetObjectConfig(b)}else e.DeleteShape("DFilter")},ocxBulidString:function(){var a="";if(singleCalibrate.CalibrateArea){var b={DFilter:[]},c=singleCalibrate.CalibrateArea[0].Area;b.DFilter=c,a=JSON.stringify(b)}else{var d={x:140,y:51},e={x:90,y:25},f=i.ocxNumChange(d,webApp.resolution),g=i.ocxNumChange(e,webApp.resolution);a='{"DFilter":[['+f[0]+"],["+f[1]+"],["+g[0]+"],["+g[1]+"]]}"}return a},onCityMgrCalibrateComplete:function(){if(i.$('[btn-for="onCityMgrCalibrateComplete"]').hasClass("ui-button-disabled"))return!1;var a=i.checkSceneSaved();return a?(K=!0,i.$("select[sel-for='onCityMgrChangePreset']").change(),i.varSetMarkflag(!1),i.applyRefreshPtz(!0),void 0):void i.$("#intelliCityMgr_tip").tip("warning",tl("com.PleaseSaveSenceTip"))},applyRefreshPtz:function(a){d.PTZ.getStatus().done(function(b){singleCalibrate.Position=b.Postion,d.PTZ.getMotorSteps().done(function(b){singleCalibrate.PtzMotorSteps=b,a===!0&&i.applySave()})})},applySave:function(){var a="",b=i.$('[sel-for="onCityMgrChangeMode"]').val();L.CalibrateArea[0].Method=b,L.CalibratePixel=i.$("#ivs_cityMgrCardsSize").val()-0;for(var c in M)if(M[c]===V){a=c;break}L.SceneID=a.slice(5)-0;var e=n;d.ConfigManager.setConfig("VideoAnalyseCalibrate",e).done(function(){i.$("#intelliCityMgr_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){i.$("#intelliCityMgr_tip").tip("error",tl("com.SaveConfigFailTip"))})},onCityMgrCalibratePreview:function(){if(i.$('[btn-for="onCityMgrCalibratePreview"]').hasClass("ui-button-disabled"))return!1;i.findConfig();var a=singleCalibrate.Position;if(a[0]<-1||a[1]<-1||a[2]<-1)return void i.$("#intelliCityMgr_tip").tip("warning",tl("com.PleaseflogSenceTip"));K=!0,i.$('[btn-for="onCityMgrCalibrate"]').hasClass("ui-button-hover")&&(i.$('[btn-for="onCityMgrCalibrate"]').removeClass("ui-button-hover"),e.DeleteShape("DFilter"));singleCalibrate.PtzMotorSteps;d.PTZ.moveAbsolutely(a).done(function(){var a=i.ocxBulidString();e.SetCurPtzID(0),e.SetObjectConfig(a)});for(var b=0;b<j.table("dataSource").length;b++)j.table("dataSource")[b].Enable&&e.ShowVideoAnalyseShape(j.table("dataSource")[b].ShapeID,!1);setTimeout(function(){e.DeleteShape("DFilter"),i.$("select[sel-for='onCityMgrChangePreset']").change()},4e3)},onCityMgrWorkPeriod:function(){_&&_&&_.EventHandler&&_.EventHandler.TimeSection&&h.open(_.EventHandler.TimeSection).done(function(a){_.EventHandler.TimeSection=a})}})}),define("cityMgrFileParam",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability"),g=null,h=null,i=null,j=null,k=[],l={},m="IntelliCityMgr",n="",o={"File Transmit Error":"com.FileTransmitErrorTip","File too large":"com.PicFileTooLargeTip","File length error":"com.FileLengthErrorTip","File write error":"com.FileWriteErrorTip",PicTypeNotSupport:"com.PicTypeNotSupportTip",BPPTypeNotSupport:"com.BPPTypeNotSupportTip",ResolutionNotSupport:"com.ResolutionNotSupportTip",PicNotExist:"com.PicNotExistTip",FileOperateError:"com.FileOperateErrorTip",PicFileTooLarge:"com.PicFileTooLargeTip"},p="/sdtraffic/";c.exports=e.extend({init:function(){g=this,g._initCityMgrFileParamTable(),g.render()},render:function(){d.DevIntelliTracker.stop(),g._getConfig(!1)},leave:function(){d.DevIntelliTracker.start()},_initCityMgrFileParamTable:function(){h=g.$("#tr_cityMgrPictureParameter_table").table({pageable:!1,reSelectRow:!0,pressEnter:!1,height:180,columns:[{t:"com.Number",width:"20%",render:function(a){return a._index+1}},{t:"ivs.Preset",width:"40%",fields:"PresetID",render:function(a){return tl("ivs.Preset")+a.PresetID}},{t:"ivs.IllegalRuleOfTypeEx",width:"40%",fields:"Type",valueMap:l,editor:function(b,c){var d="",e=c.valueMap;if(e){d='<select style="overflow-wrap:initial">';for(var f in e)"ShopPresence"!==f&&"FlowBusiness"!==f&&"CityNonMotorParking"!==f&&(d+='<option value="'+f+'">'+e[f]+"</option>");d+="</select>"}return a(d)}}],onRowSelect:function(){g._showPicture(!1)}})},_getConfig:function(){i=["VideoAnalyseGlobal"],a.when(d.ConfigManager.getConfig(i),f.get("VideoAnalyse",!0)).done(function(a,b){j=a[0].params.table,k=b.SupportedRules,g._renderElements()})},_renderElements:function(){var a="";if(k&&k.IntelliCityMgr){for(var b=0;b<k.IntelliCityMgr.length;b++)"CityMotorParkingManual"!==k.IntelliCityMgr[b]&&(l[k.IntelliCityMgr[b]]=tl("appEvent"+k.IntelliCityMgr[b]),a+="<option value='"+k.IntelliCityMgr[b]+"'>"+tl("appEvent"+k.IntelliCityMgr[b])+"</option>");g.$("#cityMgrPara_audio_sel").empty().append(a)}g._loadPicTable()},_loadPicTable:function(){var a=[],b=-1;for(var c in j[0]){var d=j[0][c];if(/Scene/.test(c)&&d.Type===m){if(b=j[0][c].PtzPresetId,0===b||1e3===b)continue;var e={PresetID:"",Type:"CityMotorParking"};e.PresetID=b,a.push(e)}}h.table("dataSource",a).table("selectRow",0)},_showPicture:function(){var b=h.table("getSelectedData").PresetID,c=h.table("getSelectedData").Type,d="/sdtraffic/Preset"+b+"_"+c+".jpg";a.ajax({url:d,success:function(){g.$("#cityMgrPic_image_preview").css({background:"url("+d+")","background-repeat":"no-repeat","background-size":"cover"})},error:function(){g.$("#cityMgrPic_image_preview").css({background:"url('')","background-color":"#BBBBBB","background-repeat":"no-repeat","background-size":"cover"}),g.$("#cityMgrParaPATips").tip("warning",tl("com.PicNotExistTip"))}})},onCityMgrPicFileChange:function(a){var b=0;if(a.value.test(/.jpg|.JPG$/i)){try{b=a.files[0].size}catch(c){}if(b>2097152)g.$("#cityMgrParaPATips").tip("warning",tl("com.PicFileTooLargeTip"));else if(h.table("getSelectedData")){var d=h.table("getSelectedData").PresetID,e=h.table("getSelectedData").Type;n="Preset"+d+"_"+e,g.$("#cityMgrPic_image_file_import").attr("name",n),g.$("#cityMgrPic_image_submit").trigger("click")}else g.$("#cityMgrParaPATips").tip("warning",tl("ivs.PresetOrRuleNoPic"))}else g.$("#cityMgrParaPATips").tip("warning",tl("com.PicTypeNotSupportTip"))},onCityMgrParaFileChange:function(b){if(b.value.test(/.wav$/i)){var c=a("#cityMgrPara_audio_sel").val();g.$("#cityMgrParaPic_audio_file_import").attr("name",c),g.$("#cityMgrParaPic_audio_submit").trigger("click")}else g.$("#cityMgrParaPATips").tip("warning",tl("com.FileFormatDefaultTip"))},_imageFileUploadFinish:function(a){a.result?g.updateOverlayPicture():g.$("#cityMgrParaPATips").tip("warning",tl(o[a.errorCode]))},updateOverlayPicture:function(){d.Encode.updateOverlayPicture([{Name:n+".jpg"}]).done(function(a){var b=a[0];if(""===b.Error){var c=b.Path.lastIndexOf("/"),d=b.Path.substring(c+1),e="url("+p+d+")";g.$("#cityMgrPic_image_preview").css("background-image",e),g.$("#cityMgrParaPATips").tip("success",tl("com.UpmoveSuccessTip"))}else g.$("#cityMgrParaPATips").tip("warning",tl(o[b.Error]))})},_audioFileUploadFinish:function(a){a.result&&g.$("#cityMgrParaPATips").tip("success",tl("com.UpmoveSuccessTip"))}}),window.paraImageUploadFinish=function(a){g._imageFileUploadFinish(a)},window.paraAudioUploadFinish=function(a){g._audioFileUploadFinish(a)},window.onCityMgrPicFileChange=function(a){g.onCityMgrPicFileChange(a)},window.onCityMgrParaFileChange=function(a){g.onCityMgrParaFileChange(a)}}),define("cityMgrOSD",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability");require("widget/js/dui.colorpicker");var g=null,h=null,i="IntelliCityMgr",j=null;require.async("OSDPublic",function(a){j=a});var k=null,l=null,m=[],n=j.ArrWholeOSDName,o=null,p=null,q=0,r=null,s=[],t="",u=[];c.exports=e.extend({init:function(){g=this,h=g.$("#osd_cityMgrOrigOSD_dialog").dialog({close:function(){},confirm:function(a,b){b.ui.close(),g.onSaveOSDPreview()}}),j.setFontSize("osd",g),g._getTemplates(),g.render()},render:function(){d.DevIntelliTracker.stop(),g.cityMgrOsdRefreshClick(!1)},leave:function(){d.DevIntelliTracker.start(),t=""},_getTemplates:function(){d.VideoInAnalyse.getTemplateSnapOSD("IntelliCityMgr").done(function(a){r=a})},renderSnapElements:function(){g.renderPreset()},renderPreset:function(){if(p&&p[0]){var a="",b="";t="";for(var c in p[0]){var d=p[0][c];if(/Scene/.test(c)&&d.Type===i){if(b=p[0][c].PtzPresetId,0===b)continue;if(1e3===b)continue;a+="<option value='"+b+"' presetId='"+b+"'>"+tl("ivs.Preset")+b+"</option>"}}for(var e=0;e<s.IntelliCityMgr.length;e++)"CityMotorParkingManual"!==s.IntelliCityMgr[e]&&(t+="<option value='"+s.IntelliCityMgr[e]+"'>"+tl("appEvent"+s.IntelliCityMgr[e])+"</option>");g.$('[sel-for="onCityMgrChangeRuleOSD"]').empty().append(t),""!==a?(g.$("[sel-for='onCityMgrChangePresetOSD']").empty().append(a),g.$(".existPreset").removeClass("fn-hide"),g.$(".existPresetib").addClass("fn-ib"),g.$("#ivs_cityMgrSuggestOverlay").removeClass("disabled"),g.$('[btn-for="cityMgrOsdRefreshClick"]').parent().removeClass("fn-hide"),g.$("select[sel-for='onCityMgrChangePresetOSD']").change(),g.$('[sel-for="onCityMgrChangeRuleOSD"]').attr("disabled",!1),g.$('[sel-for="onCityMgrChangeRuleOSD"]').change()):(g.$("[sel-for='onCityMgrChangePresetOSD']").empty().append("<option value='-1'>"+tl("com.AddPlanFirstTip")+"</option>"),g.$(".existPresetib").removeClass("fn-ib"),g.$(".existPreset").addClass("fn-hide"),g.$("#ivs_cityMgrSuggestOverlay").addClass("disabled"),g.$('[btn-for="cityMgrOsdRefreshClick"]').parent().addClass("fn-hide"),g.$('[sel-for="onCityMgrChangeRuleOSD"]').attr("disabled",!0)),g.bind()}},onCityMgrChangeRuleOSD:function(){var b=g.$('[sel-for="onCityMgrChangeRuleOSD"]').val();j.initOSDMaskItems("osd",g,b),g.$("#osd_cityMgrSnapPark_maskItems a").on("click",function(){var b=a(this).attr("data-type");g.addEleOrder(b);var c=j.getEleArr(k.OSD.OSDOrder);g.createOSDOrderItems(c)});for(var c=0;c<u.length;c++)u[c].RuleType===b&&(k=u[c]);m=k.OSD.OSDCustomizeSort,g.renderOSDElements(),g.renderGlobalParams()},onCityMgrChangePresetOSD:function(){for(var b=g.$("select[sel-for='onCityMgrChangePresetOSD']").val()-0,c=[],d=0;d<o[0].length;d++)if(c.push(o[0][d].PresetID),o[0][d].PresetID===b){u=o[0][d].OSDWithClass;for(var e=0;e<u.length;e++)u[e].RuleType===g.$('[sel-for="onCityMgrChangeRuleOSD"]').val()&&(k=u[e]);m=k.OSD.OSDCustomizeSort}if(-1===c.indexOf(b)){u=a.extend(!0,[],r.IntelliCityMgr.OSDWithClass);for(var d=0;d<u.length;d++)u[d].RuleType===g.$('[sel-for="onCityMgrChangeRuleOSD"]').val()&&(k=u[d]);m=k.OSD.OSDCustomizeSort;var f={OSDWithClass:u,PresetID:b};o[0].push(f),f={}}g.renderOSDElements(),g.renderGlobalParams()},renderOSDElements:function(){if(m.length&&m[0]){var a=m[0].Element;q=a.length-1;var b=j.getEleArr(k.OSD.OSDOrder);g.createOSDOrderItems(b)}},renderGlobalParams:function(){var b=k.OSD.OSDBlackRegion;g.$('[sel-for="onCityMgrChangeBlackPosition"]').val(b.Height>0?b.OSDPosition:"None"),g.$('[sel-for="onCityMgrChangeBlackPosition"]').change(),g.$('[sel-for="onCityMgrChangeFontSize"]').val(k.OSD.OSDWholeAttr.FontSize);var c=k.OSD.OSDWholeAttr.FontColor;a("#ivs_cityMgrOsd_font_picker_tip").css({"background-color":"rgb("+c[0]+","+c[1]+","+c[2]+")"});var d=k.OSD.OSDWholeAttr.Position||[0,0,0,0];g.$("#osd_cityMgrOsdPosition").val(d.toString());var e=g.$('[sel-for="onCityMgrChangeBKColor"]');switch(k.OSD.OSDBlackRegion.BackColor[0]){case 0:e.val("black");break;case 255:e.val("white");break;case 128:e.val("gray")}g.$("#ivs_cityMgrOSD_timeTitle").prop("checked",k.TimeTitle.Enable),g.$("#ivs_cityMgrOSD_channelTitle").prop("checked",k.ChannelTitle.Enable),g.$("#ruleBoxOSD").prop("checked",k.DetectionFrameEnable)},bind:function(){g.$("#ivs_cityMgrSuggestOverlay").on("click",function(){if(!g.$("#ivs_cityMgrSuggestOverlay").hasClass("disabled")){for(var b=0;b<r.IntelliCityMgr.OSDWithClass.length;b++)r.IntelliCityMgr.OSDWithClass[b].RuleType===g.$('[sel-for="onCityMgrChangeRuleOSD"]').val()&&(l=a.extend(!0,{},r.IntelliCityMgr.OSDWithClass[b]));var c=j.getEleArr(l.OSD.OSDOrder);m=l.OSD.OSDCustomizeSort,k.OSD.OSDOrder=l.OSD.OSDOrder,k.OSD.OSDCustomizeSort=l.OSD.OSDCustomizeSort,g.createOSDOrderItems(c)}}),g.$("#cityMgrOrigOSD_snap_modify, #cityMgrOrigOSD_snap_delete").on("click",g.onOSDActionClick),a('[sel-for="onCityMgrChangeBlackPosition"]').on("change",function(b){"None"!==a(b.target).val()?a("#osd_cityMgrOsdPosition").parent().addClass("fn-invisib"):a("#osd_cityMgrOsdPosition").parent().removeClass("fn-invisib")}),a("#ivs_cityMgrOsd_font_picker").colorpicker({onChange:function(b,c){a("#ivs_cityMgrOsd_font_picker_tip").css({"background-color":"#"+c})},onSubmit:function(b,c,d){a("#ivs_cityMgrOsd_font_picker_tip").css({"background-color":"#"+c});var e={r:0,g:1,b:2};for(index in e)k.OSD.OSDWholeAttr.FontColor[e[index]]=d[index];a("#ivs_cityMgrOsd_font_picker").colorpickerHide()}})},onOSDActionClick:function(){g.$("#osd_cityMgrSnapPark_orderItems .icon-right").each(function(a,b){"%|"===g.$(b).parent("a").attr("data-type")||"%~"===g.$(b).parent("a").attr("data-type")||(g.$("#cityMgrOrigOSD_snap_modify").prop("checked")?g.$(b).removeClass("osd-icon-del").addClass("osd-icon-edit"):g.$(b).removeClass("osd-icon-edit").addClass("osd-icon-del"))})},onCityMgrCleanAllClick:function(){a("#osd_cityMgrSnapPark_orderItems").html(""),k.OSD.OSDOrder=""},onCityMgrAddNewLineClick:function(){g.addEleOrder("%|");var a=j.getEleArr(k.OSD.OSDOrder);g.createOSDOrderItems(a)},onCityMgrAddBlockClick:function(){g.addEleOrder("%~");var a=j.getEleArr(k.OSD.OSDOrder);g.createOSDOrderItems(a)},addEleOrder:function(b){var c,d,e,f=k.OSD,g=a("#osd_cityMgrSnapPark_orderItems a"),h="";if(g.length){for(c=0;c<g.length;c++)if(a(g[c]).hasClass("osd-order-item-cur")){d=c;break}d++,b=b.replace("%",""),e=f.OSDOrder.split("%"),a("#cityMgrOrigOSD_snap_front").prop("checked")?e.splice(d,1,b,e[d]):(e.splice(d,1,e[d],b),q=d),h=e.join("%")}else h+=b;f.OSDOrder=h},delOSDElement:function(b){a("#"+b).remove()},delEleOrder:function(b){var c=[];a("#osd_cityMgrSnapPark_orderItems li").each(function(a,b){c.push(b.id)});for(var d=0;d<c.length;d++)if(c[d]==b){num=d;break}var e,f=k.OSD;e=f.OSDOrder.split("%"),e.splice(num+1,1),f.OSDOrder=e.join("%")},createOSDOrderItems:function(b){if(0===b.length)return void a("#osd_cityMgrSnapPark_orderItems").html("");var c=a("#cityMgrOrigOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del";a("#osd_cityMgrSnapPark_orderItems").html("");var d="";b.each(function(b,e){if(b){var f="";if(c=a("#cityMgrOrigOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del",1===b.NameType)f=tl("sys.Custom");else if("%|"===b.Name)f=tl("com.Cewline"),c="osd-icon-del";else if("%~"===b.Name)f=tl("com.BlankSpace"),c="osd-icon-del";else if("%54"===b.Name)f=j.ttl("com_osd.TitleBit40")+1;else if("%172"===b.Name)f=j.ttl("com_osd.TitleBit40")+2;else if("%173"===b.Name)f=j.ttl("com_osd.TitleBit40")+3;else{var g=n.indexOf(b.Name);"%y%M%d%h%m%s"==b.Name&&(g=0),f=j.ttl("com_osd.TitleBit"+g)}d+='<li id="'+("osd_snap_order"+e+"_li")+'" class="">',d+='<a class="osd-button-icon fn-width68 fn-txtoverflow" data-type="'+b.Name+'">'+f,d+='<i class="icon-right '+c+'"></i>',d+="</a>",d+="</li>"}}),g.$("#osd_cityMgrSnapPark_orderItems").html(d),g.bindOSDOrderItems(),0!==g.$("#osd_snap_order"+q+"_li").length?g.$("#osd_snap_order"+q+"_li").click():g.$("#osd_snap_order0_li").click()},bindOSDOrderItems:function(){g.$("#osd_cityMgrSnapPark_orderItems li").on("click",function(a){q=this.id.replace(/[^\d]/g,"")-0,g.$("#osd_cityMgrSnapPark_orderItems li a").removeClass("osd-order-item-cur"),g.$(this).children("a").first().addClass("osd-order-item-cur");var b=g.$(this).children("a").first().attr("data-type"),a=a||event,c=a&&(a.target||a.srcElement),d=c&&c.className||"";if(-1!==d.indexOf("icon-right")){var e=m[0].Element,f=d.indexOf("osd-icon-del"),i=d.indexOf("osd-icon-edit");if(-1!==f){g.delEleOrder("osd_snap_order"+q+"_li"),g.delOSDElement("osd_snap_order"+q+"_li"),q--;var k=g.$("#osd_snap_order"+q+"_li");if(0===k.length){var l=g.$("#osd_cityMgrSnapPark_orderItems").children("li").first();q=l?l.prop("id").replace(/[^\d]/g,"")-0:0}k=g.$("#osd_snap_order"+q+"_li"),k&&(g.$("#osd_cityMgrSnapPark_orderItems li a").removeClass("osd-order-item-cur"),k.children("a").first().addClass("osd-order-item-cur"))}if(-1!==i){var o=-1,p=tl("sys.Custom"),e=m[0].Element,r=0;if(e.each(function(a,c){a.Name==b&&(r=c,g.$("#osd_cityMgrOrigOSD_dialog [data-action='confirm']").attr("data-index",r))}),0===e[r].NameType){var s=e[r].Name;o=n.indexOf(s),"%y-%M-%d %h:%m:%s"==s&&(o=0),p=j.ttl("com_osd.TitleBit"+o),"%172"==s&&(p=j.ttl("com_osd.TitleBit40")+2),"%173"==s&&(p=j.ttl("com_osd.TitleBit40")+3)}g.$("#osd_cityMgrOrigOSD_item").text(p),g.$("#osd_cityMgrOrigOSD_prefix").val(e[r].Prefix||""),g.$("#osd_cityMgrOrigOSD_postfix").val(e[r].Postfix||""),g.$("#osd_cityMgrOrigOSD_seperater").val(e[r].SeperaterCount),h.dialog("show")}}})},cityMgrOsdRefreshClick:function(b){var c=["VideoAnalyseGlobal","SnapOSD"];a.when(d.ConfigManager.getConfig(c),f.get("VideoAnalyse",!0)).done(function(a,c){p=a[0].params.table,o=a[1].params.table,s=c.SupportedRules,g.renderSnapElements(),b!==!1&&g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OpearFaildTip")})},cityMgrOsdConfirmClick:function(){g.saveGlobalParams(),d.ConfigManager.setConfig("SnapOSD",o).done(function(){g.tip("success","com.SaveSuccessTip")}).fail(function(){g.tip("error","com.SaveConfigFailTip")})},saveGlobalParams:function(){var a=k.OSD.OSDBlackRegion;"None"===g.$('[sel-for="onCityMgrChangeBlackPosition"]').val()?a.Height=0:(a.Height=32,a.OSDPosition=g.$('[sel-for="onCityMgrChangeBlackPosition"]').val());var b=k.OSD.OSDWholeAttr;b.FontSize=~~g.$('[sel-for="onCityMgrChangeFontSize"]').val(),b.Position=g.$("#osd_cityMgrOsdPosition").val().split(",").map(function(a){return a-0});var c=(k.OSD.OSDBlackRegion.BackColor,g.$('[sel-for="onCityMgrChangeBKColor"]').val());switch(c){case"black":k.OSD.OSDBlackRegion.BackColor=[0,0,0,128];break;case"white":k.OSD.OSDBlackRegion.BackColor=[255,255,255,128];break;case"gray":k.OSD.OSDBlackRegion.BackColor=[128,128,128,128]}k.TimeTitle.Enable=g.$("#ivs_cityMgrOSD_timeTitle").prop("checked"),k.ChannelTitle.Enable=g.$("#ivs_cityMgrOSD_channelTitle").prop("checked"),k.DetectionFrameEnable=g.$("#ruleBoxOSD").prop("checked")},onSaveOSDPreview:function(){{var a=m[0].Element,b=g.$("#osd_cityMgrOrigOSD_dialog [data-action='confirm']").attr("data-index")-0;0===a[b].NameType,a[b].Name}a[b].Prefix=g.$("#osd_cityMgrOrigOSD_prefix").val(),a[b].Postfix=g.$("#osd_cityMgrOrigOSD_postfix").val(),a[b].SeperaterCount=g.$("#osd_cityMgrOrigOSD_seperater").val()-0}})}),define("cityMgrMergeOSD",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability");require("widget/js/dui.colorpicker");var g=null,h=null;require.async("OSDPublic",function(a){g=a});var i=null,j=null,k=[],l=g.ArrWholeOSDName,m=null,n=null,o="IntelliCityMgr",p=0,q=null,r=[],s="",t=[],u=null;c.exports=e.extend({init:function(){u=this,h=u.$("#osd_cityMgrMergeOSD_dialog").dialog({close:function(){},confirm:function(a,b){b.ui.close(),u.onSaveOSDPreview()}}),g.setFontSize("mergeOsd",u),u._getTemplates(),u.render()},render:function(){d.DevIntelliTracker.stop(),u.cityMgrMergeOsdRefreshClick(!1)},leave:function(){d.DevIntelliTracker.start(),s=""},_getTemplates:function(){d.VideoInAnalyse.getTemplateSnapOSD("IntelliCityMgr").done(function(a){q=a})},bind:function(){a("#ivs_cityMgrMergeSuggestOverlay").on("click",function(){if(!u.$("#ivs_cityMgrMergeSuggestOverlay").hasClass("disabled")){for(var b=0;b<q.IntelliCityMgr.OSDWithClass.length;b++)q.IntelliCityMgr.OSDWithClass[b].RuleType===u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').val()&&(j=a.extend(!0,{},q.IntelliCityMgr.OSDWithClass[b]));var c=g.getEleArr(j.MergeOSD.OSDOrder);k=j.MergeOSD.OSDCustomizeSort,i.MergeOSD.OSDOrder=j.MergeOSD.OSDOrder,i.MergeOSD.OSDCustomizeSort=j.MergeOSD.OSDCustomizeSort,u.createOSDOrderItems(c)}}),u.$("#cityMgrMergeOSD_snap_modify, #cityMgrMergeOSD_snap_delete").on("click",u.onOSDActionClick),a('[sel-for="onCityMgrChangeBlackPosition"]').on("change",function(b){"None"!==a(b.target).val()?a("#osd_cityMgrMergeOsdPosition").parent().addClass("fn-invisib"):a("#osd_cityMgrMergeOsdPosition").parent().removeClass("fn-invisib")}),a("#ivs_cityMgrMergeOSD_font_picker").colorpicker({onChange:function(b,c){a("#ivs_cityMgrMergeOSD_font_picker_tip").css({"background-color":"#"+c})},onSubmit:function(b,c,d){a("#ivs_cityMgrMergeOSD_font_picker_tip").css({"background-color":"#"+c});var e={r:0,g:1,b:2};for(index in e)i.MergeOSD.OSDWholeAttr.FontColor[e[index]]=d[index];a("#ivs_cityMgrMergeOSD_font_picker").colorpickerHide()}})},renderOSDElements:function(){if(k.length&&k[0]){var a=k[0].Element;p=a.length-1;var b=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(b)}},renderGlobalParams:function(){var b=i.MergeOSD.OSDBlackRegion;u.$('[sel-for="onCityMgrChangeBlackPosition"]').val(b.Height>0?b.OSDPosition:"None"),u.$('[sel-for="onCityMgrChangeBlackPosition"]').change(),u.$('[sel-for="onCityMgrChangeFontSize"]').val(i.MergeOSD.OSDWholeAttr.FontSize);var c=i.MergeOSD.OSDWholeAttr.FontColor;a("#ivs_cityMgrMergeOSD_font_picker_tip").css({"background-color":"rgb("+c[0]+","+c[1]+","+c[2]+")"});var d=i.MergeOSD.OSDWholeAttr.Position||[0,0,0,0];u.$("#osd_cityMgrMergeOsdPosition").val(d.toString());var e=u.$('[sel-for="onCityMgrChangeBKColor"]');switch(i.MergeOSD.OSDBlackRegion.BackColor[0]){case 0:e.val("black");break;case 255:e.val("white");break;case 128:e.val("gray")}u.$("#ivs_cityMgrMergeOSD_timeTitle").prop("checked",i.TimeTitle.Enable),u.$("#ivs_cityMgrMergeOSD_channelTitle").prop("checked",i.ChannelTitle.Enable)},renderSnapElements:function(){u.renderPreset()},renderPreset:function(){if(n&&n[0]){var a="",b="";s="";for(var c in n[0]){var d=n[0][c];if(/Scene/.test(c)&&d.Type===o){if(b=n[0][c].PtzPresetId,0===b)continue;if(1e3===b)continue;a+="<option value='"+b+"' presetId='"+b+"'>"+tl("ivs.Preset")+b+"</option>"}}for(var e=0;e<r.IntelliCityMgr.length;e++)"CityMotorParkingManual"!==r.IntelliCityMgr[e]&&(s+="<option value='"+r.IntelliCityMgr[e]+"'>"+tl("appEvent"+r.IntelliCityMgr[e])+"</option>");u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').empty().append(s),""!==a?(u.$("[sel-for='onCityMgrChangePresetMergeOSD']").empty().append(a),u.$(".existPreset").removeClass("fn-hide"),u.$(".existPresetib").addClass("fn-ib"),u.$("#ivs_cityMgrMergeSuggestOverlay").removeClass("disabled"),u.$('[btn-for="cityMgrMergeOsdRefreshClick"]').parent().removeClass("fn-hide"),u.$("select[sel-for='onCityMgrChangePresetMergeOSD']").change(),u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').attr("disabled",!1),u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').change()):(u.$("[sel-for='onCityMgrChangePresetMergeOSD']").empty().append("<option value='-1'>"+tl("com.AddPlanFirstTip")+"</option>"),u.$(".existPresetib").removeClass("fn-ib"),u.$(".existPreset").addClass("fn-hide"),u.$("#ivs_cityMgrMergeSuggestOverlay").addClass("disabled"),u.$('[btn-for="cityMgrMergeOsdRefreshClick"]').parent().addClass("fn-hide"),u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').attr("disabled",!0)),u.bind()}},onCityMgrChangeRuleMergeOSD:function(){var b=u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').val();g.initOSDMaskItems("mergeOsd",u,b),u.$("#mergeOsd_cityMgrSnapPark_maskItems a").on("click",function(){var b=a(this).attr("data-type");u.addEleOrder(b);var c=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(c)});for(var c=0;c<t.length;c++)t[c].RuleType===b&&(i=t[c]);k=i.MergeOSD.OSDCustomizeSort,u.renderOSDElements(),u.renderGlobalParams()},onCityMgrChangePresetMergeOSD:function(){for(var b=u.$("select[sel-for='onCityMgrChangePresetMergeOSD']").val()-0,c=[],d=0;d<m[0].length;d++)if(c.push(m[0][d].PresetID),m[0][d].PresetID===b){t=m[0][d].OSDWithClass;for(var e=0;e<t.length;e++)t[e].RuleType===u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').val()&&(i=t[e]);k=i.MergeOSD.OSDCustomizeSort}if(-1===c.indexOf(b)){t=a.extend(!0,[],q.IntelliCityMgr.OSDWithClass);for(var d=0;d<t.length;d++)t[d].RuleType===u.$('[sel-for="onCityMgrChangeRuleMergeOSD"]').val()&&(i=t[d]);k=i.MergeOSD.OSDCustomizeSort;var f={OSDWithClass:t,PresetID:b};m[0].push(f),f={}}u.renderOSDElements(),u.renderGlobalParams()},saveGlobalParams:function(){var a=i.MergeOSD.OSDBlackRegion;"None"===u.$('[sel-for="onCityMgrChangeBlackPosition"]').val()?a.Height=0:(a.Height=32,a.OSDPosition=u.$('[sel-for="onCityMgrChangeBlackPosition"]').val());var b=i.MergeOSD.OSDWholeAttr;b.FontSize=~~u.$('[sel-for="onCityMgrChangeFontSize"]').val(),b.Position=u.$("#osd_cityMgrMergeOsdPosition").val().split(",").map(function(a){return a-0});var c=(i.MergeOSD.OSDBlackRegion.BackColor,u.$('[sel-for="onCityMgrChangeBKColor"]').val());switch(c){case"black":i.MergeOSD.OSDBlackRegion.BackColor=[0,0,0,128];break;case"white":i.MergeOSD.OSDBlackRegion.BackColor=[255,255,255,128];break;case"gray":i.MergeOSD.OSDBlackRegion.BackColor=[128,128,128,128]}i.TimeTitle.Enable=u.$("#ivs_cityMgrMergeOSD_timeTitle").prop("checked"),i.ChannelTitle.Enable=u.$("#ivs_cityMgrMergeOSD_channelTitle").prop("checked")},cityMgrMergeOsdRefreshClick:function(b){var c=["VideoAnalyseGlobal","SnapOSD"];a.when(d.ConfigManager.getConfig(c),f.get("VideoAnalyse",!0)).done(function(a,c){n=a[0].params.table,m=a[1].params.table,r=c.SupportedRules,b!==!1&&u.tip("success","com.OperateSuccessTip"),u.renderSnapElements()}).fail(function(){u.tip("error","com.OpearFaildTip")})},cityMgrMergeOsdConfirmClick:function(){u.saveGlobalParams(),d.ConfigManager.setConfig("SnapOSD",m).done(function(){u.tip("success","com.SaveSuccessTip")}).fail(function(){u.tip("error","com.SaveConfigFailTip")})},onCityMgrCleanAllClick:function(){a("#mergeOsd_cityMgrSnapPark_orderItems").html(""),i.MergeOSD.OSDOrder=""},onCityMgrAddNewLineClick:function(){u.addEleOrder("%|");var a=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(a)},onCityMgrAddBlockClick:function(){u.addEleOrder("%~");var a=g.getEleArr(i.MergeOSD.OSDOrder);u.createOSDOrderItems(a)},addEleOrder:function(b){var c,d,e,f=i.MergeOSD,g=a("#mergeOsd_cityMgrSnapPark_orderItems a"),h="";if(g.length){for(c=0;c<g.length;c++)if(a(g[c]).hasClass("osd-order-item-cur")){d=c;break}d++,b=b.replace("%",""),e=f.OSDOrder.split("%"),a("#cityMgrMergeOSD_snap_front").prop("checked")?e.splice(d,1,b,e[d]):(e.splice(d,1,e[d],b),p=d),h=e.join("%")}else h+=b;f.OSDOrder=h},onOSDActionClick:function(){u.$("#mergeOsd_cityMgrSnapPark_orderItems .icon-right").each(function(a,b){"%|"===u.$(b).parent("a").attr("data-type")||"%~"===u.$(b).parent("a").attr("data-type")||(u.$("#cityMgrMergeOSD_snap_modify").prop("checked")?u.$(b).removeClass("osd-icon-del").addClass("osd-icon-edit"):u.$(b).removeClass("osd-icon-edit").addClass("osd-icon-del"))})},delOSDElement:function(b){a("#"+b).remove()},delEleOrder:function(b){var c=[];a("#mergeOsd_cityMgrSnapPark_orderItems li").each(function(a,b){c.push(b.id)});for(var d=0;d<c.length;d++)if(c[d]==b){num=d;break}var e,f=i.MergeOSD;e=f.OSDOrder.split("%"),e.splice(num+1,1),f.OSDOrder=e.join("%")},createOSDOrderItems:function(b){if(0===b.length)return void a("#mergeOsd_cityMgrSnapPark_orderItems").html("");var c=a("#cityMgrMergeOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del";a("#mergeOsd_cityMgrSnapPark_orderItems").html("");var d="";b.each(function(b,e){if(b){var f="";if(c=a("#cityMgrMergeOSD_snap_modify").prop("checked")?"osd-icon-edit":"osd-icon-del",1===b.NameType)f=tl("sys.Custom");else if("%|"===b.Name)f=tl("com.Cewline"),c="osd-icon-del";else if("%~"===b.Name)f=tl("com.BlankSpace"),c="osd-icon-del";else if("%54"===b.Name)f=g.ttl("com_osd.TitleBit40")+1;else if("%172"===b.Name)f=g.ttl("com_osd.TitleBit40")+2;else if("%173"===b.Name)f=g.ttl("com_osd.TitleBit40")+3;else{var h=l.indexOf(b.Name);"%y%M%d%h%m%s"==b.Name&&(h=0),f=g.ttl("com_osd.TitleBit"+h)}d+='<li id="'+("mergeOSD_snap_order"+e+"_li")+'" class="">',d+='<a class="osd-button-icon fn-width68 fn-txtoverflow" data-type="'+b.Name+'">'+f,d+='<i class="icon-right '+c+'"></i>',d+="</a>",d+="</li>"}}),u.$("#mergeOsd_cityMgrSnapPark_orderItems").html(d),u.bindOSDOrderItems(),0!==u.$("#mergeOSD_snap_order"+p+"_li").length?u.$("#mergeOSD_snap_order"+p+"_li").click():u.$("#mergeOSD_snap_order0_li").click()},bindOSDOrderItems:function(){u.$("#mergeOsd_cityMgrSnapPark_orderItems li").on("click",function(a){p=this.id.replace(/[^\d]/g,"")-0,u.$("#mergeOsd_cityMgrSnapPark_orderItems li a").removeClass("osd-order-item-cur"),u.$(this).children("a").first().addClass("osd-order-item-cur");var b=u.$(this).children("a").first().attr("data-type"),a=a||event,c=a&&(a.target||a.srcElement),d=c&&c.className||"";
if(-1!==d.indexOf("icon-right")){var e=k[0].Element,f=d.indexOf("osd-icon-del"),i=d.indexOf("osd-icon-edit");if(-1!==f){u.delEleOrder("mergeOSD_snap_order"+p+"_li"),u.delOSDElement("mergeOSD_snap_order"+p+"_li"),p--;var j=u.$("#mergeOSD_snap_order"+p+"_li");if(0===j.length){var m=u.$("#mergeOsd_cityMgrSnapPark_orderItems").children("li").first();p=m?m.prop("id").replace(/[^\d]/g,"")-0:0}j=u.$("#mergeOSD_snap_order"+p+"_li"),j&&(u.$("#mergeOsd_cityMgrSnapPark_orderItems li a").removeClass("osd-order-item-cur"),j.children("a").first().addClass("osd-order-item-cur"))}if(-1!==i){var n=-1,o=tl("sys.Custom"),e=k[0].Element,q=0;if(e.each(function(a,c){a.Name==b&&(q=c,u.$("#osd_cityMgrMergeOSD_dialog [data-action='confirm']").attr("data-index",q))}),0===e[q].NameType){var r=e[q].Name;n=l.indexOf(r),"%y-%M-%d %h:%m:%s"==r&&(n=0),o=g.ttl("com_osd.TitleBit"+n),"%172"==r&&(o=g.ttl("com_osd.TitleBit40")+2),"%173"==r&&(o=g.ttl("com_osd.TitleBit40")+3)}u.$("#osd_cityMgrMergeOSD_item").text(o),u.$("#osd_cityMgrMergeOSD_prefix").val(e[q].Prefix||""),u.$("#osd_cityMgrMergeOSD_postfix").val(e[q].Postfix||""),u.$("#osd_cityMgrMergeOSD_seperater").val(e[q].SeperaterCount),h.dialog("show")}}})},onSaveOSDPreview:function(){{var a=k[0].Element,b=u.$("#osd_cityMgrMergeOSD_dialog [data-action='confirm']").attr("data-index")-0;0===a[b].NameType,a[b].Name}a[b].Prefix=u.$("#osd_cityMgrMergeOSD_prefix").val(),a[b].Postfix=u.$("#osd_cityMgrMergeOSD_postfix").val(),a[b].SeperaterCount=u.$("#osd_cityMgrMergeOSD_seperater").val()-0}})}),define("cityMgrManualEvidence",function(require,b,c){{var d=require("jsCore/rpc"),e=(require("jsCore/plugin"),require("jsCore/pageBase")),f=require("jsCore/ability");require("jsCore/modules/timeSection")}require("widget/js/dui.slider"),require("jsCore/modules/eventHandler");var g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v="videoAnalyseCityManual",w=-1,x=[],y="";c.exports=e.extend({init:function(){g=this,a("#ivsCityMgrManualEvidenceEventHandler").eventHandler({RecordEnable:!1,RecordLatch:!1,SnapshotEnable:!1,PtzLinkEnable:!1,MailEnable:!1}),h=g.$("#cityMgrManualEvidence_picSetting_dialog").dialog({close:function(){},confirm:function(b,c){c.ui.close(),s.SingleInterval[0]=a("#cityMgrIllegalAlarmOnEx").val()-0;for(var d=0;d<a('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0;d++)s.SnapShotType[d]=a('[sel-for="onCityMgrChangePic_'+(d+1)+'_Ex"]').val();for(var d=1;d<a('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0;d++)s.SingleInterval[d]=60*(a("#ivs_cityMgrSnapT_m_"+d+"_Ex").val()-0)+(a("#ivs_cityMgrSnapT_s_"+d+"_Ex").val()-0);for(var d=0;d<s.SnapShotType.length;d++)a("#cityMgrNumber_"+(d+1)+"_Ex").prop("disabled",!1),"Far"===s.SnapShotType[d]&&(a("#cityMgrNumber_"+(d+1)+"_Ex").prop("disabled",!0),a("#cityMgrNumber_"+(d+1)+"_Ex").prop("checked",!1));s.MediumRatio=a('[sel-for="onCityMgrChangeMiddleRatioEx"]').val()-0,s.FeatureRatio=a('[sel-for="onCityMgrChangeFeatureRatioEx"]').val()-0}}).detach().appendTo(document.body),g.$("#ivs_cityMgrCardsSizeEx").numberfield({min:80,max:200,allowDecimal:!1,allowNegative:!1}),g.$("#cityMgrBodyProportion").numberfield({min:1,max:100,allowDecimal:!1,allowNegative:!1}),g.$("#cityMgrLongestCaptureIntervalEx").numberfield({min:600,max:3600,allowDecimal:!1,allowNegative:!1}),g.$("#cityMgrCaptureUploadingValueEx").numberfield({min:0,max:1440,allowDecimal:!1,allowNegative:!1}),a("[id^=ivs_cityMgrSnapT_s_]").numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),a("[id^=ivs_cityMgrSnapT_m_]").numberfield({min:0,max:59,allowDecimal:!1,allowNegative:!1}),g._initSlider(),g.bind(),g.render()},bind:function(){g.$("#ivs_cityMgrCaptureSettingEx").on("click",g._showPicSettingDialog),a('#cityMgrManualEvidence_picSetting_dialog [sel-for^="onCityMgrChangePic_"]').on("change",function(){for(var b=a('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0,c=a('#cityMgrManualEvidence_picSetting_dialog [sel-for^="onCityMgrChangePic_"]'),d=[],e=0;e<c.length;e++)d.push(c[e]);var f=d.slice(0,b).some(function(b){return"Medium"===a(b).val()}),g=d.slice(0,b).some(function(b){return"Feature"===a(b).val()});f?a('[sel-for="onCityMgrChangeMiddleRatioEx"]').parent().removeClass("fn-hide"):a('[sel-for="onCityMgrChangeMiddleRatioEx"]').parent().addClass("fn-hide"),g?a('[sel-for="onCityMgrChangeFeatureRatioEx"]').parent().removeClass("fn-hide"):a('[sel-for="onCityMgrChangeFeatureRatioEx"]').parent().addClass("fn-hide")})},_showPicSettingDialog:function(){h.dialog("show"),a("#cityMgrIllegalAlarmOnEx").val(s.SingleInterval[0]),a('[sel-for="onCityMgrChangeMiddleRatioEx"]').parent().addClass("fn-hide"),a('[sel-for="onCityMgrChangeFeatureRatioEx"]').parent().addClass("fn-hide");for(var b=s.SingleInterval.length,c=s.SnapShotType.length,d=(a('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0,1);b>d;d++)a("#ivs_cityMgrSnapT_m_"+d+"_Ex").val(parseInt(s.SingleInterval[d]/60)),a("#ivs_cityMgrSnapT_s_"+d+"_Ex").val(s.SingleInterval[d]%60);for(var e=0;c>e;e++)a('[sel-for="onCityMgrChangePic_'+(e+1)+'_Ex"]').val(s.SnapShotType[e]).change();a('[sel-for="onCityMgrChangeMiddleRatioEx"]').val(s.MediumRatio),a('[sel-for="onCityMgrChangeFeatureRatioEx"]').val(s.FeatureRatio)},render:function(){d.DevIntelliTracker.stop(),g.$("#ivsCityMgrManualEvidenceEventHandler").find('[class="ui-label"]').css({width:"200px","margin-left":"20px"}),g._getConfig()},leave:function(){y="",d.DevIntelliTracker.start()},_initSlider:function(){g.$("[slider]").slider({min:0,max:10,complete:function(a){g.$(a.target)}})},_getConfig:function(b){i=["VideoAnalyseGlobal","VideoAnalyseCalibrate","VideoAnalyseRule","MultiSceneRecord","TrafficImage","SceneSnapShotWithRule2","TrafficSnapMosaic2"],a.when(d.ConfigManager.getConfig(i),f.get("VideoAnalyse",!0)).done(function(a,c){j=a[0].params.table,k=a[1].params.table,l=a[2].params.table,m=a[3].params.table,n=a[4].params.table,o=a[5].params.table,p=a[6].params.table,x=c.SupportedRules,b&&g.$("#cityMgrManualEvidence_tip").tip("success",tl("com.OperateSuccessTip")),g._renderElements()})},_renderElements:function(){g.$('[sel-for="onCityMgrChangeModeEx"]').val(k[0][0].CalibrateArea[0].Method).change();for(var b=0;b<l[0].length;b++)1e3===l[0][b].PtzPresetId&&l[0][b].Type===v&&(q=l[0][b],w=l[0][b].Id);for(var b=0;b<x.IntelliCityMgr.length;b++)"CityMotorParkingManual"!==x.IntelliCityMgr[b]&&(y+="<option value='"+x.IntelliCityMgr[b]+"'>"+tl("appEvent"+x.IntelliCityMgr[b])+"</option>");g.$('[sel-for="onCityMgrChangeRuleManualEvidence"]').empty().append(y),a("#ivsCityMgrManualEvidenceEventHandler").eventHandler("set",q.EventHandler);for(var b=0;b<o[0].length;b++)1e3===o[0][b].PresetID&&(s=o[0][b].SnapShotWithRule[0]);a('[sel-for="onCityMgrChangeCaptureAmountEx"]').val(s.SnapShotType.length).change(),g.$("#cityMgrManualEvidence_slider").slider("value",q.Config.Sensitivity),g.$("#cityMgrZoomGetEvidenceEx").prop("checked",q.Config.ZoomEnable);for(var b=0;b<n[0].PresetImage.length;b++)1e3===n[0].PresetImage[b].PtzPresetId&&(r=n[0].PresetImage[b].Images[0]);g.$("#origpic_cityMgrLocalSaveEx").prop("checked",r.NormalSnap.SaveSnap),g.$("#origpic_cityMgrReportEx").prop("checked",r.NormalSnap.UploadSnap),g.$('[sel-for="onCityMgrChangeOrigPictureResolutionEx"]').val(r.NormalSnap.ReduceRate),g.$('[sel-for="onCityMgrChangeOrigPicQualityEx"]').val(r.NormalSnap.PicCompressRate),g.$("#mergpic_cityMgrLocalSaveEx").prop("checked",r.CombinSnap.SaveSnap),g.$("#mergpic_cityMgrReportEx").prop("checked",r.CombinSnap.UploadSnap),g.$('[sel-for="onCityMgrChangeCompPictureResolutionEx"]').val(r.CombinSnap.ReduceRate),g.$('[sel-for="onCityMgrChangeCompPicQualityEx"]').val(r.CombinSnap.PicCompressRate),g.$("#cityMgrLongestCaptureIntervalEx").val(s.SnapTimeOutInterval),g.$("#cityMgrCaptureUploadingValueEx").val(s.RepeatInterval/60),g.$("#cityMgrZeroClearTime_enableEx").prop("checked",s.RepeatIntervalFlag),g.$("#cityMgrSnapShot_enableEx").prop("checked",1===s.SnapMode?!0:!1);for(var c=s.UploadMask||0,d=c.toString(2).split("").reverse(),b=0;b<d.length;b++)d[b]-0===1?g.$("#cityMgrNumber_"+(b+1)+"_Ex").prop("checked",!0):g.$("#cityMgrNumber_"+(b+1)+"_Ex").prop("checked",!1);for(var b=0;b<s.SnapShotType.length;b++)a("#cityMgrNumber_"+(b+1)+"_Ex").prop("disabled",!1),"Far"===s.SnapShotType[b]&&(a("#cityMgrNumber_"+(b+1)+"_Ex").prop("disabled",!0),a("#cityMgrNumber_"+(b+1)+"_Ex").prop("checked",!1));for(var b=0;b<p[0].length;b++)1e3===p[0][b].PresetID&&(t=p[0][b].MosaicWithRule[0]);a(a('input[name="cityMgrMosaicTwoMethodEx"][value="'+t.MosaicTwoMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicThreeMethodEx"][value="'+t.MosaicThreeMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicFourMethodEx"][value="'+t.MosaicFourMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicFiveMethodEx"][value="'+t.MosaicFiveMethod+'"]')[0]).prop("checked",!0),a(a('input[name="cityMgrMosaicSixMethodEx"][value="'+t.MosaicSixMethod+'"]')[0]).prop("checked",!0);for(var b=0;b<m[0].PresetRecord.length;b++)1e3===m[0].PresetRecord[b].PtzPresetId&&(u=m[0].PresetRecord[b].Records[0]);g.$("#cityMgrIllegalVideo").prop("checked",u.Enable),g.$("#cityMgrUploadIllegalVideo").prop("checked",u.UploadRecordEnable)},onCityMgrChangeRuleManualEvidence:function(){},onCityMgrChangeModeEx:function(){var a=g.$('[sel-for="onCityMgrChangeModeEx"]').val();"Plate"===a?(g.$("[data-calibrateType]").addClass("fn-hide"),g.$('[data-calibrateType="ManualCalibrate"]').removeClass("fn-hide"),g.$("#ivs_cityMgrCardsSizeEx").val(k[0][0].CalibratePixel)):"Scale"===a&&(g.$("[data-calibrateType]").addClass("fn-hide"),g.$('[data-calibrateType="AutoCalibrate"]').removeClass("fn-hide"),g.$("#cityMgrBodyProportion").val(k[0][0].CalibrateArea[0].ObjectScale))},onCityMgrChangeCaptureAmountEx:function(){g._renderUpPic(),g._syncImageTable()},_renderUpPic:function(){var b=g.$('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0;g.$("[id^='cityMgrNumber_']").css("display","none");for(var c=0;b>c;c++)g.$("#cityMgrNumber_"+(c+1)+"_Ex").css("display",""),g.$("#cityMgrNumber_span_"+(c+1)+"_Ex").css("display","");5===b?s.SnapShotType[4]||("Near"===s.SnapShotType[3]?(s.SnapShotType[4]="Far",a("#cityMgrNumber_5_Ex").attr("disabled",!0),a("#cityMgrNumber_5_Ex").attr("checked",!1)):"Far"===s.SnapShotType[3]&&(s.SnapShotType[4]="Near",a("#cityMgrNumber_5_Ex").attr("disabled",!1)),s.SingleInterval[4]=s.SingleInterval[3]):6===b&&(s.SingleInterval[5]||("Near"===s.SnapShotType[3]?(s.SnapShotType[4]="Far",a("#cityMgrNumber_5_Ex").attr("disabled",!0),a("#cityMgrNumber_5_Ex").attr("checked",!1),s.SnapShotType[5]="Near",a("#cityMgrNumber_6_Ex").attr("disabled",!1)):"Far"===s.SnapShotType[3]&&(s.SnapShotType[4]="Near",a("#cityMgrNumber_5_Ex").attr("disabled",!1),s.SnapShotType[5]="Far",a("#cityMgrNumber_6_Ex").attr("disabled",!0),a("#cityMgrNumber_6_Ex").attr("checked",!1)),s.SingleInterval[4]=s.SingleInterval[3],s.SingleInterval[5]=s.SingleInterval[3]))},_syncImageTable:function(){var b=g.$('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0;a("[data-snapcapEx]").each(function(c,d){var e=a(d).attr("data-snapcapEx");e.indexOf(b)>-1?a(d).removeClass("fn-hide"):a(d).addClass("fn-hide")}),g.$(".TPMosaic").addClass("fn-hide"),g.$(".TPMosaic"+b).removeClass("fn-hide")},cityMgrManualRefreshClick:function(){g._getConfig(!0)},cityMgrManualConfirmClick:function(){var b=g.$('[sel-for="onCityMgrChangeModeEx"]').val();k[0][0].CalibrateArea[0].Method=b,"Plate"===b?k[0][0].CalibratePixel=g.$("#ivs_cityMgrCardsSizeEx").val()-0:"Scale"===b&&(k[0][0].CalibrateArea[0].ObjectScale=g.$("#cityMgrBodyProportion").val()-0),q.EventHandler=a("#ivsCityMgrManualEvidenceEventHandler").eventHandler("get"),q.Config.Sensitivity=g.$("#cityMgrManualEvidence_slider").slider("value"),q.Config.ZoomEnable=g.$("#cityMgrZoomGetEvidenceEx").prop("checked"),u.Enable=g.$("#cityMgrIllegalVideo").prop("checked"),u.UploadRecordEnable=g.$("#cityMgrUploadIllegalVideo").prop("checked"),u.RuleId=w,r.NormalSnap.SaveSnap=g.$("#origpic_cityMgrLocalSaveEx").prop("checked"),r.NormalSnap.UploadSnap=g.$("#origpic_cityMgrReportEx").prop("checked"),r.NormalSnap.PicCompressRate=a('[sel-for="onCityMgrChangeOrigPicQualityEx"]').val()-0,r.NormalSnap.ReduceRate=a('[sel-for="onCityMgrChangeOrigPictureResolutionEx"]').val()-0,r.CombinSnap.SaveSnap=g.$("#mergpic_cityMgrLocalSaveEx").prop("checked"),r.CombinSnap.UploadSnap=g.$("#mergpic_cityMgrReportEx").prop("checked"),r.CombinSnap.PicCompressRate=a('[sel-for="onCityMgrChangeCompPicQualityEx"]').val()-0,r.CombinSnap.ReduceRate=a('[sel-for="onCityMgrChangeCompPictureResolutionEx"]').val()-0,r.RuleId=w,s.SnapTimeOutInterval=g.$("#cityMgrLongestCaptureIntervalEx").val()-0,s.RepeatInterval=60*(g.$("#cityMgrCaptureUploadingValueEx").val()-0),s.RepeatIntervalFlag=g.$("#cityMgrZeroClearTime_enableEx").prop("checked"),s.SnapMode=g.$("#cityMgrSnapShot_enableEx").prop("checked")?1:0,s.SnapShotType.length=a('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0;for(var c=[],e=g.$('[sel-for="onCityMgrChangeCaptureAmountEx"]').val()-0;e>0;e--)c.push(g.$("#cityMgrNumber_"+e+"_Ex").prop("checked")?1:0);s.UploadMask=parseInt(c.join(""),2),s.RuleId=w;for(var e=0;e<a('input[name="cityMgrMosaicTwoMethodEx"]').length;e++)if(a(a('input[name="cityMgrMosaicTwoMethodEx"]')[e]).prop("checked")){t.MosaicTwoMethod=a(a('input[name="cityMgrMosaicTwoMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicThreeMethodEx"]').length;e++)if(a(a('input[name="cityMgrMosaicThreeMethodEx"]')[e]).prop("checked")){t.MosaicThreeMethod=a(a('input[name="cityMgrMosaicThreeMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicFourMethodEx"]').length;e++)if(a(a('input[name="cityMgrMosaicFourMethodEx"]')[e]).prop("checked")){t.MosaicFourMethod=a(a('input[name="cityMgrMosaicFourMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicFiveMethodEx"]').length;e++)if(a(a('input[name="cityMgrMosaicFiveMethodEx"]')[e]).prop("checked")){t.MosaicFiveMethod=a(a('input[name="cityMgrMosaicFiveMethodEx"]')[e]).val()-0;break}for(var e=0;e<a('input[name="cityMgrMosaicSixMethodEx"]').length;e++)if(a(a('input[name="cityMgrMosaicSixMethodEx"]')[e]).prop("checked")){t.MosaicSixMethod=a(a('input[name="cityMgrMosaicSixMethodEx"]')[e]).val()-0;break}t.RuleId=w;var f=[j,k,l,m,n,o,p];d.ConfigManager.setConfig(i,f).done(function(){g.$("#cityMgrManualEvidence_tip").tip("success",tl("com.SaveSuccessTip"))}).fail(function(){g.$("#cityMgrManualEvidence_tip").tip("error",tl("com.SaveConfigFailTip"))})}})}),define("OSDPublic",function(require,a,b){var c=b.exports={ArrWholeOSDName:["%y","%86","%09","%11","%05","%06","%30","%31","%32","%58","%04","%12","%57","%07","%25","%18","%33","%28","%41","%34","%03","%35","%36","%37","%38","%39","%40","%59","%42","%43","%44","%45","%46","%47","%48","%49","%50","%51","%52","%53","%54","%55","%56","%60","%61","%62","%63","%64","%107","%108","%109","%65","%66","%67","%110","%69","%~","%70","%71","%72","%73","%19","%169","%170","%171"],ttl:function(a){var b={"com_osd.TitleBit-1":window.tl("ivs_osd.TitleBit-1"),"com_osd.TitleBit0":window.tl("ivs_osd.TitleBit0"),"com_osd.TitleBit1":window.tl("ivs_osd.TitleBit1"),"com_osd.TitleBit2":window.tl("ivs_osd.TitleBit2"),"com_osd.TitleBit3":window.tl("ivs_osd.TitleBit3"),"com_osd.TitleBit4":window.tl("ivs_osd.TitleBit4"),"com_osd.TitleBit6":window.tl("ivs_osd.TitleBit6"),"com_osd.TitleBit7":window.tl("ivs_osd.TitleBit7"),"com_osd.TitleBit8":window.tl("ivs_osd.TitleBit8"),"com_osd.TitleBit9":window.tl("ivs_osd.TitleBit9"),"com_osd.TitleBit10":window.tl("ivs_osd.TitleBit10"),"com_osd.TitleBit11":window.tl("ivs_osd.TitleBit11"),"com_osd.TitleBit12":window.tl("ivs_osd.TitleBit12"),"com_osd.TitleBit13":window.tl("ivs.TitleBit63"),"com_osd.TitleBit14":window.tl("ivs_osd.TitleBit14"),"com_osd.TitleBit15":window.tl("ivs.BreakRulesCode"),"com_osd.TitleBit16":window.tl("ivs_osd.TitleBit16"),"com_osd.TitleBit17":window.tl("ivs_osd.TitleBit17"),"com_osd.TitleBit18":window.tl("ivs_osd.TitleBit18"),"com_osd.TitleBit19":window.tl("ivs_osd.TitleBit19"),"com_osd.TitleBit20":window.tl("ivs_osd.TitleBit20"),"com_osd.TitleBit21":window.tl("ivs_osd.TitleBit21"),"com_osd.TitleBit22":window.tl("ivs_osd.TitleBit22"),"com_osd.TitleBit23":window.tl("ivs_osd.TitleBit23"),"com_osd.TitleBit24":window.tl("ivs_osd.TitleBit24"),"com_osd.TitleBit27":window.tl("ivs_osd.TitleBit27"),"com_osd.TitleBit28":window.tl("ivs_osd.TitleBit28"),"com_osd.TitleBit29":window.tl("ivs_osd.TitleBit29"),"com_osd.TitleBit30":window.tl("ivs_osd.TitleBit30"),"com_osd.TitleBit32":window.tl("ivs_osd.TitleBit32"),"com_osd.TitleBit35":window.tl("ivs_osd.TitleBit35"),"com_osd.TitleBit36":window.tl("ivs_osd.TitleBit36"),"com_osd.TitleBit37":window.tl("ivs_osd.TitleBit37"),"com_osd.TitleBit38":window.tl("ivs_osd.TitleBit38"),"com_osd.TitleBit40":window.tl("ivs_osd.TitleBit40"),"com_osd.TitleBit41":window.tl("ivs_osd.TitleBit41"),"com_osd.TitleBit42":window.tl("ivs_osd.TitleBit42"),"com_osd.TitleBit44":window.tl("ivs_osd.TitleBit44"),"com_osd.TitleBit48":window.tl("ivs.InspectionSticker"),"com_osd.TitleBit49":window.tl("ivs.Pendant"),"com_osd.TitleBit50":window.tl("ivs.Perfume"),"com_osd.TitleBit51":window.tl("ivs_osd.TitleBit51"),"com_osd.TitleBit52":window.tl("ivs_osd.TitleBit52"),"com_osd.TitleBit53":window.tl("ivs_osd.TitleBit53"),"com_osd.TitleBit54":window.tl("ivs.Tissue"),"com_osd.TitleBit55":window.tl("ivs_osd.TitleBit55"),"com_osd.TitleBit57":window.tl("ivs_osd.TitleBit57"),"com_osd.TitleBit58":window.tl("ivs_osd.TitleBit58"),"com_osd.TitleBit59":window.tl("ivs_osd.TitleBit59"),"com_osd.TitleBit60":window.tl("ivs_osd.TitleBit60"),"com_osd.TitleBit61":window.tl("ivs_osd.TitleBit61"),"com_osd.TitleBit62":window.tl("ivs.BreakRulesCode"),"com_osd.TitleBit63":window.tl("ivs.ShopID"),"com_osd.TitleBit64":window.tl("ivs_osd.TitleBit64"),"com_osd.TitleBit~":window.tl("ivs_osd.TitleBit~")};return b[a]||a},setFontSize:function(a,b){var c=["16","32","48","64"];"osd"===a?c.each(function(a){b.$('[sel-for="onCityMgrChangeFontSize"]').append("<option value='"+(a-0)+"'>"+a+"</option>")}):"mergeOsd"===a&&c.each(function(a){b.$('[sel-for="onCityMgrChangeFontSize"]').append("<option value='"+(a-0)+"'>"+a+"</option>")})},getEleArr:function(a){var b,c=[];if(-1!==a.indexOf("%y%M%d%h%m%s")){var d;d=-1!==a.indexOf("%s")?{Name:"%y%M%d%h%m%s%S"}:{Name:"%y%M%d%h%m%s"},c.push(d)}return b=a.replace("%y%M%d%h%m%s","").replace("%S","").split("%"),b.each(function(a){if(a){var b={Name:"%"+a};c.push(b)}}),c},initOSDMaskItems:function(a,b,d){var e=[];switch(d){case"CityMotorParking":e=["%y","%86","%09","%07","%18","%59","%28","%41"];break;case"ShopPresence":e=["%y","%86","%07","%169","%170","%171","%28","%41"];break;case"CityNonMotorParking":case"FlowBusiness":e=["%y","%86","%07","%169","%171","%28","%41"]}b.$("#"+a+"_cityMgrSnapPark_maskItems").empty();var f="",g=-1;e.each(function(b){g=c.ArrWholeOSDName.indexOf(b),f+='<li id="'+a+"_cityMgrSnapPark_maskItems_"+g+'_li"><a id="'+a+"_cityMgrSnapPark_maskItems_"+g+'" class="osd-button-order" t="'+c.ttl("com_osd.TitleBit"+g)+'" title="'+c.ttl("com_osd.TitleBit"+g)+'" data-type="'+b+'"></a></li>'});var h=c.ArrWholeOSDName.indexOf("%54");["%54","%172","%173"].each(function(b,d){f+='<li id="'+a+"_cityMgrSnapPark_maskItems_"+(h+d)+'_li"><a id="'+a+"_cityMgrSnapPark_maskItems_"+(h+d)+'" class="osd-button-order" t="'+(c.ttl("com_osd.TitleBit"+h)+(d+1))+'" title="'+(c.ttl("com_osd.TitleBit"+h)+(d+1))+'" data-type="'+b+'"></a></li>'}),b.$("#"+a+"_cityMgrSnapPark_maskItems").append(f).translation()}}})}(jQuery);