!function(a,b){var c='<div class="u-calendar-nav">                    <h1 wgt="Calendar"></h1>                    <select data-change="month">                        <option value="0" wgt="Jan"></option>                        <option value="1" wgt="Feb"></option>                        <option value="2" wgt="Mar"></option>                        <option value="3" wgt="Apr"></option>                        <option value="4" wgt="May"></option>                        <option value="5" wgt="Jun"></option>                        <option value="6" wgt="Jul"></option>                        <option value="7" wgt="Aug"></option>                        <option value="8" wgt="Sep"></option>                        <option value="9" wgt="Oct"></option>                        <option value="10" wgt="Nov"></option>                        <option value="11" wgt="Dec"></option>                    </select>                    <a data-action="prev" class="u-nav-left">                        <i class="i-calendar-left"></i>                    </a>                    <input data-change="year"></input>                    <a data-action="next" class="u-nav-right">                        <i class="i-calendar-right"></i>                    </a>                </div>                <table>                    <thead>                        <tr><th wgt="Sun"></th><th wgt="Mon"></th><th wgt="Tue"></th><th wgt="Wen"></th><th wgt="Thu"></th><th wgt="Fri"></th><th wgt="Sat"></th></tr>                    </thead>                    <tbody></tbody>                </table>';a.widget("dui.calendar",{version:"1.0.1",widgetName:"calendar",widgetEventPrefix:"calendar",options:{date:null,maxYear:2037,minYear:2e3,disableYear:!1,selectManyDays:!1,bRange:!1,isShowToday:!0,showAdjacentDate:!1},_create:function(){var b=this,d=this.options;null===d.date&&(d.date=new Date);var e=d.date;this.year=this._justYear(e.getFullYear()),this.month=e.getMonth(),this.marks=[],this.selectDays=[],this.range=[[],[]],this.tbody=this.element.append(c).trans_wgt().addClass("u-calendar").find("tbody"),d.disableYear&&this.element.find(".u-calendar-nav a,.u-calendar-nav input").remove(),this.element.find("[data-change=year]").numberfield({min:d.minYear,max:d.maxYear,allowDecimal:!1,allowNegative:!1}).blur(function(c){var d=a(c.currentTarget).val();b.year=b._justYear(parseInt(d)),b._refresh(),0!=b.range[1].length&&b._chkCurMonth()}),this._refresh(),d.isShowToday&&this._selectDay(e.getDate(),!1,!1),this._setupEvents()},_setupEvents:function(){this._on(this._handleEvents)},_refresh:function(a){if(a){var b=a.getFullYear(),c=a.getMonth();this.monthDays=new Date(b,c+1,0).getDate(),this._renderCalendar(b,c,!0)}else{var b=this.year,c=this.month;this._renderCalendar(b,c)}this._renderCalendarNav(b,c),a||this._trigger("change",null,{ui:this,year:this.year,month:this.month+1,monthDays:this.monthDays})},_renderCalendarNav:function(a,b){this.element.find("[data-change=month]").val(b),this.element.find("[data-change=year]").val(a)},_renderCalendar:function(a,b,c){var d=new Date(a,b),e=d.getDay(),f=d.getDate(),g=new Date(a,b,0).getDate(),h=new Date(a,b,0),i=new Date(a,b+1,1),j="",k=-1;this.monthDays=new Date(a,b+1,0).getDate(),this.tbody.empty();for(var l=0,m=[];42>l;){if(l%7===0){if(f>this.monthDays)break;m.push("<tr>")}if(e>l||f>this.monthDays)if(this.options.showAdjacentDate){var n=e>l?g++-e+1:f++%this.monthDays;j=n,j=e>l?h.getFullYear()+"/"+h.getMonth()+"/"+n:i.getFullYear()+"/"+i.getMonth()+"/"+n;var o=j.split("/");k=this._getDateIndex(this.selectDays,{year:o[0],month:o[1],day:o[2]});var p=k>=0?"u-calendar-select":"";m.push('<td><a class="u-calendar-day disable '+p+' " data-value="'+j+'" data-index="'+l+'">'+n+"</a></td>")}else m.push("<td></td>");else{var q="u-calendar-day ",r=this._getMarkDate(a,b,f),s=this.selected,t=s&&s.year===a&&s.month===b&&s.day===f,u=l%7===0||l%7===6,v=this.options.showAdjacentDate?l:l-e;c&&(t=!1),(this.options.selectManyDays||this.options.bRange)&&(k=this._getDateIndex(this.selectDays,{year:a,month:b,day:f}),t=k>=0),q+=r?t?"u-calendar-select "+r.className:r.className:t?"u-calendar-select":"",j=a+"/"+b+"/"+f,m.push("<td "+(u?'class="u-calendar-weekend"':"")+'><a class="'+q+'" data-value="'+j+'" data-index="'+v+'">'+f++ +"</a></td>")}l%7===6&&m.push("</tr>"),l++}this.tbody.append(m.join(""))},select:function(a){if(a===b)return this._selectDay(this.day,!0);var c=this._paserDate(a);(this.year!==c.year||this.month!==c.month)&&(this.year=this._justYear(c.year),this.month=c.month,this._refresh()),c.day&&this._selectDay(c.day,!0)},_justYear:function(a){return Math.max(this.options.minYear,Math.min(a,this.options.maxYear))},markByBit:function(b,c){var d=new Date(this.year,this.month+1,0).getDate();b="string"===a.type(b)?b:(b>>>0).toString(2),this.clearmark();for(var e=b.length-2,f=1;d>=f;e--,f++)b.charAt(e)-0&&this.mark(new Date(this.year,this.month,f),c)},mark:function(a,b){var a=this._paserDate(a);a.day&&(a.className=b||"u-calendar-mark",this.marks.push(a),this._renderCalendar(this.year,this.month))},clearmark:function(){this.marks.length=0,this._renderCalendar(this.year,this.month)},getDay:function(){return{year:this.year,month:this.month+1,day:this.day,monthDays:this.monthDays}},refresh:function(a){this._refresh(a)},disabled:function(a){return arguments.length?(a?this.disable():this.enable(),void this.element.find("input,select").prop("disabled",a)):this.options.disabled},_getMarkDate:function(a,b,c){for(var d=this.marks.length;d--;){var e=this.marks[d];if(e.year===a&&e.month===b&&e.day===c)return e}return null},_paserDate:function(c){var d,e,f,g,h;if("date"===a.type(c))f=c.getFullYear(),g=c.getMonth(),h=c.getDate();else if(d=String(c).split(/\/|\s|-|\\/),e=d.length,e>=3?(f=parseInt(d[0]),g=parseInt(d[1])-1,h=parseInt(d[2])):2===e?(f=parseInt(d[0]),g=parseInt(d[1])-1):h=parseInt(d[0]),f!==b&&(isNaN(f)||0>=f)||g!==b&&(isNaN(g)||g>11||0>g)||h!==b&&(isNaN(h)||0>=h||h>new Date(f,g+1,0).getDate()))throw new Error("you input the wrong date. "+c+" is illegal date.");return{year:f||this.year,month:isNaN(g)?this.month:g,day:h}},_selectDay:function(a,c,d,e,f){e=parseInt(e),f=parseInt(f);var g=(e||this.year)+"\\/"+(isNaN(f)?this.month:f)+"\\/"+a,h=this.options,i=0,j="u-calendar-select",k=this.element.find("[data-value="+g+"]"),l=this.element.find(".u-calendar-select");if(0!==k.length){if(h.selectManyDays)k.hasClass(j)?c?i=1:(k.removeClass(j),i=0):(k.addClass(j),i=1);else if(h.bRange){var m=parseInt(a),n=[e||this.year,isNaN(f)?this.month:f,m];if(0==this.range[0].length)this.selectDays=[],k.addClass(j),this.range[0]=n;else if(0!=this.range[1].length)this.selectDays=[],l.removeClass(j),k.addClass(j),this.range=[n,[]];else{var o=this.range[0],p=this._compareDate(o,n);p>0?this.range[1]=n:0>p&&(this.range=[n,o]),0!=p&&(1==l.length?this._rangechk(this.range[0],this.range[1]):p>0&&0==l.length?this._rangechk(b,this.range[1]):this._rangechk(this.range[0]))}}else l.removeClass(j),k.addClass(j);this.day=parseInt(a),this.selected={year:e||this.year,month:isNaN(f)?this.month:f,day:this.day};var q=this._getDateIndex(this.selectDays,this.selected);1===i&&0>q?this.selectDays.push(this.selected):0===i&&q>=0&&this.selectDays.splice(q,1),d!==!1&&this._trigger("select",null,{ui:this,year:e||this.year,month:isNaN(f)?this.month+1:f+1,day:this.day,monthDays:e?new Date(e,f+1,0).getDate():this.monthDays,isSelected:i})}},_getDateIndex:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.year==b.year&&d.month==b.month&&d.day==b.day)return c}return-1},getSelctedDays:function(){return a.extend([],this.selectDays)},clearSelectedDays:function(){this.selectDays=[],this.range=[[],[]]},_rangechk:function(a,b){var c,d,e,f,g;a?(c=a[0]+"\\/"+a[1]+"\\/"+a[2],d=this.element.find("[data-value="+c+"]").eq(0).attr("data-index")-0):d=0,b?(e=b[0]+"\\/"+b[1]+"\\/"+b[2],f=this.element.find("[data-value="+e+"]").eq(0).attr("data-index")-0):(g=this.element.find("tbody a"),f=g.length-1),0==d&&(this.element.find("tbody a").eq(0).addClass("u-calendar-select"),d++),this.element.find("tbody a:lt("+(f+1)+"):gt("+(d-1)+")").addClass("u-calendar-select")},_compareDate:function(a,b){var c=new Date(a[0],a[1],a[2]),d=new Date(b[0],b[1],b[2]);return d-c},_chkCurMonth:function(){var a=[this.year,this.month,1],b=new Date(this.year,this.month+1,0).getDate(),c=[this.year,this.month,b];if(this.options.showAdjacentDate&&this.options.bRange){var d=this.element.find("[data-value]").first().attr("data-value").split("/");a=[d[0]-0,d[1]-0,d[2]-0];var e=this.element.find("[data-value]").last().attr("data-value").split("/");c=[e[0]-0,e[1]-0,e[2]-0]}var f=this._compareDate(a,this.range[0])>0?this.range[0]:a,g=this._compareDate(c,this.range[1])>0?c:this.range[1];this._compareDate(f,g)<0||this._rangechk(f,g)},getRange:function(){return this.range},_handleEvents:{"click [data-action]":function(b){var c=a(b.currentTarget).attr("data-action");"prev"===c&&this.year>this.options.minYear?this.year--:"next"===c&&this.year<this.options.maxYear&&this.year++,this._refresh(),0!=this.range[1].length&&this._chkCurMonth()},"change [data-change]":function(b){var c=a(b.currentTarget).attr("data-change"),d=a(b.currentTarget).val();"month"===c?this.month=parseInt(d):"year"===c&&(isNaN(parseInt(d))&&(d=this.options.minYear),this.year=this._justYear(parseInt(d))),this._refresh(),0!=this.range[1].length&&this._chkCurMonth()},"click [data-value]":function(c){var d=this.options,e=a(c.currentTarget),f=e.attr("data-value"),g=f.split("/");f={year:g[0],month:g[1],day:g[2]},d.selectManyDays||d.bRange?this._selectDay(f.day,b,b,f.year,f.month):(f.day!=this.day||this.selected.month!=this.month||this.selected.year!=this.year)&&this._selectDay(f.day,b,b,f.year,f.month)}}})}(jQuery);