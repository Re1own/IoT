!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("recordCtrl",function(require,b,c){var d,e,f,g,h,i,j,k,l=require("jsCore/rpc"),m=require("jsCore/ability"),n=require("common/common"),o=require("jsCore/pageBase"),p={0:"med.MainStream"},q=null;c.exports=o.extend({init:function(){var a=this;d=a.$("#rc_recordlen").numberfield({max:120,min:1,allowDecimal:!1,allowNegative:!1}),e=a.$("#rc_prerecord").numberfield({max:20,min:0,allowDecimal:!1,allowNegative:!1}),g=a.$("[sel-for=onOverWriteChange]"),m.get("MaxPreRecordTime").done(function(b){var c=a.$("#rc_prerecord_tip"),d=null!==b?b:5;c.text("(0~"+d+")"),e.numberfield("max",d)}),f=a.$("select[sel-for=onStreamChange]").empty().append('<option value="0" t="med.MainStream"></option>'),webApp.MaxExtraStream>=1&&(f.append('<option value="1" t="med.AuxiliaryStream"></option>'),p[1]="med.AuxiliaryStream"),f.translation(),l.RecordManager.getCaps().always(function(b){if(b&&b.RecordStreamLimit&&b.RecordStreamLimit.Local){q={};var c=b.RecordStreamLimit.Local;c.indexOf(0)>-1&&(q[0]="med.MainStream"),c.indexOf(1)>-1&&(q[1]="med.AuxiliaryStream")}a.render()})},render:function(){if(q){var b=this;l.ConfigManager.getConfig("RecordStoragePoint").done(function(c){var d=c[0],e=p;(d.TimingRecord.Local||d.AlarmRecord.Local||d.VideoDetectRecord.Local)&&(e=q),f.empty(),a.each(e,function(a,b){f.append("<option value="+a+' t="'+b+'"></option>')}),f.translation(),b._getConfig()})}else this._getConfig()},leave:function(){},destory:function(){},_getConfig:function(a){var b=this;l.ConfigManager.getConfig(["MediaGlobal","Record","RecordMode","StorageGroup","RecordStoragePoint"]).done(function(c){h=c[0].params.table,i=c[1].params.table,j=c[2].params.table,k=c[3].params.table,b.$(".record-sdencrypt-conflict").addClass("fn-hide"),l.Storage.getDeviceAllInfo().done(function(a){for(var d=c[4].params.table,e=!1,f=!1,g=0;g<a.length;g++)a[g].SDEncryptFlag&&1===a[g].SDEncryptFlag&&(e=!0);for(g=0;g<d.length;g++){var h=d[g];for(var i in h)h.hasOwnProperty(i)&&h[i]&&h[i].Local&&(f=!0)}e&&f&&b.$(".record-sdencrypt-conflict").removeClass("fn-hide")}),b._renderElement(h,i,j,k),b.disabled("a[btn-for=onSave]",!1),a&&b.tip("success","com.OperateSuccessTip")}).fail(function(){b.disabled("a[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")})},_renderElement:function(a,b,c,h){var i=this;d.numberfield("value",a.PacketLength),e.numberfield("value",b[0].PreRecord),f.val(b[0].Stream).change(),g.val(h[0].OverWrite?1:0),i.$("[name=rc_recmode][mode="+c[0].Mode+"]").prop("checked",!0)},onDefault:function(){var a=this;return l.ConfigManager.getDefault(["MediaGlobal","Record","RecordMode","StorageGroup"]).done(function(b){h.PacketLength=b[0].params.table.PacketLength;for(var c=0;c<webApp.CHANNEL_NUMBER;c++)i[c].PreRecord=b[1].params.table[c].PreRecord,i[c].Stream=b[1].params.table[c].Stream,j[c].Mode=b[2].params.table[c].Mode,k[c].OverWrite=b[3].params.table[c].OverWrite;a._renderElement(h,i,j,k),a.disabled("a[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("a[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")}),!1},onRefresh:function(){return this._getConfig(!0),!1},onSave:function(){var a=this;h.PacketLength=d.numberfield("value");for(var b=0;b<webApp.CHANNEL_NUMBER;b++)i[b].PreRecord=e.numberfield("value"),i[b].Stream=f.val()-0,k[b].OverWrite=k[1].OverWrite=Boolean(g.val()-0),j[b].Mode=a.$("[name=rc_recmode]:checked").attr("mode")-0;return l.ConfigManager.setConfig(["MediaGlobal","Record","RecordMode","StorageGroup"],[h,i,j,k]).done(function(b){n.chkMutilCallRet(b)?a.tip("success","com.SaveSuccessTip"):a.tip("error","com.SaveConfigFailTip")}),!1},onStreamChange:function(b){var c=this,d=a(b.target);return"0"!==d.val()&&-1!==webApp.ProcessInfo.indexOf("A5S")?c.$("#rc_prerecord").closest("div.ui-form-item").hide():c.$("#rc_prerecord").closest("div.ui-form-item").show(),!1}})})}(jQuery);