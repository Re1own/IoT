!function(a){var b=!1,c=null;define(function(require,d,e){e.exports=require("jsCore/pageTab");var f=require("common/common"),g=(f.Cookie,require("jsCore/rpcLogin"));e.exports.prototype.pla_gays=ability.get("SupportMutiGB").then(function(a){return/simpchinese/i.test(global.currentLanguage)&&!(a&&a.Support)}),e.exports.prototype.pla_gays_server=ability.get("SupportMutiGB").then(function(a){return c=a,!(!a||!a.Support)}),e.exports.prototype.pla_35114A=a.Deferred(function(a){ability.get("SupportGB35114Level").then(function(c){return 1===c?(b=!0,a.resolve(!0),!!c):void a.resolve(!1)},function(){a.resolve(!1)})}),e.exports.prototype.pla_hs=-1!==a.inArray("LechangePro",webApp.VSPs),e.exports.prototype.pla_P2P=function(){return!(!webCaps.is_platform_showOnvif||-1!==webApp.VSPs.indexOf("LechangePro"))},e.exports.prototype.pla_Onvif=function(){return!!webCaps.is_platform_showOnvif},e.exports.prototype.pla_GAVI=-1!==a.inArray("GAVI",webApp.VSPs),e.exports.prototype.pla_PlatformAccess=ability.get("SupportPreceptionPlatformAccess").then(function(a){if(!a)return!1;for(var b=0;b<a.length;b++)return a[b].Support===!0?!0:!1}),e.exports.prototype.pla_RTMP=function(){return!!webCaps.ShowRtmpPlatform&&"admin"==g.getLoginInfo().username}}),define("pla_gays",function(require,b,c){var d,e=require("jsCore/pageBase"),f=require("jsCore/rpc"),g=(require("common/common"),null),h=null,i=null,j=0,k=0;c.exports=e.extend({init:function(){g=this,i=0;var a=g.$("[sel-for=onSelectAlarm]");if(webApp.ALARM_IN_NUMBER<=0)a.parent().remove(),g.$("#p_g_chnNo2").parent().remove();else if(1===webApp.ALARM_IN_NUMBER)a.hide();else{a.empty();for(var b="",c=0;c<webApp.ALARM_IN_NUMBER;c++)b+="<option value=",b+=c,b+=' t="',b+="per.Alarm",b+="+",b+=c+1,b+='"></option>';a.append(b),a.translation()}g.$("#p_g_sipNo,#p_g_sipDom,#p_g_devNo,#p_g_pswd,#p_g_code,#p_g_id,#p_g_chnNo1,#p_g_chnNo3").textfield(),webApp.GongAnDetect&&(g.$("#p_g_chnNo3").parent().removeClass("fn-hide"),g.$("#audioOutInfo").removeClass("fn-hide")),g.$("#p_g_chnNo2").textfield().blur(function(){h.alarmInfo[i].id=g.$("#p_g_chnNo2").textfield("value")}),g.$("#p_g_sipPort,#p_g_localPort,#p_g_times").numberfield({max:65535,min:0,allowDecimal:!1,allowNegative:!1}),g.$("#p_g_life").numberfield({max:3600,min:30,allowDecimal:!1,allowNegative:!1}),g.$("#p_g_beat").numberfield({max:3600,min:10,allowDecimal:!1,allowNegative:!1}),g.$("#p_g_sipIP").ipfield();var d=g.$("#p_g_streamType"),e='<option value="0" t="med.MainStream"></option>';webApp.MaxExtraStream>0&&(e+='<option value="1" t="med.AuxiliaryStream1"></option>'),d.append(e).translation(),g.render()},render:function(){this._getConfig()},_render:function(){g._renderDouble(),g.$("#p_g_enable").prop("checked",h.Enable),g.$("#p_g_devNo").textfield("value",h.deviceId),g.$("#p_g_localPort").numberfield("value",h.localSipPort),g.$("#p_g_life").numberfield("value",h.sipRegExpires),g.$("#p_g_beat").numberfield("value",h.keepAliveCircle),g.$("#p_g_times").numberfield("value",h.maxTimeoutTimes),g.$("#p_g_code").textfield("value",h.civilCode),g.$("#p_g_id").textfield("value",h.intervideoID),g.$("#p_g_chnNo1").textfield("value",h.channelInfo[j].id),g.$("#p_g_level1").val(h.channelInfo[j].alarmLevel),webApp.GongAnDetect&&g.$("#p_g_chnNo3").textfield("value",h.audioOutPutChnInfo[j].id),g.$("[sel-for=onSelectAlarm]").val(i).change();for(var a=g.$("[sel-for=onSelectChannel]"),b="",c=0;c<h.channelSum;c++)b+="<option value="+c+">"+(tl("med.Channel")+(c+1))+"</option>";a.empty().append(b).val(j),h.channelSum>1&&a.removeClass("fn-hide")},_renderDouble:function(){var a=h;d&&(a=h.serverInfo[k],g.$("#p_g_serenable").prop("checked",a.enable),g.$("#p_g_streamType").val(a.streamType)),g.$("#p_g_pswd").textfield("value",a.password),g.$("#p_g_sipNo").textfield("value",a.sipSvrId),g.$("#p_g_sipDom").textfield("value",a.domain),g.$("#p_g_sipIP").ipfield("value",a.sipSvrIp),g.$("#p_g_sipPort").numberfield("value",a.sipSvrPort)},onSelectServer:function(b){g._saveDouble(),k=a(b.target).val()-0,g._renderDouble()},onSelectAlarm:function(a){i=g.$(a.target).val()-0,g.$("#p_g_chnNo2").textfield("value",h.alarmInfo[i].id),g.$("[sel-for=onSelectAlarmLevel]").val(h.alarmInfo[i].alarmLevel)},onSelectAlarmLevel:function(a){h.alarmInfo[i].alarmLevel=g.$(a.target).val()-0},onSelectChannel:function(a){h.channelInfo[j].id=g.$("#p_g_chnNo1").textfield("value"),h.channelInfo[j].alarmLevel=g.$("#p_g_level1").val()-0,j=g.$(a.target).val()-0,g.$("#p_g_chnNo1").textfield("value",h.channelInfo[j].id),g.$("#p_g_level1").val(h.channelInfo[j].alarmLevel)},_getConfig:function(a){f.ConfigManager.getConfig("VSP_GAYS").done(function(b){h=b,"boolean"!=typeof d&&(d=h.serverInfo&&h.serverInfo.length,d?g.$("[show-for = Plat]").remove():g.$("[show-for = doublePlat]").remove()),g._render(),a&&g.tip("success","com.OperateSuccessTip")}).fail(function(){g.tip("error","com.OperateFailTip")})},_saveDouble:function(){var a=h;d&&(a=h.serverInfo[k],a.enable=g.$("#p_g_serenable").prop("checked"),a.streamType=g.$("#p_g_streamType").val()-0),a.password=g.$("#p_g_pswd").textfield("value"),a.sipSvrId=g.$("#p_g_sipNo").textfield("value"),a.domain=g.$("#p_g_sipDom").textfield("value"),a.sipSvrIp=g.$("#p_g_sipIP").ipfield("value"),a.sipSvrPort=g.$("#p_g_sipPort").numberfield("value")},onSave:function(){g._saveDouble(),h.Enable=g.$("#p_g_enable").prop("checked"),h.deviceId=g.$("#p_g_devNo").textfield("value"),h.localSipPort=g.$("#p_g_localPort").numberfield("value"),h.sipRegExpires=g.$("#p_g_life").numberfield("value"),h.keepAliveCircle=g.$("#p_g_beat").numberfield("value"),h.maxTimeoutTimes=g.$("#p_g_times").numberfield("value"),h.civilCode=g.$("#p_g_code").textfield("value"),h.intervideoID=g.$("#p_g_id").textfield("value"),h.channelInfo[j].id=g.$("#p_g_chnNo1").textfield("value"),h.channelInfo[j].alarmLevel=g.$("#p_g_level1").val()-0,webApp.GongAnDetect&&(h.audioOutPutChnInfo[j].id=g.$("#p_g_chnNo3").textfield("value")),f.ConfigManager.setConfig("VSP_GAYS",h).done(function(a){g.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(a)&&webApp.reboot("com.ConfEffectRestartTip")}).fail(function(){g.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){f.ConfigManager.getDefault("VSP_GAYS").done(function(a){h=a,i=0,j=0,g._render(),g.tip("success","com.DefaultSuccessTip")}).fail(function(){g.tip("error","com.DefaultfailureTip")})},destory:function(){k=0}})}),define("pla_gays_server",function(require,d,e){var f=require("jsCore/pageBase"),g=require("jsCore/rpc"),h=(require("common/common"),null),i=null,j=null,k=0,l=0,m=(a.Deferred(),[]),n=["CACert","AdminCert","DataAuthCert","RemoteDataAuthCert"],o=0,p=100;e.exports=f.extend({init:function(){h=this,j=0;var d=h.$("[sel-for=onSelectAlarm]");if(webApp.ALARM_IN_NUMBER<=0)d.parent().remove(),h.$("#p_g_s_chnNo2_0, #p_g_s_chnNo2_1").parent().remove();else if(1===webApp.ALARM_IN_NUMBER)d.hide();else{d.empty();for(var e="",f=0;f<webApp.ALARM_IN_NUMBER;f++)e+="<option value=",e+=f,e+=' t="',e+="per.Alarm",e+="+",e+=f+1,e+='"></option>';d.append(e),d.translation()}if(c&&c.Support){1===c.Num?h.$("#p_g_s_left").removeClass("ui-half-box"):2===c.Num&&h.$(".pla-db").removeClass("fn-hide");for(var f=0;f<c.Num;f++)h.$("#p_g_s_enable_"+f+"+span").attr("t","GB35114.VSP_GB28181").parent().translation();b&&(h.$(".pla-db-35114").removeClass("fn-hide"),a('[data-for="pla_gays_server"]').attr("t","GB35114.VSP_GAYS").parent().translation(),a('[data-for="pla_35114A"]').attr("t","GB35114.VSPCertManage").parent().translation())}j=0;var d=h.$("[sel-for=onSelectAlarm]");if(webApp.ALARM_IN_NUMBER<=0)d.parent().remove(),h.$("#p_g_s_chnNo2").parent().remove();else if(1===webApp.ALARM_IN_NUMBER)d.hide();else{d.empty();for(var e="",f=0;f<webApp.ALARM_IN_NUMBER;f++)e+="<option value=",e+=f,e+=' t="',e+="per.Alarm",e+="+",e+=f+1,e+='"></option>';d.append(e),d.translation()}h.$("#p_g_s_sipNo_0,#p_g_s_sipDom_0,#p_g_s_devNo_0,#p_g_s_pswd_0,#p_g_s_code_0,#p_g_s_id_0,#p_g_s_chnNo1_0,#p_g_s_chnNo3_0").textfield(),h.$("#p_g_s_sipNo_1,#p_g_s_sipDom_1,#p_g_s_devNo_1,#p_g_s_pswd_1,#p_g_s_code_1,#p_g_s_id_1,#p_g_s_chnNo1_1,#p_g_s_chnNo3_1").textfield(),webApp.GongAnDetect&&(h.$("#p_g_s_chnNo3_0,#p_g_s_chnNo3_1").parent().removeClass("fn-hide"),h.$("#audioOutInfo_0,#audioOutInfo_1").removeClass("fn-hide")),h.$("#p_g_s_chnNo2_0").textfield().blur(function(b){var c=a(b.target).attr("id").slice(-1)-0;i.sipServer[c].alarmInfo[j].id=h.$("#p_g_s_chnNo2_0").textfield("value")}),h.$("#p_g_s_chnNo2_1").textfield().blur(function(b){var c=a(b.target).attr("id").slice(-1)-0;i.sipServer[c].alarmInfo[j].id=h.$("#p_g_s_chnNo2_1").textfield("value")}),h.$("#p_g_s_sipPort_0,#p_g_s_localPort_0,#p_g_s_times_0,#p_g_s_sipPort_1,#p_g_s_localPort_1,#p_g_s_times_1").numberfield({max:65535,min:0,allowDecimal:!1,allowNegative:!1}),h.$("#p_g_s_life_0,#p_g_s_life_1").numberfield({max:3600,min:30,allowDecimal:!1,allowNegative:!1}),h.$("#p_g_s_beat_0,#p_g_s_beat_1").numberfield({max:3600,min:10,allowDecimal:!1,allowNegative:!1}),h.$("#p_g_s_sipIP_0,#p_g_s_sipIP_1").ipfield(),isEnable("is_show_disasterRecovery")&&(h.$(".disaster-recovery").removeClass("fn-hide"),h.$("#p_g_s_regFailTimes, #p_g_s_regInterval_0, #p_g_s_regInterval_1").numberfield({max:60,min:1,allowDecimal:!1,allowNegative:!1})),h.$("[check-left]").on("click",function(){var b=a(this).attr("check-left")-0;if(a(this).prop("checked"))if(a.each(h.$("[check-left]"),function(b,c){a(c).prop("checked",!1)}),a(this).attr("id").indexOf("35114")>-1){for(var c=0;c<n.length;c++)if(-1===m.indexOf(n[c]))return h.$("[check-left="+b+"]").prop("checked",!1),h.tip("error","pfm.NotFullyImportTip");h.$("[check-left="+b+"]").prop("checked",!0)}else h.$("[check-left="+b+"]").prop("checked",!0)}),h.$("[check-right]").on("click",function(){var b=a(this).attr("check-right")-0;if(a(this).prop("checked"))if(a.each(h.$("[check-right]"),function(b,c){a(c).prop("checked",!1)}),a(this).attr("id").indexOf("35114")>-1){for(var c=0;c<n.length;c++)if(-1===m.indexOf(n[c]))return h.$("[check-right="+b+"]").prop("checked",!1),h.tip("error","pfm.NotFullyImportTip");h.$("[check-right="+b+"]").prop("checked",!0)}else h.$("[check-right="+b+"]").prop("checked",!0)}),h.render()},leave:function(){c.Support&&2===c.Num&&jQuery("#main,body").removeClass("fn-minwid1600")},render:function(){c.Support&&2===c.Num&&jQuery("#main,body").addClass("fn-minwid1600"),this._getConfig()},_render:function(){if(c){for(var a=0;a<c.Num;a++){h.$("#p_g_s_devNo_"+a+",#p_g_s_sipNo_"+a).removeClass("fn-red"),h.$("#p_g_s_enable_"+a).prop("checked","GB28181"===i.sipServer[a].serverOption),h.$("#p_g_s_enable_35114_"+a).prop("checked","GB35114"===i.sipServer[a].serverOption),h.$("#p_g_s_sipNo_"+a).textfield("value",i.sipServer[a].sipSvrId),h.$("#p_g_s_sipDom_"+a).textfield("value",i.sipServer[a].domain),h.$("#p_g_s_sipIP_"+a).ipfield("value",i.sipServer[a].sipSvrIp),h.$("#p_g_s_sipPort_"+a).numberfield("value",i.sipServer[a].sipSvrPort),h.$("#p_g_s_devNo_"+a).textfield("value",i.sipServer[a].deviceId),h.$("#p_g_s_pswd_"+a).textfield("value",i.sipServer[a].password),h.$("#p_g_s_localPort_"+a).numberfield("value",i.sipServer[a].localSipPort),h.$("#p_g_s_life_"+a).numberfield("value",i.sipServer[a].sipRegExpires),h.$("#p_g_s_beat_"+a).numberfield("value",i.sipServer[a].keepAliveCircle),h.$("#p_g_s_times_"+a).numberfield("value",i.sipServer[a].maxTimeoutTimes),h.$("#p_g_s_code_"+a).textfield("value",i.sipServer[a].civilCode),h.$("#p_g_s_id_"+a).textfield("value",i.sipServer[a].intervideoID),h.$("#p_g_s_chnNo1_"+a).textfield("value",i.sipServer[a].channelInfo[l].id),i.sipServer[a].alarmInfo&&h.$("#p_g_s_chnNo2_"+a).textfield("value",i.sipServer[a].alarmInfo[j].id),h.$("#p_g_s_level1_"+a).val(i.sipServer[a].channelInfo[l].alarmLevel),webApp.GongAnDetect&&h.$("#p_g_s_chnNo3_"+a).textfield("value",i.sipServer[a].audioOutPutChnInfo[l].id),h.$("[sel-for=onSelectAlarm][double-index="+a+"]").val(j).change();for(var b=h.$("[sel-for=onSelectChannel]"),d="",e=0;e<i.sipServer[a].channelSum;e++)d+="<option value="+e+">"+(tl("med.Channel")+(e+1))+"</option>";b.empty().append(d).val(l),i.sipServer[a].channelSum>1&&b.removeClass("fn-hide"),isEnable("is_show_disasterRecovery")&&h.$("#p_g_s_regInterval_"+a).numberfield("value",i.sipServer[a].regInterval)}isEnable("is_show_disasterRecovery")&&h.$("#p_g_s_regFailTimes").numberfield("value",i.RegFailTimes)}},onSelectAlarm:function(a){j=h.$(a.target).val()-0,k=h.$(a.target).attr("double-index")-0,h.$("#p_g_s_chnNo2_"+k).textfield("value",i.sipServer[k].alarmInfo[j].id),h.$("[sel-for=onSelectAlarmLevel][double-index="+k+"]").val(i.sipServer[k].alarmInfo[j].alarmLevel)},onSelectAlarmLevel:function(a){k=h.$(a.target).attr("double-index"),i.sipServer[k].alarmInfo[j].alarmLevel=h.$(a.target).val()-0},onSelectChannel:function(a){k=h.$(a.target).attr("double-index"),i.channelInfo[l].id=h.$("#p_g_s_chnNo1_"+k).textfield("value"),i.channelInfo[l].alarmLevel=h.$("#p_g_s_level1_"+k).val()-0,l=h.$(a.target).val()-0,h.$("#p_g_s_chnNo1_"+k).textfield("value",i.channelInfo[l].id),h.$("#p_g_s_level1"+k).val(i.channelInfo[l].alarmLevel)},_getConfig:function(a){g.ConfigManager.getConfig("VSP_GAYS_SERVER").done(function(b){i=b,o=0,m=[],CertSNArr=[],h._findCertInfos(),h._render(),a&&h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},_findCertInfos:function(){g.DigitalCertificate.getCertsInfo(o,p).done(function(b){b&&b.params&&b.params.List&&(a.each(b.params.List,function(a,b){m.push(b.Type)}),b.params.List.length===p&&h._findCertInfos())})},onSave:function(){if(c){for(var a=0;a<c.Num;a++){var b=h.$("#p_g_s_devNo_"+a).val().length,d=h.$("#p_g_s_sipNo_"+a).val().length;if(6>b&&6>d)return h.$("#p_g_s_devNo_"+a+",#p_g_s_sipNo_"+a).addClass("fn-red"),void h.tip("warning","com.WrongLengthTip");if(6>b)return h.$("#p_g_s_devNo_"+a).addClass("fn-red"),void h.tip("warning","com.WrongLengthTip");if(6>d)return h.$("#p_g_s_sipNo_"+a).addClass("fn-red"),void h.tip("warning","com.WrongLengthTip");d>=6&&b>=6&&h.$("#p_g_s_devNo_"+a+",#p_g_s_sipNo_"+a).removeClass("fn-red"),i.sipServer[a].serverOption=h.$("#p_g_s_enable_"+a).prop("checked")?"GB28181":h.$("#p_g_s_enable_35114_"+a).prop("checked")?"GB35114":"Disable",i.sipServer[a].sipSvrId=h.$("#p_g_s_sipNo_"+a).textfield("value"),i.sipServer[a].domain=h.$("#p_g_s_sipDom_"+a).textfield("value"),i.sipServer[a].sipSvrIp=h.$("#p_g_s_sipIP_"+a).ipfield("value"),i.sipServer[a].sipSvrPort=h.$("#p_g_s_sipPort_"+a).numberfield("value"),i.sipServer[a].deviceId=h.$("#p_g_s_devNo_"+a).textfield("value"),i.sipServer[a].password=h.$("#p_g_s_pswd_"+a).textfield("value"),i.sipServer[a].localSipPort=h.$("#p_g_s_localPort_"+a).numberfield("value"),i.sipServer[a].sipRegExpires=h.$("#p_g_s_life_"+a).numberfield("value"),i.sipServer[a].keepAliveCircle=h.$("#p_g_s_beat_"+a).numberfield("value"),i.sipServer[a].maxTimeoutTimes=h.$("#p_g_s_times_"+a).numberfield("value"),i.sipServer[a].civilCode=h.$("#p_g_s_code_"+a).textfield("value"),i.sipServer[a].intervideoID=h.$("#p_g_s_id_"+a).textfield("value"),i.sipServer[a].channelInfo[l].id=h.$("#p_g_s_chnNo1_"+a).textfield("value"),i.sipServer[a].alarmInfo&&(i.sipServer[a].alarmInfo[l].id=h.$("#p_g_s_chnNo2_"+a).textfield("value")),i.sipServer[a].channelInfo[l].alarmLevel=h.$("#p_g_s_level1_"+a).val()-0,webApp.GongAnDetect&&(i.sipServer[a].audioOutPutChnInfo[l].id=h.$("#p_g_s_chnNo3_"+a).textfield("value")),isEnable("is_show_disasterRecovery")&&(i.sipServer[a].regInterval=h.$("#p_g_s_regInterval_"+a).numberfield("value"))}isEnable("is_show_disasterRecovery")&&(i.RegFailTimes=h.$("#p_g_s_regFailTimes").numberfield("value")),g.ConfigManager.setConfig("VSP_GAYS_SERVER",i).done(function(a){h.tip("success","com.SaveSuccessTip"),webApp.isNeedReboot(a)&&webApp.reboot("com.ConfEffectRestartTip")}).fail(function(){h.tip("error","com.SaveConfigFailTip")})}else h.tip("error","com.SaveConfigFailTip")},onRefresh:function(){this._getConfig(!0)},onDefault:function(){g.ConfigManager.getDefault("VSP_GAYS_SERVER").done(function(a){i=a,j=0,l=0,h._render(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.DefaultfailureTip")})}})}),define("pla_35114A",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("common/common"),g=(f.Check,null),h=[""],i=[""],j=[""],k=[""],l=[""],m={},n=!1,o=50,p=-1,q=[],r=[],s=null,t=!1,u=a.Deferred(),v="cer",w=["cer"],x=0,y={"0x11330021":"com.InsideError","0x11330022":"com.GetDevIDFailed","0x11330023":"pfm.CertFileInvalid","0x11330024":"pfm.CertSerialNoRepeat","0x11330025":"pfm.CertCNInvalid","0x11330026":"pfm.UnImportRootCert","0x11330027":"pfm.CertRevoked","0x11330028":"pfm.UnvailableCert","0x11330029":"pfm.CertSignMismatch","0x1133002A":"pfm.CertOverLimit","0x1133002B":"pfm.CErtFileNotFound",288555041:"com.InsideError",288555042:"com.GetDevIDFailed",288555043:"pfm.CertFileInvalid",288555044:"pfm.CertSerialNoRepeat",288555045:"pfm.CertCNInvalid",288555046:"pfm.UnImportRootCert",288555047:"pfm.CertRevoked",288555048:"pfm.UnvailableCert",288555049:"pfm.CertSignMismatch",288555050:"pfm.CertOverLimit",288555051:"pfm.CErtFileNotFound"};c.exports=e.extend({init:function(){s=this,u=d.MagicBox.getSerialNo(),s.$("#cert_path_localDevice, #cert_path_remoteDevice, #cert_path_rootCA, #cert_path_user,#cert_path_crl").textfield(),g=s.$("#pla_certTab").table({pageable:!0,pagesize:o,height:220,columns:[{t:"w_Numbers",width:"3%",render:function(a){return a._index+1}},{fields:"CertSN",t:"pfm.CertSefialNum",width:"16%"},{fields:"DeviceIdentifier",t:"com.DeviceIdentifier",width:"22%"},{t:"pfm.CertFunction",width:"23%",fields:"Type",render:function(a){return tl(a.Type)}},{fields:"EffectiveDate",t:"com.EffectiveDate",width:"14%",render:function(a){return s._toLocalTime(a.EffectiveDate)}},{fields:"ExpirationDate",t:"com.ExpirationDate",width:"14%",render:function(a){return s._toLocalTime(a.ExpirationDate)}},{t:"sto.Download",width:"4%",action:"download",render:function(){return'<a data-action="download" class="i-download"></a>'},handle:function(b,c){a(c.target);c.stopPropagation(),a("#ocx")[0]?plugin.GetDefaultConfigPath("Cert").done(function(){"CRL"===b.Type?(v="(*.crl)",w=["crl"]):(v="cacert (*.cer;*.pem;*.crt;*.der,*p7b)",w=["cer","pem","crt","der","p7b"]),plugin.ShowSaveOrOpenDlg("saveFile",b.DeviceIdentifier+"_"+b.Type,[{description:v,extensions:w}]).done(function(a){"CRL"===b.Type?d.DigitalCertificate.exportCRL(b.CertSN).done(function(b){if(b&&b.params&&b.params.CRL){var c=b.params.CRL;plugin.WriteBase64Data(a[1],c,"w+").done(function(a){-1===a?s.tip("error","sys.CloudUpgStateDownloadFailed"):s.tip("success","com.DownloadCompletelyTip")})}else s.tip("error","sys.CloudUpgStateDownloadFailed")}).fail(function(){s.tip("error","sys.CloudUpgStateDownloadFailed")}):d.DigitalCertificate.exportCert(b.CertSN).done(function(b){if(b&&b.params&&b.params.Cert){var c=b.params.Cert;plugin.WriteBase64Data(a[1],c,"w+").done(function(a){-1===a?s.tip("error","sys.CloudUpgStateDownloadFailed"):s.tip("success","com.DownloadCompletelyTip")})}else s.tip("error","sys.CloudUpgStateDownloadFailed")}).fail(function(){s.tip("error","sys.CloudUpgStateDownloadFailed")})})}):s.tip("error","com.NeedVideoOcx")}},{t:"Delete",action:"delete",icon:"ui-table-icon-del",handle:function(b){t?a.alert(tl("pfm.PleaseOffEnableThenDelCertTip")):a.confirm(tl("com.Info"),tl("pfm.CertWillDelWhetherContinueTip"),function(){"CRL"===b.Type?d.DigitalCertificate.deleteCRLs([b.CertSN]).done(function(){g.table("del",b),q.splice(b._index,1),r.splice(b._index,1),s.tip("success","com.DelectSuccessTip")}).fail(function(){s.tip("error","com.Deletefail")}):d.DigitalCertificate.deleteCert([b.CertSN]).done(function(){g.table("del",b),q.splice(b._index,1),r.splice(b._index,1),s.tip("success","com.DelectSuccessTip")}).fail(function(){s.tip("error","com.Deletefail")})},function(){},!0)}}],onRowSelect:function(){}}),s.render()},render:function(a){n=!1,q=[],r=[],p=-1,t=!1,g.table("dataSource",""),s._getConfig(a)},_getConfig:function(a){d.ConfigManager.getConfig("VSP_GAYS_SERVER").done(function(b){VSP_GB35114=b,s._renderElements(),s._findCertInfos(),a&&s.tip("success","Operateingsuccess")}).fail(function(){s._renderButton(),s.tip("error","Operateingfailure")})},_renderElements:function(){if(s._renderButton(),VSP_GB35114.sipServer)for(var a=0;a<VSP_GB35114.sipServer.length;a++)if("GB35114"===VSP_GB35114.sipServer[a].serverOption)return void(t=!0)},_findCertInfos:function(){p++,d.DigitalCertificate.getCertsInfo(p,o).done(function(b){b&&b.params&&b.params.List&&(g.table("dataSource",b.params.List),a.each(b.params.List,function(a,b){q.push(b.CertSN),r.push(b.Type)}),b.params.List.length===o&&s._findCertInfos())})},_toLocalTime:function(a){var b=a.split(" "),c=b[0].split("-"),d=b[1].split(":"),e=new Date(c[0]-0,c[1]-0,c[2]-0,d[0]-0,d[1]-0,d[2]-0),f=e.getTimezoneOffset();return e.addMonths(-1).addSeconds(60*-f),e.format()},onClear:function(){return q.length<1?s.tip("warning","pfm.CertificateNotAvailible"):void(t?a.alert(tl("pfm.PleaseOffEnableThenDelCertTip")):a.confirm(tl("com.Info"),tl("pfm.CertWillAllDelWhetherContinueTip"),function(){for(var a=[],b=[],c=r.length,e=0;c>e;e++)"CRL"===r[e]?a.push(q[e]):b.push(q[e]);a.length>0&&0===b.length?d.DigitalCertificate.deleteCRLs(a).done(function(){g.table("dataSource",""),q=[],r=[],s.tip("success","com.DelectSuccessTip")}).fail(function(){s.tip("error","com.Deletefail")}):b.length>0&&0===a.length?d.DigitalCertificate.deleteCert(b).done(function(){g.table("dataSource",""),q=[],r=[],s.tip("success","com.DelectSuccessTip")}).fail(function(){s.tip("error","com.Deletefail")}):a.length>0&&b.length>0&&(d.DigitalCertificate.deleteCRLs(a),d.DigitalCertificate.deleteCert(b).done(function(){g.table("dataSource",""),q=[],r=[],s.tip("success","com.DelectSuccessTip")}).fail(function(){s.tip("error","com.Deletefail")}))},function(){},!0))},onRefresh:function(){s.render(!0)},onCreatSave:function(){m.NetworkType=s.$("[sel-for=onNetworkType]").val(),m.Type="DataAuthCert",m.Form=0,n=!0,s._renderButton(),s.tip("success","com.CreateSuccess")},onRequestDownload:function(){a("#ocx")[0]?plugin.GetDefaultConfigPath("Cert").done(function(){u.done(function(a){var a=a.replace(/:/g,"_"),b=a+"_"+m.Type;plugin.ShowSaveOrOpenDlg("saveFile",b,[{description:"(*.csr)",extensions:["csr"]}]).done(function(a){d.DigitalCertificate.getCertReqInfo(m).done(function(b){var c=b.ReqInfo;plugin.WriteBase64Data(a[1],c,"w+").done(function(a){-1===a?s.tip("error","sys.CloudUpgStateDownloadFailed"):s.tip("success","com.DownloadCompletelyTip")})}).fail(function(){s.tip("error","sys.CloudUpgStateDownloadFailed")})})})}):s.tip("error","com.NeedVideoOcx")},_renderCertList:function(){p=-1,q=[],r=[],s._findCertInfos()},_renderButton:function(){n?(s.disabled("[btn-for=onRequestDownload]",!1),s.$("[btn-for=onRequestDownload]").removeClass("ui-button-disabled")):(s.disabled("[btn-for=onRequestDownload]",!0),s.$("[btn-for=onRequestDownload]").addClass("ui-button-disabled"))},onRootCACertSelect:function(){return a("#ocx")[0]?plugin.ShowSaveOrOpenDlg("openFile","",[{description:"cacert (*.pem;*.cer;*.crt;*.der,*p7b)",extensions:["pem","cer","crt","der","p7b"]}]).done(function(a){j[0]=a[1],s.$("#cert_path_rootCA").textfield("value",a[1])}):s.tip("error","com.NeedVideoOcx"),!1},onRootCACertUpload:function(){var b="CACert";a("#ocx")[0]?plugin.ReadBase64Data(j[0],x).done(function(a){var c=a;d.DigitalCertificate.importCert(b,c).done(function(){s._renderCertList(),s.tip("success","com.UpmoveSuccessTip")}).fail(function(a){s.tip("error",y[a.error.code]||"com.UpmoveFailTip")})}).fail(function(){s.tip("error","com.UpmoveFailTip")}):s.tip("error","com.NeedVideoOcx")},onLocalDeviceCertSelect:function(){return a("#ocx")[0]?plugin.ShowSaveOrOpenDlg("openFile","",[{description:"cacert (*.pem;*.cer;*.crt;*.der,*p7b)",extensions:["pem","cer","crt","der","p7b"]}]).done(function(a){h[0]=a[1],s.$("#cert_path_localDevice").textfield("value",a[1])}):s.tip("error","com.NeedVideoOcx"),!1},onLocalDeviceCertUpload:function(){var b="DataAuthCert";a("#ocx")[0]?plugin.ReadBase64Data(h[0],x).done(function(a){var c=a;d.DigitalCertificate.importCert(b,c).done(function(){s._renderCertList(),s.tip("success","com.UpmoveSuccessTip")}).fail(function(a){s.tip("error",y[a.error.code]||"com.UpmoveFailTip")})}).fail(function(){s.tip("error","com.UpmoveFailTip")}):s.tip("error","com.NeedVideoOcx")},onRemoteDeviceCertSelect:function(){return a("#ocx")[0]?plugin.ShowSaveOrOpenDlg("openFile","",[{description:"cacert (*.pem;*.cer;*.crt;*.der,*p7b)",extensions:["pem","cer","crt","der","p7b"]}]).done(function(a){i[0]=a[1],s.$("#cert_path_remoteDevice").textfield("value",a[1])}):s.tip("error","com.NeedVideoOcx"),!1},onRemoteDeviceCertUpload:function(){var b="RemoteDataAuthCert";a("#ocx")[0]?plugin.ReadBase64Data(i[0],x).done(function(a){var c=a;d.DigitalCertificate.importCert(b,c).done(function(){s._renderCertList(),s.tip("success","com.UpmoveSuccessTip")}).fail(function(a){s.tip("error",y[a.error.code]||"com.UpmoveFailTip")})}).fail(function(){s.tip("error","com.UpmoveFailTip")}):s.tip("error","com.NeedVideoOcx")},onUserCertSelect:function(){return a("#ocx")[0]?plugin.ShowSaveOrOpenDlg("openFile","",[{description:"cacert (*.pem;*.cer;*.crt;*.der,*p7b)",extensions:["pem","cer","crt","der","p7b"]}]).done(function(a){k[0]=a[1],s.$("#cert_path_user").textfield("value",a[1])}):s.tip("error","com.NeedVideoOcx"),!1},onUserCertUpload:function(){var b="AdminCert";a("#ocx")[0]?plugin.ReadBase64Data(k[0],x).done(function(a){var c=a;d.DigitalCertificate.importCert(b,c).done(function(){s._renderCertList(),s.tip("success","com.UpmoveSuccessTip")}).fail(function(a){s.tip("error",y[a.error.code]||"com.UpmoveFailTip")})}).fail(function(){s.tip("error","com.UpmoveFailTip")}):s.tip("error","com.NeedVideoOcx")},onCRLSelect:function(){return a("#ocx")[0]?plugin.ShowSaveOrOpenDlg("openFile","",[{description:"(*.crl)",extensions:["crl"]}]).done(function(a){l[0]=a[1],s.$("#cert_path_crl").textfield("value",a[1])}):s.tip("error","com.NeedVideoOcx"),!1},onCRLUpload:function(){a("#ocx")[0]?plugin.ReadBase64Data(l[0],x).done(function(a){var b=a;d.DigitalCertificate.importCRL(b).done(function(){s._renderCertList(),s.tip("success","com.UpmoveSuccessTip")}).fail(function(a){s.tip("error",y[a.error.code]||"com.UpmoveFailTip")})}).fail(function(){s.tip("error","com.UpmoveFailTip")}):s.tip("error","com.NeedVideoOcx")}})}),define("pla_hs",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=(require("common/common"),null),g=null,h="VSP_HS";c.exports=d.extend({init:function(){f=this,f.$("#p_h_srvIp").textfield(),webCaps.support_paas&&(h="VSP_PaaS"),e.MagicBox.getSerialNo().done(function(b){f.$("#p_h_sriNum").text(b),a.getScript("../jsBase/lib/qrcode.js",function(){e.MagicBox.getDeviceType().done(function(a){e.MagicBox.getSystemInfoNew().done(function(c){var d=c["2DCode"];c["2DCode"]?(f.$("#p_h_CodeContainer").removeClass("fn-hide"),f.$("#p_h_vrfCode").text(d),f.$("#p_h_qrCode").html(create_qrcode("{SN:"+b+",DT:"+a+",RC:"+d+"}"))):f.$("#p_h_qrCode").html(create_qrcode("{SN:"+b+",DT:"+a+"}"))})})})}),f.render()},render:function(){this._getConfig()},_render:function(){f.$("#p_h_enable").prop("checked",g.Enable),f.$("#p_h_srvIp").textfield("value",g.RsServerIP),f.$("#p_h_state").text(tl(g.Online?"itc.OnLine":"com.NotOnline")).removeClass().addClass(g.Online?"ui-tip-green":"ui-tip-red")},_getConfig:function(a){e.ConfigManager.getConfig(h).done(function(b){g=b,f._render(),a&&f.tip("success","com.OperateSuccessTip")}).fail(function(){f.tip("error","com.OperateFailTip")})},onSave:function(){g.Enable=f.$("#p_h_enable").prop("checked"),e.ConfigManager.setConfig(h,g).done(function(){f.tip("success","com.SaveSuccessTip")}).fail(function(){f.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){e.ConfigManager.getDefault(h).done(function(a){var b=g.Online;g=a,g.Online=b,f._render(),f.tip("success","com.DefaultSuccessTip")}).fail(function(){f.tip("error","com.DefaultfailureTip")})}})}),define("pla_P2P",function(require,b,c){var d,e=require("jsCore/rpc"),f=require("jsCore/pageBase"),g="T2UServer";c.exports=f.extend({init:function(){var b=this;webCaps.support_paas&&(g="VSP_PaaS"),a.getScript("../jsBase/lib/qrcode.js",function(){e.MagicBox.getSerialNo().done(function(a){a&&(b.$("#NP_SN").text(a),b.$("#NP_QR").html(create_qrcode(a)))})}),b.render()},render:function(){this._getConfig()},_getConfig:function(a){var b=this;e.ConfigManager.getConfig(g).done(function(c){d=c,b.$("#NP_T2UEnable").prop("checked",d.Enable),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","com.OperateSuccessTip")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")}),b._getStauts()},_getStauts:function(){var a=this;e.Nat.getTurnStatus().done(function(b){b.IsTurnChannel?a.$("#NP_Status").text(tl("itc.OnLine")).addClass("p2p_online"):a.$("#NP_Status").text(tl("com.NotOnline")).removeClass("p2p_online")})},onSave:function(){var a=this;return d.Enable=a.$("#NP_T2UEnable").prop("checked"),e.ConfigManager.setConfig(g,d).done(function(){a.tip("success","com.SaveSuccessTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")}),!1},onRefresh:function(){return this._getConfig(!0),!1},onDefault:function(){var a=this;return e.ConfigManager.getDefault(g).done(function(b){d=b,a.$("#NP_T2UEnable").prop("checked",d.Enable),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")}),a._getStauts(),!1}})}),define("pla_Onvif",function(require,a,b){var c,d=require("jsCore/rpc"),e=require("jsCore/pageBase");b.exports=e.extend({init:function(){var a=this;a.render()},render:function(){this._getConfig()},_render:function(a){this.$("input[name=ra_login][loginchk="+(a.OnvifLoginCheck?1:0)+"]").prop("checked",!0)},_getConfig:function(a){var b=this;d.ConfigManager.getConfig("UserGlobal").done(function(d){c=d||{},b._render(c),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","com.OperateSuccessTip")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","com.OperateFailTip")})},onSave:function(){var a=this;c.OnvifLoginCheck=Boolean(a.$("input[name=ra_login]:checked").attr("loginchk")-0),d.ConfigManager.setConfig("UserGlobal",c).done(function(){a.tip("success","com.SaveSuccessTip")}).fail(function(){a.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;d.ConfigManager.getDefault("UserGlobal").done(function(b){c=b||{},a._render(c),a.disabled("[btn-for=onSave]",!1),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","com.DefaultfailureTip")})}})}),define("pla_GAVI",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=null,g=null,h=0,i=0;c.exports=d.extend({init:function(){f=this,f.$("#GAVI_KeepAlive").numberfield({max:90,min:30,allowDecimal:!1,allowNegative:!1}),f.$("#GAVI_MaxTimeoutTimes").numberfield({max:10,min:1,allowDecimal:!1,allowNegative:!1}),f.$("#GAVI_Port").numberfield({max:65535,min:0,allowDecimal:!1,allowNegative:!1}),f.render()},render:function(){this._getConfig()},_render:function(){f.$("#GAVI_Enable").prop("checked",g.Enable),f.$("#GAVI_KeepAlive").val(g.KeepAlive),f.$("#GAVI_MaxTimeoutTimes").val(g.MaxTimeoutTimes);for(var a="",b=0;b<g.PlatformList.length;b++)a+="<option value="+g.PlatformList[b]+">"+g.PlatformList[b]+"</option>";f.$("#GAVI_Platform").empty().append(a);for(var c="",b=0;b<g.RegisterServer.length;b++)c+="<option value="+b+">"+(b+1)+"</option>";f.$("[sel-for=onSelectChannel]").empty().append(c).val(h).change()},_getConfig:function(a){e.ConfigManager.getConfig("VSP_GAVI").done(function(b){g=b,f._render(),a&&f.tip("success","com.OperateSuccessTip")}).fail(function(){a&&f.tip("error","com.OperateFailTip")})},onSelectGAVI_Platform:function(b){2==a(b.target).val()?(f.$("#GAVI_AccessKey").prop("disabled",!1).val(g.RegisterServer[h].AccessKey),f.$("#GAVI_SecretKey").prop("disabled",!1).val(g.RegisterServer[h].SecretKey)):(f.$("#GAVI_AccessKey").prop("disabled",!0).val(""),f.$("#GAVI_SecretKey").prop("disabled",!0).val(""))
},onSelectEncodeChannel:function(a){a.isTrigger||(g.RegisterServer[h].ChannelEncode[i]=f.$("#GAVI_Encode").val()),i=f.$(a.target).val()-0,f.$("#GAVI_Encode").val(g.RegisterServer[h].ChannelEncode[i])},onSelectChannel:function(a){a.isTrigger||f.saveElement(),h=f.$(a.target).val()-0,f.$("#GAVI_DeviceID").val(g.RegisterServer[h].DeviceID),f.$("#GAVI_Address").val(g.RegisterServer[h].Address),f.$("#GAVI_Port").val(g.RegisterServer[h].Port),f.$("#GAVI_UserId").val(g.RegisterServer[h].UserId),f.$("#GAVI_Password").val(g.RegisterServer[h].Password),f.$("#GAVI_ConnectionType").val(g.RegisterServer[h].ConnectionType),f.$("#GAVI_Protocol_http").prop("checked",!g.RegisterServer[h].Protocol),f.$("#GAVI_Protocol_https").prop("checked",!!g.RegisterServer[h].Protocol),f.$("#GAVI_Platform").val(g.RegisterServer[h].Platform),2===g.RegisterServer[h].Platform?(f.$("#GAVI_AccessKey").prop("disabled",!1).val(g.RegisterServer[h].AccessKey),f.$("#GAVI_SecretKey").prop("disabled",!1).val(g.RegisterServer[h].SecretKey)):(f.$("#GAVI_AccessKey").prop("disabled",!0).val(""),f.$("#GAVI_SecretKey").prop("disabled",!0).val(""));for(var b=f.$("[sel-for=onSelectEncodeChannel]"),c=g.RegisterServer[h].ChannelEncode.length,d="",e=0;c>e;e++)d+="<option value="+e+">"+(tl("med.Channel")+(e+1))+"</option>";b.empty().append(d).val(0).change(),b.toggleClass("fn-hide",1>=c)},saveElement:function(){g.RegisterServer[h].DeviceID=f.$("#GAVI_DeviceID").val(),g.RegisterServer[h].Address=f.$("#GAVI_Address").val(),g.RegisterServer[h].Port=f.$("#GAVI_Port").val()-0,g.RegisterServer[h].UserId=f.$("#GAVI_UserId").val(),g.RegisterServer[h].Password=f.$("#GAVI_Password").val(),g.RegisterServer[h].ConnectionType=f.$("#GAVI_ConnectionType").val(),g.RegisterServer[h].Protocol=f.$("#GAVI_Protocol_http").prop("checked")?0:1,g.RegisterServer[h].Platform=f.$("#GAVI_Platform").val()-0,g.RegisterServer[h].AccessKey=f.$("#GAVI_AccessKey").val(),g.RegisterServer[h].SecretKey=f.$("#GAVI_SecretKey").val(),g.RegisterServer[h].ChannelEncode[i]=f.$("#GAVI_Encode").val()},onSave:function(){g.Enable=f.$("#GAVI_Enable").prop("checked"),g.KeepAlive=f.$("#GAVI_KeepAlive").val()-0,g.MaxTimeoutTimes=f.$("#GAVI_MaxTimeoutTimes").val()-0,f.saveElement(),e.ConfigManager.setConfig("VSP_GAVI",g).done(function(){f.tip("success","com.SaveSuccessTip")}).fail(function(){f.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){e.ConfigManager.getDefault("VSP_GAVI").done(function(a){g=a,f._render(),f.tip("success","com.DefaultSuccessTip")}).fail(function(){f.tip("error","com.DefaultfailureTip")})}})}),define("pla_PlatformAccess",function(require,a,b){var c,d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=(require("common/common"),0);b.exports=d.extend({init:function(){me=this,me.$("#Preception_SIPServerIp").ipfield(),me.$("#Preception_port").numberfield({max:65535,min:0,allowDecimal:!1,allowNegative:!1}),me.render();var a={DH:"pfm.CityDataCenter",AH:"pfm.SituationalPlatform"};ability.get("SupportPreceptionPlatformAccess").then(function(b){for(var c=me.$("#Preception_Owner").empty(),d=0;d<b.length;d++)b[d].Support===!0&&c.append("<option value ="+b[d].Owner+">"+tl(a[b[d].Owner])+"</option>")})},render:function(){e.ConfigManager.getConfig("VSP_PreceptionPlatform").done(function(a){c=a||{};for(var b=0;b<c.length;b++)me.$("#Preception_Owner").val(c[0].Owner),"DH"==me.$("#Preception_Owner").val()?(me.$("#Preception_enable").prop("checked",c[0].Enable),me.$("#Preception_port").val(c[0].Port),me.$("#Preception_SIPServerIp").ipfield("value",c[0].IPAddress)):"AH"==me.$("#Preception_Owner").val()&&(me.$("#Preception_enable").prop("checked",c[0].Enable),me.$("#Preception_port").val(c[0].Port),me.$("#Preception_SIPServerIp").ipfield("value",c[0].IPAddress))}).fail(function(){})},_render:function(a){if("DH"==me.$("#Preception_Owner").val())for(var b=0;b<a.length;b++)me.$("#Preception_Owner").val()==a[b].Owner&&(me.$("#Preception_enable").prop("checked",a[b].Enable),me.$("#Preception_port").val(a[b].Port),me.$("#Preception_SIPServerIp").ipfield("value",a[b].IPAddress));else if("AH"==me.$("#Preception_Owner").val())for(var b=0;b<a.length;b++)me.$("#Preception_Owner").val()==a[b].Owner&&(me.$("#Preception_enable").prop("checked",a[b].Enable),me.$("#Preception_port").val(a[b].Port),me.$("#Preception_SIPServerIp").ipfield("value",a[b].IPAddress))},onChange:function(){for(var a=0;a<c.length;a++)"DH"==c[a].Owner?f=a:"AH"==c[a].Owner&&(ADmode=a);me.$("#Preception_Owner").val()==c[f].Owner?(c[ADmode].Enable=me.$("#Preception_enable").prop("checked"),c[ADmode].Port=me.$("#Preception_port").val()-0,c[ADmode].IPAddress=me.$("#Preception_SIPServerIp").ipfield("value"),me.$("#Preception_enable").prop("checked",c[f].Enable),me.$("#Preception_port").val(c[f].Port),me.$("#Preception_SIPServerIp").ipfield("value",c[f].IPAddress)):(c[f].Enable=me.$("#Preception_enable").prop("checked"),c[f].Port=me.$("#Preception_port").val()-0,c[f].IPAddress=me.$("#Preception_SIPServerIp").ipfield("value"),me.$("#Preception_enable").prop("checked",c[ADmode].Enable),me.$("#Preception_port").val(c[ADmode].Port),me.$("#Preception_SIPServerIp").ipfield("value",c[ADmode].IPAddress))},_getConfig:function(){e.ConfigManager.getConfig("VSP_PreceptionPlatform").done(function(a){c=a||{},me._render(c),me.tip("success","com.OperateSuccessTip")}).fail(function(){me.tip("error","com.OperateFailTip")})},onSave:function(){for(var a=0;a<c.length;a++)me.$("#Preception_Owner").val()==c[a].Owner&&(c[a].Enable=me.$("#Preception_enable").prop("checked"),c[a].Port=me.$("#Preception_port").val()-0,c[a].IPAddress=me.$("#Preception_SIPServerIp").ipfield("value"));e.ConfigManager.setConfig("VSP_PreceptionPlatform",c).done(function(){me.tip("success","com.SaveSuccessTip")}).fail(function(){me.tip("error","com.SaveConfigFailTip")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;e.ConfigManager.getDefault("VSP_PreceptionPlatform").done(function(b){c=b||{},a._render(c),a.tip("success","com.DefaultSuccessTip")}).fail(function(){a.tip("error","com.DefaultfailureTip")})}})}),define("pla_RTMP",function(require,b,c){var d,e,f=require("jsCore/pageBase"),g=require("jsCore/rpc"),h=(require("common/common"),null),i=null,j=0,k=0,l=null,m=!1;c.exports=f.extend({init:function(){i=this,i.render(),i.$("#server_port").numberfield({max:65535,min:0,allowDecimal:!1,allowNegative:!1}),i.$("#server_address").textfield({length:64,asciiByte:1,notAsciiByte:3}),i.$("#custom_address").textfield({length:255,asciiByte:1,notAsciiByte:3}),l=a.validator([{element:i.$("#server_address"),check:[function(a){return/^[\w\d\-\.]+$/.test(a||1)}],errorMsg:["com.EmailiperrorTip"],events:["keyup"]},{element:i.$("#custom_address"),check:[function(a){return/^[\w\d\-\.:\\\/]+$/.test(a||1)}],errorMsg:["com.EmailiperrorTip"],events:["keyup"]}]);var b=i.$("#RTMP_dialog").dialog({confirm:function(){b.dialog("close")}});i._bind()},render:function(){i._getConfig()},_render:function(a){i.$("#RTMP_Enable").prop("checked",a.Enable),i.$("#server_address").val(a.Address),i.$("#server_port").numberfield("value",a.Port);for(var b="Main",c=0;k>c;c++){var d=null;if(d=0==c?"Extra":"Extra"+(c+1),a[d][j].Enable){b=d;break}}i.$('[name="RTMP_stream_type"][value='+b+"]").prop("checked",!0),i.$('[name="RTMP_stream_type"][value='+b+"]").click(),i.$("#RTMP_stream_type").val(b).change()},_getConfig:function(a){function b(){g.ConfigManager.getConfig("Encode").done(function(a){d=a,g.Encode.getConfigCaps(0,d).done(function(a){e=a,k=e[j].ExtraFormat.length,m=!0,i.renderStreamType(k),c()}).fail(function(){i.tip("error","com.OperateFailTip")})}).fail(function(){i.tip("error","com.OperateFailTip")})}function c(){g.ConfigManager.getConfig("RTMP_NVR").done(function(b){h=b,a&&i.tip("success","com.OperateSuccessTip"),i._render(b)}).fail(function(){i.tip("error","com.OperateFailTip")})}m?c():b()},renderStreamType:function(a){function b(a,b,c){var d=['<label class="ui-checkbox '+(c&&"fn-padl20"||"")+'">','<input type="radio" name="RTMP_stream_type" value="'+a+'" id="RTMP_stream_type_'+a+'">',"<span>"+tl(b)+"</span>","</label>"].join("");return d}var c=i.$("#rtmp_stream_type_wrap");c.empty(),c.append('<label class="ui-label fn-padl20">'+tl("med.StreamType")+"</label>");for(var d=0;a+1>d;d++)c.append(0==d?b("Main","med.MainStream"):1==d?b("Extra","med.AuxiliaryStream"+d,!0):b("Extra"+d,"med.AuxiliaryStream"+d,!0))},onSave:function(){if(l.isInvalid())return i.tip("warning",tl(l.errors()[0].errorMsg));h.Enable=i.$("#RTMP_Enable").prop("checked"),h.Address=i.$("#server_address").val(),h.Port=i.$("#server_port").numberfield("value");var a=i.$('[name="RTMP_stream_type"]:checked').val(),b=i.$("#custom_address").val();i.clearURlAndEnable(),h[a][j].Enable=!0,i.$("#RTMP_address_type_on").prop("checked")&&b&&(h[a][j].Url=b),g.ConfigManager.setConfig("RTMP_NVR",h).done(function(){i.tip("success","com.SaveSuccessTip")}).fail(function(){i.tip("error","com.SaveConfigFailTip")})},onDefault:function(){i.$("#custom_address").val(""),g.ConfigManager.getDefault("RTMP_NVR").done(function(a){h=a,i._render(a),i.tip("success","com.DefaultSuccessTip")}).fail(function(){i.tip("error","com.DefaultfailureTip")})},onRefresh:function(){i._getConfig(!0)},selStreamType:function(){var a=i.$('[name="RTMP_stream_type"]:checked').val(),b=h[a][j];b.Url?(i.$("#custom_address").val(b.Url),i.$("#RTMP_address_type_on").click()):(i.$("#custom_address").val(""),i.$("#RTMP_address_type_off").click()),i.$("#rtmp_stream_type_wrap").attr("currentStream",a),l.validate()},_bind:function(){i.$('[name="RTMP_address_type"]').on("click",function(){"on"==i.$(this).val()?(i.$("#server_address").prop("disabled",!0),i.$("#server_port").prop("disabled",!0),i.$("#custom_address").prop("disabled",!1)):(i.$("#server_address").prop("disabled",!1),i.$("#server_port").prop("disabled",!1),i.$("#custom_address").prop("disabled",!0))}),i.$("#RTMP_Enable").on("click",function(){i.$(this).prop("checked")&&i.$("#RTMP_dialog").dialog("show")}),i.$("#rtmp_stream_type_wrap").on("click","[name=RTMP_stream_type]",function(a){i.$("#custom_address").val()&&!a.isTrigger&&(h[i.$("#rtmp_stream_type_wrap").attr("currentStream")][j].Url=i.$("#custom_address").val()),i.selStreamType()})},clearURlAndEnable:function(){h.Main[j].Enable=!1,h.Main[j].Url="";for(var a=0;k>a;a++){var b=null;b=0==a?"Extra":"Extra"+(a+1),h[b][j].Enable=!1,h[b][j].Url=""}}})})}(jQuery);