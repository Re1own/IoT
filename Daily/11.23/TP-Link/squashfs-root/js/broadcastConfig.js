!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab"),b.exports.prototype.ts=ability.get("SupportShowMultiTS").then(function(a){return a&&a.Support})}),define("broad",function(require,b,c){require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect");var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("common/common"),g=require("jsCore/plugin"),h=null,i=null,j=null,k=null,l=null,m={},n={},o=!1,p=0,q=0,r=1,s=null,t="Multicast",u=1;c.exports=e.extend({init:function(){h=this,i=h.$("[sel-for=onChangeES]"),j=h.$("#broad_MainPort"),a.when(ability.get("SupportMultiRTPDH"),ability.get("SupportShowMultiTS")).done(function(b,c){b&&(t="MultiRTPDH",q="Main",r="Extra1"),c&&c.Support&&a("[data-for='broad']").text("RTP")}),ability.is("ExtraConflict").done(function(a){if(webApp.MaxExtraStream<2)i.hide();else{i.show(),i.empty();for(var b=a?1:webApp.MaxExtraStream,c="MultiRTPDH"==t?"Extra":0,d=1;b>=d;d++)i.append('<option value="'+(c+d)+'" t="med.AuxiliaryStream+'+d+'"></option>');i.translation()}});var b=h.$("#broad_ES_Div");webApp.MaxExtraStream<1?b.hide():b.show(),h.$("#broad_MainPort,#broad_ExtraPort").numberfield({max:65500,min:1025,allowDecimal:!1,allowNegative:!1}),k=h.$("#broad_MainIP").ipfield({type:"ipBroad"}),l=h.$("#broad_ExtraIP").ipfield({type:"ipBroad"}),webApp.CHANNEL_NUMBER>1&&(h.$("#broad_channel").parent().removeClass("fn-hide"),h.$("#broad_channel").parent().next("div").removeClass("fn-hide"),$channel=a("#broad_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){p=b.ch,q=3*p,r=q+u,h._renderElements()}}),$channel.iconSelect("index",p)),h.render()},render:function(){r="MultiRTPDH"==t?"Extra1":1,webApp.MaxExtraStream>1&&h.$("[sel-for=onChangeES]").val(r),d.ConfigManager.getConfig([t,"DVRIP"]).done(function(b){m=b[0].params.table,DVRIP=b[1].params.table,"Multicast"==t?(s=m.RTP,n=a.extend(!0,[],s)):(s=m[p],n=a.extend(!0,{},s)),h._renderElements()})},_renderElements:function(a){a||(h.$("#broad_mainEnable").prop("checked",s[q].Enable),h.$("#broad_MainPort").numberfield("value",s[q].Port),k.ipfield("value",s[q].MulticastAddr)),h.$("#broad_exEnable").prop("checked",s[r].Enable),h.$("#broad_ExtraPort").numberfield("value",s[r].Port),l.ipfield("value",s[r].MulticastAddr)},onChangeES:function(){h._saveTempJson(),r=h.$("[sel-for=onChangeES]").val(),h._renderElements(!0)},_saveTempJson:function(){s[r].MulticastAddr=l.ipfield("value"),s[r].Port=h.$("#broad_ExtraPort").numberfield("value"),s[r].Enable=h.$("#broad_exEnable").is(":checked")},onDefault:function(){d.ConfigManager.getDefault(t).done(function(a){m=a,s="Multicast"==t?m.RTP:m[p],h._renderElements(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.DefaultfailureTip")})},onRefresh:function(){d.ConfigManager.getConfig(t).done(function(a){m=a,s="Multicast"==t?m.RTP:m[p],h._renderElements(),h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},onConfirm:function(){s[q].MulticastAddr=k.ipfield("value"),DVRIP.MCASTAddress=k.ipfield("value"),s[q].Port=h.$("#broad_MainPort").numberfield("value"),DVRIP.MCASTPort=h.$("#broad_MainPort").numberfield("value"),s[q].Enable=h.$("#broad_mainEnable").is(":checked"),h._saveTempJson(),o=!1;var b=!1,c=[];return a.each(s,function(a,d){if(!f.chkPort(d.Port))return h.tip("warning","com.PortInUseSavingFailure"),void(b=!0);(d.MulticastAddr!=n[a].MulticastAddr||d.Port!=n[a].Port)&&(o=!0);var e=d.MulticastAddr+"+"+d.Port;return d.Enable&&c.indexOf(e)>-1?(h.tip("warning","com.MulticastportConflictTip"),void(b=!0)):void(d.Enable&&c.push(e))}),b?!1:void d.ConfigManager.setConfig([t,"DVRIP"],[m,DVRIP]).done(function(a){f.chkMutilCallRet(a)?(h.tip("success","com.SaveSuccessTip"),o&&setTimeout(function(){g.Reload()},3e3)):h.tip("error","com.SaveConfigFailTip")})}})}),define("ts",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("common/common"),g=require("jsCore/plugin"),h=null,i=null,j=null,k=null,l=null,m={},n=!1,o=1,p=0;c.exports=e.extend({init:function(){h=this,$ts_ES=h.$("[sel-for=onTsChangeES]"),ability.is("ExtraConflict").done(function(a){if(webApp.MaxExtraStream<2)$ts_ES.hide();else{$ts_ES.show(),$ts_ES.empty();for(var b=a?1:webApp.MaxExtraStream,c=0,d=1;b>=d;d++)$ts_ES.append('<option value="'+(c+d)+'" t="med.AuxiliaryStream'+d+'"></option>');$ts_ES.translation()}}),h.$("#ts_MainPort,#ts_ExtraPort").numberfield({max:65500,min:1025,allowDecimal:!1,allowNegative:!1}),i=h.$("#ts_MainIP").ipfield({type:"ipBroad"}),j=h.$("#ts_ExtraIP").ipfield({type:"ipBroad"}),h.render()},render:function(){d.ConfigManager.getConfig("Multicast").done(function(b){k=b,l=k.TS,m=a.extend(!0,[],l),h._renderElements()})},_renderElements:function(a){a||(h.$("#ts_mainEnable").prop("checked",l[p].Enable),h.$("#ts_MainPort").numberfield("value",l[p].Port),i.ipfield("value",l[p].MulticastAddr)),h.$("#ts_exEnable").prop("checked",l[o].Enable),h.$("#ts_ExtraPort").numberfield("value",l[o].Port),j.ipfield("value",l[o].MulticastAddr)},onTsChangeES:function(){h._saveTempJson(),o=h.$("[sel-for=onTsChangeES]").val(),h._renderElements(!0)},_saveTempJson:function(){l[o].MulticastAddr=j.ipfield("value"),l[o].Port=h.$("#ts_ExtraPort").numberfield("value"),l[o].Enable=h.$("#ts_exEnable").is(":checked")},onDefault:function(){d.ConfigManager.getDefault("Multicast").done(function(a){k=a,l=k.TS,h._renderElements(),h.tip("success","com.DefaultSuccessTip")}).fail(function(){h.tip("error","com.DefaultfailureTip")})},onRefresh:function(){d.ConfigManager.getConfig("Multicast").done(function(a){k=a,l=k.TS,h._renderElements(),h.tip("success","com.OperateSuccessTip")}).fail(function(){h.tip("error","com.OperateFailTip")})},onConfirm:function(){l[p].MulticastAddr=i.ipfield("value"),l[p].Port=h.$("#ts_MainPort").numberfield("value"),l[p].Enable=h.$("#ts_mainEnable").is(":checked"),h._saveTempJson(),n=!1;var b=!1;webApp.CHANNEL_NUMBER>1&&a.each(l,function(a){"Main"==l[a].StreamType&&(l[a].Enable=h.$("#ts_mainEnable").is(":checked")),"Extra1"==l[a].StreamType&&(l[a].Enable=h.$("#ts_exEnable").is(":checked"))});var c=[];return a.each(l,function(a,d){if(!f.chkPort(d.Port))return h.tip("warning","com.PortInUseSavingFailure"),void(b=!0);(d.MulticastAddr!=m[a].MulticastAddr||d.Port!=m[a].Port)&&(n=!0);var e=d.MulticastAddr+"+"+d.Port;return d.Enable&&c.indexOf(e)>-1?(h.tip("warning","com.MulticastportConflictTip"),void(b=!0)):void(d.Enable&&c.push(e))}),b?!1:void d.ConfigManager.setConfig("Multicast",k).done(function(a){f.chkMutilCallRet(a)?(h.tip("success","com.SaveSuccessTip"),n&&setTimeout(function(){g.Reload()},3e3)):h.tip("error","com.SaveConfigFailTip")})}})})}(jQuery);