!function(a){define(function(require,b,c){function d(){s.chkAuthority("Alarm")&&webApp.ALARM_OUT_NUMBER&&(eb=setInterval((e(),e),5e3)),A._getCoaCaps&&(fb=setInterval((A._getCoaCaps(),A._getCoaCaps),5e3))}function e(){p.Alarm.getOutState().done(function(a){for(var b=0;b<webApp.ALARM_OUT_NUMBER;b++)a&1<<b?A.$("#pre_alarm_wrap [data-index="+b+"]").addClass("current"):A.$("#pre_alarm_wrap [data-index="+b+"]").removeClass("current")})}function f(){clearInterval(eb),eb=null,clearInterval(fb),fb=null}function g(){h(),"Original Rate"===webApp.DisplayMode&&setTimeout(h,100)}function h(){var b=10,c=Math.max(document.documentElement.clientWidth-45),d=A.$(".main-right-container").width()||-10,e=A.$(".main-left-container").width()||0,f=A.$(".main-bottom").width()||c,g=A.$(".main-right-container").parent(),h=A.$(".main-bottom-container").height()||-4,i=A.$(".main-middle-container").height()||-b,j=f-b-d-e,k=Math.max(document.documentElement.clientHeight-56-54-33-b-i,390-b-i),l=Math.max(document.documentElement.clientHeight-56-54-33-h,390-h),m=k+i+b+24,n=webApp.DisplayMode;switch(E.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode&&(n="sys.AdaptedWindow"),E.videoBar("hasItem","video_fisheye")&&"Original Rate"==webApp.DisplayMode&&(n="sys.AdaptedWindow"),E.videoBar("hasItem","video_triggerVRTrack")&&"Original Rate"==webApp.DisplayMode&&(n="sys.AdaptedWindow"),n){case"Original Size":webApp.resolution.x&&webApp.resolution.y&&("nacl"!==q.type||j>=webApp.resolution.x)&&2!==webApp.CamType&&(j=webApp.resolution.x,k=webApp.resolution.y),g.css({width:j+b+d+e,margin:"0 auto"});break;default:g.css({width:f,margin:"0"})}return A.$(".main-video-container").css({width:j+b+d,left:e}),X&&(k=l),D.css({width:j,height:k}),D.css("h5"===webApp.playMode?{"background-color":"#000"}:{background:"inherit"}),-1!==webApp.DeviceType.indexOf("TPC")&&G&&G.temperReport("resize"),E.videoBar("isCurrent","video_face")&&(A.$(".main-right-container,.main-left-container").css("height",m),A.$(".main-face-feature").faceFeature("resize"),W&&A.$(".main-face-analysis").faceAnalysis("resize")),E.videoBar("isCurrent","video_traffic")&&(A.$(".main-right-container").css("height",m),A.$(".main-traffic").traffic("resize")),E.css("width",j),a(".main-bottom-container, .main-middle-container").css("width",j),E.videoBar("isCurrent","video_object")&&(A.$(".main-right-container").css("height",m),db&&A.$(".main-object-NonMotor").objectNonMotor("resize"),A.$(".main-traffic").traffic("resize")),webApp.hide_by_dialog||("hls"==webApp.playMode?u.cover(D):"flash"==webApp.playMode?v.cover(D):"h5"==webApp.playMode?w.cover(D):q.cover(D)),document.documentElement.clientHeight-56-54-A.$(".main-right-container").height()-33<70?a(".main-ptz-status").css("top",110+A.$(".main-right-container").height()-33):a(".main-ptz-status").css("top",""),"flash"!==webApp.playMode&&"h5"!==webApp.playMode||!_||t.resize("#preview_video"),!1}function i(){p.ConfigManager.getConfig(["Encode","EncodeEncrypt"]).done(function(a){var b=a[0].result&&a[0].params.table[0].MainFormat[0].Video,c=a[1].result&&a[1].params.table[0][0];return"SVAC"===b.Compression&&(c.EncryptEnable&&q.SetDecodeKey(c.Key),b.SVCTLayer-1)?(E.videoBar("hideItem","video_svac",!1),void q.ChooseFrame(E.videoBar("isCurrent","video_svac",1)?1:0)):(E.videoBar("hideItem","video_svac",!0),void q.ChooseFrame(0))})}function j(a){q.SetVisibleVideoWnd(webApp.CHANNEL_NUMBER,0),webApp.CHANNEL_NUMBER>1?(s.chkAuthority("Monitor_01")&&s.chkAuthority("Monitor_02")&&q.open(a,0,2),!s.chkAuthority("Monitor_01")&&s.chkAuthority("Monitor_02")&&(q.open(a,1,1),q.SetVideoWndTip(0,tl("noVideoAuthoity"))),s.chkAuthority("Monitor_01")&&!s.chkAuthority("Monitor_02")&&(q.open(a,0,1),q.SetVideoWndTip(1,tl("noVideoAuthoity"))),s.chkAuthority("Monitor_01")||s.chkAuthority("Monitor_02")||(q.SetVideoWndTip(0,tl("noVideoAuthoity")),q.SetVideoWndTip(1,tl("noVideoAuthoity")))):s.chkAuthority("Monitor_01")?q.open(a,0,1):q.SetVideoWndTip(0,tl("noVideoAuthoity"))}function k(){a.when(r.get("AudioInputCaps"),p.ConfigManager.getConfig("AudioInput")).done(function(a,b){var c=b[0].AudioSource;"LineIn"==c&&a.LineIn<2||"Mic"==c&&a.Mic<2?A.$("[btn-for=onVoice2]").hide():A.$("[btn-for=onVoice2]").show()})}function l(){webCaps.Anonymous||(N=(N+1)%65536,p.PTZ.attachStatusProc(C,N).done(function(){common.devNotify.subscribe("client.notifyPtzStream",n),O=!0}))}function m(){O&&(webCaps.Anonymous||p.PTZ.detachStatusProc(C,N))}function n(a){var b=a.status;null!=b.PresetID&&b.PresetID>=1&&b.PresetStatus&&"Reach"==b.PresetStatus&&b.PresetID!==M&&(webApp.PresetID=b.PresetID,G.temperReport("render"))}var o=require("common/common"),p=require("jsCore/rpc"),q=require("jsCore/plugin"),r=require("jsCore/ability"),s=(require("common/common").Cookie,require("jsCore/rpcLogin")),t=require("jsCore/pluginCanvas"),u=require("jsCore/hlsplayer"),v=require("jsCore/flashplayer"),w=require("jsCore/h5player"),x=require("jsCore/pageBase");require("jsCore/modules/ptzControl"),require("jsCore/modules/ptzSetting"),require("jsCore/modules/zoomFocus"),require("jsCore/modules/videoBar"),require("jsCore/modules/imageAdjust"),require("jsCore/modules/triggerTrack"),require("jsCore/modules/triggerVRTrack"),require("jsCore/modules/zoomFocus");var y,z,A=null,B=".preview",C=0,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=0,O=!1,P=!1,Q=!1,R=0,S=null,T=!0,U=1,V=!0,W=!1,X=!1,Y=null,Z=!1,$=null,_=!1,ab=!1,bb=1,cb=!1,db=!1;c.exports=x.extend({init:function(){$=a.Deferred(),A=this,a("body").on("mousedown",function(){a.publish("win.active")}),q.addEvent("ReturnWindInfo",function(){a.publish("ocx.active")}),a.subscribe("SessionInvalid",function(){p.DevIntelliTracker.start(),q.addEvent("ReturnWindInfo",null),a("body").off("mousedown").one("mousedown",function(){"flash"===webApp.playMode&&(v.hide(),t.hide()),"h5"===webApp.playMode&&(w.hide(),t.hide()),a(".u-dialog:visible").dialog("close"),setTimeout(function(){q.close(),q.hide(),$logoutDialog.dialog("show")},0),webApp.hide_by_dialog=!0})}),global.supportHls()&&"nacl"!=q.type&&(A.$("#pre_playType_container").removeClass("fn-hide").find("#pre_playType_select").append('<option value="hls">HLS</option>'),u&&u.init("","",p.getSession()),webApp.playMode="hls"),global.supportFlash()&&"nacl"!=q.type&&(webApp.playMode="flash",A.$("#pre_playType_container").remove()),global.supportH5Player()&&"nacl"!=q.type&&(webApp.playMode="h5",A.$("#pre_playType_container").remove(),w&&w.init());var b=setInterval(function(){q.type&&(clearInterval(b),-1!==webApp.DeviceType.indexOf("SD")&&-1===webApp.DeviceType.indexOf("TPC")?(q.FaceShowMode(1),r.get("SDFaceDetect").done(function(a){a&&a.FaceShowMode&&q.FaceShowMode(a.FaceShowMode)})):r.get("FaceDetection").done(function(a){a&&a.FaceShowMode&&q.FaceShowMode(a.FaceShowMode)}))},1e3);r.get("IOCaps").done(function(a){if(a){var b=a.caps.SupportControlLight,c=a.caps.SupportControlSpeaker;1===c?A.$("[btn-for=onSpeakerWhite]:eq(0)").show():A.$("[btn-for=onSpeakerWhite]:eq(0)").remove(),1===b?A.$('[btn-for="onSpeakerWhite"]:eq(1)').show():A.$('[btn-for="onSpeakerWhite"]:eq(1)').remove(),1!==c&&1!==b&&(A._getCoaCaps=null)}else A._getCoaCaps=null}),D=A.$(".main-video"),E=A.$(".ui-video-bar").videoBar(),S=A.$("#pre_playType_select");var c=[];-1!==webApp.DeviceType.indexOf("TPC")?(c.push(a.Deferred(function(a){require.async(["jsCore/modules/tpcLocalFocus","jsCore/modules/tpcTracker"],function(){I=A.$(".main-report-container").tpcLocalFocus(),J=A.$(".main-report-container").tpcTracker(),a.resolve()})})),A.$("[sel-for=onChangeResolute]").remove(),A.$("[btn-for=onCutResolute]").remove(),r.get("RadioMetry").done(function(b){b&&b.Support&&(X=!0,c.push(a.Deferred(function(a){require.async(["jsCore/modules/temperReport","jsCore/modules/curTemper"],function(){G=A.$(".main-report-container").temperReport({presetReal:webApp.PresetID}),H=A.$(".main-report-container").curTemper(),a.resolve()})})),-1!==webApp.DeviceType.indexOf("SD")&&l())}),r.get("MeasureDistance").done(function(b){P=b&&b.Support&&"Laser"===b.Type&&2===isEnable("is_show_MeasureDistance"),P?c.push(a.Deferred(function(a){require.async("jsCore/modules/ptzDistance",function(){L=A.$(".main-ptz-distance").show().ptzDistance(),A.$(".main-ptz-distance [btn-for=onRun]").on("click",function(){E.videoBar("isCurrent","video_rayright")&&E.videoBar("toggleCurrent","video_rayright"),E.videoBar("hideItem","video_rayright",!0),L.ptzDistance("onRun")}),A.$(".main-ptz-distance [btn-for=onClose]").on("click",function(){E.videoBar("hideItem","video_rayright",!1),L.ptzDistance("onClose")}),a.resolve()})})):A.$(".main-ptz-distance").remove()})):(c.push(a.Deferred(function(a){r.get("VideoInputCaps").done(function(b){b&&b.FishEye?require.async("jsCore/modules/fishEye",function(){A.$(".main-fisheye").fishEye({closeIVS:function(){E.videoBar("isCurrent","video_ivsRule",0)&&(q.SetIVSEnable(!1),E.videoBar("hideItem","video_ivsRule",!0))},openIVS:function(){E.videoBar("isCurrent","video_ivsRule",0)&&(q.SetIVSEnable(!0),E.videoBar("hideItem","video_ivsRule",!1))},pluginMode:function(){E.videoBar("hideItem","video_fisheye",!1),E.videoBar("isCurrent","video_fisheye")&&A.$(".main-fisheye").show(),A.$("#video_ivsRule").parent("div").show()},chipMode:function(){E.videoBar("hideItem","video_fisheye",!0),A.$(".main-fisheye").hide(),A.$("#video_ivsRule").parent("div").hide()}}),a.resolve()}):a.resolve()})})),c.push(a.Deferred(function(b){a.when(r.get("IVSCaps"),r.is("DSPConflict")).done(function(c,d){if(c&&!d){W=(webApp.IsIPCIntel||webApp.IsSDIntel)&&-1!==a.inArray("FaceAnalysis",c.SupportedScene);var e=-1!==a.inArray("FaceDetection",c.SupportedScene)&&c.SupportedScenes.FaceDetection.SupportedRules.FaceDetection.FeatureSupport,f=-1!==a.inArray("Gate",c.SupportedScene),g=-1!==a.inArray("ObjectDetect",c.SupportedScene),h=[];e&&h.push("jsCore/modules/faceFeature"),W&&h.push("jsCore/modules/faceFeature","jsCore/modules/faceAnalysis"),f&&h.push("jsCore/modules/traffic"),g&&(h.push("jsCore/modules/traffic"),h.push("jsCore/modules/objectNonMotor")),h.length?require.async(h,function(){if((e||W)&&A.$(".main-face-feature").faceFeature({video:D}),W&&A.$(".main-face-analysis").faceAnalysis({video:D}),f&&A.$(".main-traffic").traffic({video:D}),g){A.$(".main-traffic").traffic({video:D});var a=c.SupportedScenes.ObjectDetect.SupportedRules;(a.NonMotorDetect||a.HumanTrait)&&(db=!0,A.$(".main-object-NonMotor").objectNonMotor({video:D}))}b.resolve()}):b.resolve()}else b.resolve()})}))),p.ConfigManager.getConfig("SmartEncode").done(function(a){a&&a.Enable&&E.videoBar("hideItem","video_ivsRule",!0)}),a.when.apply(null,c).done(function(){K=A.$(".main-image-adjust").imageAdjust(),A.$(".main-zoom-focus").zoomFocus("flash"===webApp.playMode||"h5"===webApp.playMode?{type:"preview",noPlugin:!0}:{type:"preview"}),A.$(".main-trigger-track").triggerTrack(),A.$(".main-trigger-VRtrack").triggerVRTrack(),r.is("ExtraConflict").done(function(a){var b=webApp.MaxExtraStream;a&&b>1&&(b=1),b>1&&A.$("[btn-for=onConnectExtra][index=1]").attr("t","med.AuxiliaryStream1").text(tl("med.AuxiliaryStream1"));for(var c=1;b>=c;c++)A.$("[btn-for=onConnectExtra][index="+c+"]").show()}),webApp.GongAnDetect&&(A.$("[btn-for=onConnectExtra][index=3]").show(),A.$("[btn-for=onConnectExtra][index=4]").show());var b=A.$("#pre_type").empty().append('<option value="0">TCP</option>').off("change").on("change",A.onTypeChange);q.CheckFuncSupport(0).done(function(a){a&&b.append('<option value="4">UDP</option>')}),q.CheckFuncSupport(1).done(function(c){if(c){var d="3";a.when(r.get("SupportMultiRTPDH"),r.get("SupportShowMultiTS")).done(function(a,c){a&&(d="5"),c&&c.Support?b.append("<option value="+d+' t="com.RTP"></option>').translation():b.append("<option value="+d+' t="net.Multicast"></option>').translation()})}}),r.get("SupportDHTSforRTSP").done(function(a){a&&a.Support&&b.append('<option value="6">DHTS</option>')}),""!==q.type&&A.$("a[btn-for=onConnectMain]").addClass("current last"),i(),A._initButtons(),r.get("PtzDirectionCalibration").done(function(a){a&&a.Support&&-1===webApp.DeviceType.indexOf("TPC")&&A.$("#b_dirAdjust").removeClass("fn-hide")}),r.get("AudioTalkMode").done(function(a){isHalf=a&&a[0],isHalf&&"Half"===isHalf&&(A.$("[btn-for=onTalk]").unbind("click"),A.$("#speakbut").off("mousedown"),A.$("#speakbut").off("mouseup"),A.$("#speakbut").off("mouseout"),A.$("#speakbut").on({mousedown:function(){A.$("[btn-for=onTalk]").hasClass("current")||(q.SetTalkFromDeviceEnable(!1),q.controlTalking(A.$("[btn-for=onTalk]")).then(function(a){a&&(A.$("[btn-for=onVoice]").hasClass("current")&&(q.state("dualAudioEnable1",!1),A.$("[btn-for=onVoice]").addClass("stopVoice")),A.$("[btn-for=onTalk]").addClass("current"))}))},mouseup:function(){A.$("[btn-for=onTalk]").hasClass("current")&&q.controlTalking(A.$("[btn-for=onTalk]")).then(function(a){a&&(A.$("[btn-for=onTalk]").removeClass("current"),A.$("[btn-for=onVoice]").hasClass("stopVoice")&&window.setTimeout(function(){q.state("dualAudioEnable1",!0),A.$("[btn-for=onVoice]").removeClass("stopVoice")},500))})},mouseout:function(){A.$("[btn-for=onTalk]").hasClass("current")&&q.controlTalking(A.$("[btn-for=onTalk]")).then(function(a){a&&(A.$("[btn-for=onTalk]").removeClass("current"),A.$("[btn-for=onVoice]").hasClass("stopVoice")&&window.setTimeout(function(){q.state("dualAudioEnable1",!0),A.$("[btn-for=onVoice]").removeClass("stopVoice")},500))})}}))}),a.when(r.get("VideoInputCaps"),r.get("AutoFocus"),r.get("AutoFocusButtonVisible"),r.get("AutoFocusButtonThermal"),r.get("PTZCaps")).then(function(a,b,c,d,e){if(-1!==webApp.DeviceType.indexOf("TPC")&&-1===webApp.DeviceType.indexOf("SD")&&0==webCaps.Anonymous&&(1===webApp.CHANNEL_NUMBER&&d&&d.Support?Q=!0:webApp.CHANNEL_NUMBER>1&&1!==webApp.CamType&&webCaps.Anonymous===!1&&(Q=!0)),s.chkAuthority("MPTZ")&&webApp.HasPtz&&-1!==webApp.DeviceType.indexOf("SD")||Q||webApp.isSpecialPtz){var f={ptzJoystick:!0,autoFocus:!(!c||!c.Support)||!(!d||!d.Support)||b,isPtzLocate:-1!==webApp.DeviceType.indexOf("TPC")||-1!==webApp.DeviceType.indexOf("SD")||webApp.isSpecialPtz,isLaserDistMeasure:!1,channel:q.windowId};webApp.isSpecialPtz&&(f.ptzJoystick=!1),Q&&(f.ptzJoystick=!1,f.showDirction=!1,f.showStep=!1,f.title=!0),(null===e.Move||e.Move&&-1===e.Move.indexOf("Directly"))&&(f.isPtzLocate=!1),F=A.$(".main-ptz-control").ptzControl(f)}A.render(),s.chkAuthority("MPTZ")&&webApp.HasPtz&&-1!==webApp.DeviceType.indexOf("SD")&&E.videoBar("toggleCurrent","video_ptz"),Q&&E.videoBar("toggleCurrent","video_adjust"),a&&a.FishEye&&E.videoBar("toggleCurrent","video_fisheye"),$.resolve(),gb.init()})}),r.get("SupportCloudUpgrade").done(function(b){webApp.CloudUpgrade=b,p.CloudUpgrader.getAutoCheck().done(function(b){webApp.CloudAutoCheck=b.flag,b&&b.flag&&p.CloudUpgrader.check(2).done(function(b){webApp.CloudUpgraderInfo=b.info,"None"!==b.info.State&&a("[data-for=set]").addClass("noted")})})}),r.get("IntelliFrameCaps").done(function(a){Y=a}),r.get("ShowPtzMoveStatus").done(function(a){a&&a.Support&&(Z=!0)}),p.PTZ.getCurrentProtocolCaps().done(function(a){a.SupportPointFocus&&a.SupportPointFocus.Support&&(cb=!0)})},_initButtons:function(){var b=A.$("#pre_alarm_wrap").empty().off("click").on("click",function(a){var b=A.$(a.target),c=b.data("index");p.ConfigManager.getConfig("AlarmOut").done(function(a){b.hasClass("current")?(b.removeClass("current"),1==a[c].Mode?(a[c].Mode=0,p.ConfigManager.setConfig("AlarmOut",a)):(a[c].Mode=1,p.ConfigManager.setConfig("AlarmOut",a).done(function(){a[c].Mode=0,p.ConfigManager.setConfig("AlarmOut",a)}))):(b.addClass("current"),a[c].Mode=1,p.ConfigManager.setConfig("AlarmOut",a))})});if(s.chkAuthority("Alarm")&&webApp.ALARM_OUT_NUMBER){if(1===webApp.ALARM_OUT_NUMBER)b.append('<a class="main-top-icon-alarm" href="javascript:;" data-index="0" hidefocus="true" t="title::per.AlarmOutput"></a>');else for(var c=webApp.ALARM_OUT_NUMBER;c>0;c--)b.append('<a class="main-top-icon-alarm" href="javascript:;" data-index="'+(c-1)+'" hidefocus="true" t="title::per.AlarmOutput+'+c+'"></a>');b.translation()}0===webApp.AUDIO_IN_NUMBER||0===webApp.AUDIO_OUT_NUMBER||"hls"===webApp.playMode||"flash"===webApp.playMode||"h5"===webApp.playMode?A.$("[btn-for=onTalk]").remove():A.$("[btn-for=onTalk]").show(),0===webApp.AUDIO_IN_NUMBER||"hls"===webApp.playMode||"flash"===webApp.playMode?A.$("[btn-for=onVoice],[btn-for=onVoice1],[btn-for=onVoice2]").remove():1===webApp.AUDIO_IN_NUMBER?(A.$("[btn-for=onVoice]").show(),A.$("[btn-for=onVoice1],[btn-for=onVoice2]").remove()):2===webApp.AUDIO_IN_NUMBER&&("h5"===webApp.playMode?(A.$("[btn-for=onVoice1]").show(),A.$("[btn-for=onVoice], [btn-for=onVoice2]").remove()):(A.$("[btn-for=onVoice1],[btn-for=onVoice2]").show(),A.$("[btn-for=onVoice]").remove())),"hls"===webApp.playMode||"flash"===webApp.playMode||"h5"===webApp.playMode?(A.$("[btn-for=onEnlarged]").remove(),A.$("[btn-for=onSnap3]").remove(),A.$("[btn-for=onSetAF]").remove(),A.$("[btn-for=onRecord]").remove()):(A.$("[btn-for=onEnlarged]").show(),A.$("[btn-for=onSnap3]").show(),A.$("[btn-for=onSetAF]").show(),A.$("[btn-for=onRecord]").show()),r.get("VideoInputCaps").done(function(a){a&&a.AutofocusPeak&&"h5"!==webApp.playMode?A.$("[btn-for=onSetAF]").show():A.$("[btn-for=onSetAF]").remove()}),r.get("IntelliTracker").done(function(a){-1===webApp.DeviceType.indexOf("IPC")&&a&&a.Support?A.$("[btn-for=onTrackObject]").show():A.$("[btn-for=onTrackObject]").remove()}),r.get("PTZCaps").done(function(a){a&&a.SupportRegionFocus&&-1!==webApp.DeviceType.indexOf("SD")?A.$("[btn-for=onRegionFocus]").show():A.$("[btn-for=onRegionFocus]").remove(),a&&a.CheckDeviceOffset&&a.CheckDeviceOffset.Support?(A.$("[btn-for=onAdjustOffset]").show(),p.ConfigManager.getConfig("CheckDeviceOffset").done(function(a){a&&a.Enable&&A.$("[btn-for=onAdjustOffset]").addClass("current")})):A.$("[btn-for=onAdjustOffset]").remove(),a&&a.ClearFrostHeater&&a.ClearFrostHeater.Support&&s.chkAuthority("PtzHeater")?A.$("div.ui-ClearFrostHeater").show():A.$("div.ui-ClearFrostHeater").hide()}),webApp.GongAnDetect?(A.$("[btn-for=onZoneExpose]").show(),A.$("[sel-for=onChangeResolute]").show().change(),A.$("[btn-for=onCutResolute]").show()):(A.$("[btn-for=onZoneExpose]").remove(),A.$("[sel-for=onChangeResolute]").remove(),A.$("[btn-for=onCutResolute]").remove()),-1!==webApp.DeviceType.indexOf("SD")&&isEnable("is_show_mousecontrolptz")&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode?A.$("[btn-for=onFigure]").show():A.$("[btn-for=onFigure]").remove(),-1!==webApp.DeviceType.indexOf("SD")&&isEnable("is_show_duck")?(A.$("#b_duck").show(),A.$("#b_duckdrawn").show()):(A.$("#b_duck").remove(),A.$("#b_duckdrawn").remove()),-1!==webApp.DeviceType.indexOf("TPC")?(A.$("[btn-for=onSnap3]").remove(),webApp.CHANNEL_NUMBER>1?(1===webApp.CamType||webCaps.Anonymous!==!1||webApp.isFixFocusDoubleThermal||A.$("[btn-for=onFixedFocus]").show(),A.$("[btn-for=onRecordAll]").show(),r.get("HighZoomPtzMoveAdaptor").done(function(a){a&&a.Support&&A.$("#b_ptzAdaptor").removeClass("fn-hide"),p.ConfigManager.getConfig("HighZoomPtzMoveAdaptor").done(function(a){A.$("#b_ptzAdaptor").find("[data-adaptor="+a.Type+"]").addClass("main-top-icon-ptzAdaptor-choose-"+a.Type)})})):(A.$("[btn-for=onFixedFocus]").remove(),A.$("[btn-for=onRecordAll]").remove()),webApp.CHANNEL_NUMBER>1&&q.windowId&&A.$("[btn-for=onRegionFocus]").hide()):(A.$("[btn-for=onFixedFocus]").remove(),A.$("[btn-for=onRecordAll]").remove()),r.get("ScenicSpotCaps").done(function(a){a&&a.Enable&&s.chkAuthority("AuthManuCtr")&&A.$("[btn-for=onHighSkyEyes]").show()}),webApp.DeviceType.indexOf("SD")>-1&&-1===webApp.DeviceType.indexOf("TPC")&&(a.when(r.get("IVSCaps"),r.get("RainBrushControl")).done(function(a,b){if(a&&a.SupportedScene){var c=a.SupportedScene[0];c&&"Traffic"===c?(A.$('[btn-for="onManualEvidence"]').show(),A.onManualEvidence()):A.$('[btn-for="onManualEvidence"]').hide()}s.chkAuthority("RainBrushConfig")&&b&&b.Support&&-1===webApp.DeviceType.indexOf("TPC")?A.$("div.ui-rainBrush").show():A.$("div.ui-rainBrush").hide()}),p.LaserDistMeasure.getCaps().done(function(a){s.chkAuthority("PtzConfig")&&s.chkAuthority("MPTZ")&&a&&a.Support&&1===isEnable("is_show_MeasureDistance")&&"h5"!==webApp.playMode?A.$("[btn-for=onMeasureDistance]").show():A.$("[btn-for=onMeasureDistance]").hide()}),("flash"===webApp.playMode||"h5"===webApp.playMode)&&(A.$("[btn-for=onHighSkyEyes]").remove(),A.$("#b_duck,#b_duckdrawn").remove(),A.$('[btn-for="onEnlarged"]').remove(),A.$('[btn-for="onRecord"]').remove(),A.$('[btn-for="onSnap3"]').remove()))},_getCoaCaps:function(){p.CoaxialControlIO.getStatus().done(function(a){var b=a.status.Speaker,c=a.status.WhiteLight;"On"===b?A.$("[btn-for=onSpeakerWhite]:eq(0)").addClass("current"):A.$("[btn-for=onSpeakerWhite]:eq(0)").removeClass("current"),"On"===c?A.$("[btn-for=onSpeakerWhite]:eq(1)").addClass("current"):A.$("[btn-for=onSpeakerWhite]:eq(1)").removeClass("current")})},render:function(){ab=!1,webCaps.is_show_newIntelli&&p.ConfigManager.getConfig("VideoAnalyseGlobal").done(function(a){for(var b in a[0]){var c=a[0][b];if(/Scene/.test(b)&&1e3===c.PtzPresetId)return"TrafficPark"===c.Type?(A.$("[btn-for=onTrackObject]").hide(),A.$('[btn-for="onManualEvidence"]').show()):(A.$("[btn-for=onTrackObject]").show(),A.$('[btn-for="onManualEvidence"]').hide()),!1}}),bb=1,a(window).off("resize"+B),a(window).on("resize"+B,g),g();var b={showImage:!0,showPtz:s.chkAuthority("MPTZ")&&webApp.HasPtz&&(-1!==webApp.DeviceType.indexOf("SD")||webApp.isSpecialPtz),ptzOn:function(){-1!==webApp.DeviceType.indexOf("SD")&&-1===webApp.DeviceType.indexOf("TPC")&&webApp.PtzFunctionMenu===!1?A.$(".main-ptz-setting").hide():A.$(".main-ptz-setting").show().ptzSetting("render"),A.$(".main-ptz-control").show(),g()},ptzOff:function(){A.$(".main-ptz-setting").hide(),A.$(".main-ptz-control").hide(),g()},imageOn:function(){A.$(".main-image-adjust").show(),g()},imageOff:function(){A.$(".main-image-adjust").hide(),g()},modeChange:g,zoomOn:function(){A.$(".main-zoom-focus").zoomFocus("render").show(),g()},zoomOff:function(){A.$(".main-zoom-focus").zoomFocus("leave").hide(),g()},wideviewOn:function(a){gb._loginWideView(),a.isTrigger?q.ShowWideView(!0):(gb.config[0].Enable=!0,p.ConfigManager.setConfig("WideViewControl",gb.config).done(function(){q.ShowWideView(!0)}))},wideviewOff:function(a){a.isTrigger?q.ShowWideView(!1):(gb.config[0].Enable=!1,p.ConfigManager.setConfig("WideViewControl",gb.config).done(function(){q.ShowWideView(!1)}))},trackOn:function(){q.state("partialEnlarged")&&q.state("partialEnlarged",!1),q.state("activeLocalFocus")&&q.state("activeLocalFocus",!1),A.$(".main-trigger-track").triggerTrack("render").show(),g()},trackOff:function(){A.$(".main-trigger-track").triggerTrack("leave").hide(),g()},trackMode:function(){return A.$(".main-trigger-track").triggerTrack("getScreenMode")},VRtrackOn:function(){q.state("partialEnlarged")&&q.state("partialEnlarged",!1),q.state("activeLocalFocus")&&q.state("activeLocalFocus",!1),A.$(".main-trigger-VRtrack").triggerVRTrack("render").show(),g()},VRtrackOff:function(){A.$(".main-trigger-VRtrack").triggerVRTrack("leave").hide(),g()},faceOn:function(){A.$(".main-face-feature").show(),W&&A.$(".main-face-analysis").show(),g()},faceOff:function(){A.$(".main-face-feature").hide(),W&&A.$(".main-face-analysis").hide(),g()},trafficOn:function(){A.$(".main-traffic").show(),g()},trafficOff:function(){A.$(".main-traffic").hide(),g()},objectOn:function(){db&&A.$(".main-object-NonMotor").show(),A.$(".main-traffic").show(),g()},objectOff:function(){A.$(".main-object-NonMotor").hide(),A.$(".main-traffic").hide(),g()}};switch(-1!==webApp.DeviceType.indexOf("TPC")?(a.extend(b,{showRayRight:!0,showTemperReport:X,showWhRate:!1,showZoomFocus:!1,showOriginal:!1,showFluency:!1,showFullScreeny:!1,showFishEye:!1,showDivideEnable:!0,reportOn:function(){A.$(".main-report-container").show(),G.temperReport("render"),g()},reportOff:function(){A.$(".main-report-container").hide(),g()},adjustOn:function(){A.$(".main-ptz-control").show(),g()},adjustOff:function(){A.$(".main-ptz-control").hide(),g()},divideOn:function(){A.$(".main-divide-control").show(),q.SetDivideEnble(1),g()},divideOff:function(){q.SetDivideEnble(0),A.$(".main-divide-control").hide(),g()}}),Q&&(b.showPtz=!1,b.showAdjust=!0)):-1===webApp.DeviceType.indexOf("TPC")&&webApp.DeviceType.indexOf("SD")>-1?a.extend(b,{showZoomFocus:!1,girdOn:function(){var a=0;A.$(".main-gird-control").show(),r.get("VideoInImageGird").done(function(b){b.SupportPoint&&b.SupportGird?a=3:b.SupportGird&&!b.SupportPoint?a=2:!b.SupportGird&&b.SupportPoint&&(a=1),q.NetShowMode(a)}),g()},girdOff:function(){A.$(".main-gird-control").hide(),q.NetShowMode(0),g()}}):a.extend(b,{showFishEye:!0,fishEyeOn:function(){q.state("partialEnlarged")&&q.state("partialEnlarged",!1),q.state("activeLocalFocus")&&q.state("activeLocalFocus",!1),A.$(".main-fisheye").fishEye("render"),webApp.hideIVS||A.$(".main-fisheye").show(),g()},fishEyeOff:function(){A.$(".main-fisheye").fishEye("leave").hide(),g()}}),E.videoBar("render",b),E.videoBar("isCurrent","video_ptz")||E.videoBar("isCurrent","video_adjust")?(-1!==webApp.DeviceType.indexOf("SD")&&webApp.PtzFunctionMenu===!1?A.$(".main-ptz-setting").hide():Q||A.$(".main-ptz-setting").show().ptzSetting("render"),A.$(".main-ptz-control").show()):(A.$(".main-ptz-setting").hide(),A.$(".main-ptz-control").hide()),E.videoBar("isCurrent","video_zoomFocus")?A.$(".main-zoom-focus").zoomFocus("render").show():A.$(".main-zoom-focus").zoomFocus("leave").hide(),E.videoBar("isCurrent","video_image")?A.$(".main-image-adjust").show():A.$(".main-image-adjust").hide(),E.videoBar("isCurrent","video_report")?(A.$(".main-report-container").show(),G.temperReport("render")):A.$(".main-report-container").hide(),webApp.DisplayMode){case"Adaptive Window":E.videoBar("toggleCurrent","video_whRate",1);break;case"Original Rate":E.videoBar("toggleCurrent","video_whRate",0);break;case"Original Size":E.videoBar("isCurrent","video_original")?(E.find("#video_whRate").hide(),g()):E.videoBar("toggleCurrent","video_original")}if(E.videoBar("hasItem","video_triggerTrack")&&(E.videoBar("isCurrent","video_triggerTrack")?A.$(".main-trigger-track").triggerTrack("render").show():A.$(".main-trigger-track").triggerTrack("leave").hide()),E.videoBar("hasItem","video_triggerVRTrack")&&(E.videoBar("isCurrent","video_triggerVRTrack")?A.$(".main-trigger-VRtrack").triggerVRTrack("render").show():A.$(".main-trigger-VRtrack").triggerVRTrack("leave").hide()),E.videoBar("hasItem","video_face")&&(A.$(".main-face-feature").faceFeature("render"),W&&A.$(".main-face-analysis").faceAnalysis("render")),"flash"!==webApp.playMode&&"hls"!==webApp.playMode&&"h5"!==webApp.playMode&&q.cover(D,function(a){q.SetModuleMode(0);var b=A.$(a?"a[btn-for=onConnectMain]":"a.last[btn-for^=onConnect]");if(A.$("a[btn-for^=onConnect]").removeClass("current"),b.length||(b=A.$("a[btn-for=onConnectMain]")),b.click(),E.videoBar("isCurrent","video_ivsRule",0)?q.SetIVSEnable(!0):E.videoBar("hasItem","video_triggerTrack")&&(q.SetIVSEnable(!0),q.ShowRuleState(!1)),r.get("Dhop").done(function(a){a&&a.Support&&q.SetIVSEnable(!0)}),E.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode){var c;c=0!==A.$(".main-trigger-track").triggerTrack("getScreenMode")?2:1,q.SetShowMode(c)}E.videoBar("hasItem","video_fisheye")&&(A.$(".main-fisheye").fishEye("render"),a&&E.videoBar("toggleCurrent","video_whRate",0)),r.is("OcxStabilization").done(function(a){a&&p.ConfigManager.getConfig("VideoImageControl").done(function(a){q.ControlVideoStable(!!a[q.channel].Stable)})}),i()}),"flash"===webApp.playMode||"h5"===webApp.playMode){var c=A.$("a[btn-for^=onConnect].current");"h5"===webApp.playMode&&A.$("a[btn-for^=onConnect]").removeClass("current"),c.length||(c=A.$("a[btn-for=onConnectMain]")),c.click(),p.ConfigManager.getConfig(["Encode","SmartEncode","VideoImageControl"]).done(function(a){if(y=a[0].params.table[0],z=!1,a[1]&&a[1].params&&a[1].params.table&&a[1].params.table[0]&&(z=a[1].params.table[0].Enable),webApp.resolution.x=a[0].params.table[0].MainFormat[0].Video.Width,webApp.resolution.y=a[0].params.table[0].MainFormat[0].Video.Height,1==a[2].params.table[0].Rotate90||2==a[2].params.table[0].Rotate90){var b;b=webApp.resolution.x,webApp.resolution.x=webApp.resolution.y,webApp.resolution.y=b}("flash"===webApp.playMode||"h5"===webApp.playMode)&&(t.cover("#preview_video",webApp.resolution.x+"*"+webApp.resolution.y),_=!0),g()})}q.addEvent("ResolutionChangePreview",g),q.addEvent("StateChangedPreview",function(){g(),E.videoBar("isCurrent","video_ivsRule",0)&&q.SetIVSEnable(!0),E.videoBar("isCurrent","video_triggerTrack")&&A.$(".main-trigger-track").triggerTrack("render").show(),E.videoBar("isCurrent","video_triggerVRTrack")&&A.$(".main-trigger-VRtrack").triggerVRTrack("render").show(),1!=q.stream?E.videoBar("hideItem","video_svac",!0):i(),E.videoBar("hasItem","video_fisheye")&&A.$(".main-fisheye").fishEye("render")}),q.addEvent("DeviceReconnectedPreview",function(){E.videoBar("isCurrent","video_ivsRule",0)&&q.SetIVSEnable(!0)}),q.addEvent("RecordDiskFullPreview",function(){q.hide(),webApp.hide_by_dialog=!0,a.alert(tl("pfm.StorageLowSpace"),function(){q.cover(D)})}),d(),gb.render(),-1!=webApp.DeviceType.indexOf("TPC")&&(F&&F.ptzControl("changeChannel",q.windowId),q.addEvent("WndSwitch",function(a){q.state("setAFEnable")&&q.state("setAFEnable",!1),q.state("partialEnlarged")&&q.state("partialEnlarged",!1),q.state("activeLocalFocus")&&q.state("activeLocalFocus",!1),q.state("enableMousePtz")&&q.state("enableMousePtz",!1),q.state("activePTZLocate")&&q.state("activePTZLocate",!1),q.state("activeManualLocate")&&q.state("activeManualLocate",!1),q.state("activeMeasureDistance")&&q.state("activeMeasureDistance",!1),q.state("recordVideo")&&q.state("recordVideo",!1),q.windowId=a,E.videoBar("isCurrent","video_image")&&K.imageAdjust("render"),X&&H.curTemper("render"),webApp.CHANNEL_NUMBER>1&&F&&F.ptzControl("changeChannel",q.windowId),P&&L.ptzDistance("changeWin",q.windowId),-1!==webApp.DeviceType.indexOf("SD")&&isEnable("is_show_duck")&&q.messageMarkDuckClick(A.$("[btn-for=onDuckClick]"),!0),webApp.CHANNEL_NUMBER>1&&1===q.windowId?A.$("[btn-for=onRegionFocus]").hide():webApp.CHANNEL_NUMBER>1&&0===q.windowId&&A.$("[btn-for=onRegionFocus]").show()}),q.addEvent("VideoAnalyzeConfig",function(a){var b=JSON.parse(a);q.state("activeLocalFocus")?I.tpcLocalFocus("render",b):q.state("activeManualLocate")?J.tpcTracker("render",b):H.curTemper("getTemper",b)}),X&&H.curTemper("render")),2===webApp.AUDIO_IN_NUMBER&&k(),"hls"===webApp.playMode&&(u.cover(D),S.change()),"flash"===webApp.playMode&&A._playFlash(),"h5"===webApp.playMode,a("#b_manualEvidence")&&a("#b_manualEvidence").hasClass("current")&&a("#b_manualEvidence").click(),r.get("PTZCaps").done(function(b){b&&b.CheckDeviceOffset&&b.CheckDeviceOffset.Support&&p.ConfigManager.getConfig("CheckDeviceOffset").done(function(b){b&&b.Enable?(A.$("[btn-for=onAdjustOffset]").addClass("current"),V&&(q.hide(),webApp.hide_by_dialog=!0,a.alert(tl("per.AdjustDeviceTip"),function(){webApp.hide_by_dialog=!1,"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&q.cover(A.$(".main-video"))}))):A.$("[btn-for=onAdjustOffset]").removeClass("current"),V=!1})}),Z&&p.AuthPTZ.getMoveStatus(0).done(function(a){if(a&&a.MoveStatus){var b=a.MoveStatus.MotionState;a.MoveStatus.IntelliPresetFlag?A.$("#PTZ_status").text(b).css("color","").addClass("fn-color-ivsGreen").parent().fadeIn("slow"):A.$("#PTZ_status").text(b).removeClass("fn-color-ivsGreen").css("color","#fff").parent().fadeIn("slow"),setTimeout(function(){A.$("#PTZ_status").parent().fadeOut("slow")},5e3)}})},leave:function(){ab=!0,$.done(function(){a(window).off("resize"+B),E.videoBar("isCurrent","video_zoomFocus")&&A.$(".main-zoom-focus").zoomFocus("leave").hide(),E.videoBar("hasItem","video_fisheye")&&A.$(".main-fisheye").fishEye("leave"),E.videoBar("isCurrent","video_triggerTrack")&&A.$(".main-trigger-track").triggerTrack("leave").hide(),E.videoBar("isCurrent","video_triggerVRTrack")&&A.$(".main-trigger-VRtrack").triggerVRTrack("leave").hide(),P&&L.ptzDistance("getStatus")&&(L.ptzDistance("leave"),E.videoBar("hideItem","video_rayright",!1)),2===webApp.CamType&&E.videoBar("isCurrent","video_original")&&E.videoBar("toggleCurrent","video_original"),A._clearOCXFunction(),q.state("recordVideo")||q.close(),q.state("setAFEnable")&&q.state("setAFEnable",!1),A.$("[btn-for=onHighSkyEyes]")&&A.$("[btn-for=onHighSkyEyes]").hasClass("current")&&(A.$("[btn-for=onHighSkyEyes]").removeClass("current"),q.SubVideoWndCtrl(30,0)),q.SetIVSEnable(!1),q.hide(),"flash"===webApp.playMode?(v.hide(),A.$("[btn-for=onTrackObject]").removeClass("current"),A.$("[btn-for=onRegionFocus]").removeClass("current"),a("#ptz_locate").removeClass("current"),t&&t.hide(),a.unsubscribe("RegionChanged",null),_=!1):"hls"===webApp.playMode?u.hideAndStopLoad():"h5"===webApp.playMode&&(w.hide(),A.$("[btn-for=onTrackObject]").removeClass("current"),A.$("[btn-for=onRegionFocus]").removeClass("current"),a("#ptz_locate").removeClass("current"),t&&t.hide(),a.unsubscribe("RegionChanged",null),_=!1),-1!==webApp.DeviceType.indexOf("SD")&&isEnable("is_show_duck")&&q.messageMarkDuckClick(A.$("[btn-for=onDuckClick]"),!0),q.enableMousePtz(A.$("[btn-for=onFigure]")),q.addEvent("ResolutionChangePreview",null),q.addEvent("StateChangedPreview",null),q.addEvent("DeviceReconnectedPreview",null),q.addEvent("RecordDiskFullPreview",null),f(),gb.leave(),-1!=webApp.DeviceType.indexOf("TPC")&&(X&&H.curTemper("leave"),q.addEvent("VideoAnalyzeConfig",null),q.addEvent("WndSwitch",function(a){q.windowId=a,P&&L.ptzDistance("changeWin",q.windowId)
}))})},destory:function(){a(window).off("resize"+B),A.$("a[btn-for^=onConnect]").removeClass("current").removeClass("last"),E.videoBar("isCurrent","video_zoomFocus")&&A.$(".main-zoom-focus").zoomFocus("leave").hide(),E.videoBar("isCurrent","video_fisheye")&&A.$(".main-fisheye").fishEye("leave").hide(),E.videoBar("isCurrent","video_triggerTrack")&&A.$(".main-trigger-track").triggerTrack("leave").hide(),E.videoBar("isCurrent","video_triggerVRTrack")&&A.$(".main-trigger-VRtrack").triggerVRTrack("leave").hide(),E.videoBar("hasItem","video_face")&&(A.$(".main-face-feature").faceFeature("destroy").hide(),W&&A.$(".main-face-analysis").faceAnalysis("destroy").hide()),E.videoBar("hasItem","video_traffic")&&A.$(".main-traffic").traffic("destroy").hide(),E.videoBar("hasItem","video_object")&&(A.$(".main-traffic").traffic("destroy").hide(),db&&A.$(".main-object-NonMotor").objectNonMotor("destroy").hide()),E.videoBar("destroy"),gb.destory(),X&&(G.temperReport("destroy"),H.curTemper("destory"),m(),common.devNotify.detach("client.notifyPtzStream")),"flash"==webApp.playMode&&(A.$("[btn-for=onSnap]").attr("href","javascript:;").attr("target",""),A.$("#pre_stream").show(),A.$("#pre_video_bar").show(),A.$("div.main-top").removeClass("play_hls_type"),v.destroy(),webApp.playMode="ocx"),"h5"===webApp.playMode&&(A.$("[btn-for=onSnap]").attr("href","javascript:;").attr("target",""),A.$("#pre_stream").show(),A.$("#pre_video_bar").show(),A.$("div.main-top").removeClass("play_hls_type"),w.destroy(),webApp.playMode="ocx"),A.$("#pre_playType_select").find("option[value=flash]").remove()},_clearOCXFunction:function(){q.state("dualAudioEnable1")&&q.state("dualAudioEnable1",!1),q.state("dualAudioEnable14")&&q.state("dualAudioEnable14",!1),q.state("dualAudioEnable15")&&q.state("dualAudioEnable15",!1),q.state("setAFEnable")&&q.state("setAFEnable",!1),q.state("partialEnlarged")&&q.state("partialEnlarged",!1),q.state("recordAllVideo")&&q.state("recordAllVideo",!1),q.state("activeLocalFocus")&&q.state("activeLocalFocus",!1),q.state("activeZoneExpose")&&q.state("activeZoneExpose",!1),q.state("cutResolute")&&q.state("cutResolute",!1),q.state("enableMousePtz")&&q.state("enableMousePtz",!1),q.state("activePTZLocate")&&q.state("activePTZLocate",!1),q.state("activeManualLocate")&&q.state("activeManualLocate",!1),q.state("activeMeasureDistance")&&q.state("activeMeasureDistance",!1),E.videoBar("isCurrent","video_fisheye")&&q.SetFeShowMode(0)},onConnectMain:function(){if("hls"==webApp.playMode)return u&&u.hideAndStopLoad(),A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current"),A.$("[btn-for=onConnectMain]").addClass("current"),void S.change();if("flash"==webApp.playMode)return-1===y.MainFormat[0].Video.Compression.indexOf("264")||z?A.$(".u-tip.flash-cannot-preview").show():A.$(".u-tip.flash-cannot-preview").hide(),v.hide(),A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current"),A.$("[btn-for=onConnectMain]").addClass("current"),void A._playFlash();if("h5"==webApp.playMode)return A.$(".u-tip.flash-cannot-preview").hide(),A.$("[btn-for=onConnectMain]").hasClass("current")?(A.$("[btn-for=onConnectMain]").removeClass("current"),void w.hide()):(A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current"),A.$("[btn-for=onConnectMain]").addClass("current"),void A._playH5());if(A._clearOCXFunction(),E.videoBar("hasItem","video_ivsRule")&&E.videoBar("hideItem","video_ivsRule",!1),E.videoBar("isCurrent","video_ivsRule",0)&&q.SetIVSEnable(!0),E.videoBar("hasItem","video_traffic")&&E.videoBar("hideItem","video_traffic",!1),E.videoBar("hasItem","video_face")&&E.videoBar("hideItem","video_face",!1),E.videoBar("hasItem","video_object")&&E.videoBar("hideItem","video_object",!1),A.$("[btn-for=onConnectMain]").hasClass("current"))q.close(!0).done(function(a){a&&A.$("[btn-for=onConnectMain]").removeClass("current")});else{if(-1!==webApp.DeviceType.indexOf("TPC")||webApp.CHANNEL_NUMBER>1)return j(1),A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current last"),void A.$("[btn-for=onConnectMain]").addClass("current last");q.open(1).done(function(a){A.$("[btn-for^=onConnect]").removeClass("current last"),a&&A.$("[btn-for=onConnectMain]").addClass("current last"),Y&&Y[R]&&(0===Y[R][0]?E.videoBar("hideItem","video_ivsRule",!0):E.videoBar("hideItem","video_ivsRule",!1))})}},onConnectExtra:function(b){var c=a(b.target),d=c.attr("index")-0;if("hls"==webApp.playMode)return u&&u.hideAndStopLoad(),A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current"),c.addClass("current"),void S.change();if("flash"==webApp.playMode)return-1===y.ExtraFormat[0].Video.Compression.indexOf("264")?A.$(".u-tip.flash-cannot-preview").show():A.$(".u-tip.flash-cannot-preview").hide(),v.hide(),A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current"),c.addClass("current"),void A._playFlash();if("h5"==webApp.playMode)return A.$(".u-tip.flash-cannot-preview").hide(),c.hasClass("current")?(c.removeClass("current"),void w.hide()):(A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current"),c.addClass("current"),void A._playH5());if(A._clearOCXFunction(),E.videoBar("isCurrent","video_ivsRule",0)&&q.SetIVSEnable(!0),p.ConfigManager.getConfig("EncodeCrop").done(function(a){var b=!(!a[0]["Extra"+d]||!a[0]["Extra"+d].Enable);b&&(E.videoBar("isCurrent","video_ivsRule")&&E.videoBar("toggleCurrent","video_ivsRule"),q.SetIVSEnable(!1),E.videoBar("isCurrent","video_traffic")&&E.videoBar("toggleCurrent","video_traffic"),E.videoBar("isCurrent","video_face")&&E.videoBar("toggleCurrent","video_face"),E.videoBar("isCurrent","video_object")&&E.videoBar("toggleCurrent","video_object")),E.videoBar("hideItem","video_ivsRule",b),ab||(E.videoBar("hideItem","video_traffic",b),E.videoBar("hideItem","video_face",b),E.videoBar("hideItem","video_object",b))}).always(function(){Y&&Y[R]&&(0===Y[R][d]?E.videoBar("hideItem","video_ivsRule",!0):E.videoBar("hideItem","video_ivsRule",!1))}),c.hasClass("current"))q.close(!0).done(function(a){a&&c.removeClass("current")});else{var e=d+1;if(-1!==webApp.DeviceType.indexOf("TPC")||webApp.CHANNEL_NUMBER>1)return j(e),A.$("[btn-for=onConnectMain],[btn-for=onConnectExtra]").removeClass("current last"),void c.addClass("current last");webApp.GongAnDetect&&(3===d&&(e=2),4===d&&(e=3)),e>4&&(e+=3),q.open(e).done(function(a){A.$("[btn-for^=onConnect]").removeClass("current last"),a&&c.addClass("current last")})}},onTypeChange:function(){var b=s.getLoginInfo().logintype,c=A.$("#pre_type").val()-0;"ActiveDirectory"===b&&(c=13),"LDAP"===b&&(c=12);var d,e=A.$("[btn-for^=onConnect]");a.each(e,function(b,c){a(c).hasClass("current")&&(d=arguments[0])}),A.$("[btn-for^=onConnect]").removeClass("current"),A._clearOCXFunction(),q.state("recordVideo")&&q.state("recordVideo",!1),q.state("controlTalking")&&q.state("controlTalking",!1),q.setSocketType(c).done(function(){if(1===q.stream)A.onConnectMain();else{var a=q.stream-1;a>4&&(a-=3),webApp.GongAnDetect&&(3===d&&(a=3),4===d&&(a=4)),A.$('[btn-for="onConnectExtra"][index='+a+"]").click()}})},onPlayTypeChange:function(){webApp.playMode=S.val(),A.$('[btn-for="onConnectExtra"]').removeClass("disabled");var a=A.$("[btn-for^=onConnect].current");"hls"==webApp.playMode?(u.currentStream=a.attr("index")-0,a.length||(A.$('[btn-for="onConnectMain"]').addClass("current"),u&&(u.currentStream=0)),A.$('[btn-for="onConnectExtra"][index=2]').removeClass("current"),A.$("#pre_stream").hide(),A.$('[btn-for="onConnectExtra"][index=2]').addClass("disabled"),T&&(p.ConfigManager.getConfig("Encode").done(function(a){var b=a;(b&&webApp.MaxBitRate[0]>0&&b[0].MainFormat[0].Video.BitRate>webApp.MaxBitRate[0]||b&&webApp.MaxBitRate[1]>0&&b[0].ExtraFormat[0].Video.BitRate>webApp.MaxBitRate[1])&&jQuery.alert(tl("com.MaximumStreamBite")+","+tl("com.RecomMainStream")+" "+webApp.MaxBitRate[0]+"Kb,"+tl("com.RecomSubStream")+" "+webApp.MaxBitRate[1]+"Kb.")}),T=!1),q.hide(),v&&v.hide(),w&&w.hide(),q.close(),u&&u.cover(D),A._clearOCXFunction(),u&&u.init("","",p.getSession()),u&&u.beginPlay(),A.$("div.main-top").addClass("play_hls_type"),-1!==webApp.DeviceType.indexOf("SD")||webApp.isSpecialPtz?(A.$("div.ui-video-iconbar a").hide(),A.$("#video_image").show(),A.$("#video_ptz").show()):A.$("#pre_video_bar").hide(),A.$("div.ui-video-iconbar a.current").click()):(a.length?(a.removeClass("current"),a.click()):A.$('[btn-for="onConnectMain"]').click(),A.$("[btn-for=onSnap]").attr("href","javascript:;").attr("target",""),A.$("#pre_stream").show(),u&&u.hideAndStopLoad(),v&&v.hide(),w&&w.hide(),q.cover(D),A.$("#pre_video_bar").show(),A.$("div.main-top").removeClass("play_hls_type"))},_playFlash:function(){v.init();var a=A.$("[btn-for^=onConnect].current"),b=a.attr("index")-0;a.length||(A.$('[btn-for="onConnectMain"]').addClass("current"),b=0),b>3&&(b+=3),A.$("#pre_stream").hide(),v.cover(D),A._clearOCXFunction(),v.playPreview(U,b),A.$("[btn-for=onSnap]").attr({target:"_blank",href:A.getEncryptServerUrl(p.getSession())}).show(),A.$("div.ui-video-iconbar a").hide(),A.$("#video_zoomFocus").show(),(-1!==webApp.DeviceType.indexOf("SD")||webApp.isSpecialPtz)&&(A.$("#video_ptz").show(),"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&A.$("#video_anti_aliasing").show())},_playH5:function(){var a=A.$("[btn-for^=onConnect].current"),b=a.attr("index")-0;a.length||(A.$('[btn-for="onConnectExtra"][index = 1]').addClass("current"),b=1),b>3&&(b+=3),A.$("#pre_stream").hide(),A._clearOCXFunction(),w&&(w.hide(),w.playPreview(U,b,D,A._videoDelayMax)),A.$("div.ui-video-iconbar a").hide(),A.$("#video_zoomFocus").show(),(-1!==webApp.DeviceType.indexOf("SD")||webApp.isSpecialPtz)&&(A.$("#video_ptz").show(),"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&A.$("#video_anti_aliasing").show())},onSnap:function(){"h5"===webApp.playMode?w.capture():q.CatchPicture(6,"LiveSnapshot")},onSnap3:function(){q.CatchPictures(1,"LiveSnapshot")},onTalk:function(){q.controlTalking(A.$("[btn-for=onTalk]"))},onVoice:function(){"h5"===webApp.playMode?A.$("[btn-for=onVoice]").hasClass("current")?(A.$("[btn-for=onVoice]").removeClass("current"),w.setAudioVolume(0)):(A.$("[btn-for=onVoice]").addClass("current"),w.setAudioVolume(1)):q.dualAudioEnable(A.$("[btn-for=onVoice]"))},onVoice1:function(){"h5"===webApp.playMode?A.$("[btn-for=onVoice1]").hasClass("current")?(A.$("[btn-for=onVoice1]").removeClass("current"),w.setAudioVolume(0)):(A.$("[btn-for=onVoice1]").addClass("current"),w.setAudioVolume(1)):q.dualAudioEnable(A.$("[btn-for=onVoice1]"))},onVoice2:function(){q.dualAudioEnable(A.$("[btn-for=onVoice2]"))},onSpeakerWhite:function(b){var c=a(b.target),d=c.data("name"),e=0,f=0;e="white"===d?1:2,f=c.hasClass("current")?2:1,p.CoaxialControlIO.control([{Type:e,IO:f,TriggerMode:2}]).done(function(){c.toggleClass("current")})},onSetAF:function(){-1!==webApp.DeviceType.indexOf("TPC")&&webApp.CHANNEL_NUMBER>1&&0===q.windowId||q.setAFEnable(A.$("[btn-for=onSetAF]"))},onRecord:function(){q.recordVideo(A.$("[btn-for=onRecord]"))},onRecordAll:function(){q.recordAllVideo(A.$("[btn-for=onRecordAll]"))},onTrackObject:function(b){if("flash"===webApp.playMode||"h5"===webApp.playMode){webApp.RegionFocusTrackObject=!1,webApp.LocateTrackObject=!1,A.$("[btn-for=onRegionFocus]").hasClass("current")&&(A.$("[btn-for=onRegionFocus]").removeClass("current"),webApp.TrackObjectRegionFocus=!0),a("#ptz_locate").hasClass("current")&&(a("#ptz_locate").removeClass("current"),webApp.TrackObjectLocate=!0);var c=!b.target.hasClass("current");c?(A.$("[btn-for=onTrackObject]").toggleClass("current"),t.SetRegionNum(1),t.SetSelRegionByIndex(0,0,0,0,0),a.subscribe("RegionChanged",function(b,c){A.$("[btn-for=onTrackObject]").removeClass("current"),t.DelSelReg(0,!1),a.unsubscribe("RegionChanged",null);var d=c[0],e=c[1],f=c[2],g=c[3];webApp.RegionFocusTrackObject||webApp.LocateTrackObject||p.DevIntelliTracker.trackObject({ObjectID:-1,BoundingBox:[d,e,f,g]})})):(A.$("[btn-for=onTrackObject]").removeClass("current"),t.SetRegionNum(0),a.unsubscribe("RegionChanged",null))}else q.activeManualLocate(A.$("[btn-for=onTrackObject]"))},onEnlarged:function(){!q.state("partialEnlarged")&&E.videoBar("isCurrent","video_triggerTrack")&&E.videoBar("toggleCurrent","video_triggerTrack"),!q.state("partialEnlarged")&&E.videoBar("isCurrent","video_triggerVRTrack")&&E.videoBar("toggleCurrent","video_triggerVRTrack"),q.partialEnlarged(A.$("[btn-for=onEnlarged]")).done(function(){if(q.state("partialEnlarged"))E.videoBar("isCurrent","video_fisheye")&&E.videoBar("toggleCurrent","video_fisheye"),E.videoBar("hideItem","video_ivsRule"),A.$("#video_ivsRule").hasClass("current")&&(A.$("#video_ivsRule").removeClass("current"),A.$("#video_ivsRule").toggleClass("currentflag")),E.videoBar("isCurrent","video_ivsRule",0)&&q.SetIVSEnable(!1);else{if(E.videoBar("hasItem","video_ivsRule")){var a=[!1,!1,!1];p.ConfigManager.getConfig("EncodeCrop").done(function(b){b&&(a[1]=b[0].Extra1.Enable,a[2]=b[0].Extra2.Enable)}).always(function(){var b=a[q.stream-1];Y&&Y[R]&&0===Y[R][q.stream-1]&&(b=!0),E.videoBar("hideItem","video_ivsRule",b),A.$("#video_ivsRule").hasClass("currentflag")&&(A.$("#video_ivsRule").toggleClass("current"),A.$("#video_ivsRule").removeClass("currentflag")),E.videoBar("isCurrent","video_ivsRule",0)&&q.SetIVSEnable(!0)})}E.videoBar("hasItem","video_fisheye")&&webApp.hideIVS&&E.videoBar("toggleCurrent","video_fisheye")}})},onDirAdjust:function(){p.PTZ.directionCalibration()},onRegionFocus:function(b){if("flash"===webApp.playMode||"h5"===webApp.playMode){webApp.TrackObjectRegionFocus=!1,webApp.LocateRegionFocus=!1,A.$("[btn-for=onTrackObject]").hasClass("current")&&(A.$("[btn-for=onTrackObject]").removeClass("current"),webApp.RegionFocusTrackObject=!0),a("#ptz_locate").hasClass("current")&&(a("#ptz_locate").removeClass("current"),webApp.RegionFocusLocate=!0);var c=!b.target.hasClass("current");c?(A.$("[btn-for=onRegionFocus]").toggleClass("current"),t.SetRegionNum(1),t.SetSelRegionByIndex(0,0,0,0,0),a.subscribe("RegionChanged",function(b,c){t.DelSelReg(0,!1),t.SetRegionNum(0),webApp.TrackObjectRegionFocus||webApp.LocateRegionFocus||(-1!==webApp.DeviceType.indexOf("SD")?p.PTZ.focusRegion("InROIRegion",[c[0],c[1],c[2],c[3]],0):p.DevVideoInput.focusRegion("InROIRegion",[c[0],c[1],c[2],c[3]],0),cb&&(t.SetRegionNum(1),t.SetSelRegionByIndex(0,0,0,0,0))),cb||(A.$("[btn-for=onRegionFocus]").removeClass("current"),a.unsubscribe("RegionChanged",null))})):(A.$("[btn-for=onRegionFocus]").removeClass("current"),t.SetRegionNum(0),t.clearCanvas(),a.unsubscribe("RegionChanged",null))}else cb?q.activeLocalFocus(A.$("[btn-for=onRegionFocus]"),!0):q.activeLocalFocus(A.$("[btn-for=onRegionFocus]"))},onHighSkyEyes:function(){q.highSkyEyes(A.$("[btn-for=onHighSkyEyes]"))},onZoneExpose:function(){q.activeZoneExpose(A.$("[btn-for=onZoneExpose]"))},onManualEvidence:function(){q.changeZoomEvidence(A.$("[btn-for=onManualEvidence]"))},onDuckColorClick1:function(){q.messageMarkColorClick(1)},onDuckColorClick2:function(){q.messageMarkColorClick(2)},onDuckColorClick3:function(){q.messageMarkColorClick(3)},onDuckDrawnClick:function(){q.messageMarkDuckDrawnClick(),A.$("div.ui-rainBrush-wrap")&&!A.$("div.ui-rainBrush-wrap").hasClass("fn-hide")&&A.$("div.ui-rainBrush-wrap").addClass("fn-hide"),A.$("div.ui-ClearFrostHeater-wrap")&&!A.$("div.ui-ClearFrostHeater-wrap").hasClass("fn-hide")&&A.$("div.ui-ClearFrostHeater-wrap").addClass("fn-hide")},onDuckClick:function(){q.messageMarkDuckClick(A.$("[btn-for=onDuckClick]"))},onFigure:function(){q.enableMousePtz(A.$("[btn-for=onFigure]"))},onMeasureDistance:function(){q.activeMeasureDistance(A.$("[btn-for=onMeasureDistance]"))},onFixedFocus:function(){p.ThermographyManager.fixFocus(0,[0,1],0)},onCutResolute:function(){q.cutResolute(A.$("[btn-for=onCutResolute]")).done(function(){var a=A.$("[sel-for=onChangeResolute]").val(),b=a.split("x");q.SetCalWndSize(b[0]-0,b[1]-0)})},onPtzAdaptor:function(a){var b="main-top-icon-ptzAdaptor-choose-",c=A.$(a.target).data("adaptor"),d=0,e=1===c?2:1;A.$(a.target).siblings().removeClass(b+e),A.$(a.target).hasClass(b+c)?(A.$(a.target).removeClass(b+c),d=0):(A.$(a.target).addClass(b+c),d=c),p.ConfigManager.setConfig("HighZoomPtzMoveAdaptor",{Type:d})},onAdjustOffset:function(b){var c=!a(b.target).hasClass("current"),d={};c?(a(b.target).addClass("current"),d.Enable=c,q.hide(),webApp.hide_by_dialog=!0,a.alert(tl("per.AdjustDeviceTip"),function(){webApp.hide_by_dialog=!1,"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&q.cover(A.$(".main-video")),p.ConfigManager.setConfig("CheckDeviceOffset",d).fail(function(){q.hide(),webApp.hide_by_dialog=!0,a.alert(tl("per.PtzStartingTip")+tl("com.SaveConfigFailTip"),function(){webApp.hide_by_dialog=!1,"hls"!==webApp.playMode&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode&&q.cover(A.$(".main-video"))})})})):(a(b.target).removeClass("current"),d.Enable=c,p.ConfigManager.setConfig("CheckDeviceOffset",d))},onRainBrushCtrl:function(){A.$("div.ui-rainBrush-wrap").hasClass("fn-hide")?A.$("div.ui-rainBrush-wrap").removeClass("fn-hide"):A.$("div.ui-rainBrush-wrap").addClass("fn-hide"),A.$("div.ui-rainBrush-wrap a").off("click").on("click",function(){switch(A.$("div.ui-rainBrush-wrap a").css("color","#FFF"),a(this).css("color","#FFAD37"),A.$("div.ui-rainBrush-wrap").addClass("fn-hide"),a(this).attr("mark")){case"start":p.ConfigManager.getConfig("RainBrush").done(function(a){var b=~~a.Interval;p.RainBrush.moveContinuously(b)});break;case"close":p.RainBrush.stopMove();break;case"once":p.RainBrush.moveOnce()}}),A.$("#b_duckdrawn")&&"none"!==A.$("#duck_wrap").css("display")&&(A.$("#duck_wrap").css("display","none"),A.$("#b_duckdrawn").removeClass("main-top-duck-draw-current")),A.$("div.ui-ClearFrostHeater-wrap")&&"none"!==A.$("div.ui-ClearFrostHeater-wrap").css("display")&&A.$("div.ui-ClearFrostHeater-wrap").addClass("fn-hide")},onClearFrostHeater:function(){A.$("div.ui-ClearFrostHeater-wrap").hasClass("fn-hide")?A.$("div.ui-ClearFrostHeater-wrap").removeClass("fn-hide"):A.$("div.ui-ClearFrostHeater-wrap").addClass("fn-hide"),A.$("div.ui-ClearFrostHeater-wrap a").off("click").on("click",function(){switch(A.$("div.ui-ClearFrostHeater-wrap a").css("color","#FFF"),a(this).css("color","#FFAD37"),A.$("div.ui-ClearFrostHeater-wrap").addClass("fn-hide"),a(this).attr("mark")){case"start":p.PtzPeripheral.startClearFrost();break;case"close":p.PtzPeripheral.stopClearFrost()}}),A.$("div.ui-rainBrush-wrap")&&"none"!==A.$("div.ui-rainBrush-wrap").css("display")&&A.$("div.ui-rainBrush-wrap").addClass("fn-hide"),A.$("#b_duckdrawn")&&"none"!==A.$("#duck_wrap").css("display")&&(A.$("#duck_wrap").css("display","none"),A.$("#b_duckdrawn").removeClass("main-top-duck-draw-current"))},_videoDelayMax:function(){if(1===bb){var a=["Encode"];p.ConfigManager.getConfig(a).done(function(a){var b=a[0].params.table[0].ExtraFormat[0],c=a[0].params.table[0].ExtraFormat[1];b.VideoEnable?A.$('[btn-for="onConnectExtra"][index = 1]').hasClass("current")||(A.$('[btn-for="onConnectExtra"][index = 1]').click(),w.showAutoSwitch(!0,tl("med.autoSwitchEncodeMode")),bb=1):c.VideoEnable?A.$('[btn-for="onConnectExtra"][index = 2]').hasClass("current")||(A.$('[btn-for="onConnectExtra"][index = 2]').click(),w.showAutoSwitch(!0,tl("med.autoSwitchEncodeMode")),bb=1):(w.showAutoSwitch(!0,tl("med.openExtraStream")),bb=0)}).fail(function(){bb=0})}},getEncryptServerUrl:function(a){var b="/cgi-bin/Snapshot.cgi?sessionId="+a;return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&(b=o.getEncryptServerUrl("/cgi-bin/Snapshot.cgi?","sessionId="+a)),b}});var eb=null,fb=null,gb={support:!1,login:!1,init:function(){r.get("WideViewControl").done(function(a){a&&a[0]&&a[0].Support&&s.chkAuthority("MPTZ")&&(gb.support=!0,gb._loginWideView(),gb.render())})},render:function(){gb.support&&p.ConfigManager.getConfig("WideViewControl").done(function(a){gb.config=a,(gb.config&&gb.config[0].Enable&&""!==q.type)!==E.videoBar("isCurrent","video_wideview")&&E.videoBar("toggleCurrent","video_wideview")})},leave:function(){gb.support&&E.videoBar("isCurrent","video_wideview")&&E.videoBar("toggleCurrent","video_wideview")},destory:function(){gb.support&&gb.login&&q.LogoutWideView()},_loginWideView:function(){gb.login!==!0&&q.LoginWideView(q.ip,q.port,s.getLoginInfo().username,s.getLoginInfo().password,0).done(function(b){if(b){var c={1:tl("Password is error."),2:tl("com.AccoutNonentityTip"),3:tl("com.LogInOvertimeTip"),4:tl("com.AccoutLogedTip"),5:tl("com.AccoutLockTip"),6:tl("com.AccoutBlackedTip"),7:tl("com.SystemIsBusyingTip"),8:tl("com.SubConnectFailTip"),9:tl("com.MainConnectFail"),10:tl("com.MaximumConnectTip")};q.hide(),webApp.hide_by_dialog=!0,a.alert(tl("ivs.WideView")+c[b]||tl("com.LoginControlFailureTip"),function(){webApp.hide_by_dialog=!1,"hls"!=webApp.playMode&&"flash"!=webApp.playMode&&"h5"!=webApp.playMode&&q.cover(A.$(".main-video"))})}else gb.login=!0})}}})}(jQuery);