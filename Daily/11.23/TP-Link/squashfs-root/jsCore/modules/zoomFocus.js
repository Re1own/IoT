!function(a){define(function(require,b,c){function d(b,c){var d=this;d.options=a.extend({},l,c),d.e=a(b),d.e.empty().append(a(i).siblings("[zf-type="+d.options.type+"]")).translation(),a.when(g.get("VideoInputCapsEx"),g.get("VideoInputCaps"),g.get("BFFunction")).done(function(a,b,c){var e=d.$("#zf_title"),f="itc.ZoomFocus";a&&a.VideoInFocus&&a.VideoInFocus.SupportFocusRegion&&"flash"!==webApp.playMode&&"h5"!==webApp.playMode?d.$("#zf_Region").show():d.$("#zf_Region").hide(),a&&a.ABFFunction.Support&&(f="med.Focus",d.$("#zf_zoom").hide(),d.$("[name=desc]").hide()),b&&b.SyncFocus&&(f="itc.Zoom",d.$("#zf_focus").hide(),d.$("#zff_AutoFocus").hide(),d.$("[name=desc]").hide()),c&&c.Support&&(f="med.ABF",d.$("#zf_zoom").hide(),d.$("[name=desc]").hide(),m=c.Support,d.$("#zff_AutoFocus").find("label").attr("t","med.ABF").parent().translation()),e.attr("t",f).parent().translation()}),d.init()}function e(a,b){void 0===b&&(b=!0),a.prop("disabled",b),b?a.addClass("disabled"):a.removeClass("disabled")}var f=require("../plugin"),g=require("../ability"),h=require("../rpc"),i=require("./zoomFocus.html");require("widget/js/dui.slider");var j,k,l={type:"setting",noPlugin:!1},m=null;a.fn.zoomFocus=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){var f=a(this),g=f.data("zoomFocus");if(g||f.data("zoomFocus",g=new d(f,b)),"string"===a.type(b)&&a.isFunction(g[b])){var h=g[b].apply(g,c);if(void 0!==h)return e=h,!1}}),e},d.prototype.init=function(){var b=this;b.b_zoom=!1,b.b_focus=!1,b.b_autofocus=!1;var c=m?h.LensFunc.getBackFocusStatus():h.DevVideoInput.getFocusStatus();b.initSlider=c.always(function(a){j=a.ZoomMotorSteps||2e3,k=a.FocusMotorSteps||2e3,b.$("#zfz_slider").slider({prompt:!1,min:0,max:j,change:function(){b.b_zoom=!0,b.b_autofocus=!1},complete:function(a,c){b.b_zoom=!0,b.b_autofocus=!1,b.$("#zfz_slider").slider("disable"),h.DevVideoInput.adjustFocus(b.$("#zff_slider").slider("value")/k,c.value/j).done(function(){b.b_normal=0,window.setTimeout(function(){b.getStatusByRPC()},500)}),b.options.noPlugin&&b.getStatusByRPC()},start:function(a,c){h.DevVideoInput.adjustFocusContinuously(-1,"add"===c.oper?.032:-.032),b.b_normal=0,b.options.noPlugin&&b.getStatusByRPC()},end:function(){h.DevVideoInput.adjustFocusContinuously(-1,0),b.b_normal=0}}),b.$("#zff_slider").slider({prompt:!1,min:0,max:k,timer:m?!1:!0,change:function(){b.b_focus=!0,b.b_autofocus=!1},complete:function(a,c){function d(){b.b_focus=!0,b.b_autofocus=!1,b.$("#zfz_slider").slider("disable"),m?h.LensFunc.backFocusAbsolutely(c.value/k).done(function(){window.setTimeout(function(){b.getStatusByRPC()},500)}):h.DevVideoInput.adjustFocus(c.value/k,b.$("#zfz_slider").slider("value")/j,0).done(function(){b.b_normal=0,b.options.noPlugin?b.getStatusByRPC():window.setTimeout(function(){b.getStatusByRPC()},500)})}!b.b_focus&&!b.b_zoom||m?d():h.DevVideoInput.stopAutoFocus().done(d)},start:function(a,c){function d(){if(m){var a=b.$("#zff_step").val()-0;h.LensFunc.backFocusContinuously("add"===c.oper?.001*a:.001*-a).done(function(){window.setTimeout(function(){b.getStatusByRPC()},500)})}else h.DevVideoInput.adjustFocusContinuously("add"===c.oper?.02:-.02,-1),b.b_normal=0,b.options.noPlugin&&b.getStatusByRPC()}!b.b_focus&&!b.b_zoom||m?d():h.DevVideoInput.stopAutoFocus().done(d)},end:function(){m?h.LensFunc.backFocusContinuously(0):(h.DevVideoInput.adjustFocusContinuously(0,-1),b.b_normal=0)}})}),b.$(".u-tab").tab(),b.$("#zfz_step").on("change",function(){return b.$("#zfz_slider").slider("step",a(this).val()-0),!1}),b.$("#zff_step").on("change",function(){return b.$("#zff_slider").slider("step",a(this).val()-0),!1}),b.$("#zff_AutoFocus").on("click",function(){return b.$(this).prop("disabled")?!1:(m?h.LensFunc.autoBackFocus():h.DevVideoInput.autoFocus(),b.options.noPlugin&&(b.b_autofocus=!0,b.getStatusByRPC()),!1)}),b.$("#zf_Refresh").on("click",function(){return b.$(this).prop("disabled")?!1:(b._getStatus(),!1)}),b.$("#zf_Restory").on("click",function(){return b.$(this).prop("disabled")?!1:(b.$("#zfz_step").val(20).change(),b.$("#zff_step").val(20).change(),m?h.LensFunc.resetBackFocus():(h.DevVideoInput.adjustFocus(-1,-1),b.b_normal=0,b.options.noPlugin&&(b.b_autofocus=!0,b.getStatusByRPC())),!1)}),b.$("#zf_Region").on("click",function(){var a=b.$(this);return a.prop("disabled")?!1:(f.activeLocalFocus(a),!1)})},d.prototype.render=function(){var a=this;a.initSlider.always(function(){f.addEvent("FocusZoomStatus",function(b,c,d){(!a.b_zoom&&!a.b_focus||"Normal"!==d||a.b_autofocus)&&(a.b_zoom||a.$("#zfz_slider").slider("value",c*j,!1),a.b_focus||a.$("#zff_slider").slider("value",b*k,!1),"Normal"===d?(a.b_zoom=!1,a.b_focus=!1,e(a.$("a.u-button"),!1),a.$("#zfz_slider").slider("enable")):(a.b_autofocus=!0,e(a.$("a.u-button"))))}),a.$("#zfz_step").val(20).change(),a.$("#zff_step").val(20).change(),a._getStatus()})},d.prototype.leave=function(){f.addEvent("FocusZoomStatus",null),f.state("activeLocalFocus")&&f.state("activeLocalFocus",!1)},d.prototype.$=function(a){return this.e.find(a)},d.prototype._getStatus=function(){var a=arguments,b=this;e(b.$("a.u-button")),m?h.LensFunc.getBackFocusStatus().done(function(c){b.$("#zff_slider").slider("value",c.BackFocus.toFixed(6)*k,!1),"Autobackfocus"===c.Status?(e(b.$("a.u-button")),setTimeout(function(){a.callee.call(b)},1e3)):e(b.$("a.u-button"),!1)}).fail(function(a){a&&a.error&&403===a.error.code&&e(b.$("a.u-button"))}):h.DevVideoInput.getFocusStatus().done(function(c){b.$("#zfz_slider").slider("value",c.Zoom.toFixed(6)*j,!1),b.$("#zff_slider").slider("value",c.Focus.toFixed(6)*k,!1),"Autofocus"===c.Status?(e(b.$("a.u-button")),a.callee.call(b)):e(b.$("a.u-button"),!1)}).fail(function(a){a&&a.error&&403===a.error.code&&e(b.$("a.u-button"))})},d.prototype.getStatusByRPC=function(){var a=(arguments,this);m?h.LensFunc.getBackFocusStatus().done(function(b){"Normal"!=b.Status?setTimeout(function(){a.getStatusByRPC()},1e3):(a.$("#zff_slider").slider("value",b.BackFocus.toFixed(6)*k,!1),a.$("#zfz_slider").slider("enable"),e(a.$("a.u-button"),!1))}):h.DevVideoInput.getFocusStatus().done(function(b){"Normal"!=b.Status?(a.b_normal=0,a.options.noPlugin&&(a.b_autofocus=!0,e(a.$("a.u-button")),!a.b_zoom&&a.$("#zfz_slider").slider("value",b.Zoom.toFixed(6)*j,!1),!a.b_focus&&a.$("#zff_slider").slider("value",b.Focus.toFixed(6)*k,!1)),a.getStatusByRPC()):a.b_autofocus&&5!==a.b_normal?a.b_normal<5&&(a.getStatusByRPC(),a.b_normal=a.b_normal+1):(a.$("#zfz_slider").slider("value",b.Zoom.toFixed(6)*j,!1),a.$("#zff_slider").slider("value",b.Focus.toFixed(6)*k,!1),a.b_normal=0,a.b_zoom=!1,a.b_focus=!1,a.b_autofocus=!1,a.$("#zfz_slider").slider("enable"),e(a.$("a.u-button"),!1))})},c.exports=d})}(jQuery);