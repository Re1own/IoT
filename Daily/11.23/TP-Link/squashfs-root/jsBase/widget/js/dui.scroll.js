!function(a){a.widget("dui.scroll",{version:"1.0.1",widgetName:"scroll",widgetEventPrefix:"scroll",options:{scrollYEnable:!0,scrollXEnable:!1,btnEnable:!1,wheelStep:3,btnStep:30,contentWrap:null,content:null,xBar:null,yBar:null,actionList:{left:null,right:null,x:null,up:null,down:null,y:null}},_create:function(){var b=this.element;this.scrollYShow=!1,this.scrollXShow=!1,this.actionList={},this.contentWrap=b.find(this.options.contentWrap),this.content=b.find(this.options.content),this.yBar=b.find(this.options.yBar),this.xBar=b.find(this.options.xBar),this.barWidth=this.yBar.width()||this.xBar.height();var c=this.actionList;if(a.each(this.options.actionList,function(a,d){c[a]=b.find(d).attr("action",a)}),this.options.btnEnable){var d=c.up.width()||c.left.height(),e=c.up.height()||c.left.width();this.btnSize=[d,e]}else this.btnSize=[0,0];this.dragLen=c.y.height()||c.x.width(),this._setupEvents(),this.resize()},_setupEvents:function(){this._on(this._handleEvents)},_handleEvents:{"click [action]":function(b){var c=a(b.target).attr("action");return"x"===c||"y"===c?!1:void this._srcollByBtn(c)},"mousedown [action]":function(b){var c=a(b.target).attr("action");if("x"!==c&&"y"!==c)return!1;var d=this,e=a(b.target).offset(),f={x:b.pageX-e.left,y:b.pageY-e.top};a(document).on("mousemove.duiscroll",function(a){a.stopPropagation(),d._srcollByDrag(a,c,f)}).on("mouseup.duiscroll",function(){b.stopPropagation(),a(document).unbind("mousemove.duiscroll mouseup.duiscroll selectstart.duiscroll")}).on("selectstart.duiscroll",function(){return!1})},mousewheel:"_scrollByWheel"},_srcollByDrag:function(a,b,c){var d=this.actionList[b],e=d.position(),f=this.content.position(),g={left:e.left,top:e.top},h={left:f.left,top:f.top};"x"===b?(g.left=a.pageX-this.barOffsetPos.x.left-c.x,h.left=-this.xRate*(g.left-this.xLimit[0])):(g.top=a.pageY-this.barOffsetPos.y.top-c.y,h.top=-this.yRate*(g.top-this.yLimit[0]));var i=this._limitPosition(g,h,b);this.content.css({left:i[1].left,top:i[1].top}),d.css({left:i[0].left,top:i[0].top})},_scrollByWheel:function(a,b){if(!this.options.scrollYEnable)return!1;a.preventDefault(),b=-b;var c={x:0,y:0};c.y=this.options.wheelStep*b,this._setPosition(c)},_srcollByBtn:function(a){var b={x:0,y:0},c=this.options.btnStep;switch(a){case"up":b.y-=c;break;case"down":b.y+=c;break;case"left":b.x-=c;break;case"right":b.x+=c}this._setPosition(b)},_setPosition:function(a){var b=a.x?"x":"y",c=this.actionList[b],d=this.content.position(),e=c.position(),f={left:e.left+a.x,top:e.top+a.y},g={x:0,y:0};g[b]=this[b+"Rate"]*a[b];var h={left:d.left-g.x,top:d.top-g.y},i=this._limitPosition(f,h,b);this.content.css({left:i[1].left,top:i[1].top}),c.css({left:i[0].left,top:i[0].top})},_limitPosition:function(a,b,c){var d=this[c+"Limit"],e=this.contentLimit[c],f="y"===c?"top":"left";return b[f]>0||a[f]<d[0]?(b[f]=0,a[f]=d[0]):(Math.abs(b[f])>e[1]||a[f]>d[1])&&(b[f]=-e[1],a[f]=d[1]),[a,b]},resize:function(){this.elementSize=[this.element.width(),this.element.height()],this.contentWrapSize=[this.elementSize[0],this.elementSize[1]],this.contentSize=[this.content.width(),this.content.height()],this.options.scrollYEnable&&this.contentSize[1]>this.contentWrapSize[1]?(this.scrollYShow=!0,this.contentWrapSize[0]=this.elementSize[0]-this.barWidth,this.yBar.show()):(this.scrollYShow=!1,this.yBar.hide(),this.content.css("top",0)),this.options.scrollXEnable&&this.contentSize[0]>this.contentWrapSize[0]?(this.scrollXShow=!0,this.contentWrapSize[1]=this.elementSize[1]-this.barWidth,this.xBar.show()):(this.scrollXShow=!1,this.xBar.hide(),this.content.css("left",0)),this.contentWrap.css({width:this.contentWrapSize[0],height:this.contentWrapSize[1]}),this.contentLimit={x:[0,Math.max(0,this.contentSize[0]-this.contentWrapSize[0])],y:[0,Math.max(0,this.contentSize[1]-this.contentWrapSize[1])]};var a=this.btnSize[1];this.yLimit=[a,this.contentWrapSize[1]-a-this.dragLen],this.xLimit=[a,this.contentWrapSize[0]-a-this.dragLen],this.barOffsetPos={x:{left:0,top:0},y:{left:0,top:0}},this.scrollYShow&&(this.yBar.css("height",this.contentWrapSize[1]),this.yRate=this.contentLimit.y[1]/(this.yLimit[1]-this.yLimit[0]),this.barOffsetPos.y.top=this.yBar.offset().top),this.scrollXShow&&(this.xBar.css("width",this.contentWrapSize[0]),this.xRate=this.contentLimit.x[1]/(this.xLimit[1]-this.xLimit[0]),this.barOffsetPos.x.left=this.xBar.offset().left),this._setPositionByResize()},_setPositionByResize:function(){var a=this.content.position();if(this.scrollYShow){var b=this.yLimit[0]+1/this.yRate*Math.abs(a.top);this.actionList.y.css("top",b)}if(this.scrollXShow){var c=this.xLimit[0]+1/this.xRate*Math.abs(a.left);this.actionList.x.css("left",c)}}})}(jQuery);